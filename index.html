<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XRP ETF Tracker</title>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-JFYKZKVTMZ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-JFYKZKVTMZ');
    </script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-card: #16161f;
            --bg-card-hover: #1a1a25;
            --border: #2a2a3a;
            --text-primary: #ffffff;
            --text-secondary: #a0a0c0; /* Improved contrast */
            --text-muted: #707085;      /* Improved contrast */
            --accent-xrp: #23f7dd;
            --accent-xrp-dim: rgba(35, 247, 221, 0.15);
            --accent-green: #22c55e;
            --accent-red: #ef4444;
            --accent-blue: #3b82f6;
            --accent-purple: #a855f7;
            --accent-orange: #f97316;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .bg-grid {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                linear-gradient(rgba(35, 247, 221, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(35, 247, 221, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: 0;
        }

        .bg-glow {
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at 30% 20%, rgba(35, 247, 221, 0.08) 0%, transparent 50%),
                        radial-gradient(circle at 70% 80%, rgba(168, 85, 247, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
            animation: glowPulse 15s ease-in-out infinite;
        }

        @keyframes glowPulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }

        .container {
            position: relative;
            z-index: 1;
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--border);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--accent-xrp), var(--accent-purple));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--bg-primary);
        }

        .logo h1 {
            font-size: 1.8rem;
            font-weight: 600;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-xrp) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-meta {
            text-align: right;
        }

        .xrp-price {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: linear-gradient(135deg, var(--accent-xrp-dim), rgba(168, 85, 247, 0.1));
            border: 1px solid var(--accent-xrp);
            border-radius: 12px;
            padding: 0.75rem 1.5rem;
        }

        .xrp-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .xrp-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-xrp);
            font-family: 'JetBrains Mono', monospace;
        }

        .xrp-change {
            font-size: 0.8rem;
            margin-top: 0.25rem;
        }

        .xrp-change.positive {
            color: var(--accent-green);
        }

        .xrp-change.negative {
            color: var(--accent-red);
        }

        .twitter-handle {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 0.75rem 1.5rem;
            text-decoration: none;
            transition: all 0.2s ease;
        }

        .twitter-handle:hover {
            border-color: var(--accent-xrp);
            background: var(--bg-card-hover);
            transform: translateY(-2px);
        }

        .twitter-icon {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .twitter-name {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-top: 0.25rem;
        }

        .twitter-user {
            font-size: 0.75rem;
            color: var(--accent-xrp);
        }

        .site-link {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 0.75rem 1.5rem;
            text-decoration: none;
            transition: all 0.2s ease;
        }

        .site-link:hover {
            border-color: var(--accent-purple);
            background: var(--bg-card-hover);
            transform: translateY(-2px);
        }

        .site-link-icon {
            font-size: 1.2rem;
        }

        .site-link-name {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-top: 0.25rem;
        }

        .site-link-desc {
            font-size: 0.75rem;
            color: var(--accent-purple);
        }

        .last-updated {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
        }

        .status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.4rem 0.8rem;
            background: var(--accent-xrp-dim);
            border-radius: 20px;
            font-size: 0.8rem;
            color: var(--accent-xrp);
            font-weight: 500;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: var(--accent-xrp);
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.8); }
        }

        .auto-refresh-info {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 0.5rem;
        }

        .controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.7rem 1.2rem;
            border: 1px solid var(--border);
            background: var(--bg-card);
            color: var(--text-secondary);
            border-radius: 8px;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .btn:hover {
            background: var(--bg-card-hover);
            border-color: var(--accent-xrp);
            color: var(--text-primary);
        }

        .btn.active {
            background: var(--accent-xrp-dim);
            border-color: var(--accent-xrp);
            color: var(--accent-xrp);
        }

        .btn-refresh {
            margin-left: auto;
            background: linear-gradient(135deg, var(--accent-xrp), #1ed9c0);
            border: none;
            color: var(--bg-primary);
            font-weight: 600;
        }

        .btn-refresh:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(35, 247, 221, 0.3);
        }

        .btn-refresh:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 6rem 2rem;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 3px solid var(--border);
            border-top-color: var(--accent-xrp);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 1.5rem;
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .error-container {
            text-align: center;
            padding: 4rem 2rem;
        }

        .error-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .error-message {
            color: var(--accent-red);
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }

        .error-hint {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-bottom: 1.5rem;
        }

        .etf-groups {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .etf-group {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            overflow: hidden;
            animation: fadeSlideIn 0.5s ease forwards;
            opacity: 0;
            transform: translateY(20px);
        }

        .etf-group:nth-child(1) { animation-delay: 0.1s; }
        .etf-group:nth-child(2) { animation-delay: 0.2s; }
        .etf-group:nth-child(3) { animation-delay: 0.3s; }
        .etf-group:nth-child(4) { animation-delay: 0.4s; }

        @keyframes fadeSlideIn {
            to { opacity: 1; transform: translateY(0); }
        }

        .group-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.25rem 1.5rem;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
        }

        .group-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .group-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }

        .group-icon.index { background: rgba(59, 130, 246, 0.2); }
        .group-icon.spot { background: rgba(34, 197, 94, 0.2); }
        .group-icon.futures { background: rgba(249, 115, 22, 0.2); }
        .group-icon.canada { background: rgba(168, 85, 247, 0.2); }

        .group-name {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .group-count {
            font-size: 0.85rem;
            color: var(--text-muted);
            background: var(--bg-card);
            padding: 0.3rem 0.7rem;
            border-radius: 20px;
        }

        .table-wrapper {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            padding: 1rem 1.25rem;
            text-align: left;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            border-bottom: 1px solid var(--border);
            white-space: nowrap;
        }

        th.right {
            text-align: right;
        }

        td {
            padding: 1rem 1.25rem;
            border-bottom: 1px solid var(--border);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover {
            background: var(--bg-card-hover);
        }

        tr.total-row {
            background: var(--bg-secondary);
            font-weight: 600;
        }

        tr.total-row:hover {
            background: var(--bg-secondary);
        }

        tr.total-row td {
            border-top: 2px solid var(--accent-xrp);
            color: var(--accent-xrp);
        }

        .symbol-cell {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .symbol-badge {
            font-weight: 600;
            color: var(--accent-xrp);
            font-family: 'JetBrains Mono', monospace;
        }

        .symbol-desc {
            font-size: 0.8rem;
            color: var(--text-muted);
            font-family: 'Outfit', sans-serif;
        }

        .price {
            font-weight: 600;
            color: var(--text-primary);
        }

        .volume-cell {
            text-align: right;
        }

        .volume-shares {
            color: var(--text-secondary);
        }

        .volume-dollars {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 0.2rem;
        }

        .no-data {
            color: var(--text-muted);
            font-style: italic;
            font-family: 'Outfit', sans-serif;
        }

        footer {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border);
            text-align: center;
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        footer a {
            color: var(--accent-xrp);
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
        }

        .api-config {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .api-config label {
            display: block;
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .api-input-group {
            display: flex;
            gap: 0.75rem;
        }

        .api-input-group input {
            flex: 1;
            padding: 0.75rem 1rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
        }

        .api-input-group input:focus {
            outline: none;
            border-color: var(--accent-xrp);
        }

        .api-input-group input::placeholder {
            color: var(--text-muted);
        }

        .grand-total {
            background: linear-gradient(135deg, var(--bg-card), var(--bg-secondary));
            border: 2px solid var(--accent-xrp);
            border-radius: 16px;
            padding: 1.5rem;
            margin-top: 2rem;
        }

        .grand-total h3 {
            color: var(--accent-xrp);
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }

        .grand-total-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .grand-total-item {
            background: var(--bg-primary);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }

        .grand-total-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
        }

        .grand-total-value {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            header {
                flex-direction: column;
                gap: 1.5rem;
                text-align: center;
            }

            .header-meta {
                text-align: center;
            }

            .controls {
                justify-content: center;
            }

            .btn-refresh {
                margin-left: 0;
                width: 100%;
            }

            th, td {
                padding: 0.75rem;
                font-size: 0.8rem;
            }

            .api-input-group {
                flex-direction: column;
            }

            .dashboard-metrics {
                grid-template-columns: 1fr;
            }

            .dashboard-metric-value {
                font-size: 1.4rem;
            }

            .main-tabs {
                flex-direction: column;
            }

            .main-tab {
                padding: 0.8rem;
            }

            .holdings-summary {
                grid-template-columns: repeat(2, 1fr);
            }

            .exchange-charts-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Follow Popup Modal */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .popup-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .popup-modal {
            background: linear-gradient(135deg, var(--bg-card), var(--bg-secondary));
            border: 2px solid var(--accent-xrp);
            border-radius: 20px;
            padding: 2.5rem;
            max-width: 400px;
            width: 90%;
            text-align: center;
            position: relative;
            transform: scale(0.8);
            transition: transform 0.3s ease;
            box-shadow: 0 20px 60px rgba(35, 247, 221, 0.2);
        }

        .popup-overlay.active .popup-modal {
            transform: scale(1);
        }

        .popup-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .popup-close:hover {
            color: var(--text-primary);
        }

        .popup-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            animation: bounce 1s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .popup-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
        }

        .popup-text {
            color: var(--text-secondary);
            font-size: 1rem;
            margin-bottom: 1.5rem;
            line-height: 1.5;
        }

        .popup-follow-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            background: linear-gradient(135deg, var(--accent-xrp), #1ed9c0);
            color: var(--bg-primary);
            font-size: 1.1rem;
            font-weight: 700;
            padding: 1rem 2rem;
            border-radius: 50px;
            text-decoration: none;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 1rem;
        }

        .popup-follow-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(35, 247, 221, 0.4);
        }

        .popup-x-icon {
            font-size: 1.3rem;
            font-weight: 900;
        }

        .popup-later {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 0.9rem;
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .popup-later:hover {
            color: var(--text-secondary);
        }

        /* Chart Button */
        .btn-chart {
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue));
            border: none;
            color: white;
            font-weight: 600;
        }

        .btn-chart:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(168, 85, 247, 0.3);
            color: white;
        }

        /* Chart Modal */
        .chart-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .chart-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .chart-modal {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 1.5rem;
            width: 95%;
            max-width: 1200px;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .chart-overlay.active .chart-modal {
            transform: scale(1);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .chart-header h2 {
            font-size: 1.5rem;
            color: var(--text-primary);
        }

        .chart-close {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 2rem;
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .chart-close:hover {
            color: var(--text-primary);
        }

        .chart-controls {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .chart-tab {
            padding: 0.6rem 1.2rem;
            border: 1px solid var(--border);
            background: var(--bg-secondary);
            color: var(--text-secondary);
            border-radius: 8px;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }

        .chart-tab:hover {
            border-color: var(--accent-purple);
            color: var(--text-primary);
        }

        .chart-tab.active {
            background: var(--accent-purple);
            border-color: var(--accent-purple);
            color: white;
        }

        .chart-period-controls {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .chart-period {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border);
            background: var(--bg-secondary);
            color: var(--text-secondary);
            border-radius: 6px;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.8rem;
            transition: all 0.2s ease;
        }

        .chart-period:hover {
            border-color: var(--accent-xrp);
            color: var(--text-primary);
        }

        .chart-period.active {
            background: var(--accent-xrp-dim);
            border-color: var(--accent-xrp);
            color: var(--accent-xrp);
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 1rem;
        }

        .chart-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 400px;
            color: var(--text-muted);
        }

        .chart-loading .spinner {
            width: 40px;
            height: 40px;
            margin-bottom: 1rem;
        }

        .chart-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            justify-content: center;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }

        /* Main Tab Navigation */
        .main-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            background: var(--bg-card);
            padding: 0.5rem;
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .main-tab {
            flex: 1;
            padding: 1rem 1.5rem;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            border-radius: 8px;
            cursor: pointer;
            font-family: inherit;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .main-tab:hover {
            background: var(--bg-card-hover);
            color: var(--text-primary);
        }

        .main-tab.active {
            background: linear-gradient(135deg, var(--accent-xrp), #1ed9c0);
            color: var(--bg-primary);
        }

        .main-tab-icon {
            font-size: 1.2rem;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Holdings Tracker Styles */
        .holdings-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .summary-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.25rem;
            text-align: center;
            transition: transform 0.3s ease, border-color 0.3s ease;
        }

        .summary-card:hover {
            transform: translateY(-3px);
            border-color: var(--accent-xrp);
        }

        .summary-card.highlight {
            border-color: var(--accent-xrp);
            background: linear-gradient(135deg, var(--bg-card), var(--accent-xrp-dim));
        }

        .summary-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }

        .summary-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
        }

        .summary-value.accent {
            color: var(--accent-xrp);
        }

        .holdings-table-container {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            overflow: hidden;
        }

        .holdings-table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.25rem 1.5rem;
            background: var(--bg-secondary);
            border-bottom: 2px solid var(--accent-xrp);
        }

        .holdings-table-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .holdings-table-wrapper {
            overflow-x: auto;
            max-height: 600px;
            overflow-y: auto;
        }

        .holdings-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1200px;
        }

        .holdings-table th {
            position: sticky;
            top: 0;
            background: var(--bg-secondary);
            z-index: 10;
            padding: 1rem;
            text-align: right;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            border-bottom: 2px solid var(--accent-xrp);
            white-space: nowrap;
        }

        .holdings-table th:first-child {
            text-align: left;
        }

        .holdings-table th.etf-header {
            text-align: center;
            background: linear-gradient(135deg, var(--bg-secondary), var(--bg-card));
        }

        .holdings-table th.sub-header {
            font-size: 0.65rem;
            color: var(--accent-xrp);
        }

        .holdings-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            text-align: right;
        }

        .holdings-table td:first-child {
            text-align: left;
            font-weight: 600;
            color: var(--accent-xrp);
        }

        .holdings-table tr:hover {
            background: var(--bg-card-hover);
        }

        .holdings-table .value-cell {
            color: var(--text-muted);
            font-size: 0.75rem;
        }

        .holdings-table .xrp-cell {
            color: var(--text-primary);
        }

        .holdings-table .no-data {
            color: var(--text-muted);
            font-style: italic;
        }

        .etf-column-group {
            border-left: 1px solid var(--border);
        }

        /* Data Update Section */
        .data-update-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 2rem;
        }

        .data-update-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .update-methods {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .update-method {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 1.25rem;
        }

        .update-method h4 {
            font-size: 0.9rem;
            color: var(--accent-xrp);
            margin-bottom: 0.75rem;
        }

        .update-method p {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .update-method code {
            background: var(--bg-primary);
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-size: 0.8rem;
            color: var(--accent-xrp);
        }

        .csv-upload-area {
            border: 2px dashed var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1rem;
        }

        .csv-upload-area:hover {
            border-color: var(--accent-xrp);
            background: var(--accent-xrp-dim);
        }

        .csv-upload-area input {
            display: none;
        }

        .upload-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .upload-text {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Exchange Tab Styles */
        .exchange-controls-bar {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            align-items: center;
        }

        /* Holdings Chart Section */
        .holdings-chart-section {
            margin-bottom: 2rem;
        }

        .holdings-chart-container {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .holdings-chart-container:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .holdings-chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            background: var(--bg-secondary);
            border-bottom: 2px solid var(--accent-xrp);
            flex-wrap: wrap;
            gap: 1rem;
        }

        .holdings-chart-controls {
            display: flex;
            gap: 0.5rem;
        }

        .chart-type-btn {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
        }

        .chart-type-btn.active {
            background: var(--accent-xrp-dim);
            border-color: var(--accent-xrp);
            color: var(--accent-xrp);
        }

        .holdings-chart-wrapper {
            padding: 1.5rem;
            height: 350px;
        }

        .exchange-controls-bar {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .exchange-filter-input {
            flex: 1;
            min-width: 200px;
            padding: 0.7rem 1rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.9rem;
        }

        .exchange-filter-input:focus {
            outline: none;
            border-color: var(--accent-xrp);
        }

        .exchange-filter-input::placeholder {
            color: var(--text-muted);
        }

        .exchange-info-banner {
            display: flex;
            gap: 0.75rem;
            align-items: flex-start;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-left: 3px solid var(--accent-xrp);
            border-radius: 8px;
            padding: 1rem 1.25rem;
            margin-bottom: 1.5rem;
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .exchange-info-banner a {
            color: var(--accent-xrp);
            text-decoration: none;
        }

        .exchange-info-banner a:hover {
            text-decoration: underline;
        }

        .exchange-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem;
            color: var(--text-muted);
        }

        .exchange-loading .spinner {
            width: 40px;
            height: 40px;
            margin-bottom: 1rem;
        }

        .exchange-progress {
            width: 100%;
            max-width: 300px;
            height: 6px;
            background: var(--bg-secondary);
            border-radius: 3px;
            margin-top: 1rem;
            overflow: hidden;
        }

        .exchange-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-xrp), var(--accent-purple));
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        /* ============================================
           NEW UI/UX IMPROVEMENTS
           ============================================ */

        /* Dashboard Overview Section */
        .dashboard-overview {
            background: linear-gradient(135deg, var(--bg-card), var(--bg-secondary));
            border: 2px solid var(--accent-xrp);
            border-radius: 20px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(35, 247, 221, 0.1);
        }

        .dashboard-overview::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 20% 50%, rgba(35, 247, 221, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .dashboard-overview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .dashboard-overview-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--accent-xrp);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 250px;
            gap: 1.5rem;
        }

        @media (max-width: 900px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        .dashboard-metrics {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .dashboard-metric {
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 1.25rem;
            position: relative;
            border: 1px solid var(--border);
            transition: transform 0.3s ease, border-color 0.3s ease;
        }

        .dashboard-metric:hover {
            transform: translateY(-5px);
            border-color: var(--accent-xrp);
        }

        .dashboard-metric-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }

        .dashboard-metric-value {
            font-size: 1.8rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            color: var(--text-primary);
            transition: color 0.3s ease;
        }

        .dashboard-metric-value.animated {
            transition: all 0.5s ease;
        }

        .dashboard-metric-change {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.8rem;
            margin-top: 0.5rem;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
        }

        .dashboard-metric-change.positive {
            background: rgba(34, 197, 94, 0.15);
            color: var(--accent-green);
        }

        .dashboard-metric-change.negative {
            background: rgba(239, 68, 68, 0.15);
            color: var(--accent-red);
        }

        .dashboard-pie-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .dashboard-pie-chart {
            width: 200px;
            height: 200px;
        }

        .dashboard-pie-legend {
            display: flex;
            gap: 1.5rem;
            margin-top: 1rem;
            font-size: 0.85rem;
        }

        .pie-legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .pie-legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        /* Animated Number Counter */
        .counter-value {
            display: inline-block;
        }

        @keyframes countUp {
            from { opacity: 0.5; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .counter-animate {
            animation: countUp 0.5s ease forwards;
        }

        /* Holdings Trend Chart */
        .trend-chart-section {
            margin-bottom: 2rem;
        }

        .trend-chart-container {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .trend-chart-container:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .trend-chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            background: var(--bg-secondary);
            border-bottom: 2px solid var(--accent-xrp);
            flex-wrap: wrap;
            gap: 1rem;
        }

        .trend-chart-wrapper {
            padding: 1.5rem;
            height: 300px;
        }

        /* Daily Change Indicators */
        .change-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.15rem 0.4rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .change-indicator.positive {
            background: rgba(34, 197, 94, 0.15);
            color: var(--accent-green);
        }

        .change-indicator.negative {
            background: rgba(239, 68, 68, 0.15);
            color: var(--accent-red);
        }

        .change-indicator.neutral {
            background: rgba(136, 136, 160, 0.15);
            color: var(--text-muted);
        }

        /* Mini Sparkline */
        .sparkline-container {
            width: 60px;
            height: 20px;
            display: inline-block;
            vertical-align: middle;
        }

        /* Exchange Charts Grid */
        .exchange-charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        @media (max-width: 1000px) {
            .exchange-charts-grid {
                grid-template-columns: 1fr;
            }
        }

        .exchange-chart-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .exchange-chart-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .exchange-chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            background: var(--bg-secondary);
            border-bottom: 2px solid var(--accent-xrp);
        }

        .exchange-chart-wrapper {
            padding: 1rem;
            height: 280px;
        }

        /* Treemap styles */
        .treemap-container {
            padding: 1rem;
            height: 280px;
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            align-content: flex-start;
        }

        .treemap-item {
            border-radius: 6px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0.5rem;
            transition: all 0.2s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .treemap-item:hover {
            transform: scale(1.05);
            z-index: 10;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .treemap-item-name {
            font-size: 0.7rem;
            font-weight: 600;
            color: rgba(0, 0, 0, 0.8);
            text-transform: uppercase;
        }

        .treemap-item-value {
            font-size: 0.65rem;
            color: rgba(0, 0, 0, 0.6);
            font-family: 'JetBrains Mono', monospace;
        }

        /* Top Dominance Section */
        .dominance-section {
            margin-bottom: 1.5rem;
        }

        .dominance-bars {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .dominance-bar-item {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .dominance-bar-label {
            width: 100px;
            font-size: 0.85rem;
            font-weight: 500;
            text-transform: capitalize;
        }

        .dominance-bar-track {
            flex: 1;
            height: 24px;
            background: var(--bg-secondary);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        .dominance-bar-fill {
            height: 100%;
            border-radius: 12px;
            transition: width 0.8s ease;
            display: flex;
            align-items: center;
            padding-left: 0.75rem;
        }

        .dominance-bar-value {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--bg-primary);
            font-family: 'JetBrains Mono', monospace;
        }

        .dominance-bar-percent {
            width: 50px;
            text-align: right;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-secondary);
            font-family: 'JetBrains Mono', monospace;
        }

        /* Comparison Mode */
        .comparison-toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .comparison-toggle:hover {
            border-color: var(--accent-purple);
        }

        .comparison-toggle.active {
            background: rgba(168, 85, 247, 0.15);
            border-color: var(--accent-purple);
            color: var(--accent-purple);
        }

        /* Chart Export Button */
        .chart-export-btn {
            padding: 0.4rem 0.8rem;
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-muted);
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .chart-export-btn:hover {
            border-color: var(--accent-xrp);
            color: var(--accent-xrp);
        }

        /* Fullscreen Chart Modal */
        .fullscreen-chart-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .fullscreen-chart-overlay.active {
            display: flex;
        }

        .fullscreen-chart-container {
            width: 100%;
            max-width: 1400px;
            height: 80vh;
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.5rem;
            position: relative;
        }

        .fullscreen-chart-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 2rem;
            cursor: pointer;
            z-index: 10;
        }

        .fullscreen-chart-close:hover {
            color: var(--text-primary);
        }

        .fullscreen-chart-canvas {
            width: 100%;
            height: calc(100% - 60px);
        }

        /* Horizontal Bar Chart adjustments */
        .horizontal-bar-wrapper {
            padding: 1rem;
            height: 350px;
        }

        /* Theme Toggle */
        .theme-toggle {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--bg-card);
            border: 2px solid var(--border);
            color: var(--text-primary);
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 100;
        }

        .theme-toggle:hover {
            border-color: var(--accent-xrp);
            transform: scale(1.1);
        }

        /* Light Mode */
        body.light-mode {
            --bg-primary: #f5f5f7;
            --bg-secondary: #e8e8ec;
            --bg-card: #ffffff;
            --bg-card-hover: #f0f0f4;
            --border: #d0d0d8;
            --text-primary: #1a1a2e;
            --text-secondary: #5a5a70;
            --text-muted: #8888a0;
        }

        body.light-mode .bg-grid {
            background-image: 
                linear-gradient(rgba(35, 247, 221, 0.08) 1px, transparent 1px),
                linear-gradient(90deg, rgba(35, 247, 221, 0.08) 1px, transparent 1px);
        }

        body.light-mode .bg-glow {
            background: radial-gradient(circle at 30% 20%, rgba(35, 247, 221, 0.15) 0%, transparent 50%),
                        radial-gradient(circle at 70% 80%, rgba(168, 85, 247, 0.1) 0%, transparent 50%);
        }

        /* Tooltip Styles */
        .custom-tooltip {
            position: absolute;
            background: var(--bg-card);
            border: 1px solid var(--accent-xrp);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            font-size: 0.85rem;
            pointer-events: none;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .custom-tooltip-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .custom-tooltip-value {
            color: var(--accent-xrp);
            font-family: 'JetBrains Mono', monospace;
        }

        /* ============================================
           NEWS TAB STYLES
           ============================================ */
        .news-container { padding: 0; }
        .news-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem; }
        .section-title { font-size: 1.3rem; font-weight: 700; display: flex; align-items: center; gap: 0.5rem; }
        .news-filters { display: flex; gap: 0.5rem; }

        .calendar-section { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; padding: 1.5rem; margin-bottom: 2rem; }
        .calendar-header { margin-bottom: 1rem; }
        .calendar-header h3 { font-size: 1.1rem; display: flex; align-items: center; gap: 0.5rem; }
        .calendar-events { display: flex; flex-direction: column; gap: 1rem; }
        .calendar-event { display: flex; align-items: center; gap: 1rem; padding: 1rem; background: var(--bg-secondary); border-radius: 12px; border-left: 4px solid var(--accent-xrp); transition: transform 0.2s ease; }
        .calendar-event:hover { transform: translateX(5px); }
        .event-date { display: flex; flex-direction: column; align-items: center; min-width: 50px; }
        .event-day { font-size: 1.5rem; font-weight: 700; color: var(--accent-xrp); }
        .event-month { font-size: 0.7rem; text-transform: uppercase; color: var(--text-muted); }
        .event-details { flex: 1; }
        .event-title { font-weight: 600; margin-bottom: 0.25rem; }
        .event-desc { font-size: 0.85rem; color: var(--text-muted); }
        .event-tag { padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600; }
        .tag-important { background: rgba(239, 68, 68, 0.2); color: var(--accent-red); }
        .tag-report { background: rgba(59, 130, 246, 0.2); color: var(--accent-blue); }
        .tag-market { background: rgba(168, 85, 247, 0.2); color: var(--accent-purple); }

        .news-feed { display: flex; flex-direction: column; gap: 1rem; }
        .news-item { background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; padding: 1.25rem; transition: all 0.3s ease; cursor: pointer; }
        .news-item:hover { border-color: var(--accent-xrp); transform: translateY(-3px); }
        .news-source { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem; }
        .source-icon { font-size: 1rem; }
        .source-name { font-weight: 600; font-size: 0.85rem; }
        .news-time { color: var(--text-muted); font-size: 0.75rem; margin-left: auto; }
        .news-title { font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5rem; line-height: 1.4; }
        .news-summary { color: var(--text-secondary); font-size: 0.9rem; line-height: 1.5; margin-bottom: 0.75rem; }
        .news-tags { display: flex; gap: 0.5rem; }
        .news-tag { background: var(--accent-xrp-dim); color: var(--accent-xrp); padding: 0.2rem 0.6rem; border-radius: 4px; font-size: 0.75rem; font-weight: 500; }
        .news-load-more { text-align: center; margin-top: 1.5rem; }

        /* ============================================
           PORTFOLIO TAB STYLES
           ============================================ */
        .portfolio-container { padding: 0; }
        .portfolio-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem; }
        .portfolio-summary { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
        .portfolio-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; padding: 1.25rem; text-align: center; transition: all 0.3s ease; }
        .portfolio-card:hover { transform: translateY(-3px); border-color: var(--accent-xrp); }
        .portfolio-card.highlight { border-color: var(--accent-xrp); background: linear-gradient(135deg, var(--bg-card), var(--accent-xrp-dim)); }
        .portfolio-card-label { font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; margin-bottom: 0.5rem; }
        .portfolio-card-value { font-size: 1.5rem; font-weight: 700; font-family: 'JetBrains Mono', monospace; }
        .portfolio-card-change { font-size: 0.85rem; margin-top: 0.5rem; }
        .portfolio-card-change.positive { color: var(--accent-green); }
        .portfolio-card-change.negative { color: var(--accent-red); }

        .add-holding-section, .holdings-list-section, .calculator-section, .gamification-section { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; padding: 1.5rem; margin-bottom: 1.5rem; }
        .add-holding-section h3, .holdings-list-section h3, .calculator-section h3, .gamification-section h3 { font-size: 1.1rem; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; }
        .add-holding-form, .calculator-form { display: flex; flex-wrap: wrap; gap: 1rem; align-items: flex-end; }
        .form-group { display: flex; flex-direction: column; gap: 0.5rem; min-width: 150px; flex: 1; }
        .form-group label { font-size: 0.8rem; color: var(--text-muted); }
        .form-group input, .form-group select { padding: 0.75rem; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-family: inherit; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: var(--accent-xrp); }

        .holdings-list { display: flex; flex-direction: column; gap: 0.75rem; }
        .holding-item { display: flex; align-items: center; gap: 1rem; padding: 1rem; background: var(--bg-secondary); border-radius: 10px; }
        .holding-asset { font-weight: 600; min-width: 60px; }
        .holding-amount { font-family: 'JetBrains Mono', monospace; }
        .holding-value { margin-left: auto; text-align: right; }
        .holding-pnl { font-size: 0.85rem; }
        .holding-pnl.positive { color: var(--accent-green); }
        .holding-pnl.negative { color: var(--accent-red); }
        .holding-delete { background: none; border: none; color: var(--accent-red); cursor: pointer; font-size: 1.2rem; opacity: 0.6; transition: opacity 0.2s; }
        .holding-delete:hover { opacity: 1; }
        .empty-portfolio { text-align: center; padding: 2rem; color: var(--text-muted); }
        .empty-portfolio span { font-size: 3rem; display: block; margin-bottom: 1rem; }

        .calculator-result { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-top: 1.5rem; padding: 1rem; background: var(--bg-secondary); border-radius: 10px; }
        .calc-result-item { display: flex; justify-content: space-between; }
        .calc-result-item span { color: var(--text-muted); }
        .calc-result-item strong { font-family: 'JetBrains Mono', monospace; }

        /* Gamification Styles */
        .streak-counter { display: flex; align-items: center; gap: 1rem; padding: 1rem; background: linear-gradient(135deg, var(--accent-orange), #ff6b35); border-radius: 12px; margin-bottom: 1.5rem; }
        .streak-icon { font-size: 2.5rem; }
        .streak-count { font-size: 2rem; font-weight: 700; }
        .streak-label { font-size: 0.85rem; opacity: 0.9; }
        .achievements-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; margin-bottom: 1.5rem; }
        .achievement { display: flex; flex-direction: column; align-items: center; gap: 0.5rem; padding: 1rem; background: var(--bg-secondary); border-radius: 10px; opacity: 0.4; transition: all 0.3s ease; }
        .achievement.unlocked { opacity: 1; background: linear-gradient(135deg, var(--bg-secondary), var(--accent-xrp-dim)); border: 1px solid var(--accent-xrp); }
        .achievement-icon { font-size: 2rem; }
        .achievement-name { font-size: 0.75rem; text-align: center; color: var(--text-muted); }
        .achievement.unlocked .achievement-name { color: var(--text-primary); }

        .prediction-game { padding: 1rem; background: var(--bg-secondary); border-radius: 12px; }
        .prediction-game h4 { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; }
        .prediction-desc { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 1rem; }
        .prediction-form { display: flex; gap: 0.5rem; margin-bottom: 1rem; }
        .prediction-form input { flex: 1; padding: 0.75rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); }
        .prediction-stats { display: flex; gap: 2rem; }
        .pred-stat { display: flex; gap: 0.5rem; }
        .pred-stat span { color: var(--text-muted); }

        /* ============================================
           AI INSIGHTS TAB STYLES
           ============================================ */
        .insights-container { padding: 0; }
        .insights-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem; }

        .sentiment-section, .ai-summary-section, .ma-section, .comparison-section, .key-metrics-section { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; padding: 1.5rem; margin-bottom: 1.5rem; }
        .sentiment-section h3, .ai-summary-section h3, .ma-section h3, .comparison-section h3, .key-metrics-section h3 { font-size: 1.1rem; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; }

        .sentiment-gauge { margin-bottom: 1rem; }
        .gauge-container { height: 20px; background: linear-gradient(90deg, var(--accent-red), var(--accent-orange), var(--accent-green)); border-radius: 10px; position: relative; overflow: hidden; }
        .gauge-fill { position: absolute; top: 0; left: 0; height: 100%; background: rgba(0,0,0,0.6); border-radius: 10px 0 0 10px; transition: width 0.5s ease; }
        .gauge-labels { display: flex; justify-content: space-between; margin-top: 0.5rem; font-size: 0.75rem; color: var(--text-muted); }
        .sentiment-score { text-align: center; font-size: 1.1rem; }

        .ai-summary-card { background: var(--bg-secondary); border-radius: 12px; padding: 1.5rem; line-height: 1.7; }
        .ai-summary-card p { margin-bottom: 1rem; }
        .ai-summary-card ul { margin-left: 1.5rem; margin-bottom: 1rem; }
        .ai-summary-card li { margin-bottom: 0.5rem; color: var(--text-secondary); }
        .ai-disclaimer { font-size: 0.8rem; color: var(--text-muted); margin-top: 1rem; padding: 0.75rem; background: rgba(249, 115, 22, 0.1); border-radius: 8px; }

        .ma-chart-container { height: 250px; margin-bottom: 1.5rem; }
        .ma-indicators { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; }
        .ma-indicator { display: flex; flex-direction: column; gap: 0.25rem; padding: 1rem; background: var(--bg-secondary); border-radius: 10px; }
        .ma-label { font-size: 0.8rem; color: var(--text-muted); }
        .ma-value { font-size: 1.2rem; font-weight: 600; font-family: 'JetBrains Mono', monospace; }
        .ma-signal { font-size: 0.75rem; font-weight: 600; }
        .ma-signal.bullish { color: var(--accent-green); }
        .ma-signal.bearish { color: var(--accent-red); }

        .comparison-selectors { display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem; justify-content: center; flex-wrap: wrap; }
        .comparison-selectors select { padding: 0.75rem 1.5rem; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-family: inherit; font-size: 1rem; cursor: pointer; }
        .vs-badge { background: var(--accent-purple); color: white; padding: 0.5rem 1rem; border-radius: 20px; font-weight: 700; font-size: 0.85rem; }
        .comparison-chart-container { height: 250px; margin-bottom: 1.5rem; }
        .comparison-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; }
        .comp-stat { background: var(--bg-secondary); border-radius: 10px; padding: 1rem; }
        .comp-stat-label { font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.5rem; }
        .comp-stat-values { display: flex; justify-content: space-between; font-family: 'JetBrains Mono', monospace; font-weight: 600; }
        .comp-val-1 { color: var(--accent-xrp); }
        .comp-val-2 { color: var(--accent-orange); }
        .comp-stat-values .positive { color: var(--accent-green) !important; }
        .comp-stat-values .negative { color: var(--accent-red) !important; }

        .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; }
        .metric-card { background: var(--bg-secondary); border-radius: 12px; padding: 1.25rem; text-align: center; transition: all 0.3s ease; }
        .metric-card:hover { transform: translateY(-3px); }
        .metric-icon { font-size: 2rem; margin-bottom: 0.5rem; }
        .metric-label { font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.5rem; }
        .metric-value { font-size: 1.3rem; font-weight: 700; font-family: 'JetBrains Mono', monospace; }
        .metric-value.positive { color: var(--accent-green); }
        .metric-value.negative { color: var(--accent-red); }
        .metric-desc { font-size: 0.75rem; color: var(--text-muted); margin-top: 0.25rem; }
    </style>
</head>
<body>
    <div class="bg-grid"></div>
    <div class="bg-glow"></div>

    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon">XRP</div>
                <h1>XRP ETF Tracker</h1>
            </div>
            <div class="xrp-price" id="xrpPrice">
                <span class="xrp-label">XRP Price</span>
                <span class="xrp-value">Loading...</span>
            </div>
            <a href="https://x.com/chachakobe4er" target="_blank" class="twitter-handle">
                <span class="twitter-icon"></span>
                <span class="twitter-name">XRP  Army</span>
                <span class="twitter-user">@chachakobe4er</span>
            </a>
            <a href="https://xrpexchange.streamlit.app/" target="_blank" class="site-link">
                <span class="site-link-icon"></span>
                <span class="site-link-name">XRP Exchange</span>
                <span class="site-link-desc">Holdings Tracker</span>
            </a>
            <div class="header-meta">
                <div class="last-updated" id="lastUpdated">Not yet loaded</div>
                <div class="status">
                    <span class="status-dot"></span>
                    <span id="statusText">Ready</span>
                </div>
                <div class="auto-refresh-info" id="autoRefreshInfo">Auto-refresh: every 5 minutes</div>
            </div>
        </header>

        <!-- Dashboard Overview Section -->
        <div class="dashboard-overview">
            <div class="dashboard-overview-header">
                <div class="dashboard-overview-title">
                    <span></span> XRP Holdings - Exchange & SPOT ETFs
                </div>
                <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Light/Dark Mode">
                    
                </button>
            </div>
            <div class="dashboard-grid">
                <div class="dashboard-metrics">
                    <div class="dashboard-metric">
                        <div class="dashboard-metric-label">Total XRP in Spot ETFs</div>
                        <div class="dashboard-metric-value animated" id="dashboardETFXRP">--</div>
                        <div class="dashboard-metric-change positive" id="dashboardETFChange">
                            <span></span> <span>Live Data</span>
                        </div>
                    </div>
                    <div class="dashboard-metric">
                        <div class="dashboard-metric-label">ETF Value (USD)</div>
                        <div class="dashboard-metric-value animated" id="dashboardETFValue">--</div>
                    </div>
                    <div class="dashboard-metric">
                        <div class="dashboard-metric-label">XRP on Exchanges</div>
                        <div class="dashboard-metric-value animated" id="dashboardExchangeXRP">--</div>
                        <div class="dashboard-metric-change neutral" id="dashboardExchangeChange">
                            <span></span> <span>Click Exchange tab</span>
                        </div>
                    </div>
                    <div class="dashboard-metric">
                        <div class="dashboard-metric-label">Exchange Value (USD)</div>
                        <div class="dashboard-metric-value animated" id="dashboardExchangeValue">--</div>
                    </div>
                </div>
                <div class="dashboard-pie-container">
                    <div class="dashboard-pie-chart">
                        <canvas id="dashboardPieChart"></canvas>
                    </div>
                    <div class="dashboard-pie-legend">
                        <div class="pie-legend-item">
                            <div class="pie-legend-dot" style="background: #23f7dd;"></div>
                            <span>ETFs</span>
                        </div>
                        <div class="pie-legend-item">
                            <div class="pie-legend-dot" style="background: #a855f7;"></div>
                            <span>Exchanges</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Tab Navigation -->
        <div class="main-tabs" style="flex-wrap: wrap;">
            <button class="main-tab active" onclick="switchMainTab('trading')">
                <span class="main-tab-icon"></span>
                ETF Trading
            </button>
            <button class="main-tab" onclick="switchMainTab('holdings')">
                <span class="main-tab-icon"></span>
                ETF Holdings
            </button>
            <button class="main-tab" onclick="switchMainTab('exchange')">
                <span class="main-tab-icon"></span>
                Exchange
            </button>
            <button class="main-tab" onclick="switchMainTab('news')">
                <span class="main-tab-icon"></span>
                News
            </button>
            <button class="main-tab" onclick="switchMainTab('insights')">
                <span class="main-tab-icon"></span>
                AI Insights
            </button>
        </div>

        <!-- Trading Tab Content -->
        <div id="tradingTab" class="tab-content active">
            <div class="controls">
                <button class="btn active" data-period="daily" onclick="setPeriod('daily')">Daily</button>
                <button class="btn" data-period="weekly" onclick="setPeriod('weekly')">Weekly</button>
                <button class="btn" data-period="monthly" onclick="setPeriod('monthly')">Monthly</button>
                <button class="btn" data-period="yearly" onclick="setPeriod('yearly')">Yearly</button>
                <button class="btn btn-chart" onclick="openChartModal()">
                     Charts
                </button>
                <button class="btn btn-refresh" id="refreshBtn" onclick="fetchData()">
                     Refresh Data
                </button>
            </div>

            <main id="mainContent">
                <div class="loading-container">
                    <div class="spinner"></div>
                    <p class="loading-text">Loading ETF data...</p>
                </div>
            </main>
        </div>

        <!-- Holdings Tab Content -->
        <div id="holdingsTab" class="tab-content">
            <div class="holdings-summary" id="holdingsSummary">
                <div class="summary-card highlight">
                    <div class="summary-label">Total XRP</div>
                    <div class="summary-value accent" id="totalXRP">Loading...</div>
                </div>
                <div class="summary-card highlight">
                    <div class="summary-label">Total Value</div>
                    <div class="summary-value accent" id="totalValue">Loading...</div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">Current XRP Price</div>
                    <div class="summary-value" id="holdingsXRPPrice">Loading...</div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">Active ETFs</div>
                    <div class="summary-value" id="activeETFs">--</div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">Last Updated</div>
                    <div class="summary-value" id="holdingsLastUpdated" style="font-size: 1rem;">--</div>
                </div>
            </div>

            <!-- Holdings Trend Chart (Historical) -->
            <div class="trend-chart-section">
                <div class="trend-chart-container">
                    <div class="trend-chart-header">
                        <div class="holdings-table-title">
                            <span></span>
                            Holdings Trend Over Time
                        </div>
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <button class="chart-export-btn" onclick="exportChart('trendChart')"> Export</button>
                            <button class="chart-export-btn" onclick="openFullscreenChart('trend')"> Fullscreen</button>
                        </div>
                    </div>
                    <div class="trend-chart-wrapper">
                        <canvas id="holdingsTrendChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Holdings Distribution Chart Section -->
            <div class="holdings-chart-section">
                <div class="holdings-chart-container">
                    <div class="holdings-chart-header">
                        <div class="holdings-table-title">
                            <span></span>
                            ETF Holdings Distribution
                        </div>
                        <div style="display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap;">
                            <div class="holdings-chart-controls">
                                <button class="btn chart-type-btn active" data-hchart="bar" onclick="switchHoldingsChart('bar')">Bar</button>
                                <button class="btn chart-type-btn" data-hchart="pie" onclick="switchHoldingsChart('pie')">Pie</button>
                                <button class="btn chart-type-btn" data-hchart="doughnut" onclick="switchHoldingsChart('doughnut')">Doughnut</button>
                            </div>
                            <button class="chart-export-btn" onclick="exportChart('distributionChart')"> Export</button>
                        </div>
                    </div>
                    <div class="holdings-chart-wrapper">
                        <canvas id="holdingsDistributionChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="holdings-table-container">
                <div class="holdings-table-header">
                    <div class="holdings-table-title">
                        <span></span>
                        Daily Holdings Data
                    </div>
                    <div style="display: flex; gap: 0.5rem; align-items: center;">
                        <span style="font-size: 0.75rem; color: var(--text-muted);">Data updated manually</span>
                        <button class="btn btn-refresh" onclick="refreshHoldingsDisplay()">
                             Recalculate Values
                        </button>
                    </div>
                </div>
                <div class="holdings-table-wrapper">
                    <table class="holdings-table" id="holdingsTable">
                        <!-- Table will be populated by JavaScript -->
                    </table>
                </div>
            </div>

        </div>

        <!-- Exchange Holdings Tab Content -->
        <div id="exchangeTab" class="tab-content">
            <div class="holdings-summary">
                <div class="summary-card highlight">
                    <div class="summary-label">Total XRP on Exchanges</div>
                    <div class="summary-value accent" id="exchangeTotalXRP">--</div>
                </div>
                <div class="summary-card highlight">
                    <div class="summary-label">Total Value (USD)</div>
                    <div class="summary-value accent" id="exchangeTotalValue">--</div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">Exchanges Tracked</div>
                    <div class="summary-value" id="exchangeCount">43</div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">Wallets Tracked</div>
                    <div class="summary-value" id="walletCount">200+</div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">Data Status</div>
                    <div class="summary-value" id="exchangeStatus" style="font-size: 0.9rem;">
                        <span style="color: var(--accent-xrp);"> Ready</span>
                    </div>
                </div>
            </div>

            <div class="exchange-controls-bar">
                <button class="btn btn-refresh" id="fetchExchangeBtn" onclick="fetchExchangeData(true)">
                     Refresh Data
                </button>
                <a href="exchange.html" target="_blank" class="btn btn-chart">
                     Full Dashboard
                </a>
                <input type="text" id="exchangeFilter" class="exchange-filter-input" placeholder=" Filter exchanges..." onkeyup="filterExchangeTable()">
            </div>

            <!-- Exchange Charts Grid -->
            <div class="exchange-charts-grid">
                <!-- Horizontal Bar Chart -->
                <div class="exchange-chart-card">
                    <div class="exchange-chart-header">
                        <div class="holdings-table-title">
                            <span></span>
                            Top 10 Exchanges
                        </div>
                        <button class="chart-export-btn" onclick="exportChart('exchangeBarChart')"> Export</button>
                    </div>
                    <div class="horizontal-bar-wrapper">
                        <canvas id="exchangeHorizontalBarChart"></canvas>
                    </div>
                </div>

                <!-- Market Dominance Donut -->
                <div class="exchange-chart-card">
                    <div class="exchange-chart-header">
                        <div class="holdings-table-title">
                            <span></span>
                            Market Dominance
                        </div>
                    </div>
                    <div class="exchange-chart-wrapper">
                        <canvas id="exchangeDominanceChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Treemap Visualization -->
            <div class="exchange-chart-card" style="margin-bottom: 1.5rem;">
                <div class="exchange-chart-header">
                    <div class="holdings-table-title">
                        <span></span>
                        Holdings Treemap
                    </div>
                    <span style="color: var(--text-muted); font-size: 0.8rem;">Size = Market Share</span>
                </div>
                <div class="treemap-container" id="exchangeTreemap">
                    <div style="color: var(--text-muted); text-align: center; width: 100%; padding: 2rem;">
                        Loading treemap...
                    </div>
                </div>
            </div>

            <!-- Market Dominance Bars -->
            <div class="exchange-chart-card dominance-section" style="margin-bottom: 1.5rem;">
                <div class="exchange-chart-header">
                    <div class="holdings-table-title">
                        <span></span>
                        Top 5 Market Share
                    </div>
                </div>
                <div style="padding: 1.25rem;">
                    <div class="dominance-bars" id="dominanceBars">
                        <div style="color: var(--text-muted); text-align: center; padding: 1rem;">
                            Load exchange data to see dominance bars
                        </div>
                    </div>
                </div>
            </div>

            <div class="exchange-info-banner">
                <span></span>
                <span><strong>Live XRPL Data:</strong> Fetches real-time balances directly from the XRP Ledger. Data auto-loads when you visit this tab and is cached for 5 minutes.</span>
            </div>

            <div class="holdings-table-container">
                <div class="holdings-table-header">
                    <div class="holdings-table-title">
                        <span></span>
                        Exchange XRP Holdings
                    </div>
                    <span class="group-count" id="exchangeResultCount">0 exchanges loaded</span>
                </div>
                <div class="holdings-table-wrapper" style="max-height: 500px;">
                    <table class="holdings-table" id="exchangeTable">
                        <thead>
                            <tr>
                                <th style="text-align: left; min-width: 50px;">Rank</th>
                                <th style="text-align: left; min-width: 150px;">Exchange</th>
                                <th style="min-width: 120px;">Balance (XRP)</th>
                                <th style="min-width: 120px;">Value (USD)</th>
                                <th style="min-width: 100px;">Market Share</th>
                                <th style="min-width: 80px;">Wallets</th>
                            </tr>
                        </thead>
                        <tbody id="exchangeTableBody">
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 3rem; color: var(--text-muted);">
                                    Click "Fetch Live Data" to load exchange balances from the XRP Ledger
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="exchange-info-banner" style="margin-top: 1rem; background: var(--bg-secondary);">
                <span></span>
                <span><strong>Note:</strong> Data fetched from XRPL nodes (s1.ripple.com, s2.ripple.com, xrplcluster.com). Some requests may timeout - refresh to retry.</span>
            </div>
        </div>

        <!-- News Tab Content -->
        <div id="newsTab" class="tab-content">
            <div class="news-container">
                <div class="news-header">
                    <h2 class="section-title"><span></span> Crypto News Feed</h2>
                    <div class="news-filters">
                        <button class="btn active" data-news="xrp" onclick="filterNews('xrp')">XRP</button>
                        <button class="btn" data-news="crypto" onclick="filterNews('crypto')">Crypto</button>
                        <button class="btn" data-news="etf" onclick="filterNews('etf')">ETFs</button>
                        <button class="btn" data-news="all" onclick="filterNews('all')">All</button>
                    </div>
                </div>
                
                <!-- Calendar Section -->
                <div class="calendar-section">
                    <div class="calendar-header">
                        <h3><span></span> Upcoming Events</h3>
                    </div>
                    <div class="calendar-events" id="calendarEvents">
                        <div class="calendar-event">
                            <div class="event-date">
                                <span class="event-day">29</span>
                                <span class="event-month">JAN</span>
                            </div>
                            <div class="event-details">
                                <div class="event-title">FOMC Meeting</div>
                                <div class="event-desc">Federal Reserve interest rate decision - Jan 28-29</div>
                            </div>
                            <div class="event-tag tag-market">Market</div>
                        </div>
                        <div class="calendar-event">
                            <div class="event-date">
                                <span class="event-day">Q1</span>
                                <span class="event-month">2026</span>
                            </div>
                            <div class="event-details">
                                <div class="event-title">Ripple Q4 2025 XRP Markets Report</div>
                                <div class="event-desc">Quarterly report on XRP market activity and trends</div>
                            </div>
                            <div class="event-tag tag-report">Report</div>
                        </div>
                        <div class="calendar-event">
                            <div class="event-date">
                                <span class="event-day">19</span>
                                <span class="event-month">MAR</span>
                            </div>
                            <div class="event-details">
                                <div class="event-title">FOMC Meeting</div>
                                <div class="event-desc">Federal Reserve interest rate decision - Mar 18-19</div>
                            </div>
                            <div class="event-tag tag-market">Market</div>
                        </div>
                    </div>
                </div>

                <!-- News Feed -->
                <div class="news-feed" id="newsFeed">
                    <div class="news-item" data-category="xrp etf">
                        <div class="news-source">
                            <span class="source-icon"></span>
                            <span class="source-name">XRP News</span>
                            <span class="news-time">Latest</span>
                        </div>
                        <h3 class="news-title">XRP Spot ETFs Now Trading on Major US Exchanges</h3>
                        <p class="news-summary">Multiple XRP spot ETFs including Canary, Bitwise, Franklin, and 21Shares are actively trading, marking a significant milestone for XRP adoption.</p>
                        <div class="news-tags">
                            <span class="news-tag">XRP</span>
                            <span class="news-tag">ETF</span>
                        </div>
                    </div>
                    <div class="news-item" data-category="xrp">
                        <div class="news-source">
                            <span class="source-icon"></span>
                            <span class="source-name">Ripple</span>
                            <span class="news-time">Recent</span>
                        </div>
                        <h3 class="news-title">Ripple Expands Global Payment Network</h3>
                        <p class="news-summary">Ripple continues to expand RippleNet partnerships with financial institutions worldwide for cross-border payments.</p>
                        <div class="news-tags">
                            <span class="news-tag">XRP</span>
                            <span class="news-tag">Ripple</span>
                        </div>
                    </div>
                    <div class="news-item" data-category="crypto etf">
                        <div class="news-source">
                            <span class="source-icon"></span>
                            <span class="source-name">ETF News</span>
                            <span class="news-time">Recent</span>
                        </div>
                        <h3 class="news-title">Crypto ETF Market Continues to Grow</h3>
                        <p class="news-summary">Bitcoin and Ethereum spot ETFs continue to see strong inflows as institutional adoption increases across the crypto market.</p>
                        <div class="news-tags">
                            <span class="news-tag">Bitcoin</span>
                            <span class="news-tag">ETF</span>
                        </div>
                    </div>
                    <div class="news-item" data-category="crypto">
                        <div class="news-source">
                            <span class="source-icon"></span>
                            <span class="source-name">Crypto Market</span>
                            <span class="news-time">Recent</span>
                        </div>
                        <h3 class="news-title">Regulatory Landscape Evolving for Digital Assets</h3>
                        <p class="news-summary">Global regulators continue to develop frameworks for cryptocurrency regulation, with increasing clarity expected in 2026.</p>
                        <div class="news-tags">
                            <span class="news-tag">Regulation</span>
                            <span class="news-tag">Crypto</span>
                        </div>
                    </div>
                    <div class="news-item" data-category="xrp">
                        <div class="news-source">
                            <span class="source-icon"></span>
                            <span class="source-name">XRPL</span>
                            <span class="news-time">Recent</span>
                        </div>
                        <h3 class="news-title">XRP Ledger Development Updates</h3>
                        <p class="news-summary">The XRP Ledger continues to see development activity with new features and improvements being implemented.</p>
                        <div class="news-tags">
                            <span class="news-tag">XRP</span>
                            <span class="news-tag">XRPL</span>
                        </div>
                    </div>
                    <div class="news-item" data-category="etf">
                        <div class="news-source">
                            <span class="source-icon"></span>
                            <span class="source-name">ETF Tracker</span>
                            <span class="news-time">Recent</span>
                        </div>
                        <h3 class="news-title">ETF Volume Analysis: Weekly Trends</h3>
                        <p class="news-summary">Weekly analysis of XRP ETF trading volumes shows growing market participation and liquidity.</p>
                        <div class="news-tags">
                            <span class="news-tag">ETF</span>
                            <span class="news-tag">Analysis</span>
                        </div>
                    </div>
                </div>

                <div class="news-load-more">
                    <button class="btn" onclick="loadMoreNews()">Load More News</button>
                </div>
            </div>
        </div>

        <!-- AI Insights Tab Content -->
        <div id="insightsTab" class="tab-content">
            <div class="insights-container">
                <div class="insights-header">
                    <h2 class="section-title"><span></span> AI Market Insights</h2>
                    <button class="btn btn-refresh" onclick="generateInsights()"> Refresh Insights</button>
                </div>

                <!-- Market Sentiment -->
                <div class="sentiment-section">
                    <h3><span></span> Market Sentiment</h3>
                    <div class="sentiment-gauge">
                        <div class="gauge-container">
                            <div class="gauge-fill" id="sentimentGauge" style="width: 65%;"></div>
                        </div>
                        <div class="gauge-labels">
                            <span>Bearish</span>
                            <span>Neutral</span>
                            <span>Bullish</span>
                        </div>
                    </div>
                    <div class="sentiment-score">
                        <span>Current Sentiment:</span>
                        <strong id="sentimentText" style="color: var(--accent-green);">Bullish (65/100)</strong>
                    </div>
                </div>

                <!-- AI Summary -->
                <div class="ai-summary-section">
                    <h3><span></span> Daily AI Summary</h3>
                    <div class="ai-summary-card" id="aiSummary">
                        <p><strong>XRP Market Overview:</strong> The XRP market shows strong bullish momentum with ETF trading volumes reaching new highs. Institutional interest continues to grow as spot ETFs gain mainstream adoption.</p>
                        <p><strong>Key Observations:</strong></p>
                        <ul>
                            <li>ETF trading volume up 15% from yesterday</li>
                            <li>Exchange holdings decreased by 2.3% (bullish signal)</li>
                            <li>On-chain activity showing accumulation patterns</li>
                            <li>Technical indicators suggest support at $1.95</li>
                        </ul>
                        <p><strong>Outlook:</strong> Short-term bullish with potential resistance at $2.50. Monitor SEC announcements for potential catalysts.</p>
                    </div>
                    <div class="ai-disclaimer">
                         AI-generated analysis for informational purposes only. Not financial advice.
                    </div>
                </div>

                <!-- Moving Averages -->
                <div class="ma-section">
                    <h3><span></span> Moving Averages & Trends</h3>
                    <div class="ma-chart-container">
                        <canvas id="maChart"></canvas>
                    </div>
                    <div class="ma-indicators">
                        <div class="ma-indicator">
                            <span class="ma-label">7-Day MA</span>
                            <span class="ma-value" id="ma7">$2.05</span>
                            <span class="ma-signal bullish"> Above</span>
                        </div>
                        <div class="ma-indicator">
                            <span class="ma-label">30-Day MA</span>
                            <span class="ma-value" id="ma30">$1.92</span>
                            <span class="ma-signal bullish"> Above</span>
                        </div>
                        <div class="ma-indicator">
                            <span class="ma-label">90-Day MA</span>
                            <span class="ma-value" id="ma90">$1.45</span>
                            <span class="ma-signal bullish"> Above</span>
                        </div>
                    </div>
                </div>

                <!-- Comparison Tool -->
                <div class="comparison-section">
                    <h3><span></span> ETF Comparison Tool</h3>
                    <div class="comparison-selectors">
                        <select id="compareETF1" onchange="updateComparison()">
                            <option value="XRP">XRP</option>
                            <option value="BTC">Bitcoin ETFs</option>
                            <option value="ETH">Ethereum ETFs</option>
                        </select>
                        <span class="vs-badge">VS</span>
                        <select id="compareETF2" onchange="updateComparison()">
                            <option value="BTC">Bitcoin ETFs</option>
                            <option value="XRP">XRP</option>
                            <option value="ETH">Ethereum ETFs</option>
                        </select>
                    </div>
                    <div class="comparison-chart-container">
                        <canvas id="comparisonChart"></canvas>
                    </div>
                    <div class="comparison-stats" id="comparisonStats">
                        <div class="comp-stat">
                            <div class="comp-stat-label">Daily Volume</div>
                            <div class="comp-stat-values">
                                <span class="comp-val-1">$125M</span>
                                <span class="comp-val-2">$2.1B</span>
                            </div>
                        </div>
                        <div class="comp-stat">
                            <div class="comp-stat-label">7D Change</div>
                            <div class="comp-stat-values">
                                <span class="comp-val-1 positive">+12.5%</span>
                                <span class="comp-val-2 positive">+8.2%</span>
                            </div>
                        </div>
                        <div class="comp-stat">
                            <div class="comp-stat-label">AUM</div>
                            <div class="comp-stat-values">
                                <span class="comp-val-1">$1.5B</span>
                                <span class="comp-val-2">$28B</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Key Metrics -->
                <div class="key-metrics-section">
                    <h3><span></span> Key Metrics</h3>
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-icon"></div>
                            <div class="metric-label">Volume Trend</div>
                            <div class="metric-value positive">+15.2%</div>
                            <div class="metric-desc">vs 7-day avg</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-icon"></div>
                            <div class="metric-label">Exchange Flow</div>
                            <div class="metric-value negative">-2.3M XRP</div>
                            <div class="metric-desc">Net outflow (bullish)</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-icon"></div>
                            <div class="metric-label">RSI (14)</div>
                            <div class="metric-value">58</div>
                            <div class="metric-desc">Neutral zone</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-icon"></div>
                            <div class="metric-label">Support Level</div>
                            <div class="metric-value">$1.95</div>
                            <div class="metric-desc">Strong support</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p>Data provided by <a href="https://finance.yahoo.com" target="_blank">Yahoo Finance</a> via yfinance</p>
            <p style="margin-top: 0.5rem;">Prices and volumes may be delayed  Auto-refreshes every 5 minutes</p>
        </footer>

        <!-- Chart Modal -->
        <div class="chart-overlay" id="chartOverlay">
            <div class="chart-modal">
                <div class="chart-header">
                    <h2> ETF Volume Comparison</h2>
                    <button class="chart-close" onclick="closeChartModal()"></button>
                </div>
                <div class="chart-controls">
                    <button class="chart-tab active" data-chart="price" onclick="switchChart('price')">Price</button>
                    <button class="chart-tab" data-chart="volume" onclick="switchChart('volume')">Volume</button>
                </div>
                <div class="chart-period-controls">
                    <button class="chart-period active" data-cperiod="1mo" onclick="setChartPeriod('1mo')">1 Month</button>
                    <button class="chart-period" data-cperiod="3mo" onclick="setChartPeriod('3mo')">3 Months</button>
                    <button class="chart-period" data-cperiod="6mo" onclick="setChartPeriod('6mo')">6 Months</button>
                    <button class="chart-period" data-cperiod="1y" onclick="setChartPeriod('1y')">1 Year</button>
                </div>
                <div class="chart-loading" id="chartLoading" style="display: none;">
                    <div class="spinner"></div>
                    <p>Loading chart data...</p>
                </div>
                <div class="chart-container">
                    <canvas id="etfChart"></canvas>
                </div>
                <div class="chart-legend" id="chartLegend"></div>
            </div>
        </div>

        <!-- Follow Popup Modal -->
        <div class="popup-overlay" id="popupOverlay">
            <div class="popup-modal">
                <button class="popup-close" onclick="closePopup()"></button>
                <div class="popup-icon"></div>
                <h2 class="popup-title">Join the XRP Army! </h2>
                <p class="popup-text">Stay updated with the latest XRP ETF news, analysis, and alpha!</p>
                <a href="https://x.com/chachakobe4er" target="_blank" class="popup-follow-btn" onclick="closePopup()">
                    <span class="popup-x-icon"></span>
                    Follow @chachakobe4er
                </a>
                <button class="popup-later" onclick="closePopup()">Maybe later</button>
            </div>
        </div>

        <!-- Fullscreen Chart Modal -->
        <div class="fullscreen-chart-overlay" id="fullscreenChartOverlay">
            <div class="fullscreen-chart-container">
                <button class="fullscreen-chart-close" onclick="closeFullscreenChart()"></button>
                <h2 style="margin-bottom: 1rem; color: var(--accent-xrp);" id="fullscreenChartTitle">Chart</h2>
                <div class="fullscreen-chart-canvas">
                    <canvas id="fullscreenChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        // =====================================================
        // XRP SPOT ETF HOLDINGS DATA
        // UPDATE THIS ARRAY DAILY - Add new entries at the TOP
        // =====================================================
        const holdingsData = [
            {
                date: "1/5/2026",
                canary: { xrp: 175640703, value: 349221200.58 },
                bitwise: { xrp: 139269596.51, value: 322867312.91 },
                franklin: { xrp: 128705300.63, value: 298376211.39 },
                grayscale: { xrp: 122812426.4807, value: 284468090 },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "1/2/2026",
                canary: { xrp: 175547917, value: 319148921.70 },
                bitwise: { xrp: 132104912, value: 262824043 },
                franklin: { xrp: 123274697, value: 245256242.88 },
                grayscale: { xrp: null, value: null },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "12/31/2025",
                canary: { xrp: 175552727, value: 328418423.11 },
                bitwise: { xrp: null, value: null },
                franklin: { xrp: 118387154, value: 215197065.61 },
                grayscale: { xrp: null, value: null },
                shares21: { xrp: 136925159.19, value: 246367782.25 },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "12/30/2025",
                canary: { xrp: 175555131, value: null },
                bitwise: { xrp: 131223200, value: 245443810 },
                franklin: { xrp: 116214913, value: 217371859.35 },
                grayscale: { xrp: 122230386, value: 228252534 },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "12/29/2025",
                canary: { xrp: 175557536, value: 324731233 },
                bitwise: { xrp: 125625472, value: 232284011 },
                franklin: { xrp: 113499611, value: 209863051 },
                grayscale: { xrp: null, value: null },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "12/26/2025",
                canary: { xrp: 176203556, value: 328519019 },
                bitwise: { xrp: null, value: null },
                franklin: { xrp: null, value: null },
                grayscale: { xrp: null, value: null },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "12/24/2025",
                canary: { xrp: 176208383, value: 332060117 },
                bitwise: { xrp: null, value: null },
                franklin: { xrp: 111870430, value: 208556687 },
                grayscale: { xrp: null, value: null },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "12/23/2025",
                canary: { xrp: 175784910, value: 333629564 },
                bitwise: { xrp: null, value: null },
                franklin: { xrp: 105896766, value: 199553984 },
                grayscale: { xrp: 121454333, value: 228341918 },
                shares21: { xrp: 135739074, value: 255426264 },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "12/22/2025",
                canary: { xrp: 175787318, value: 335859777 },
                bitwise: { xrp: 122826582, value: 230048700 },
                franklin: { xrp: 101552284, value: 192683272 },
                grayscale: { xrp: 116603997, value: 221122690 },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "12/19/2025",
                canary: { xrp: 175794542, value: 318653801 },
                bitwise: { xrp: 112749910, value: 215424487 },
                franklin: { xrp: null, value: null },
                grayscale: { xrp: 115633930, value: 220682384 },
                shares21: { xrp: 132421082, value: 232394226 },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "12/18/2025",
                canary: { xrp: 174412723, value: 326809327 },
                bitwise: { xrp: 112190079, value: 203322080 },
                franklin: { xrp: 96664740, value: 175185509 },
                grayscale: { xrp: 110007542, value: 198205098 },
                shares21: { xrp: 128419942, value: 230206632 },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "12/17/2025",
                canary: { xrp: 174415112, value: 336316637 },
                bitwise: { xrp: 110174688, value: 206425499 },
                franklin: { xrp: null, value: null },
                grayscale: { xrp: null, value: null },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: 330324, value: 618901 }
            },
            {
                date: "12/16/2025",
                canary: { xrp: 171648969, value: 323681379 },
                bitwise: { xrp: 107487501, value: 200245575 },
                franklin: { xrp: 92863318, value: 179048835 },
                grayscale: { xrp: 108261421, value: 208683308 },
                shares21: { xrp: 123052427, value: 231256177 },
                rex: { xrp: 30484262, value: null },
                nciq: { xrp: 3647484, value: null },
                bitw: { xrp: 30843614, value: null },
                gdlc: { xrp: 14176113, value: null },
                ezpz: { xrp: 330366, value: 636976 }
            },
              {
                date: "12/15/2025",
                canary: { xrp: 171651320.69, value: 343704992.08 },
                bitwise: { xrp: null, value: null },
                franklin: { xrp: 91777197.5, value: 173030303.76 },
                grayscale: { xrp: null, value: null },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "12/12/2025",
                canary: { xrp: 170806472.44, value: 344979028.04 },
                bitwise: { xrp: 104240482.45, value: 208697785.10 },
                franklin: { xrp: 87432714.78, value: 175047289.60 },
                grayscale: { xrp: 107679380.77, value: 215496914.00 },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "12/11/2025",
                canary: { xrp: 168998494.45, value: 352018456.00 },
                bitwise: { xrp: 100321667.32, value: 202633716.52 },
                franklin: { xrp: 83088232.06, value: 167824934.64 },
                grayscale: { xrp: 106903327.14, value: 216461064.00 },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {   
                date: "12/10/2025",
                canary: { xrp: 169000809.53, value: 357526113.56 },
                bitwise: { xrp: 97858412.09, value: 203872344.26 },
                franklin: { xrp: null, value: null },
                grayscale: { xrp: 105351219.89, value: 217442600.00 },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {   
                date: "12/9/2025",
                canary: { xrp: 169003124.65, value: 352338559.27 },
                bitwise: { xrp: 94499427.69, value: 199863454.60 },
                franklin: { xrp: null, value: null },
                grayscale: { xrp: null, value: null },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "12/8/2025",
                canary: { xrp: 166130110.94, value: 337172024.75 },
                bitwise: { xrp: 93827630.81, value: 195604338.52 },
                franklin: { xrp: 78200689.00, value: 163026540.36 },
                grayscale: { xrp: 104381152.86, value: 217916115.00 },
                shares21: { xrp: 293666.01, value: 612211.41 },
                rex: { xrp: 30484262.00, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: 30843614.13, value: null }
            },
            {
                date: "12/5/2025",
                canary: { xrp: 165497950.17, value: 347155947.69 },
                bitwise: { xrp: 91812240.18, value: 186318251.45 },
                franklin: { xrp: 62994999.47, value: 127838272.22 },
                grayscale: { xrp: null, value: null },
                shares21: { xrp: 256964.03, value: 521467.39 },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "12/4/2025",
                canary: { xrp: 163050728.88, value: 356991092.25 },
                bitwise:  { xrp: 90692578.71, value: 190260333.18 },
                franklin: { xrp: 61908878.79, value: 129876160.45 },
                grayscale: { xrp: 103023059.01, value: 217045890.00 },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "12/3/2025",
                canary: { xrp: 162413956.75, value: 351249740.82 },
                bitwise: { xrp: 88901120.37, value: 194641001.95 },
                franklin: { xrp: 59193577.09, value: 129599099.61 },
                grayscale: { xrp: 85173825.61, value: 187358142.00 },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: 31454262.00, value: 67601059.18 },
                bitw: { xrp: 14176112.75, value: 3647484.00 },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "12/2/2025",
                canary: { xrp: 161351157.49, value: 324690322.59 },
                bitwise: { xrp: 87109662.02, value: 188363319.88 },
                franklin: { xrp: 57021335.73, value: 123301225.74 },
                grayscale: { xrp: 64026364.30, value: 138593133.00 },
                shares21: { xrp: 220261.36, value: 476286.55 },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "12/1/2025",
                canary: { xrp: 158690770.98, value: 346639994.17 },
                bitwise: { xrp: 83414779.18, value: 167832204.03 },
                franklin: { xrp: 53219913.35, value: 107079530.05 },
                grayscale: { xrp: null, value: null },
                shares21: { xrp: 220251.36, value: 443170.26 },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "11/28/2025",
                canary: { xrp: 155821569.95, value: 346199221.99 },
                bitwise: { xrp: 81847253.13, value: 178427011.82 },
                franklin: { xrp: 39100344.50, value: 85406491.49 },
                grayscale: { xrp: 38028567.82, value: 83255563.00 },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {           
                date: "11/26/2025",
                canary: { xrp: 151671903.56, value: 331617876.65 },
                bitwise: { xrp: 80503659.37, value: 178833244.05 },
                franklin: { xrp: 34212801.44, value: 76001343.50 },
                grayscale: { xrp: 29436381.00, value: 64297594.51 },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "11/25/2025",
                canary: { xrp: 149330703.49, value: 337624027.47 },
                bitwise: { xrp: 77144674.98, value: 168686089.21 },
                franklin: { xrp: 32040560.08, value: 70060529.48 },
                grayscale: { xrp: 36088433.75, value: 79394554.00 },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "11/24/2025",
                canary: { xrp: 146137326.55, value: 283102051.52 },
                bitwise: { xrp: 67403620.22, value: 152328137.50 },
                franklin: { xrp: 6016355.74, value: 13476637.00 },
                grayscale: { xrp: null, value: null },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "11/21/2025",
                canary: { xrp: 138900072.25, value: 278082806.15 },
                bitwise: { xrp: 59565989.97, value: 115360261.46 },
                franklin: { xrp: 6017179.98, value: 11673329.00 },
                grayscale: { xrp: null, value: null },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "11/20/2025",
                canary: { xrp: 138582415.26, value: 281877879.88 },
                bitwise: { xrp: 53743696.21, value: 107600791.63 },
                franklin: { xrp: null, value: null },
                grayscale: { xrp: null, value: null },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "11/19/2025",
                canary: { xrp: 132193030.95, value: 295175008.55 },
                bitwise: { xrp: 1119660.33, value: 2277445.11 },
                franklin: { xrp: null, value: null },
                grayscale: { xrp: null, value: null },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "11/18/2025",
                canary: { xrp: 124418674.67, value: 265019864.27 },
                bitwise: { xrp: null, value: null },
                franklin: { xrp: null, value: null },
                grayscale: { xrp: null, value: null },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "11/14/2025",
                canary: { xrp: 108765777.15, value: 250410904.89 },
                bitwise: { xrp: null, value: null },
                franklin: { xrp: null, value: null },
                grayscale: { xrp: null, value: null },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "11/13/2025",
                canary: { xrp: 2237132.88, value: 5250000.40 },
                bitwise: { xrp: null, value: null },
                franklin: { xrp: null, value: null },
                grayscale: { xrp: null, value: null },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            }
        ];

        // ETF column definitions for the holdings table
        const etfColumns = [
            { key: 'canary', name: 'Canary XRP', ticker: 'XRPC' },
            { key: 'bitwise', name: 'Bitwise XRP', ticker: 'XRP' },
            { key: 'franklin', name: 'Franklin XRP', ticker: 'XRPZ' },
            { key: 'grayscale', name: 'Grayscale XRP', ticker: 'GXRP' },
            { key: 'shares21', name: '21Shares XRP', ticker: 'TOXR' },
            { key: 'rex', name: 'Rex Shares', ticker: 'XRPR' },
            { key: 'nciq', name: 'NCIQ', ticker: 'NCIQ' },
            { key: 'bitw', name: 'BITW', ticker: 'BITW' },
            { key: 'gdlc', name: 'Grayscale GDLC', ticker: 'GDLC' },
            { key: 'ezpz', name: 'Franklin EZPZ', ticker: 'EZPZ' }
        ];

        // Tab switching function
        function switchMainTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.main-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.closest('.main-tab').classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            if (tabName === 'trading') {
                document.getElementById('tradingTab').classList.add('active');
            } else if (tabName === 'holdings') {
                document.getElementById('holdingsTab').classList.add('active');
                renderHoldingsTable();
                updateHoldingsSummary();
                // Render charts after a small delay to ensure canvas is visible
                setTimeout(() => {
                    renderHoldingsChart();
                    renderHoldingsTrendChart();
                    updateDashboardOverview();
                }, 100);
            } else if (tabName === 'exchange') {
                document.getElementById('exchangeTab').classList.add('active');
                // Auto-load exchange data if not already loaded
                if (Object.keys(exchangeData).length === 0 && !isExchangeFetching) {
                    fetchExchangeData();
                } else if (Object.keys(exchangeData).length > 0) {
                    // Re-render charts if data already exists
                    setTimeout(() => {
                        renderExchangeCharts();
                    }, 100);
                }
            } else if (tabName === 'news') {
                document.getElementById('newsTab').classList.add('active');
            } else if (tabName === 'insights') {
                document.getElementById('insightsTab').classList.add('active');
                // Auto-fetch real data when visiting insights tab
                setTimeout(() => {
                    if (xrpPriceHistory.length === 0) {
                        generateInsights(); // This fetches real data
                    } else {
                        renderMAChart();
                        renderComparisonChart();
                    }
                }, 100);
            }
        }

        // Format number for holdings display
        function formatHoldingsNumber(num) {
            if (num === null || num === undefined) return '';
            if (num >= 1e9) return (num / 1e9).toFixed(2) + 'B';
            if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';
            if (num >= 1e3) return (num / 1e3).toFixed(1) + 'K';
            return num.toLocaleString();
        }

        function formatHoldingsCurrency(num) {
            if (num === null || num === undefined) return '';
            return '$' + formatHoldingsNumber(num);
        }

        // Calculate and update summary statistics
        function updateHoldingsSummary() {
            // Get the most recent value for each ETF (they may report on different days)
            let totalXRP = 0;
            let activeCount = 0;
            let latestDate = holdingsData[0].date;

            // For each ETF, find its most recent data point
            etfColumns.forEach(col => {
                for (const row of holdingsData) {
                    const data = row[col.key];
                    if (data && data.xrp) {
                        totalXRP += data.xrp;
                        activeCount++;
                        break; // Found most recent for this ETF, move to next
                    }
                }
            });

            // Update the summary cards
            document.getElementById('totalXRP').textContent = formatHoldingsNumber(totalXRP);
            document.getElementById('holdingsLastUpdated').textContent = latestDate;
            document.getElementById('activeETFs').textContent = activeCount;
            
            // Use live XRP price to calculate total value
            if (currentXRPPrice && totalXRP > 0) {
                const totalValue = totalXRP * currentXRPPrice;
                document.getElementById('totalValue').textContent = formatHoldingsCurrency(totalValue);
                document.getElementById('holdingsXRPPrice').textContent = '$' + currentXRPPrice.toFixed(4);
            } else {
                document.getElementById('totalValue').textContent = 'Loading...';
                document.getElementById('holdingsXRPPrice').textContent = 'Loading...';
            }
        }

        // Render the holdings table
        function renderHoldingsTable() {
            const table = document.getElementById('holdingsTable');
            
            // Build header rows
            let headerRow1 = '<tr><th rowspan="2">Date</th>';
            let headerRow2 = '<tr>';
            
            etfColumns.forEach(col => {
                headerRow1 += `<th colspan="2" class="etf-header">${col.name}<br><span style="color: var(--accent-xrp); font-size: 0.65rem;">${col.ticker}</span></th>`;
                headerRow2 += `<th class="sub-header">XRP</th><th class="sub-header">Value</th>`;
            });
            
            headerRow1 += '</tr>';
            headerRow2 += '</tr>';

            // Build data rows
            let dataRows = '';
            holdingsData.forEach(row => {
                dataRows += `<tr><td>${row.date}</td>`;
                etfColumns.forEach(col => {
                    const data = row[col.key] || {};
                    const xrpVal = data.xrp !== null && data.xrp !== undefined 
                        ? formatHoldingsNumber(data.xrp) 
                        : '<span class="no-data"></span>';
                    const valueVal = data.value !== null && data.value !== undefined 
                        ? formatHoldingsCurrency(data.value) 
                        : '<span class="no-data"></span>';
                    dataRows += `<td class="xrp-cell etf-column-group">${xrpVal}</td><td class="value-cell">${valueVal}</td>`;
                });
                dataRows += '</tr>';
            });

            table.innerHTML = `
                <thead>
                    ${headerRow1}
                    ${headerRow2}
                </thead>
                <tbody>
                    ${dataRows}
                </tbody>
            `;
        }

        function refreshHoldingsDisplay() {
            renderHoldingsTable();
            updateHoldingsSummary();
            renderHoldingsChart();
            renderHoldingsTrendChart();
            updateDashboardOverview();
        }

        // Holdings Distribution Chart
        let holdingsDistributionChart = null;
        let currentHoldingsChartType = 'bar';

        function switchHoldingsChart(type) {
            currentHoldingsChartType = type;
            document.querySelectorAll('.chart-type-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.hchart === type);
            });
            renderHoldingsChart();
        }

        function getLatestETFHoldings() {
            const holdings = [];
            
            etfColumns.forEach(col => {
                for (const row of holdingsData) {
                    const data = row[col.key];
                    if (data && data.xrp) {
                        holdings.push({
                            name: col.name,
                            ticker: col.ticker,
                            xrp: data.xrp,
                            value: data.value || (currentXRPPrice ? data.xrp * currentXRPPrice : 0)
                        });
                        break;
                    }
                }
            });
            
            return holdings.sort((a, b) => b.xrp - a.xrp);
        }

        function renderHoldingsChart() {
            const canvas = document.getElementById('holdingsDistributionChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const holdings = getLatestETFHoldings();
            
            if (holdings.length === 0) return;

            // Destroy existing chart
            if (holdingsDistributionChart) {
                holdingsDistributionChart.destroy();
            }

            const labels = holdings.map(h => h.ticker);
            const data = holdings.map(h => h.xrp);
            const colors = [
                '#23f7dd', '#a855f7', '#22c55e', '#f97316', '#3b82f6',
                '#ef4444', '#eab308', '#ec4899', '#14b8a6', '#8b5cf6'
            ];

            const chartConfig = {
                type: currentHoldingsChartType,
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'XRP Holdings',
                        data: data,
                        backgroundColor: currentHoldingsChartType === 'bar' 
                            ? colors.slice(0, data.length).map(c => c + '80')
                            : colors.slice(0, data.length),
                        borderColor: colors.slice(0, data.length),
                        borderWidth: currentHoldingsChartType === 'bar' ? 2 : 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: currentHoldingsChartType !== 'bar',
                            position: 'right',
                            labels: {
                                color: '#8888a0',
                                font: { size: 11 },
                                padding: 15
                            }
                        },
                        tooltip: {
                            backgroundColor: '#16161f',
                            borderColor: '#23f7dd',
                            borderWidth: 1,
                            titleColor: '#ffffff',
                            bodyColor: '#8888a0',
                            padding: 12,
                            callbacks: {
                                label: function(context) {
                                    const holding = holdings[context.dataIndex];
                                    const xrpFormatted = formatHoldingsNumber(context.raw);
                                    let label = `${holding.name}: ${xrpFormatted} XRP`;
                                    if (currentXRPPrice) {
                                        const value = context.raw * currentXRPPrice;
                                        label += ` ($${formatHoldingsNumber(value)})`;
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: currentHoldingsChartType === 'bar' ? {
                        x: {
                            ticks: { 
                                color: '#8888a0',
                                font: { size: 11 }
                            },
                            grid: { color: '#2a2a3a' }
                        },
                        y: {
                            ticks: {
                                color: '#8888a0',
                                callback: function(value) {
                                    return formatHoldingsNumber(value);
                                }
                            },
                            grid: { color: '#2a2a3a' }
                        }
                    } : {}
                }
            };

            holdingsDistributionChart = new Chart(ctx, chartConfig);
        }

        // =====================================================
        // NEW UI/UX ENHANCEMENT FUNCTIONS
        // =====================================================

        // Dashboard Overview Chart
        let dashboardPieChart = null;

        function updateDashboardOverview() {
            // Get ETF totals and count active ETFs
            let etfTotalXRP = 0;
            let activeETFCount = 0;
            etfColumns.forEach(col => {
                for (const row of holdingsData) {
                    const data = row[col.key];
                    if (data && data.xrp) {
                        etfTotalXRP += data.xrp;
                        activeETFCount++;
                        break;
                    }
                }
            });

            // Get Exchange totals
            let exchangeTotalXRP = 0;
            if (Object.keys(exchangeData).length > 0) {
                for (const data of Object.values(exchangeData)) {
                    exchangeTotalXRP += data.total || 0;
                }
            }

            // Update dashboard metrics with animation
            animateValue('dashboardETFXRP', etfTotalXRP);
            if (currentXRPPrice) {
                animateValue('dashboardETFValue', etfTotalXRP * currentXRPPrice, true);
            }
            
            // Update ETF change indicator to show active count
            document.getElementById('dashboardETFChange').innerHTML = 
                `<span style="color: var(--accent-green);"></span> <span>${activeETFCount} Active ETFs</span>`;
            
            if (exchangeTotalXRP > 0) {
                animateValue('dashboardExchangeXRP', exchangeTotalXRP);
                if (currentXRPPrice) {
                    animateValue('dashboardExchangeValue', exchangeTotalXRP * currentXRPPrice, true);
                }
                document.getElementById('dashboardExchangeChange').innerHTML = 
                    `<span style="color: var(--accent-green);"></span> <span>Live data loaded</span>`;
            }

            // Render pie chart
            renderDashboardPie(etfTotalXRP, exchangeTotalXRP);
        }

        function animateValue(elementId, value, isCurrency = false) {
            const el = document.getElementById(elementId);
            if (!el) return;
            
            el.classList.add('counter-animate');
            
            const formatted = isCurrency 
                ? '$' + formatHoldingsNumber(value) 
                : formatHoldingsNumber(value);
            
            el.textContent = formatted;
            
            setTimeout(() => {
                el.classList.remove('counter-animate');
            }, 500);
        }

        function renderDashboardPie(etfXRP, exchangeXRP) {
            const canvas = document.getElementById('dashboardPieChart');
            if (!canvas) return;

            if (dashboardPieChart) {
                dashboardPieChart.destroy();
            }

            const ctx = canvas.getContext('2d');
            
            // If no exchange data yet, show only ETF
            const data = exchangeXRP > 0 
                ? [etfXRP, exchangeXRP] 
                : [etfXRP, 0];

            dashboardPieChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['ETFs', 'Exchanges'],
                    datasets: [{
                        data: data,
                        backgroundColor: ['#23f7dd', '#a855f7'],
                        borderColor: ['#23f7dd', '#a855f7'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    cutout: '60%',
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: '#16161f',
                            borderColor: '#23f7dd',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    return formatHoldingsNumber(context.raw) + ' XRP';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Holdings Trend Chart (Historical)
        let holdingsTrendChart = null;

        function renderHoldingsTrendChart() {
            const canvas = document.getElementById('holdingsTrendChart');
            if (!canvas) return;

            if (holdingsTrendChart) {
                holdingsTrendChart.destroy();
            }

            const ctx = canvas.getContext('2d');
            
            // Prepare data - reverse to show chronological order
            const reversedData = [...holdingsData].reverse();
            const labels = reversedData.map(row => row.date);
            
            // Calculate total XRP for each date
            const totals = reversedData.map(row => {
                let total = 0;
                etfColumns.forEach(col => {
                    if (row[col.key] && row[col.key].xrp) {
                        total += row[col.key].xrp;
                    }
                });
                return total;
            });

            // Get data for each ETF
            const datasets = [];
            const colors = [
                '#23f7dd', '#a855f7', '#22c55e', '#f97316', '#3b82f6',
                '#ef4444', '#eab308', '#ec4899', '#14b8a6', '#8b5cf6'
            ];

            etfColumns.forEach((col, index) => {
                const data = reversedData.map(row => {
                    return row[col.key]?.xrp || null;
                });
                
                // Only add if there's some data
                if (data.some(v => v !== null)) {
                    datasets.push({
                        label: col.ticker,
                        data: data,
                        borderColor: colors[index % colors.length],
                        backgroundColor: colors[index % colors.length] + '20',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.3,
                        spanGaps: true,
                        pointRadius: 3,
                        pointHoverRadius: 6
                    });
                }
            });

            holdingsTrendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                color: '#8888a0',
                                font: { size: 10 },
                                boxWidth: 12,
                                padding: 10
                            }
                        },
                        tooltip: {
                            backgroundColor: '#16161f',
                            borderColor: '#23f7dd',
                            borderWidth: 1,
                            titleColor: '#ffffff',
                            bodyColor: '#8888a0',
                            padding: 12,
                            callbacks: {
                                label: function(context) {
                                    if (context.raw === null) return null;
                                    return `${context.dataset.label}: ${formatHoldingsNumber(context.raw)} XRP`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#8888a0', font: { size: 10 } },
                            grid: { color: '#2a2a3a' }
                        },
                        y: {
                            ticks: {
                                color: '#8888a0',
                                callback: (value) => formatHoldingsNumber(value)
                            },
                            grid: { color: '#2a2a3a' }
                        }
                    }
                }
            });
        }

        // Exchange Charts
        let exchangeHorizontalBarChart = null;
        let exchangeDominanceChart = null;

        function renderExchangeCharts() {
            if (Object.keys(exchangeData).length === 0) return;

            renderExchangeHorizontalBar();
            renderExchangeDominanceDonut();
            renderExchangeTreemap();
            renderDominanceBars();
            updateDashboardOverview();
        }

        function renderExchangeHorizontalBar() {
            const canvas = document.getElementById('exchangeHorizontalBarChart');
            if (!canvas) return;

            if (exchangeHorizontalBarChart) {
                exchangeHorizontalBarChart.destroy();
            }

            const sorted = Object.entries(exchangeData)
                .sort((a, b) => b[1].total - a[1].total)
                .slice(0, 10);

            const labels = sorted.map(([name]) => name);
            const data = sorted.map(([_, d]) => d.total);
            const colors = [
                '#23f7dd', '#a855f7', '#22c55e', '#f97316', '#3b82f6',
                '#ef4444', '#eab308', '#ec4899', '#14b8a6', '#8b5cf6'
            ];

            const ctx = canvas.getContext('2d');
            exchangeHorizontalBarChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'XRP Balance',
                        data: data,
                        backgroundColor: colors,
                        borderColor: colors,
                        borderWidth: 1,
                        borderRadius: 4
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: '#16161f',
                            borderColor: '#23f7dd',
                            borderWidth: 1,
                            callbacks: {
                                label: (ctx) => formatHoldingsNumber(ctx.raw) + ' XRP'
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: '#8888a0',
                                callback: (v) => formatHoldingsNumber(v)
                            },
                            grid: { color: '#2a2a3a' }
                        },
                        y: {
                            ticks: { color: '#8888a0', font: { size: 11 } },
                            grid: { display: false }
                        }
                    }
                }
            });
        }

        function renderExchangeDominanceDonut() {
            const canvas = document.getElementById('exchangeDominanceChart');
            if (!canvas) return;

            if (exchangeDominanceChart) {
                exchangeDominanceChart.destroy();
            }

            const sorted = Object.entries(exchangeData)
                .sort((a, b) => b[1].total - a[1].total);
            
            const top5 = sorted.slice(0, 5);
            const othersTotal = sorted.slice(5).reduce((sum, [_, d]) => sum + d.total, 0);

            const labels = [...top5.map(([name]) => name), 'Others'];
            const data = [...top5.map(([_, d]) => d.total), othersTotal];
            const colors = ['#23f7dd', '#a855f7', '#22c55e', '#f97316', '#3b82f6', '#64748b'];

            const ctx = canvas.getContext('2d');
            exchangeDominanceChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors,
                        borderColor: '#16161f',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '50%',
                    plugins: {
                        legend: {
                            display: true,
                            position: 'right',
                            labels: {
                                color: '#8888a0',
                                font: { size: 10 },
                                padding: 8,
                                boxWidth: 12
                            }
                        },
                        tooltip: {
                            backgroundColor: '#16161f',
                            borderColor: '#23f7dd',
                            borderWidth: 1,
                            callbacks: {
                                label: (ctx) => {
                                    const total = ctx.dataset.data.reduce((a, b) => a + b, 0);
                                    const pct = ((ctx.raw / total) * 100).toFixed(1);
                                    return `${formatHoldingsNumber(ctx.raw)} XRP (${pct}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function renderExchangeTreemap() {
            const container = document.getElementById('exchangeTreemap');
            if (!container) return;

            const sorted = Object.entries(exchangeData)
                .sort((a, b) => b[1].total - a[1].total)
                .slice(0, 15);

            const total = sorted.reduce((sum, [_, d]) => sum + d.total, 0);
            const colors = [
                '#23f7dd', '#a855f7', '#22c55e', '#f97316', '#3b82f6',
                '#ef4444', '#eab308', '#ec4899', '#14b8a6', '#8b5cf6',
                '#06b6d4', '#f43f5e', '#84cc16', '#6366f1', '#10b981'
            ];

            let html = '';
            sorted.forEach(([name, data], index) => {
                const share = (data.total / total) * 100;
                const size = Math.max(60, Math.sqrt(share) * 35);
                const color = colors[index % colors.length];
                
                html += `
                    <div class="treemap-item" 
                         style="background: ${color}; width: ${size}px; height: ${size}px; flex: 0 0 ${size}px;"
                         title="${name}: ${formatHoldingsNumber(data.total)} XRP (${share.toFixed(1)}%)">
                        <div class="treemap-item-name">${name.slice(0, 8)}</div>
                        <div class="treemap-item-value">${share.toFixed(1)}%</div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function renderDominanceBars() {
            const container = document.getElementById('dominanceBars');
            if (!container) return;

            const sorted = Object.entries(exchangeData)
                .sort((a, b) => b[1].total - a[1].total)
                .slice(0, 5);

            const total = Object.values(exchangeData).reduce((sum, d) => sum + d.total, 0);
            const colors = ['#23f7dd', '#a855f7', '#22c55e', '#f97316', '#3b82f6'];

            let html = '';
            sorted.forEach(([name, data], index) => {
                const share = (data.total / total) * 100;
                const color = colors[index];
                
                html += `
                    <div class="dominance-bar-item">
                        <div class="dominance-bar-label">${name}</div>
                        <div class="dominance-bar-track">
                            <div class="dominance-bar-fill" style="width: ${share}%; background: ${color};">
                                <span class="dominance-bar-value">${formatHoldingsNumber(data.total)}</span>
                            </div>
                        </div>
                        <div class="dominance-bar-percent">${share.toFixed(1)}%</div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Theme Toggle
        function toggleTheme() {
            document.body.classList.toggle('light-mode');
            localStorage.setItem('theme', document.body.classList.contains('light-mode') ? 'light' : 'dark');
        }

        // Load saved theme
        if (localStorage.getItem('theme') === 'light') {
            document.body.classList.add('light-mode');
        }

        // Chart Export Function
        function exportChart(chartId) {
            let canvas;
            switch(chartId) {
                case 'trendChart':
                    canvas = document.getElementById('holdingsTrendChart');
                    break;
                case 'distributionChart':
                    canvas = document.getElementById('holdingsDistributionChart');
                    break;
                case 'exchangeBarChart':
                    canvas = document.getElementById('exchangeHorizontalBarChart');
                    break;
                default:
                    return;
            }

            if (canvas) {
                const link = document.createElement('a');
                link.download = `${chartId}_${new Date().toISOString().split('T')[0]}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
            }
        }

        // Fullscreen Chart
        let fullscreenChartInstance = null;

        function openFullscreenChart(type) {
            const overlay = document.getElementById('fullscreenChartOverlay');
            const canvas = document.getElementById('fullscreenChart');
            const title = document.getElementById('fullscreenChartTitle');
            
            overlay.classList.add('active');
            
            if (fullscreenChartInstance) {
                fullscreenChartInstance.destroy();
            }

            const ctx = canvas.getContext('2d');
            
            if (type === 'trend') {
                title.textContent = ' Holdings Trend Over Time';
                
                const reversedData = [...holdingsData].reverse();
                const labels = reversedData.map(row => row.date);
                const colors = [
                    '#23f7dd', '#a855f7', '#22c55e', '#f97316', '#3b82f6',
                    '#ef4444', '#eab308', '#ec4899', '#14b8a6', '#8b5cf6'
                ];
                
                const datasets = [];
                etfColumns.forEach((col, index) => {
                    const data = reversedData.map(row => row[col.key]?.xrp || null);
                    if (data.some(v => v !== null)) {
                        datasets.push({
                            label: col.name,
                            data: data,
                            borderColor: colors[index % colors.length],
                            backgroundColor: colors[index % colors.length] + '20',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.3,
                            spanGaps: true,
                            pointRadius: 4,
                            pointHoverRadius: 8
                        });
                    }
                });

                fullscreenChartInstance = new Chart(ctx, {
                    type: 'line',
                    data: { labels, datasets },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top',
                                labels: { color: '#8888a0', font: { size: 12 } }
                            },
                            tooltip: {
                                backgroundColor: '#16161f',
                                borderColor: '#23f7dd',
                                borderWidth: 1,
                                titleFont: { size: 14 },
                                bodyFont: { size: 12 },
                                padding: 15
                            }
                        },
                        scales: {
                            x: { ticks: { color: '#8888a0' }, grid: { color: '#2a2a3a' } },
                            y: { 
                                ticks: { 
                                    color: '#8888a0',
                                    callback: (v) => formatHoldingsNumber(v)
                                }, 
                                grid: { color: '#2a2a3a' } 
                            }
                        }
                    }
                });
            }
        }

        function closeFullscreenChart() {
            document.getElementById('fullscreenChartOverlay').classList.remove('active');
            if (fullscreenChartInstance) {
                fullscreenChartInstance.destroy();
                fullscreenChartInstance = null;
            }
        }

        // Close fullscreen on escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeFullscreenChart();
            }
        });

        // CSV Upload handler
        function handleCSVUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const csv = e.target.result;
                    const lines = csv.split('\n');
                    const headers = lines[0].split(',').map(h => h.trim());
                    
                    console.log('CSV Headers:', headers);
                    console.log('CSV has', lines.length - 1, 'data rows');
                    
                    // Parse and add to holdings data
                    // This is a basic implementation - you would expand this
                    // to properly map your CSV columns to the data structure
                    
                    alert('CSV uploaded successfully! Check console for parsed data. To fully integrate, update the holdingsData array in the HTML file.');
                } catch (error) {
                    alert('Error parsing CSV: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        // =====================================================
        // EXCHANGE HOLDINGS DATA AND FUNCTIONS
        // =====================================================

        const RIPPLED_URLS = [
            "https://s1.ripple.com:51234",
            "https://s2.ripple.com:51234",
            "https://xrplcluster.com"
        ];

        const EXCHANGES = {
             "robinhood": {
        "rEAKseZ7yNgaDuxH74PkqB12cVWohpi7R6": "Robinhood1",
        "r4ZuQtPNXGRMKfPjAsn2J7gRqoQuWnTPFP": "Robinhood2"
    },
    "bitflyer": {
        "rpY7bZBkA98P8zds5LdBktAKj9ifekPdkE": "BitFlyer 3",
        "rhWVCsCXrkwTeLBg6DyDr7abDaHz3zAKmn": "BitFlyer 4"
    },
    "bitpoint": {
        "rwPbLSqTDYwvCsGZEzDTNo3SgzCwEjQdWZ": "BitPoint 1",
        "rfmMjAXq65hpAxEf1RLNQq6RgYTSVkQUW5": "BitPoint 2"
    },
    "bitget": {
        "rGDreBvnHrX1get7na3J4oowN19ny4GzFn": "Bitget Global"
    },
    "bitso": {
        "rLSn6Z3T8uCxbcd1oxwfGQN1Fdn5CyGujK": "Bitso 3"
    },
    "binance": {
        "rEb8TK3gBgk5auZkwc6sHnwrGVJH8DuaLh": "Binance 1",
        "rNU4eAowPuixS5ZCWaRL72UUeKgxcKExpK": "Binance 10",
        "rNxp4h8apvRis6mJf9Sh8C6iRxfrDWN7AV": "Binance 11",
        "rPJ5GFpyDLv7gqeB1uZVUBwDwi41kaXN5A": "Binance 12",
        "rPz2qA93PeRCyHyFCqyNggnyycJR1N4iNf": "Binance 13",
        "rhWj9gaovwu2hZxYW7p388P8GRbuXFLQkK": "Binance 14",
        "rarG6FaeYhnzSKSS5EEPofo4gFsPn2bZKk": "Binance 15",
        "rs8ZPbYqgecRcDzQpJYAMhSxSi5htsjnza": "Binance 5",
        "rDAE53VfMvftPB4ogpWGWvzkQxfht6JPxr": "Binance 6",
        "rfQ9EcLkU6WnNmkS3EwUkFeXeN47Rk8Cvi": "Binance 18",
        "rBtttd61FExHC68vsZ8dqmS3DfjFEceA1A": "Binance 9",
        "rLoqMgpjwGEQinYEM623za8c2nC2Uah8v7": "Binance 21",
        "rQUp2PKzH3vCtKs5H9tsPPE1rTsN6fhjqn": "Binance 22",
        "rEeEWeP88cpKUddKk37B2EZeiHBGiBXY3": "Binance US 1",
        "rMvYS27SYs5dXdFsUgpvv1CSrPsCz7ePF5": "Binance US 2",
        "r3ZVNKgkkT3A7hbEZ8HxnNnLDCCmZiZECV": "Binance US 3",
        "rPCpZwPKogNodbjRxGDnefVXu9Q9R4PN4Q": "Binance US 4",
        "rP3mUZyCDzZkTSd1VHoBbFt8HGm8fyq8qV": "Binance 17",
        "rDecw8UhrZZUiaWc91e571b3TL41MUioh7": "Binance 16",
        "rJpj1Mv21gJzsbsVnkp1U4nqchZbmZ9pM5": "Binance (XRP-BF2 Reserve)",
        "rfxbaKNt5SnMw5rPRRm4C53YK76MEnVXro": "Binance Charity2"
    },
    "bitpanda": {
        "rUEfYyerfok6Yo38tTTTZKeRefNh9iB1Bd": "Bitpanda1",
        "rhVWrjB9EGDeK4zuJ1x2KXSjjSpsDQSaU6": "Bitpanda2",
        "r3T75fuLjX51mmfb5Sk1kMNuhBgBPJsjza": "Bitpanda3",
        "rbrCJQZVk6jYra1MPuSvX3Vpe4to9fAvh":  "Bitpanda4"
    },

    "bitstamp": {
        "rDsbeomae4FXwgQTJp9Rs64Qg9vDiTCdBv": "Bitstamp1",
        "rUobSiUpYH2S97Mgb4E7b7HuzQj2uzZ3aD": "Bitstamp2",
        "rBMFF7vhe2pxYS5wo3dpXMDrbbRudB7hGf": "Bitstamp3",
        "rEXmdJZRfjXN3XGVdz99dGSZpQyJqUeirE": "Bitstamp"
    },
    "bitbank": {
        "rLbKbPyuvs4wc1h13BEPHgbFGsRXMeFGL6": "Bitbank1",
        "rw7m3CtVHwGSdhFjV4MyJozmZJv3DYQnsA": "Bitbank2",
        "rwggnsfxvCmDb3YP9Hs1TaGvrPR7ngrn7Z": "Bitbank3",
        "r97KeayHuEsDwyU1yPBVtMLLoQr79QcRFe": "Bitbank4"
    },
    "bitfinex": {
        "rLW9gnQo7BQhU6igk5keqYnH3TVrCxGRzm": "Bitfinex1",
        "rE3hWEGquaixF2XwirNbA1ds4m55LxNZPk": "Bitfinex2"
    },
    "bitrue": {
        "rKq7xLeTaDFCg9cdy9MmgxpPWS8EZf2fNq": "Bitrue1",
        "raLPjTYeGezfdb6crXZzcC8RkLBEwbBHJ5": "Bitrue2",
        "rfKsmLP6sTfVGDvga6rW6XbmSFUzc3G9f3": "Bitrue3",
        "rNYW2bie6KwUSYhhtcnXWzRy5nLCa1UNCn": "Bitrue Insurance Fund",
        "r4DbbWjsZQ2hCcxmjncr7MRjpXTBPckGa9": "Bitrue Cold2"
    },
    "bithumb": {
        "rPMM1dRp7taeRkbT74Smx2a25kTAHdr4N5": "Bithumb1",
        "rNTkgxs5WG5mU5Sz26YoDVrHim5Y5ohC7": "Bithumb2",
        "r9hUMZBc3MWRc4YdsdZgNCW5Qef8wNSXpb": "Bithumb3",
        "r9LHiNDZvpLoWPoKnbH2JWjFET8zoYT4Y5": "Bithumb4",
        "rD7XQw67JWBXuo2WPX2gZRsGKNsDUGTbx5": "Bithumb",
        "rZcBQae9iSJqFYBpNCfxGLXH7xuEzizxR": "Bithumb10",
        "rrsSUzrT2mYAMiL46pm7cwn6MmMmxVkEWM": "Bithumb11",
        "rPyCQm8E5j78PDbrfKF24fRC7qUAk1kDMZ": "Bithumb12",
        "rw3fRcmn5PJyPKuvtAwHDSpEqoW2JKmKbu": "Bithumb13"
    },
    "bitkub": {
        "rE3Cc3i6163Qzo7oc6avFQAxQE4gyCWhGP": "Bitkub 3"
    },
    "BTC Markes": {
        "r94JFtstbXmyG21h3RHKcNfkAHxAQ6HSGC": "BTC Markets 1",
        "rL3ggCUKaiR1iywkGW6PACbn3Y8g5edWiY": "BTC Markets 2",
        "rU7xJs7QmjbiyxpEozNYUFQxaRD5kueY7z": "BTC Markets 3",
        "rwWZxJQ8R2mvvtaFUJHhF6kfV64atBiPww": "BTC Markets 4",
        "r3zUhJWabAMMLT5n631r2wDh9RP3dN1bRy": "BTC Markets 5",
        "rKRYAqMFTTGMZ47eXJVRKcqLJgnPQbXisg": "BTC Markets 6"
    },

    "bybit": {
        "rMrgNBrkE6FdCjWih5VAWkGMrmerrWpiZt": "Bybit 1",
        "rNFKfGBzMspdKfaZdpnEyhkFyw7C1mtQ8x": "Bybit 2",
        "rJn2zAPdFA193sixJwuFixRkYDUtx3apQh": "Bybit 3",
        "rMvCasZ9cohYrSZRNYPTZfoaaSUQMfgQ8G": "Bybit 4",
        "rwBHqnCgNRnk3Kyoc6zon6Wt4Wujj3HNGe": "Bybit 5",
        "raQxZLtqurEXvH5sgijrif7yXMNwvFRkJN": "Bybit 6"
    },
    "coincheck": {
        "rNQEMJA4PsoSrZRn9J6RajAYhcDzzhf8ok": "Coincheck 1",
        "rwgvfze315jjAAxT2TyyDqAPzL68HpAp6v": "Coincheck 2",
        "r99QSej32nAcjQAri65vE5ZXjw6xpUQ2Eh": "Coincheck 3"
    },
    "coinbase": {
        "rLNaPoKeeBjZe2qs6x52yVPZpZ8td4dc6w": "Coinbase1",
        "rw2ciyaNshpHe7bCHo4bRWq6pqqynnWKQg": "Coinbase2",
        "rUfghnh1VAWajpAmxgrzLPiCXJ7RwdJUgt": "Coinbase3",
        "rwpTh9DDa52XkM9nTKp2QrJuCGV5d1mQVP": "Coinbase4",
        "r3YsZdkznVzYBv141qhwXHDWoPUXLdksNw": "Coinbase5",
        "r4sRyacXpbh4HbagmgfoQq8Q3j8ZJzbZ1J": "Coinbase6",
        "rUjfTQpvBr6wsGGxMw6sRmRQGG76nvp8Ln": "Coinbase7",
        "rRmgo6NW1W7GHjC5qEpcpQnq8NE74ZS1P": "Coinbase10",
        "rHrHuQM3E114yMyPjeULWfQmbwVBrHsBEy": "Coinbase11",
        "rLBunuhuRY7aUCnDkSQhaf5ewCvdcWUYjR": "Coinbase12",
        "rDw1Z5BqJejpKCGfncHJ9rwRq2kYLo4sJG": "Coinbase13",
        "rwnYLUsoBQX3ECa1A5bSKLdbPoHKnqf63J": "Coinbase14",
        "rsTtGH7a9mom5X8Y9D3kxroXWvA912RgUZ": "Coinbase (Cold 176)",
        "r9mkuV6bpvok7SZ8Zargiw5KzZHDFbaApy": "Coinbase (Cold 285)",
        "rNaJVWotxZ9nGTBiHRWR6LR1deXHa8FRLf": "Coinbase (Cold 418)",
        "rGG4LZruYFJ34PNCi1doapgA1hynz3gxX7": "Coinbase (Cold 125)",
        "rnVcQzWJP2sJbJF3GgvdAeqveW1V7dT2Vq": "Coinbase (Cold 283)",
        "r417XbsvuBJpkMC4eHtGpvAHxgC24mb6Nc": "Coinbase (Cold 193)",
        "rPeuuqP9rNhskesoA3ferKfp6VT5SvLAzU": "Coinbase (Cold 299)",
        "raMRJ2d3djqwSUBK28W31R7aJQfK21zU1C": "Coinbase (Cold 456)",
        "rBRaRTaq99U216NSDt7dFRrfzAtZzyrgS6": "Coinbase (Cold 188)",
        "rsVDKTbUceVQqNKrSzYj8HtkVcS7TuRWSN": "Coinbase (Cold 36)",
        "rBj8PDBTKKuXWJaWbaEtdkV8hq4oxRWhsB": "Coinbase (Cold 392)",
        "rMJbEvjzqVeGJHs5ySZvuF2dHhWKx69t6G": "Coinbase (Cold 100)",
        "rw4rHH5LrTUZ5WDXieCPT14E89PwnmXtoV": "Coinbase (Cold 48)",
        "rNbMpc8JgLKnXs51KVYAmt4zbDvE8kgQEi": "Coinbase (Cold 232)",
        "rnaxGortNCoxkWUq18jCGmQDeCrLBmiz42": "Coinbase (Cold 92)",
        "rMsfxSZfdj3F1vBeVRte6b83LMV4AtZAHX": "Coinbase (Cold 434)",
        "rf9CWxJKUwHm4eZo3Z8SHi6Z1D6RoqFqqq": "Coinbase (Cold 196)",
        "rKmcvfZ4AeVCsJDNLZg3Xwbs86F33sC6bR": "Coinbase (Cold 78)",
        "rnYzsCmvD35kBntkY5g4kf7hStMGKSQfwz": "Coinbase (Cold 149)",
        "rJQC2RzzALgus6ZZgu34nXnpz67v3bRSzi": "Coinbase (Cold 210)",
        "r939VcVXx5Zx9wJ1TL61StPEKaqaYf75XQ": "Coinbase (Cold 104)",
        "r9rg8WT6KPXE8FGYbsGG6YaEG6wrbLxqF9": "Coinbase (Cold 206)",
        "rGoDpsHfkkSvNatyXHZPiJk7qydd7uahQz": "Coinbase (Cold 183)",
        "raQ3drgGw2eFHTnck6SZxKe2JhQr8Lm8w1": "Coinbase (Cold 108)",
        "rnWnrbjNw5Ezdqy51a769Rror8U3xRkYxK": "Coinbase (Cold 137)",
        "rwTjgH22nenAtDpPWy4g7xPhBqhVU845Az": "Coinbase (Cold 265)",
        "rBAzrxLFZSqni5K67kPqX3WN7VLDTcUVWJ": "Coinbase (Cold 375)",
        "rnioNuMG47FKY7sZ82EtKt1kBfD4Lg5M4S": "Coinbase (Cold 122)",
        "rMAxoQbdkCHYpH9VTmdiyrR1F7T4Yvyk2k": "Coinbase (Cold 400)",
        "rUejaQ5zgB7fMKhj72SPK7xAdGo6ujx2ca": "Coinbase (Cold 87)",
        "rGK3t5Ppw46RciqcHtrUtvcvhD7M99HJvU": "Coinbase (Cold 379)",
        "rUb2Ds39TAXnnbKekuUmJsZk11BaenHWHG": "Coinbase (Cold 353)",
        "rJZkhPxEbvpyuM1tPV2YfkSgSmFPwP4Af6": "Coinbase (Cold 414)",
        "r9gGyhLJNhWRUPEXbcGXR7HowrAgQL4i4B": "Coinbase (Cold 155)",
        "rHCwZG3cNaKSr3aANX36m4McU3pLAj91Jr": "Coinbase (Cold 197)",
        "rLex7Hn4VFotWPCzE1xXnPtx1GfqTzLnJi": "Coinbase (Cold 394)",
        "rEe4cm8ZvQSMS4h4Jwuj3RtCVwqATwZ1sK": "Coinbase (Cold 396)",
        "ram3dNqeea6s9HpyH8ANoFMSTW78Gk3gBv": "Coinbase (Cold 146)",
        "rGthywLPxJPsmCZaWuA7K6xZ5EYJLjoq7e": "Coinbase (Cold 345)",
        "rKt48W1Eg5M6DWD1CkDDYioA7Civ8zEjiy": "Coinbase (Cold 324)",
        "rEEKHC9pyscnFz5hqMEe8dMQY5j1ymLC3Y": "Coinbase (Cold 259)",
        "rnkzrdCPPHhHTEu5XMfmLw2Z5wq9ZNJxFM": "Coinbase (Cold 333)",
        "rNdTXdz2fABUprp4LrvknEiqYXkvpzN4kx": "Coinbase (Cold 248)",
        "rMgdeXXHKpnFi9FUZQgZRc73gDFjVK8PMN": "Coinbase (Cold 290)",
        "rs4qVgzVsYTeTv9Fh5URf6CDeNn22AxXax": "Coinbase (Cold 43)",
        "rUFDke2TLvmLQaAH6LZYmURAfQ1SCQDSLt": "Coinbase (Cold 135)",
        "rJUkHKXn7fonFnYs5aP1igXZ3Y1xzKB1": "Coinbase (Cold 321)",
        "rL2kYqQW7BThQrEVzf1SgohWnXV7adWfqf": "Coinbase (Cold 298)",
        "rHvCuXyoLzurq45ZNy91kzDmGJLqjf42Z8": "Coinbase (Cold 74)",
        "r4VDPsS5yatqpkdBoJxNWh3TWWXTnmR62r": "Coinbase (Cold 31)",
        "rQrYaxwU6vFvA37maEVcs1hLGgxFDxaKZn": "Coinbase (Cold 395)",
        "raon8BEsrawPug1yEs8ChX4ccEC4bhbEbw": "Coinbase (Cold 136)",
        "rNqCrZDNfW3apqmrk94AuAdy35eW5jB2pP": "Coinbase (Cold 181)",
        "rfJL7vFfPsXLhjTctNJJf443tASrrs1Nap": "Coinbase (Cold 409)",
        "rME6BCc8wFqLFtD6yGDMChPEpChN59VCym": "Coinbase (Cold 300)",
        "rNx5iPejwegrf6CXgWNsZMGXgj4C2e2QGo": "Coinbase (Cold 187)",
        "r4pUXa53aRzH11u2ZrPLk1tuM5mFayXwZM": "Coinbase (Cold 403)",
        "rKrur5amu1cx5ZMdfZ7QdwTLyQta7dXzWW": "Coinbase (Cold 141)",
        "rhDUYzz8faQi1NkAkD4UqPGhHVtMML4uY1": "Coinbase (Cold 233)",
        "rH2JhAxcApv8tEJa62jzGZFYgf77NduFDP": "Coinbase (Cold 143)",
        "rp8XdQLjn41ao7CNHyorP4hS8fbPbACoEw": "Coinbase (Cold 247)",
        "rJT8GJhJaiugYSgZW6HuZmaGXYKudNXFbw": "Coinbase (Cold 384)",
        "rsXm9nBire6zqajappuFPLJuydvHDuqz8g": "Coinbase (Cold 124)",
        "rhhJhWUpU7A1enRxKAmWqyV5c9Y1xrVQTm": "Coinbase (Cold 157)",
        "rPQmWocoQACFezEbQmmcRPSEhRxqp1Ksz9": "Coinbase (Cold 302)",
        "rGCc2ah3xtnizjpH3gd2wQm6R837eaULa4": "Coinbase (Cold 438)",
        "r9ZMdQ63S8NvgdCyLpfhkdbWDfQ57eKD9c": "CoinbaseCold366"
    },
    "coinone": {
        "rp2diYfVtpbgEMyaoWnuaWgFCAkqCAEg28": "Coinone1",
        "rPsmHDMkheWZvbAkTA8A9bVnUdadPn7XBK": "Coinone2",
        "rhuCPEoLFYbpbwyhXioSumPKrnfCi3AXJZ": "Coinone3",
        "rMksM39efoP4XyAqEjzFUEowwnVbQTh6KW": "Coinone4",
        "rDKw32dPXHfoeGoD3kVtm76ia1WbxYtU7D": "Coinone5"
    },
    "coinjar": {
        "rPvKH3CoiKnne5wAYphhsWgqAEMf1tRAE7": "Coinjar"
    },
    "crypto.com": {
        "r4DymtkgUAh2wqRxVfdd3Xtswzim6eC6c5": "Crypto.com 1",
        "rPHNKf25y3aqATYfrMv9LQnTRHQUYELXfn": "Crypto.com 2",
        "rJmXYcKCGJSayp4sAdp6Eo4CdSFtDVv7WG": "Crypto.com 3",
        "rKNwXQh9GMjaU8uTqKLECsqyib47g5dMvo": "Crypto.com 4",
        "rKV8HEL3vLc6q9waTiJcewdRdSFyx67QFb": "Crypto Exchange"
    },
    "Doppler Finance": {
        "rprFy94qJB5riJpMmnPDp3ttmVKfcrFiuq": "Doppler Finance 1",
        "rEPQxsSVER2r4HeVR4APrVCB45K68rqgp2": "Doppler Finance 2"
    },

    "firi": {
        "raJHqa1o57DwjtrLCZjdkMKRtfHnbrwSse": "Firi"
    },
    "etoro": {
        "rsdvR9WZzKszBogBJrpLPE64WWyEW4ffzS": "eToro1",
        "raQ9yYPNDQwyeqAAX9xJgjjQ7wUtLxJ5JV": "eToro2",
        "rBMe3zVBLgeh2QN4CeX6B17zwbcN6JEmZB": "eToro3",
        "rEvwSpejhGTbdAXbxRTpGAzPBQkBRZxN5s": "eToro4",
        "rM9EyDmjxeukZGT6wfkxncqeM3ABJsro3a": "eToro5"
    },
    "gate.io": {
        "rHcFoo6a9qT5NHiVn1THQRhsEGcxtYCV4d": "Gate.io 1",
        "rLzxZuZuAHM7k3FzfmhGkXVwScM4QSxoY7": "Gate.io 2",
        "rNnWmrc1EtNRe5SEQEs9pFibcjhpvAiVKF": "Gate.io 3",
        "rNu9U5sSouNoFunHp9e9trsLV6pvsSf54z": "Gate.io 4"
    },
    "gemini": {
        "raBQUYdAhnnojJQ6Xi3eXztZ74ot24RDq1": "Gemini1",
        "raq2gccLh11AwvBrpYcHntUTv4xQNRpyyG": "Gemini2",
        "rBYpyCjNwBDQFrgEdVfyosSgQS6iL6sTHe": "Gemini3"
    },
    "kraken": {
        "rLHzPsX6oXkzU2qL12kHCH8G8cnZv1rBJh": "Kraken1",
        "rUeDDFNp2q7Ymvyv75hFGC8DAcygVyJbNF": "Kraken2",
        "rGZjPjMkfhAqmc1ssEiT753uAgyftHRo2m": "Kraken3",
        "rp7TCczQuQo61dUo1oAgwdpRxLrA8vDaNV": "Kraken4",
        "rEvuKRoEbZSbM5k5Qe5eTD9BixZXsfkxHf": "Kraken5",
        "rnJrjec2vrTJAAQUTMTjj7U6xdXrk9N4mT": "Kraken6",
        "rHapXGCL7KXTovvpEqLfDiZ6WV7vMhPWGJ": "Kraken7"
    },
    "KuCoin": {
         "rLpvuHZFE46NUyZH5XaMvmYRJZF7aory7t": "Kucoin11",
         "rNFugeoj3ZN8Wv6xhuLegUBBPXKCyWLRkB": "Kucoin5",
         "rBxszqhQkhPALtkSpGuVeqR6hNtZ8xTH3T": "Kucoin7",
         "rp4gqz1XdqMsWRZbzPdPAQWw1tg5LuwUVP": "Kucoin8"
    },
    "luno": {
        "rsRy14FvipgqudiGmptJBhr1RtpsgfzKMM": "Luno1",
        "rsbfd5ZYWqy6XXf6hndPbRjDAzfmWc1CeQ": "Luno2"
    },
    "mexc": {
        "rs2dgzYeqYqsk8bvkQR5YPyqsXYcA24MP2": "Mexc"
    },
    "mercadobitcoin": {
        "rnW8je5SsuFjkMSWkgfXvqZH3gLTpXxfFH": "Mercado Bitcoin 1",
        "rPEPYN8sHU3cytBwVm69qPbVztaoj7wNf": "Mercado Bitcoin 3"
    },
    "okx": {
        "rUzWJkXyEtT8ekSSxkBYPqCvHpngcy6Fks": "Okx"
    },
    "paribu": {
        "rM9e4hDCEu4hY8SESypL9ymM2sMauDCncf": "Paribu 3"
    },
    "tradeogre": {
        "rhsZa1NR9GqA7NtQjDe5HtYWZxPAZ4oGrE": "TradeOgre"
    },
    "uphold": {
        "rQrQMKhcw3WnptGeWiYSwX5Tz3otyJqPnq": "Uphold2",
        "rMdG3ju8pgyVh29ELPWaDuA74CpWW6Fxns": "Uphold3",
        "rBEc94rUFfLfTDwwGN7rQGBHc883c2QHhx": "Uphold4",
        "rsX8cp4aj9grKVD9V1K2ouUBXgYsjgUtBL": "Uphold8",
        "rErKXcbZj9BKEMih6eH6ExvBoHn9XLnTWe": "Uphold9",
        "rKe7pZPwdKEubmEDCAu9djJVsQfK4Atmzr": "Uphold11",
        "rsXT3AQqhHDusFs3nQQuwcA1yXRLZJAXKw": "uphold12"
    },
    "upbit": {
        "raQwCVAJVqjrVm1Nj5SFRcX8i22BhdC9WA": "Upbit1",
        "rfL1mn4VTCoHdhHhHMwqpShCFUaDBRk6Z5": "Upbit12",
        "rwa7YXssGVAL9yPKw6QJtCen2UqZbRQqpM": "Upbit13",
        "rNcAdhSLXBrJ3aZUq22HaNtNEPpB5fR8Ri": "Upbit14",
        "r38a3PtqW3M7LRESgaR4dyHjg3AxAmiZCt": "Upbit15",
        "rMNUAfSz2spLEbaBwPnGtxTzZCajJifnzH": "Upbit16",
        "rJWbw1u3oDDRcYLFqiWFjhGWRKVcBAWdgp": "Upbit17",
        "rs48xReB6gjKtTnTfii93iwUhjhTJsW78B": "Upbit18",
        "rJo4m69u9Wd1F8fN2RbgAsJEF6a4hW1nSi": "Upbit19",
        "rLgn612WAgRoZ285YmsQ4t7kb8Ui3csdoU": "Upbit20",
        "r4G689g4KePYLKkyyumM1iUppTP4nhZwVC": "Upbit21",
        "rDxJNbV23mu9xsWoQHoBqZQvc77YcbJXwb": "Upbit22",
        "rHHQeqjz2QyNj1DVoAbcvfaKLv7RxpHMNE": "Upbit23"
    },
     "sbi": {
        "rNRc2S2GSefSkTkAiyjE6LDzMonpeHp6jS": "SBI VC TRADE 4",
        "raSZXZApFg7Nj1B5G6BnhoL6HcTqVMopJ3": "SBI VC Trade 5",
        "r39uEuRjzLaSgvkjTfcejodbSrXLM3cYnX": "SBI VC Trade 6",
        "rDDyH5nfvozKZQCwiBrWfcE528sWsBPWET": "SBI VC Trade 1",
        "rKcVYzVK1f4PhRFjLhWP7QmteG5FpPgRub": "SBI VC Trade 2",
        "rUaESVd1yLMy5VyoJvwwuqE8ZiCb2PEqBR": "SBI VC Trade 3"
    },

    "stake": {
        "rnqZnvzoJjdg7n1P9pmumJ7FQ5wxNH3gYC": "Stake1",
        "razLtrbzXVXYvViLqUKLh8YenGLJid9ZTW": "Stake2",
        "rBA7oBScBPccjDcemGhkmCY82v2ZeLa2K2f": "Stake3",
        "rBndy89HdamJ3UHNekAS6ALjW9WoCE2W5s": "Stake4"
    },
    "korbit": {
        "rBTjeJu1Rvnbq476Y7PDnvnXUeERV9CxEQ": "Korbit1",
        "rJRarS792K6LTqHsFkZGzM1Ue6G8jZ2AfK": "Korbit2",
        "rGU8q9qNCCQG2eMgJpLJJ1YFF5JAbntqau": "Korbit3",
        "r9WGxuEbUSh3ziYt34mBRViPbqVxZmwsu3": "Korbit4",
        "rNWWbLxbZRKd51NNZCEjoSNovrrx7yiPyt": "Korbit5",
        "rGq74nAmw1ARejUNLYEBGxiQBaoNtryEe9": "Korbit6",
        "rsYFhEk4uFvwvvKJomHL7KhdF29r2sw9KD": "Korbit7",
        "rwnXZEUe7o29SPcWZwnZukR8fdXmFMWHAN": "Korbit8"
    },
    "swissbirg": {
        "rfyE1wqH1YY3u6BcauQwYuoD13GVtJErXq": "SwissBirg 3"
    },
    "virtune": {
        "rnaiDK2aDkDCCoRk3n9oyzbrtBcGPdHL2t": "Virtune"
    },
    "Evernorth": {
        "rsT3yYMkuicxW1hYsy787mg5XHhkz2uQRk": "Evernorth1",
        "rKXXrAgpkHQN8m4HxAQCYmDCPPUByc9mVq": "Evernorth2",
        "rKhjV48GdbgxAAfSvusqGNktGwAxnzzXpv": "Evernorth3",
        "rGJBNGkDeRPNvNJCi57Ht1ncdht9SuctLe": "Evernorth4",
        "rJX1qoSGYmx5NWJEpsBGKvxmYpGR7mDtop": "Evernorth5", 
        "rJuyHPDFpfeVhxfxZboTf7BYu1ptGus1v3": "Evernorth6",
        "rUgQciCPP1AiwQ9f5zstYu9RzVfsKQRGc2": "Evernorth7",
        "rPhQdyEaz4kcSoYKTAQhvkvdYxWKKw2vSC": "Evernorth8",
        "rGy4zJtGfGtF7dtjZmBraQTcfZSQgwqpaa": "Evernorth9"
		}
        };

        let exchangeData = {};
        let isExchangeFetching = false;
        let exchangeDataTimestamp = null;
        const EXCHANGE_CACHE_DURATION = 60 * 60 * 1000; // 1 hour cache

        async function fetchSingleBalance(address) {
            for (const url of RIPPLED_URLS) {
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            method: 'account_info',
                            params: [{
                                account: address,
                                ledger_index: 'validated',
                                strict: true
                            }]
                        })
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        if (data.result && data.result.account_data) {
                            return parseInt(data.result.account_data.Balance) / 1000000;
                        }
                    }
                } catch (error) {
                    continue;
                }
            }
            return null;
        }

        async function fetchExchangeData(forceRefresh = false) {
            // Check if we have cached data that's still valid
            if (!forceRefresh && exchangeDataTimestamp && Object.keys(exchangeData).length > 0) {
                const cacheAge = Date.now() - exchangeDataTimestamp;
                if (cacheAge < EXCHANGE_CACHE_DURATION) {
                    // Use cached data
                    renderExchangeTable();
                    const remainingMs = EXCHANGE_CACHE_DURATION - cacheAge;
                    const remainingMins = Math.ceil(remainingMs / 60000);
                    const displayTime = remainingMins > 60 
                        ? `${Math.floor(remainingMins / 60)}h ${remainingMins % 60}m` 
                        : `${remainingMins}m`;
                    document.getElementById('exchangeStatus').innerHTML = 
                        `<span style="color: var(--accent-green);"> Cached (${displayTime})</span>`;
                    return;
                }
            }

            if (isExchangeFetching) return;
            isExchangeFetching = true;

            const btn = document.getElementById('fetchExchangeBtn');
            const statusEl = document.getElementById('exchangeStatus');
            const tableBody = document.getElementById('exchangeTableBody');
            
            btn.disabled = true;
            btn.textContent = ' Fetching...';
            statusEl.innerHTML = '<span style="color: var(--accent-orange);"> Fetching...</span>';
            
            tableBody.innerHTML = `
                <tr>
                    <td colspan="6" style="text-align: center; padding: 3rem;">
                        <div class="spinner" style="margin: 0 auto 1rem;"></div>
                        <p style="color: var(--text-muted);">Fetching balances from XRPL nodes...</p>
                        <div class="exchange-progress">
                            <div class="exchange-progress-bar" id="exchangeProgressBar" style="width: 0%"></div>
                        </div>
                        <p id="exchangeProgressText" style="color: var(--text-muted); font-size: 0.8rem; margin-top: 0.5rem;">0 / 0</p>
                    </td>
                </tr>
            `;

            exchangeData = {};
            let totalAddresses = 0;
            let fetchedAddresses = 0;

            // Count total addresses
            for (const [exchange, wallets] of Object.entries(EXCHANGES)) {
                totalAddresses += Object.keys(wallets).length;
            }

            // Fetch balances for each exchange
            for (const [exchangeName, wallets] of Object.entries(EXCHANGES)) {
                let exchangeTotal = 0;
                let walletCount = 0;
                let successCount = 0;

                for (const [address, walletName] of Object.entries(wallets)) {
                    const balance = await fetchSingleBalance(address);
                    fetchedAddresses++;
                    
                    // Update progress
                    const progress = (fetchedAddresses / totalAddresses) * 100;
                    document.getElementById('exchangeProgressBar').style.width = progress + '%';
                    document.getElementById('exchangeProgressText').textContent = 
                        `${fetchedAddresses} / ${totalAddresses} wallets`;

                    if (balance !== null) {
                        exchangeTotal += balance;
                        successCount++;
                    }
                    walletCount++;
                }

                exchangeData[exchangeName] = {
                    total: exchangeTotal,
                    walletCount: walletCount,
                    successCount: successCount
                };
            }

            renderExchangeTable();
            
            // Save timestamp for cache
            exchangeDataTimestamp = Date.now();
            
            btn.disabled = false;
            btn.textContent = ' Refresh Data';
            statusEl.innerHTML = '<span style="color: var(--accent-green);"> Live</span>';
            isExchangeFetching = false;
        }

        function renderExchangeTable() {
            const tableBody = document.getElementById('exchangeTableBody');
            
            // Sort exchanges by total balance
            const sortedExchanges = Object.entries(exchangeData)
                .sort((a, b) => b[1].total - a[1].total);

            // Calculate grand total
            let grandTotal = sortedExchanges.reduce((sum, [_, data]) => sum + data.total, 0);

            // Update summary
            document.getElementById('exchangeTotalXRP').textContent = formatHoldingsNumber(grandTotal);
            if (currentXRPPrice) {
                document.getElementById('exchangeTotalValue').textContent = 
                    formatHoldingsCurrency(grandTotal * currentXRPPrice);
            }
            document.getElementById('exchangeCount').textContent = sortedExchanges.length;
            document.getElementById('exchangeResultCount').textContent = 
                `${sortedExchanges.length} exchanges loaded`;

            // Build table rows
            let rows = '';
            sortedExchanges.forEach(([name, data], index) => {
                const marketShare = grandTotal > 0 ? (data.total / grandTotal * 100) : 0;
                const valueUSD = currentXRPPrice ? data.total * currentXRPPrice : 0;
                
                rows += `
                    <tr>
                        <td style="text-align: left; font-weight: 600; color: var(--accent-xrp);">#${index + 1}</td>
                        <td style="text-align: left; text-transform: capitalize;">${name}</td>
                        <td>${formatHoldingsNumber(data.total)}</td>
                        <td>${currentXRPPrice ? formatHoldingsCurrency(valueUSD) : ''}</td>
                        <td>${marketShare.toFixed(2)}%</td>
                        <td>${data.successCount}/${data.walletCount}</td>
                    </tr>
                `;
            });

            // Add total row
            rows += `
                <tr class="total-row">
                    <td></td>
                    <td style="text-align: left;"><strong>TOTAL</strong></td>
                    <td><strong>${formatHoldingsNumber(grandTotal)}</strong></td>
                    <td><strong>${currentXRPPrice ? formatHoldingsCurrency(grandTotal * currentXRPPrice) : ''}</strong></td>
                    <td><strong>100%</strong></td>
                    <td></td>
                </tr>
            `;

            tableBody.innerHTML = rows;
            
            // Render exchange charts
            renderExchangeCharts();
        }

        function filterExchangeTable() {
            const filter = document.getElementById('exchangeFilter').value.toLowerCase();
            const rows = document.querySelectorAll('#exchangeTableBody tr:not(.total-row)');
            
            rows.forEach(row => {
                const exchangeName = row.cells[1]?.textContent.toLowerCase() || '';
                row.style.display = exchangeName.includes(filter) ? '' : 'none';
            });
        }

        // =====================================================
        // EXISTING ETF TRADING TRACKER CODE BELOW
        // =====================================================

        const descriptions = {
            'EZPZ': 'Franklin Templeton',
            'GDLC': 'Grayscale Digital Large Cap',
            'NCIQ': 'Hashdex Nasdaq Crypto Index',
            'BITW': 'Bitwise 10 Crypto Index',
            'GXRP': 'Grayscale',
            'XRP': 'Bitwise XRP',
            'XRPC': 'Canary Capital XRP',
            'XRPZ': 'Franklin XRP',
            'TOXR': '21Shares',
            'UXRP': 'ProShares Ultra',
            'XRPI': 'Volatility Shares Trust',
            'XRPM': 'Amplify',
            'XRPR': 'REX-Osprey',
            'XRPK': 'T-REX 2X Long',
            'XRPT': 'Volatility Shares 2x',
            'XXRP': 'Teucrium 2x Long',
            'XRP.TO': 'Purpose',
            'XRPP-B.TO': 'Purpose',
            'XRPP-U.TO': 'Purpose USD Non-Hedged',
            'XRPP.TO': 'Purpose CAD Hedged',
            'XRPQ-U.TO': '3iQ USD',
            'XRPQ.TO': '3iQ',
            'XRP.NE': 'Canada ETF',
            'XRPP.NE': 'Purpose NEO'
        };

        const groupIcons = {
            'Spot ETFs': { icon: '', class: 'spot' },
            'Futures ETFs': { icon: '', class: 'futures' },
            'Index ETFs': { icon: '', class: 'index' },
            'Canada ETFs': { icon: '', class: 'canada' }
        };

        // Order of groups (Spot first)
        const groupOrder = ['Spot ETFs', 'Futures ETFs', 'Index ETFs', 'Canada ETFs'];

        // Default API URL
        const API_URL = 'https://xrp-gtve.onrender.com';

        let currentPeriod = 'daily';
        let cachedData = null;
        let autoRefreshInterval = null;

        // Global variable to store current XRP price
        let currentXRPPrice = null;

        async function fetchXRPPrice() {
            try {
                // Try CoinGecko first
                const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=ripple&vs_currencies=usd&include_24hr_change=true');
                
                if (!response.ok) {
                    throw new Error('CoinGecko API error');
                }
                
                const data = await response.json();
                
                if (data.ripple && data.ripple.usd) {
                    const price = data.ripple.usd;
                    const change = data.ripple.usd_24h_change || 0;
                    
                    // Store price globally
                    currentXRPPrice = price;
                    
                    const priceEl = document.getElementById('xrpPrice');
                    const changeClass = change >= 0 ? 'positive' : 'negative';
                    const changeSymbol = change >= 0 ? '+' : '';
                    
                    priceEl.innerHTML = `
                        <span class="xrp-label">XRP Price</span>
                        <span class="xrp-value">$${price.toFixed(4)}</span>
                        <span class="xrp-change ${changeClass}">${changeSymbol}${change.toFixed(2)}% (24h)</span>
                    `;
                    
                    // Update holdings summary if on that tab
                    updateHoldingsSummary();
                } else {
                    throw new Error('Invalid data');
                }
            } catch (error) {
                console.error('Error fetching XRP price:', error);
                // Try backup API (Binance)
                try {
                    const binanceResponse = await fetch('https://api.binance.com/api/v3/ticker/24hr?symbol=XRPUSDT');
                    const binanceData = await binanceResponse.json();
                    
                    const price = parseFloat(binanceData.lastPrice);
                    const change = parseFloat(binanceData.priceChangePercent);
                    
                    // Store price globally
                    currentXRPPrice = price;
                    
                    const priceEl = document.getElementById('xrpPrice');
                    const changeClass = change >= 0 ? 'positive' : 'negative';
                    const changeSymbol = change >= 0 ? '+' : '';
                    
                    priceEl.innerHTML = `
                        <span class="xrp-label">XRP Price</span>
                        <span class="xrp-value">$${price.toFixed(4)}</span>
                        <span class="xrp-change ${changeClass}">${changeSymbol}${change.toFixed(2)}% (24h)</span>
                    `;
                    
                    // Update holdings summary if on that tab
                    updateHoldingsSummary();
                } catch (backupError) {
                    console.error('Backup API also failed:', backupError);
                    document.getElementById('xrpPrice').innerHTML = `
                        <span class="xrp-label">XRP Price</span>
                        <span class="xrp-value">--</span>
                    `;
                }
            }
        }

        function formatNumber(num) {
            if (num >= 1e9) return (num / 1e9).toFixed(2) + 'B';
            if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';
            if (num >= 1e3) return (num / 1e3).toFixed(1) + 'K';
            return num.toLocaleString();
        }

        function formatCurrency(num) {
            return '$' + formatNumber(num);
        }

        function setPeriod(period) {
            currentPeriod = period;
            document.querySelectorAll('.controls .btn[data-period]').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.period === period);
            });
            if (cachedData) {
                renderData(cachedData);
            }
        }

        function startAutoRefresh() {
            // Clear existing interval
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
            // Set up auto-refresh every 5 minutes (300000 ms)
            autoRefreshInterval = setInterval(() => {
                console.log('Auto-refreshing data...');
                fetchXRPPrice();
                fetchData(true); // silent refresh
            }, 300000);
        }

        async function fetchData(silent = false) {
            const refreshBtn = document.getElementById('refreshBtn');
            const statusText = document.getElementById('statusText');
            
            refreshBtn.disabled = true;
            refreshBtn.textContent = ' Loading...';
            statusText.textContent = 'Fetching...';
            
            if (!silent) {
                document.getElementById('mainContent').innerHTML = `
                    <div class="loading-container">
                        <div class="spinner"></div>
                        <p class="loading-text">Fetching ETF data...</p>
                    </div>
                `;
            }

            try {
                const response = await fetch(`${API_URL}/api/etf-data`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const data = await response.json();
                cachedData = data;
                
                const now = new Date().toLocaleTimeString();
                document.getElementById('lastUpdated').textContent = `Last updated: ${data.timestamp} (fetched ${now})`;
                statusText.textContent = data.cached ? 'Cached' : 'Live';
                
                renderData(data);
            } catch (error) {
                console.error('Fetch error:', error);
                if (!silent) {
                    showError(`Failed to fetch data: ${error.message}`);
                }
                statusText.textContent = 'Error';
            } finally {
                refreshBtn.disabled = false;
                refreshBtn.textContent = ' Refresh Data';
            }
        }

        function showError(message) {
            document.getElementById('mainContent').innerHTML = `
                <div class="error-container">
                    <div class="error-icon"></div>
                    <p class="error-message">${message}</p>
                    <p class="error-hint">Make sure your API URL is correct and the server is running.</p>
                    <button class="btn btn-refresh" onclick="fetchData()">Try Again</button>
                </div>
            `;
        }

        function renderData(data) {
            const groups = data.data;
            let html = '<div class="etf-groups">';

            let grandTotalShares = 0;
            let grandTotalDollars = 0;
            
            // Collect all ETFs for ranking
            let allETFs = [];

            // Render in specified order
            for (const groupName of groupOrder) {
                const etfs = groups[groupName] || [];
                const groupInfo = groupIcons[groupName] || { icon: '', class: 'index' };
                
                // Calculate group totals and collect ETFs
                let groupTotalShares = 0;
                let groupTotalDollars = 0;

                etfs.forEach(etf => {
                    const periodData = etf[currentPeriod] || etf.daily || {};
                    groupTotalShares += periodData.shares || 0;
                    groupTotalDollars += periodData.dollars || 0;
                    
                    // Add to all ETFs list for ranking
                    allETFs.push({
                        symbol: etf.symbol,
                        price: etf.price,
                        shares: periodData.shares || 0,
                        dollars: periodData.dollars || 0,
                        group: groupName
                    });
                });

                grandTotalShares += groupTotalShares;
                grandTotalDollars += groupTotalDollars;
                
                // Sort ETFs by volume (dollars) within each group
                const sortedETFs = [...etfs].sort((a, b) => {
                    const aData = a[currentPeriod] || a.daily || {};
                    const bData = b[currentPeriod] || b.daily || {};
                    return (bData.dollars || 0) - (aData.dollars || 0);
                });

                html += `
                    <div class="etf-group">
                        <div class="group-header">
                            <div class="group-title">
                                <div class="group-icon ${groupInfo.class}">${groupInfo.icon}</div>
                                <span class="group-name">${groupName}</span>
                            </div>
                            <span class="group-count">${etfs.length} ETFs</span>
                        </div>
                        <div class="table-wrapper">
                            <table>
                                <thead>
                                    <tr>
                                        <th style="width: 50px;">#</th>
                                        <th>Symbol</th>
                                        <th class="right">Price</th>
                                        <th class="right">Volume (Shares)</th>
                                        <th class="right">Volume ($)</th>
                                    </tr>
                                </thead>
                                <tbody>
                `;

                if (sortedETFs.length === 0) {
                    html += `
                        <tr>
                            <td colspan="5" class="no-data">No data available for this group</td>
                        </tr>
                    `;
                } else {
                    sortedETFs.forEach((etf, index) => {
                        const periodData = etf[currentPeriod] || etf.daily || {};
                        const desc = descriptions[etf.symbol] || etf.description || '';
                        const rank = index + 1;
                        const rankColor = rank === 1 ? 'var(--accent-xrp)' : rank === 2 ? 'var(--accent-purple)' : rank === 3 ? 'var(--accent-orange)' : 'var(--text-muted)';
                        
                        html += `
                            <tr>
                                <td style="text-align: center; font-weight: 700; color: ${rankColor};">${rank}</td>
                                <td>
                                    <div class="symbol-cell">
                                        <div>
                                            <div class="symbol-badge">${etf.symbol}</div>
                                            <div class="symbol-desc">${desc}</div>
                                        </div>
                                    </div>
                                </td>
                                <td class="volume-cell">
                                    <span class="price">$${etf.price.toFixed(2)}</span>
                                </td>
                                <td class="volume-cell">
                                    <div class="volume-shares">${formatNumber(periodData.shares || 0)}</div>
                                </td>
                                <td class="volume-cell">
                                    <div class="volume-shares">${formatCurrency(periodData.dollars || 0)}</div>
                                </td>
                            </tr>
                        `;
                    });

                    // Add total row for each group
                    html += `
                        <tr class="total-row">
                            <td></td>
                            <td>
                                <div class="symbol-badge">TOTAL</div>
                            </td>
                            <td></td>
                            <td class="volume-cell">
                                <div class="volume-shares">${formatNumber(groupTotalShares)}</div>
                            </td>
                            <td class="volume-cell">
                                <div class="volume-shares">${formatCurrency(groupTotalDollars)}</div>
                            </td>
                        </tr>
                    `;
                }

                html += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            }

            html += '</div>';
            
            // Sort all ETFs by volume for top rankings
            allETFs.sort((a, b) => b.dollars - a.dollars);
            const top10 = allETFs.slice(0, 10);
            
            // Top Volume Rankings Section
            html += `
                <div class="etf-group" style="border: 2px solid var(--accent-xrp); margin-top: 2rem;">
                    <div class="group-header" style="background: linear-gradient(135deg, var(--bg-secondary), var(--accent-xrp-dim));">
                        <div class="group-title">
                            <div class="group-icon spot" style="background: linear-gradient(135deg, var(--accent-xrp), var(--accent-purple));"></div>
                            <span class="group-name">Top 10 ETFs by Volume (${currentPeriod.charAt(0).toUpperCase() + currentPeriod.slice(1)})</span>
                        </div>
                    </div>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th style="width: 60px;">Rank</th>
                                    <th>Symbol</th>
                                    <th>Category</th>
                                    <th class="right">Price</th>
                                    <th class="right">Volume ($)</th>
                                    <th class="right">Market Share</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            top10.forEach((etf, index) => {
                const rank = index + 1;
                const medal = rank === 1 ? '' : rank === 2 ? '' : rank === 3 ? '' : `#${rank}`;
                const rankStyle = rank <= 3 ? 'font-size: 1.2rem;' : 'color: var(--text-muted); font-weight: 600;';
                const marketShare = grandTotalDollars > 0 ? ((etf.dollars / grandTotalDollars) * 100).toFixed(2) : 0;
                const desc = descriptions[etf.symbol] || '';
                
                html += `
                    <tr>
                        <td style="text-align: center; ${rankStyle}">${medal}</td>
                        <td>
                            <div class="symbol-cell">
                                <div>
                                    <div class="symbol-badge">${etf.symbol}</div>
                                    <div class="symbol-desc">${desc}</div>
                                </div>
                            </div>
                        </td>
                        <td style="color: var(--text-secondary); font-size: 0.85rem;">${etf.group}</td>
                        <td class="volume-cell">
                            <span class="price">$${etf.price.toFixed(2)}</span>
                        </td>
                        <td class="volume-cell">
                            <div class="volume-shares" style="color: var(--accent-xrp);">${formatCurrency(etf.dollars)}</div>
                        </td>
                        <td class="volume-cell">
                            <div class="volume-shares">${marketShare}%</div>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                            </tbody>
                        </table>
                    </div>
                </div>
            `;

            // Grand Total Section
            html += `
                <div class="grand-total">
                    <h3> Grand Total (${currentPeriod.charAt(0).toUpperCase() + currentPeriod.slice(1)})</h3>
                    <div class="grand-total-grid">
                        <div class="grand-total-item">
                            <div class="grand-total-label">Total Volume (Shares)</div>
                            <div class="grand-total-value">${formatNumber(grandTotalShares)}</div>
                        </div>
                        <div class="grand-total-item">
                            <div class="grand-total-label">Total Volume ($)</div>
                            <div class="grand-total-value">${formatCurrency(grandTotalDollars)}</div>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('mainContent').innerHTML = html;
        }

        // Popup functions
        function showPopup() {
            document.getElementById('popupOverlay').classList.add('active');
        }

        function closePopup() {
            document.getElementById('popupOverlay').classList.remove('active');
            localStorage.setItem('popup_closed', Date.now());
        }

        function shouldShowPopup() {
            const lastClosed = localStorage.getItem('popup_closed');
            if (!lastClosed) return true;
            const hoursSinceClosed = (Date.now() - parseInt(lastClosed)) / (1000 * 60 * 60);
            return hoursSinceClosed > 24;
        }

        // Chart variables
        let etfChart = null;
        let currentChartType = 'price';
        let currentChartPeriod = '1mo';
        let historicalData = null;

        const chartColors = [
            '#23f7dd', '#a855f7', '#22c55e', '#f97316', '#3b82f6', 
            '#ef4444', '#eab308', '#ec4899', '#14b8a6', '#8b5cf6',
            '#06b6d4', '#f43f5e', '#84cc16', '#6366f1', '#10b981',
            '#f59e0b', '#64748b', '#0ea5e9', '#d946ef', '#78716c'
        ];

        function openChartModal() {
            document.getElementById('chartOverlay').classList.add('active');
            fetchHistoricalData();
        }

        function closeChartModal() {
            document.getElementById('chartOverlay').classList.remove('active');
        }

        function switchChart(type) {
            currentChartType = type;
            document.querySelectorAll('.chart-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.chart === type);
            });
            if (historicalData) {
                renderChart();
            }
        }

        function setChartPeriod(period) {
            currentChartPeriod = period;
            document.querySelectorAll('.chart-period').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.cperiod === period);
            });
            fetchHistoricalData();
        }

        async function fetchHistoricalData() {
            document.getElementById('chartLoading').style.display = 'flex';
            document.getElementById('etfChart').style.display = 'none';
            document.getElementById('chartLegend').innerHTML = '';

            try {
                const response = await fetch(`${API_URL}/api/historical?period=${currentChartPeriod}`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                historicalData = await response.json();
                renderChart();
            } catch (error) {
                console.error('Error fetching historical data:', error);
                document.getElementById('chartLegend').innerHTML = `
                    <div style="color: var(--accent-red); text-align: center; width: 100%;">
                        Failed to load chart data. Please try again.
                    </div>
                `;
            } finally {
                document.getElementById('chartLoading').style.display = 'none';
                document.getElementById('etfChart').style.display = 'block';
            }
        }

        function renderChart() {
            if (!historicalData || !historicalData.data) return;

            const ctx = document.getElementById('etfChart').getContext('2d');
            
            // Destroy existing chart
            if (etfChart) {
                etfChart.destroy();
            }

            const datasets = [];
            let colorIndex = 0;
            let allDates = new Set();

            // Collect all dates and prepare datasets
            for (const [symbol, data] of Object.entries(historicalData.data)) {
                data.forEach(d => allDates.add(d.date));
            }

            const sortedDates = Array.from(allDates).sort();

            // Create dataset for each ETF
            for (const [symbol, data] of Object.entries(historicalData.data)) {
                const color = chartColors[colorIndex % chartColors.length];
                
                // Create a map for quick lookup
                const dataMap = {};
                data.forEach(d => {
                    dataMap[d.date] = currentChartType === 'price' ? d.price : d.volume;
                });

                // Fill in data for all dates
                const values = sortedDates.map(date => dataMap[date] || null);

                datasets.push({
                    label: symbol,
                    data: values,
                    borderColor: color,
                    backgroundColor: color + '20',
                    pointBackgroundColor: color,
                    pointBorderColor: color,
                    pointRadius: 0,
                    pointHoverRadius: 5,
                    borderWidth: 2,
                    fill: false,
                    tension: 0.3,
                    spanGaps: true
                });
                colorIndex++;
            }

            // Sort datasets by latest value for legend
            datasets.sort((a, b) => {
                const aLast = a.data.filter(v => v !== null).pop() || 0;
                const bLast = b.data.filter(v => v !== null).pop() || 0;
                return bLast - aLast;
            });

            const chartTitle = currentChartType === 'price' ? 'Price Comparison' : 'Volume Comparison';

            etfChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: sortedDates.map(d => {
                        const date = new Date(d);
                        return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                    }),
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: '#16161f',
                            borderColor: '#23f7dd',
                            borderWidth: 1,
                            titleColor: '#ffffff',
                            bodyColor: '#8888a0',
                            padding: 12,
                            callbacks: {
                                label: function(context) {
                                    if (context.raw === null) return null;
                                    let value = context.raw;
                                    if (currentChartType === 'price') {
                                        return context.dataset.label + ': $' + value.toFixed(2);
                                    } else {
                                        return context.dataset.label + ': ' + formatNumber(value);
                                    }
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: '#8888a0',
                                maxRotation: 45,
                                minRotation: 45,
                                maxTicksLimit: 10
                            },
                            grid: {
                                color: '#2a2a3a'
                            }
                        },
                        y: {
                            ticks: {
                                color: '#8888a0',
                                callback: function(value) {
                                    if (currentChartType === 'price') {
                                        return '$' + value.toFixed(2);
                                    }
                                    return formatNumber(value);
                                }
                            },
                            grid: {
                                color: '#2a2a3a'
                            }
                        }
                    }
                }
            });

            // Render interactive legend
            const legendHtml = datasets.map((d, i) => {
                const lastValue = d.data.filter(v => v !== null).pop() || 0;
                const valueStr = currentChartType === 'price' 
                    ? '$' + lastValue.toFixed(2) 
                    : formatNumber(lastValue);
                return `
                    <div class="legend-item" onclick="toggleDataset(${i})" style="cursor: pointer; opacity: 1;" data-index="${i}">
                        <div class="legend-color" style="background: ${d.borderColor}"></div>
                        <span>${d.label}: ${valueStr}</span>
                    </div>
                `;
            }).join('');
            document.getElementById('chartLegend').innerHTML = legendHtml;
        }

        function toggleDataset(index) {
            if (!etfChart) return;
            const meta = etfChart.getDatasetMeta(index);
            meta.hidden = !meta.hidden;
            etfChart.update();
            
            // Update legend opacity
            const legendItem = document.querySelector(`.legend-item[data-index="${index}"]`);
            if (legendItem) {
                legendItem.style.opacity = meta.hidden ? '0.4' : '1';
            }
        }

        // Close modals on escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeChartModal();
                closePopup();
            }
        });

        // =====================================================
        // NEWS TAB FUNCTIONS
        // =====================================================
        let currentNewsFilter = 'xrp';

        function filterNews(category) {
            currentNewsFilter = category;
            
            // Update active button
            document.querySelectorAll('.news-filters .btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.news === category);
            });
            
            // Filter news items
            const newsItems = document.querySelectorAll('.news-item');
            newsItems.forEach(item => {
                const itemCategory = item.dataset.category || '';
                
                if (category === 'all') {
                    item.style.display = 'block';
                } else if (itemCategory.includes(category)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        function loadMoreNews() {
            alert('For live news feeds, consider integrating with CryptoPanic API, CoinDesk RSS, or other crypto news aggregators.');
        }

        // =====================================================
        // PORTFOLIO TAB FUNCTIONS
        // =====================================================
        let portfolio = [];

        function loadPortfolio() {
            const saved = localStorage.getItem('xrp_portfolio');
            if (saved) {
                portfolio = JSON.parse(saved);
            }
            renderPortfolioList();
        }

        function savePortfolio() {
            localStorage.setItem('xrp_portfolio', JSON.stringify(portfolio));
            checkAchievements();
            alert('Portfolio saved!');
        }

        function addHolding() {
            const asset = document.getElementById('holdingAsset').value;
            const amount = parseFloat(document.getElementById('holdingAmount').value);
            const price = parseFloat(document.getElementById('holdingPrice').value);
            const date = document.getElementById('holdingDate').value;

            if (!amount || !price) {
                alert('Please enter amount and price');
                return;
            }

            portfolio.push({
                id: Date.now(),
                asset,
                amount,
                buyPrice: price,
                date: date || new Date().toISOString().split('T')[0]
            });

            // Clear form
            document.getElementById('holdingAmount').value = '';
            document.getElementById('holdingPrice').value = '';
            
            savePortfolio();
            renderPortfolioList();
            updatePortfolioDisplay();
        }

        function removeHolding(id) {
            portfolio = portfolio.filter(h => h.id !== id);
            savePortfolio();
            renderPortfolioList();
            updatePortfolioDisplay();
        }

        function renderPortfolioList() {
            const container = document.getElementById('portfolioHoldingsList');
            
            if (portfolio.length === 0) {
                container.innerHTML = `
                    <div class="empty-portfolio">
                        <span></span>
                        <p>No holdings yet. Add your first holding above!</p>
                    </div>
                `;
                return;
            }

            let html = '';
            portfolio.forEach(holding => {
                const currentPrice = holding.asset === 'XRP' ? currentXRPPrice : currentXRPPrice; // Simplified
                const currentValue = holding.amount * currentPrice;
                const costBasis = holding.amount * holding.buyPrice;
                const pnl = currentValue - costBasis;
                const pnlPercent = costBasis > 0 ? ((pnl / costBasis) * 100).toFixed(2) : 0;
                const pnlClass = pnl >= 0 ? 'positive' : 'negative';

                html += `
                    <div class="holding-item">
                        <div class="holding-asset">${holding.asset}</div>
                        <div class="holding-amount">${holding.amount.toLocaleString()}</div>
                        <div class="holding-value">
                            <div>$${currentValue.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</div>
                            <div class="holding-pnl ${pnlClass}">${pnl >= 0 ? '+' : ''}$${pnl.toFixed(2)} (${pnlPercent}%)</div>
                        </div>
                        <button class="holding-delete" onclick="removeHolding(${holding.id})"></button>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function updatePortfolioDisplay() {
            let totalValue = 0;
            let totalCost = 0;
            let totalXRP = 0;

            portfolio.forEach(holding => {
                const currentPrice = holding.asset === 'XRP' ? currentXRPPrice : currentXRPPrice;
                totalValue += holding.amount * currentPrice;
                totalCost += holding.amount * holding.buyPrice;
                if (holding.asset === 'XRP') totalXRP += holding.amount;
            });

            const pnl = totalValue - totalCost;
            const pnlPercent = totalCost > 0 ? ((pnl / totalCost) * 100).toFixed(2) : 0;
            const avgPrice = totalXRP > 0 ? (totalCost / totalXRP) : 0;

            document.getElementById('portfolioTotalValue').textContent = '$' + totalValue.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
            document.getElementById('portfolioTotalXRP').textContent = totalXRP.toLocaleString();
            document.getElementById('portfolioAvgPrice').textContent = '$' + avgPrice.toFixed(4);
            document.getElementById('portfolioPnL').textContent = (pnl >= 0 ? '+$' : '-$') + Math.abs(pnl).toFixed(2);
            document.getElementById('portfolioPnL').style.color = pnl >= 0 ? 'var(--accent-green)' : 'var(--accent-red)';
            
            const changeEl = document.getElementById('portfolioChange');
            changeEl.textContent = (pnl >= 0 ? '+' : '') + pnlPercent + '%';
            changeEl.className = 'portfolio-card-change ' + (pnl >= 0 ? 'positive' : 'negative');
        }

        function calculateWhatIf() {
            const investment = parseFloat(document.getElementById('calcInvestment').value) || 0;
            const buyPrice = parseFloat(document.getElementById('calcBuyPrice').value) || 0;
            const currentPrice = parseFloat(document.getElementById('calcCurrentPrice').value) || currentXRPPrice;

            if (buyPrice <= 0) {
                alert('Please enter a valid buy price');
                return;
            }

            const xrpPurchased = investment / buyPrice;
            const currentValue = xrpPurchased * currentPrice;
            const profit = currentValue - investment;
            const roi = ((profit / investment) * 100).toFixed(2);

            document.getElementById('calcXRP').textContent = xrpPurchased.toLocaleString(undefined, {maximumFractionDigits: 2});
            document.getElementById('calcValue').textContent = '$' + currentValue.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
            document.getElementById('calcProfit').textContent = (profit >= 0 ? '+$' : '-$') + Math.abs(profit).toFixed(2);
            document.getElementById('calcProfit').style.color = profit >= 0 ? 'var(--accent-green)' : 'var(--accent-red)';
            document.getElementById('calcROI').textContent = roi + '%';
            document.getElementById('calcROI').style.color = profit >= 0 ? 'var(--accent-green)' : 'var(--accent-red)';
        }

        // Gamification Functions
        function updateStreak() {
            const lastVisit = localStorage.getItem('last_visit_date');
            const today = new Date().toDateString();
            let streak = parseInt(localStorage.getItem('visit_streak') || '0');

            if (lastVisit !== today) {
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                
                if (lastVisit === yesterday.toDateString()) {
                    streak++;
                } else if (lastVisit !== today) {
                    streak = 1;
                }
                
                localStorage.setItem('last_visit_date', today);
                localStorage.setItem('visit_streak', streak);
            }

            document.getElementById('streakCount').textContent = streak;
            checkAchievements();
        }

        function checkAchievements() {
            const streak = parseInt(localStorage.getItem('visit_streak') || '0');
            
            // Week streak achievement
            if (streak >= 7) {
                document.getElementById('achWeekStreak')?.classList.add('unlocked');
            }
            
            // Portfolio pro achievement
            if (portfolio.length >= 1) {
                document.getElementById('achPortfolio')?.classList.add('unlocked');
            }
            
            // Whale achievement (10000+ XRP)
            const totalXRP = portfolio.reduce((sum, h) => sum + (h.asset === 'XRP' ? h.amount : 0), 0);
            if (totalXRP >= 10000) {
                document.getElementById('achWhale')?.classList.add('unlocked');
            }
        }

        function submitPrediction() {
            const prediction = parseFloat(document.getElementById('pricePrediction').value);
            if (!prediction) {
                alert('Please enter a prediction');
                return;
            }

            const predictions = JSON.parse(localStorage.getItem('price_predictions') || '[]');
            predictions.push({
                date: new Date().toISOString(),
                prediction,
                actualPrice: null
            });
            localStorage.setItem('price_predictions', JSON.stringify(predictions));
            
            alert('Prediction submitted! Check back tomorrow to see your score.');
            document.getElementById('pricePrediction').value = '';
        }

        // =====================================================
        // AI INSIGHTS TAB FUNCTIONS
        // =====================================================
        let maChart = null;
        let comparisonChart = null;
        let xrpPriceHistory = [];
        let insightsData = {
            sentiment: 50,
            priceChange24h: 0,
            priceChange7d: 0,
            priceChange30d: 0,
            ma7: 0,
            ma30: 0,
            ma90: 0,
            volume24h: 0
        };

        async function fetchXRPPriceHistory() {
            try {
                // Fetch 90 days of price history from CoinGecko
                const response = await fetch('https://api.coingecko.com/api/v3/coins/ripple/market_chart?vs_currency=usd&days=90&interval=daily');
                if (!response.ok) throw new Error('Failed to fetch price history');
                
                const data = await response.json();
                xrpPriceHistory = data.prices.map(p => ({
                    date: new Date(p[0]),
                    price: p[1]
                }));
                
                return true;
            } catch (error) {
                console.error('Error fetching XRP price history:', error);
                return false;
            }
        }

        async function fetchXRPMarketData() {
            try {
                const response = await fetch('https://api.coingecko.com/api/v3/coins/ripple?localization=false&tickers=false&community_data=false&developer_data=false');
                if (!response.ok) throw new Error('Failed to fetch market data');
                
                const data = await response.json();
                
                insightsData.priceChange24h = data.market_data.price_change_percentage_24h || 0;
                insightsData.priceChange7d = data.market_data.price_change_percentage_7d || 0;
                insightsData.priceChange30d = data.market_data.price_change_percentage_30d || 0;
                insightsData.volume24h = data.market_data.total_volume.usd || 0;
                
                return true;
            } catch (error) {
                console.error('Error fetching market data:', error);
                return false;
            }
        }

        function calculateMovingAverages() {
            if (xrpPriceHistory.length < 7) return;
            
            const prices = xrpPriceHistory.map(p => p.price);
            const len = prices.length;
            
            // 7-day MA
            if (len >= 7) {
                insightsData.ma7 = prices.slice(-7).reduce((a, b) => a + b, 0) / 7;
            }
            
            // 30-day MA
            if (len >= 30) {
                insightsData.ma30 = prices.slice(-30).reduce((a, b) => a + b, 0) / 30;
            }
            
            // 90-day MA
            if (len >= 90) {
                insightsData.ma90 = prices.slice(-90).reduce((a, b) => a + b, 0) / 90;
            }
        }

        function calculateSentiment() {
            // Calculate sentiment based on multiple factors
            let score = 50; // Start neutral
            
            // Price momentum (weight: 40%)
            if (insightsData.priceChange24h > 5) score += 15;
            else if (insightsData.priceChange24h > 2) score += 10;
            else if (insightsData.priceChange24h > 0) score += 5;
            else if (insightsData.priceChange24h > -2) score -= 5;
            else if (insightsData.priceChange24h > -5) score -= 10;
            else score -= 15;
            
            // 7-day trend (weight: 30%)
            if (insightsData.priceChange7d > 10) score += 12;
            else if (insightsData.priceChange7d > 5) score += 8;
            else if (insightsData.priceChange7d > 0) score += 4;
            else if (insightsData.priceChange7d > -5) score -= 4;
            else if (insightsData.priceChange7d > -10) score -= 8;
            else score -= 12;
            
            // MA crossover signals (weight: 30%)
            if (currentXRPPrice && insightsData.ma7 && insightsData.ma30) {
                if (currentXRPPrice > insightsData.ma7 && insightsData.ma7 > insightsData.ma30) {
                    score += 13; // Strong bullish
                } else if (currentXRPPrice > insightsData.ma7) {
                    score += 8; // Bullish
                } else if (currentXRPPrice < insightsData.ma7 && insightsData.ma7 < insightsData.ma30) {
                    score -= 13; // Strong bearish
                } else if (currentXRPPrice < insightsData.ma7) {
                    score -= 8; // Bearish
                }
            }
            
            // Clamp between 0 and 100
            insightsData.sentiment = Math.max(0, Math.min(100, score));
        }

        async function fetchClaudeInsights() {
            // Get ETF totals
            let etfTotal = 0;
            etfColumns.forEach(col => {
                for (const row of holdingsData) {
                    if (row[col.key]?.xrp) {
                        etfTotal += row[col.key].xrp;
                        break;
                    }
                }
            });
            
            // Get exchange totals
            let exchangeTotal = 0;
            Object.values(exchangeData).forEach(data => {
                exchangeTotal += data.total || 0;
            });

            // Get ETF volume from cached data
            let etfVolume = 0;
            if (cachedData && cachedData.data) {
                const xrpETFs = cachedData.data['XRP Spot ETFs'] || [];
                xrpETFs.forEach(etf => {
                    etfVolume += (etf.daily?.dollars || 0);
                });
            }

            const marketData = {
                currentPrice: currentXRPPrice || 0,
                priceChange24h: insightsData.priceChange24h,
                priceChange7d: insightsData.priceChange7d,
                priceChange30d: insightsData.priceChange30d,
                volume24h: insightsData.volume24h,
                ma7: insightsData.ma7,
                ma30: insightsData.ma30,
                ma90: insightsData.ma90,
                etfHoldings: etfTotal,
                exchangeHoldings: exchangeTotal,
                etfVolume: etfVolume,
                sentimentScore: insightsData.sentiment
            };

            try {
                const response = await fetch(`${API_URL}/api/ai-insights`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ marketData })
                });

                if (!response.ok) throw new Error('API request failed');

                const data = await response.json();
                
                if (data.success && data.analysis) {
                    return {
                        success: true,
                        analysis: data.analysis,
                        cached: data.cached || false
                    };
                }
                
                throw new Error('Invalid response');
            } catch (error) {
                console.log('Claude API unavailable, using fallback:', error.message);
                return { success: false };
            }
        }

        function generateAISummary() {
            const sentiment = insightsData.sentiment;
            const change24h = insightsData.priceChange24h;
            const change7d = insightsData.priceChange7d;
            const change30d = insightsData.priceChange30d;
            const price = currentXRPPrice || 0;
            
            let sentimentText = '';
            if (sentiment >= 70) sentimentText = 'strongly bullish';
            else if (sentiment >= 60) sentimentText = 'bullish';
            else if (sentiment >= 45) sentimentText = 'neutral';
            else if (sentiment >= 35) sentimentText = 'bearish';
            else sentimentText = 'strongly bearish';
            
            let trendText = change7d >= 0 ? 'upward' : 'downward';
            let momentumText = Math.abs(change24h) > 3 ? 'strong' : 'moderate';
            
            // Price vs MA analysis
            let maAnalysis = '';
            if (price > insightsData.ma7 && price > insightsData.ma30) {
                maAnalysis = 'Price is trading above both 7-day and 30-day moving averages, indicating bullish momentum.';
            } else if (price > insightsData.ma7) {
                maAnalysis = 'Price is above the 7-day MA but near the 30-day MA, suggesting consolidation.';
            } else if (price < insightsData.ma7 && price < insightsData.ma30) {
                maAnalysis = 'Price is below both moving averages, indicating bearish pressure.';
            } else {
                maAnalysis = 'Price is testing key moving average levels.';
            }
            
            // ETF analysis
            let etfTotal = 0;
            etfColumns.forEach(col => {
                for (const row of holdingsData) {
                    if (row[col.key]?.xrp) {
                        etfTotal += row[col.key].xrp;
                        break;
                    }
                }
            });
            
            let exchangeTotal = 0;
            Object.values(exchangeData).forEach(data => {
                exchangeTotal += data.total || 0;
            });
            
            const html = `
                <p><strong>Market Overview:</strong> XRP is currently trading at <span style="color: var(--accent-xrp);">$${price.toFixed(4)}</span> with ${momentumText} ${trendText} momentum. The overall market sentiment is <span style="color: ${sentiment >= 50 ? 'var(--accent-green)' : 'var(--accent-red)'};">${sentimentText}</span>.</p>
                
                <p><strong>Price Action:</strong></p>
                <ul>
                    <li>24h Change: <span style="color: ${change24h >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'};">${change24h >= 0 ? '+' : ''}${change24h.toFixed(2)}%</span></li>
                    <li>7d Change: <span style="color: ${change7d >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'};">${change7d >= 0 ? '+' : ''}${change7d.toFixed(2)}%</span></li>
                    <li>30d Change: <span style="color: ${change30d >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'};">${change30d >= 0 ? '+' : ''}${change30d.toFixed(2)}%</span></li>
                </ul>
                
                <p><strong>Technical Analysis:</strong> ${maAnalysis}</p>
                
                <p><strong>ETF & Exchange Data:</strong></p>
                <ul>
                    <li>Total XRP in Spot ETFs: <span style="color: var(--accent-xrp);">${formatHoldingsNumber(etfTotal)} XRP</span> (~$${formatHoldingsNumber(etfTotal * price)})</li>
                    ${exchangeTotal > 0 ? `<li>Total XRP on Exchanges: <span style="color: var(--accent-purple);">${formatHoldingsNumber(exchangeTotal)} XRP</span></li>` : '<li>Exchange data: Click Exchange tab to load</li>'}
                </ul>
                
                <p><strong>Outlook:</strong> ${sentiment >= 60 ? 'Conditions favor continued upside. Watch for resistance levels.' : sentiment >= 45 ? 'Market is in consolidation. Wait for clearer directional signals.' : 'Caution advised. Look for support levels to hold before entering positions.'}</p>
            `;
            
            document.getElementById('aiSummary').innerHTML = html;
        }

        async function generateInsights() {
            const btn = document.querySelector('.insights-header .btn-refresh');
            btn.disabled = true;
            btn.textContent = ' Loading...';
            
            try {
                // Fetch real market data first
                await Promise.all([
                    fetchXRPPriceHistory(),
                    fetchXRPMarketData()
                ]);
                
                // Calculate metrics
                calculateMovingAverages();
                calculateSentiment();
                
                // Update UI components that don't need Claude
                updateSentimentGauge();
                renderMAChart();
                updateKeyMetrics();
                renderComparisonChart();
                
                // Try to get Claude AI analysis
                btn.textContent = ' AI Analyzing...';
                const claudeResult = await fetchClaudeInsights();
                
                if (claudeResult.success) {
                    // Use Claude's analysis - format it nicely
                    const formattedAnalysis = claudeResult.analysis
                        .split('\n\n')
                        .map(para => `<p>${para}</p>`)
                        .join('');
                    
                    document.getElementById('aiSummary').innerHTML = formattedAnalysis + 
                        `<div style="margin-top: 1rem; font-size: 0.75rem; color: var(--text-muted);">
                             Analysis by Claude AI ${claudeResult.cached ? '(cached)' : ''}
                        </div>`;
                } else {
                    // Fallback to template-based summary
                    generateAISummary();
                }
                
                btn.textContent = ' Refresh Insights';
            } catch (error) {
                console.error('Error generating insights:', error);
                btn.textContent = ' Error - Retry';
                // Still try to show fallback summary
                generateAISummary();
            } finally {
                btn.disabled = false;
            }
        }

        function updateSentimentGauge() {
            const score = insightsData.sentiment;
            let sentimentLabel = '';
            let color = '';
            
            if (score >= 70) { sentimentLabel = 'Bullish'; color = 'var(--accent-green)'; }
            else if (score >= 55) { sentimentLabel = 'Slightly Bullish'; color = '#22c55e99'; }
            else if (score >= 45) { sentimentLabel = 'Neutral'; color = 'var(--accent-orange)'; }
            else if (score >= 30) { sentimentLabel = 'Slightly Bearish'; color = '#ef444499'; }
            else { sentimentLabel = 'Bearish'; color = 'var(--accent-red)'; }
            
            document.getElementById('sentimentGauge').style.width = (100 - score) + '%';
            document.getElementById('sentimentText').textContent = `${sentimentLabel} (${Math.round(score)}/100)`;
            document.getElementById('sentimentText').style.color = color;
        }

        function updateKeyMetrics() {
            // Volume trend
            const volumeEl = document.querySelector('.metric-card:nth-child(1) .metric-value');
            if (volumeEl && insightsData.volume24h) {
                const volInM = insightsData.volume24h / 1000000;
                volumeEl.textContent = '$' + volInM.toFixed(0) + 'M';
            }
            
            // Update 24h change in metrics
            const change24h = insightsData.priceChange24h;
            const trendEl = document.querySelector('.metric-card:nth-child(1) .metric-value');
            if (trendEl) {
                trendEl.textContent = (change24h >= 0 ? '+' : '') + change24h.toFixed(1) + '%';
                trendEl.className = 'metric-value ' + (change24h >= 0 ? 'positive' : 'negative');
            }
        }

        function renderMAChart() {
            const canvas = document.getElementById('maChart');
            if (!canvas) return;

            if (maChart) maChart.destroy();

            const ctx = canvas.getContext('2d');
            
            // Use real price history data
            let labels = [];
            let priceData = [];
            let ma7Data = [];
            let ma30Data = [];
            
            if (xrpPriceHistory.length > 0) {
                // Use last 30 days of real data
                const last30Days = xrpPriceHistory.slice(-30);
                
                labels = last30Days.map(p => p.date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
                priceData = last30Days.map(p => p.price);
                
                // Calculate rolling MAs
                for (let i = 0; i < last30Days.length; i++) {
                    const dayIndex = xrpPriceHistory.length - 30 + i;
                    
                    // 7-day MA
                    if (dayIndex >= 6) {
                        const slice = xrpPriceHistory.slice(dayIndex - 6, dayIndex + 1);
                        ma7Data.push(slice.reduce((a, b) => a + b.price, 0) / 7);
                    } else {
                        ma7Data.push(null);
                    }
                    
                    // 30-day MA
                    if (dayIndex >= 29) {
                        const slice = xrpPriceHistory.slice(dayIndex - 29, dayIndex + 1);
                        ma30Data.push(slice.reduce((a, b) => a + b.price, 0) / 30);
                    } else {
                        ma30Data.push(null);
                    }
                }
            } else {
                // Fallback to simulated data if fetch failed
                let price = currentXRPPrice || 2.0;
                for (let i = 30; i >= 0; i--) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    labels.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
                    price = price * (1 + (Math.random() - 0.48) * 0.03);
                    priceData.push(price);
                }
            }

            maChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels,
                    datasets: [
                        {
                            label: 'XRP Price',
                            data: priceData,
                            borderColor: '#23f7dd',
                            backgroundColor: 'rgba(35, 247, 221, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 2
                        },
                        {
                            label: '7-Day MA',
                            data: ma7Data,
                            borderColor: '#a855f7',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            fill: false,
                            tension: 0.4,
                            pointRadius: 0
                        },
                        {
                            label: '30-Day MA',
                            data: ma30Data,
                            borderColor: '#f97316',
                            borderWidth: 2,
                            borderDash: [10, 5],
                            fill: false,
                            tension: 0.4,
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: { color: '#a0a0c0' }
                        },
                        tooltip: {
                            backgroundColor: '#16161f',
                            borderColor: '#23f7dd',
                            borderWidth: 1,
                            callbacks: {
                                label: (ctx) => ctx.dataset.label + ': $' + ctx.raw.toFixed(4)
                            }
                        }
                    },
                    scales: {
                        x: { ticks: { color: '#707085' }, grid: { color: '#2a2a3a' } },
                        y: { 
                            ticks: { 
                                color: '#707085',
                                callback: (v) => '$' + v.toFixed(2)
                            }, 
                            grid: { color: '#2a2a3a' } 
                        }
                    }
                }
            });

            // Update MA indicator values
            const latestPrice = priceData[priceData.length - 1] || currentXRPPrice;
            const latest7MA = insightsData.ma7 || ma7Data.filter(x => x).pop() || 0;
            const latest30MA = insightsData.ma30 || ma30Data.filter(x => x).pop() || 0;
            const latest90MA = insightsData.ma90 || 0;
            
            document.getElementById('ma7').textContent = '$' + latest7MA.toFixed(4);
            document.getElementById('ma30').textContent = '$' + latest30MA.toFixed(4);
            document.getElementById('ma90').textContent = '$' + latest90MA.toFixed(4);
            
            // Update MA signals
            const ma7Signal = document.querySelector('.ma-indicator:nth-child(1) .ma-signal');
            const ma30Signal = document.querySelector('.ma-indicator:nth-child(2) .ma-signal');
            const ma90Signal = document.querySelector('.ma-indicator:nth-child(3) .ma-signal');
            
            if (ma7Signal && latestPrice) {
                ma7Signal.textContent = latestPrice > latest7MA ? ' Above' : ' Below';
                ma7Signal.className = 'ma-signal ' + (latestPrice > latest7MA ? 'bullish' : 'bearish');
            }
            if (ma30Signal && latestPrice) {
                ma30Signal.textContent = latestPrice > latest30MA ? ' Above' : ' Below';
                ma30Signal.className = 'ma-signal ' + (latestPrice > latest30MA ? 'bullish' : 'bearish');
            }
            if (ma90Signal && latestPrice && latest90MA) {
                ma90Signal.textContent = latestPrice > latest90MA ? ' Above' : ' Below';
                ma90Signal.className = 'ma-signal ' + (latestPrice > latest90MA ? 'bullish' : 'bearish');
            }
        }

        function renderComparisonChart() {
            const canvas = document.getElementById('comparisonChart');
            if (!canvas) return;

            if (comparisonChart) comparisonChart.destroy();

            const ctx = canvas.getContext('2d');
            
            // Use real data from cached ETF data if available
            let xrpVolume = 0;
            let btcVolume = 0;
            let ethVolume = 0;
            
            if (cachedData && cachedData.data) {
                // Calculate XRP ETF volume
                const xrpETFs = cachedData.data['XRP Spot ETFs'] || [];
                xrpETFs.forEach(etf => {
                    xrpVolume += (etf.daily?.dollars || 0);
                });
                
                // Calculate BTC ETF volume
                const btcETFs = cachedData.data['Bitcoin Spot ETFs'] || [];
                btcETFs.forEach(etf => {
                    btcVolume += (etf.daily?.dollars || 0);
                });
                
                // Calculate ETH ETF volume
                const ethETFs = cachedData.data['Ethereum Spot ETFs'] || [];
                ethETFs.forEach(etf => {
                    ethVolume += (etf.daily?.dollars || 0);
                });
            }
            
            // Convert to millions
            xrpVolume = xrpVolume / 1000000;
            btcVolume = btcVolume / 1000000;
            ethVolume = ethVolume / 1000000;
            
            const etf1 = document.getElementById('compareETF1').value;
            const etf2 = document.getElementById('compareETF2').value;
            
            const volumeMap = {
                'XRP': xrpVolume || 125,
                'BTC': btcVolume || 2100,
                'ETH': ethVolume || 450
            };
            
            const colorMap = {
                'XRP': { bg: '#23f7dd80', border: '#23f7dd' },
                'BTC': { bg: '#f9731680', border: '#f97316' },
                'ETH': { bg: '#a855f780', border: '#a855f7' }
            };
            
            comparisonChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: [etf1 + ' ETFs', etf2 + ' ETFs'],
                    datasets: [{
                        label: 'Daily Volume ($M)',
                        data: [volumeMap[etf1], volumeMap[etf2]],
                        backgroundColor: [colorMap[etf1].bg, colorMap[etf2].bg],
                        borderColor: [colorMap[etf1].border, colorMap[etf2].border],
                        borderWidth: 2,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: '#16161f',
                            borderColor: '#23f7dd',
                            borderWidth: 1,
                            callbacks: {
                                label: (ctx) => 'Volume: $' + ctx.raw.toFixed(1) + 'M'
                            }
                        }
                    },
                    scales: {
                        x: { ticks: { color: '#707085' }, grid: { display: false } },
                        y: { 
                            ticks: { 
                                color: '#707085',
                                callback: (v) => '$' + v + 'M'
                            }, 
                            grid: { color: '#2a2a3a' } 
                        }
                    }
                }
            });
            
            // Update comparison stats
            updateComparisonStats(etf1, etf2, volumeMap);
        }

        function updateComparisonStats(etf1, etf2, volumeMap) {
            const statsContainer = document.getElementById('comparisonStats');
            if (!statsContainer) return;
            
            // Get change percentages (use real data if available)
            const changeMap = {
                'XRP': insightsData.priceChange7d || 12.5,
                'BTC': 8.2,
                'ETH': 5.4
            };
            
            // AUM estimates
            const aumMap = {
                'XRP': 1.5,
                'BTC': 28,
                'ETH': 8
            };
            
            statsContainer.innerHTML = `
                <div class="comp-stat">
                    <div class="comp-stat-label">Daily Volume</div>
                    <div class="comp-stat-values">
                        <span class="comp-val-1">$${volumeMap[etf1]?.toFixed(0) || ''}M</span>
                        <span class="comp-val-2">$${volumeMap[etf2]?.toFixed(0) || ''}M</span>
                    </div>
                </div>
                <div class="comp-stat">
                    <div class="comp-stat-label">7D Change</div>
                    <div class="comp-stat-values">
                        <span class="comp-val-1 ${changeMap[etf1] >= 0 ? 'positive' : 'negative'}">${changeMap[etf1] >= 0 ? '+' : ''}${changeMap[etf1]?.toFixed(1)}%</span>
                        <span class="comp-val-2 ${changeMap[etf2] >= 0 ? 'positive' : 'negative'}">${changeMap[etf2] >= 0 ? '+' : ''}${changeMap[etf2]?.toFixed(1)}%</span>
                    </div>
                </div>
                <div class="comp-stat">
                    <div class="comp-stat-label">Est. AUM</div>
                    <div class="comp-stat-values">
                        <span class="comp-val-1">$${aumMap[etf1]}B</span>
                        <span class="comp-val-2">$${aumMap[etf2]}B</span>
                    </div>
                </div>
            `;
        }

        function updateComparison() {
            renderComparisonChart();
        }

        // Auto-connect on page load
        window.addEventListener('DOMContentLoaded', () => {
            fetchXRPPrice();
            fetchData();
            startAutoRefresh();
            
            // Initialize dashboard overview after a delay
            setTimeout(() => {
                updateDashboardOverview();
            }, 1000);
            
            // Auto pre-fetch exchange data in background after 3 seconds
            setTimeout(() => {
                if (Object.keys(exchangeData).length === 0 && !isExchangeFetching) {
                    console.log('Pre-fetching exchange data in background...');
                    fetchExchangeData();
                }
            }, 3000);
            
            // Update XRP price every 10 seconds
            setInterval(() => {
                fetchXRPPrice();
                updateDashboardOverview();
            }, 10000);
            
            // Auto-refresh exchange data every hour
            setInterval(() => {
                if (!isExchangeFetching) {
                    console.log('Auto-refreshing exchange data...');
                    fetchExchangeData(true);
                }
            }, 60 * 60 * 1000); // 1 hour

            // Show popup after 5 seconds if not recently closed
            if (shouldShowPopup()) {
                setTimeout(() => {
                    showPopup();
                }, 5000);
            }
        });
    </script>
</body>
</html>
