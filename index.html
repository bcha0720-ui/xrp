<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XRP Analytics</title>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-JFYKZKVTMZ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-JFYKZKVTMZ');
    </script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Professional Dark Theme - Midnight Blue */
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-card: #1e293b;
            --bg-card-hover: #334155;
            --border: #334155;
            
            /* Text Colors - WCAG AA Compliant */
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            
            /* Accent Colors */
            --accent-xrp: #23f7dd;
            --accent-xrp-dim: rgba(35, 247, 221, 0.15);
            --accent-green: #22c55e;
            --accent-red: #ef4444;
            --accent-blue: #3b82f6;
            --accent-purple: #a855f7;
            --accent-orange: #f97316;
            --accent-yellow: #eab308;
            
            /* Status Colors */
            --status-loading: #f97316;
            --status-success: #22c55e;
            --status-error: #ef4444;
            
            /* Glassmorphism */
            --glass-bg: rgba(30, 41, 59, 0.6);
            --glass-bg-light: rgba(30, 41, 59, 0.4);
            --glass-border: rgba(255, 255, 255, 0.08);
            --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            --glass-blur: 12px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        /* Glassmorphism Base Styles */
        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
        }
        
        .glass-light {
            background: var(--glass-bg-light);
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border: 1px solid var(--glass-border);
        }
        
        .glass-accent {
            background: linear-gradient(135deg, rgba(35, 247, 221, 0.1), rgba(168, 85, 247, 0.1));
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border: 1px solid rgba(35, 247, 221, 0.2);
            box-shadow: var(--glass-shadow), 0 0 40px rgba(35, 247, 221, 0.05);
        }
        
        /* Animated Price Ticker */
        .price-ticker {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 36px;
            background: linear-gradient(90deg, #0f172a, #1e293b, #0f172a);
            border-bottom: 1px solid var(--border);
            z-index: 1000;
            overflow: hidden;
        }
        
        .ticker-track {
            display: inline-flex;
            animation: tickerScroll 30s linear infinite;
            white-space: nowrap;
            will-change: transform;
        }
        
        .ticker-track:hover {
            animation-play-state: paused;
        }
        
        @keyframes tickerScroll {
            0% { transform: translateX(0%); }
            100% { transform: translateX(-50%); }
        }
        
        .ticker-item {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0 1.5rem;
            font-size: 0.8rem;
            font-family: 'JetBrains Mono', monospace;
            height: 36px;
        }
        
        .ticker-symbol {
            font-weight: 600;
            color: var(--accent-xrp);
        }
        
        .ticker-price {
            color: var(--text-primary);
        }
        
        .ticker-change {
            padding: 0.1rem 0.4rem;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 500;
        }
        
        .ticker-change.positive {
            background: rgba(34, 197, 94, 0.2);
            color: var(--accent-green);
        }
        
        .ticker-change.negative {
            background: rgba(239, 68, 68, 0.2);
            color: var(--accent-red);
        }
        
        .ticker-divider {
            color: var(--border);
        }
        
        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            padding-top: 36px;
        }

        .bg-grid {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                linear-gradient(rgba(35, 247, 221, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(35, 247, 221, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: 0;
        }

        .bg-glow {
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at 30% 20%, rgba(35, 247, 221, 0.08) 0%, transparent 50%),
                        radial-gradient(circle at 70% 80%, rgba(168, 85, 247, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
            animation: glowPulse 15s ease-in-out infinite;
        }

        @keyframes glowPulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }

        .container {
            position: relative;
            z-index: 1;
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--border);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-icon {
            width: 56px;
            height: 56px;
            background: #23292f;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 8px;
            box-shadow: 0 4px 15px rgba(35, 247, 221, 0.3);
            border: 2px solid rgba(35, 247, 221, 0.3);
        }

        .logo-icon svg {
            width: 100%;
            height: 100%;
        }

        .logo h1 {
            font-size: 2.2rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-xrp) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-meta {
            text-align: right;
        }

        .xrp-price {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: linear-gradient(135deg, rgba(35, 247, 221, 0.15), rgba(168, 85, 247, 0.1));
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border: 1px solid rgba(35, 247, 221, 0.4);
            border-radius: 16px;
            padding: 0.75rem 1.5rem;
            box-shadow: 0 4px 20px rgba(35, 247, 221, 0.15);
            transition: all 0.3s ease;
        }
        
        .xrp-price:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(35, 247, 221, 0.25);
        }

        .xrp-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .xrp-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-xrp);
            font-family: 'JetBrains Mono', monospace;
        }

        .xrp-change {
            font-size: 0.8rem;
            margin-top: 0.25rem;
        }

        .xrp-change.positive {
            color: var(--accent-green);
        }

        .xrp-change.negative {
            color: var(--accent-red);
        }

        .twitter-handle {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 0.75rem 1.5rem;
            text-decoration: none;
            transition: all 0.2s ease;
        }

        .twitter-handle:hover {
            border-color: var(--accent-xrp);
            background: var(--bg-card-hover);
            transform: translateY(-2px);
        }

        .twitter-icon {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .twitter-name {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-top: 0.25rem;
        }

        .twitter-user {
            font-size: 0.75rem;
            color: var(--accent-xrp);
        }

        .site-link {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 0.75rem 1.5rem;
            text-decoration: none;
            transition: all 0.2s ease;
        }

        .site-link:hover {
            border-color: var(--accent-purple);
            background: var(--bg-card-hover);
            transform: translateY(-2px);
        }

        .site-link-icon {
            font-size: 1.2rem;
        }

        .site-link-name {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-top: 0.25rem;
        }

        .site-link-desc {
            font-size: 0.75rem;
            color: var(--accent-purple);
        }

        .last-updated {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
        }

        .status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.4rem 0.8rem;
            background: var(--accent-xrp-dim);
            border-radius: 20px;
            font-size: 0.8rem;
            color: var(--accent-xrp);
            font-weight: 500;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: var(--accent-xrp);
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
            transition: background 0.3s ease;
        }
        
        .status-dot.loading {
            background: var(--accent-orange);
            animation: loadingPulse 0.8s ease-in-out infinite;
        }
        
        .status-dot.success {
            background: var(--accent-green);
        }
        
        .status-dot.error {
            background: var(--accent-red);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.8); }
        }
        
        @keyframes loadingPulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.3; transform: scale(1.2); }
        }

        .auto-refresh-info {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 0.5rem;
        }

        .controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.7rem 1.2rem;
            border: 1px solid var(--border);
            background: var(--bg-card);
            color: var(--text-secondary);
            border-radius: 8px;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .btn:hover {
            background: var(--bg-card-hover);
            border-color: var(--accent-xrp);
            color: var(--text-primary);
        }

        .btn.active {
            background: var(--accent-xrp-dim);
            border-color: var(--accent-xrp);
            color: var(--accent-xrp);
        }

        .btn-refresh {
            margin-left: auto;
            background: linear-gradient(135deg, var(--accent-xrp), #1ed9c0);
            border: none;
            color: var(--bg-primary);
            font-weight: 600;
        }

        .btn-refresh:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(35, 247, 221, 0.3);
        }

        .btn-refresh:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 6rem 2rem;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 3px solid var(--border);
            border-top-color: var(--accent-xrp);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 1.5rem;
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .error-container {
            text-align: center;
            padding: 4rem 2rem;
        }

        .error-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .error-message {
            color: var(--accent-red);
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }

        .error-hint {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-bottom: 1.5rem;
        }

        .etf-groups {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .etf-group {
            background: var(--glass-bg);
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            overflow: hidden;
            animation: fadeSlideIn 0.5s ease forwards;
            opacity: 0;
            transform: translateY(20px);
            box-shadow: var(--glass-shadow);
            transition: all 0.3s ease;
        }
        
        .etf-group:hover {
            border-color: rgba(35, 247, 221, 0.2);
            box-shadow: var(--glass-shadow), 0 0 30px rgba(35, 247, 221, 0.05);
        }

        .etf-group:nth-child(1) { animation-delay: 0.1s; }
        .etf-group:nth-child(2) { animation-delay: 0.2s; }
        .etf-group:nth-child(3) { animation-delay: 0.3s; }
        .etf-group:nth-child(4) { animation-delay: 0.4s; }

        @keyframes fadeSlideIn {
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(100px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes slideOut {
            from { opacity: 1; transform: translateX(0); }
            to { opacity: 0; transform: translateX(100px); }
        }

        .group-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.25rem 1.5rem;
            background: rgba(30, 41, 59, 0.5);
            border-bottom: 1px solid var(--glass-border);
        }

        .group-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .group-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }

        .group-icon.index { background: rgba(59, 130, 246, 0.2); }
        .group-icon.spot { background: rgba(35, 247, 221, 0.2); }
        .group-icon.futures { background: rgba(249, 115, 22, 0.2); }
        .group-icon.canada { background: rgba(168, 85, 247, 0.2); }

        .group-name {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .group-count {
            font-size: 0.85rem;
            color: var(--text-muted);
            background: var(--bg-card);
            padding: 0.3rem 0.7rem;
            border-radius: 20px;
        }

        .table-wrapper {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            padding: 1rem 1.25rem;
            text-align: left;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            border-bottom: 1px solid var(--border);
            white-space: nowrap;
        }

        th.right {
            text-align: right;
        }

        td {
            padding: 1rem 1.25rem;
            border-bottom: 1px solid var(--border);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover {
            background: var(--bg-card-hover);
        }

        tr.total-row {
            background: var(--bg-secondary);
            font-weight: 600;
        }

        tr.total-row:hover {
            background: var(--bg-secondary);
        }

        tr.total-row td {
            border-top: 2px solid var(--accent-xrp);
            color: var(--accent-xrp);
        }

        .symbol-cell {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .symbol-badge {
            font-weight: 600;
            color: var(--accent-xrp);
            font-family: 'JetBrains Mono', monospace;
        }

        .symbol-desc {
            font-size: 0.8rem;
            color: var(--text-muted);
            font-family: 'Outfit', sans-serif;
        }

        .price {
            font-weight: 600;
            color: var(--text-primary);
        }

        .volume-cell {
            text-align: right;
        }

        .volume-shares {
            color: var(--text-secondary);
        }

        .volume-dollars {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 0.2rem;
        }

        .no-data {
            color: var(--text-muted);
            font-style: italic;
            font-family: 'Outfit', sans-serif;
        }

        footer {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border);
            text-align: center;
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        footer a {
            color: var(--accent-xrp);
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
        }

        .api-config {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .api-config label {
            display: block;
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .api-input-group {
            display: flex;
            gap: 0.75rem;
        }

        .api-input-group input {
            flex: 1;
            padding: 0.75rem 1rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
        }

        .api-input-group input:focus {
            outline: none;
            border-color: var(--accent-xrp);
        }

        .api-input-group input::placeholder {
            color: var(--text-muted);
        }

        .grand-total {
            background: linear-gradient(135deg, var(--bg-card), var(--bg-secondary));
            border: 2px solid var(--accent-xrp);
            border-radius: 16px;
            padding: 1.5rem;
            margin-top: 2rem;
        }

        .grand-total h3 {
            color: var(--accent-xrp);
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }

        .grand-total-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .grand-total-item {
            background: var(--bg-primary);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }

        .grand-total-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
        }

        .grand-total-value {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            header {
                flex-direction: column;
                gap: 1.5rem;
                text-align: center;
            }

            .header-meta {
                text-align: center;
            }

            .controls {
                justify-content: center;
            }

            .btn-refresh {
                margin-left: 0;
                width: 100%;
            }

            th, td {
                padding: 0.75rem;
                font-size: 0.8rem;
            }

            .api-input-group {
                flex-direction: column;
            }

            .dashboard-metrics {
                grid-template-columns: 1fr;
            }

            .dashboard-metric-value {
                font-size: 1.4rem;
            }

            .main-tabs {
                flex-direction: column;
            }

            .main-tab {
                padding: 0.8rem;
            }

            .holdings-summary {
                grid-template-columns: repeat(2, 1fr);
            }

            .exchange-charts-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Follow Popup Modal */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .popup-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .popup-modal {
            background: linear-gradient(135deg, var(--bg-card), var(--bg-secondary));
            border: 2px solid var(--accent-xrp);
            border-radius: 20px;
            padding: 2.5rem;
            max-width: 400px;
            width: 90%;
            text-align: center;
            position: relative;
            transform: scale(0.8);
            transition: transform 0.3s ease;
            box-shadow: 0 20px 60px rgba(35, 247, 221, 0.2);
        }

        .popup-overlay.active .popup-modal {
            transform: scale(1);
        }

        .popup-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .popup-close:hover {
            color: var(--text-primary);
        }

        .popup-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            animation: bounce 1s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .popup-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
        }

        .popup-text {
            color: var(--text-secondary);
            font-size: 1rem;
            margin-bottom: 1.5rem;
            line-height: 1.5;
        }

        .popup-follow-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            background: linear-gradient(135deg, var(--accent-xrp), #1ed9c0);
            color: var(--bg-primary);
            font-size: 1.1rem;
            font-weight: 700;
            padding: 1rem 2rem;
            border-radius: 50px;
            text-decoration: none;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 1rem;
        }

        .popup-follow-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(35, 247, 221, 0.4);
        }

        .popup-x-icon {
            font-size: 1.3rem;
            font-weight: 900;
        }

        .popup-later {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 0.9rem;
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .popup-later:hover {
            color: var(--text-secondary);
        }

        /* Chart Button */
        .btn-chart {
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue));
            border: none;
            color: white;
            font-weight: 600;
        }

        .btn-chart:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(168, 85, 247, 0.3);
            color: white;
        }

        /* Chart Modal */
        .chart-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .chart-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .chart-modal {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 1.5rem;
            width: 95%;
            max-width: 1200px;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .chart-overlay.active .chart-modal {
            transform: scale(1);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .chart-header h2 {
            font-size: 1.5rem;
            color: var(--text-primary);
        }

        .chart-close {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 2rem;
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .chart-close:hover {
            color: var(--text-primary);
        }

        .chart-controls {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .chart-tab {
            padding: 0.6rem 1.2rem;
            border: 1px solid var(--border);
            background: var(--bg-secondary);
            color: var(--text-secondary);
            border-radius: 8px;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }

        .chart-tab:hover {
            border-color: var(--accent-purple);
            color: var(--text-primary);
        }

        .chart-tab.active {
            background: var(--accent-purple);
            border-color: var(--accent-purple);
            color: white;
        }

        .chart-period-controls {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .chart-period {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border);
            background: var(--bg-secondary);
            color: var(--text-secondary);
            border-radius: 6px;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.8rem;
            transition: all 0.2s ease;
        }

        .chart-period:hover {
            border-color: var(--accent-xrp);
            color: var(--text-primary);
        }

        .chart-period.active {
            background: var(--accent-xrp-dim);
            border-color: var(--accent-xrp);
            color: var(--accent-xrp);
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 1rem;
        }

        .chart-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 400px;
            color: var(--text-muted);
        }

        .chart-loading .spinner {
            width: 40px;
            height: 40px;
            margin-bottom: 1rem;
        }

        .chart-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            justify-content: center;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }

        /* Main Tab Navigation */
        .main-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            background: var(--bg-card);
            padding: 0.5rem;
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .main-tab {
            flex: 1;
            padding: 1rem 1.5rem;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            border-radius: 8px;
            cursor: pointer;
            font-family: inherit;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .main-tab:hover {
            background: var(--bg-card-hover);
            color: var(--text-primary);
        }

        .main-tab.active {
            background: linear-gradient(135deg, var(--accent-xrp), #1ed9c0);
            color: var(--bg-primary);
        }

        .main-tab-icon {
            font-size: 1.2rem;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Holdings Tracker Styles */
        .holdings-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .summary-card {
            background: var(--glass-bg);
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 1.25rem;
            text-align: center;
            transition: all 0.3s ease;
            box-shadow: var(--glass-shadow);
        }

        .summary-card:hover {
            transform: translateY(-5px);
            border-color: rgba(35, 247, 221, 0.3);
            box-shadow: var(--glass-shadow), 0 0 20px rgba(35, 247, 221, 0.1);
        }

        .summary-card.highlight {
            border-color: rgba(35, 247, 221, 0.4);
            background: linear-gradient(135deg, var(--glass-bg), rgba(35, 247, 221, 0.15));
        }

        .summary-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }

        .summary-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
        }

        .summary-value.accent {
            color: var(--accent-xrp);
        }

        .holdings-table-container {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            overflow: hidden;
        }

        .holdings-table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.25rem 1.5rem;
            background: var(--bg-secondary);
            border-bottom: 2px solid var(--accent-xrp);
        }

        .holdings-table-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .holdings-table-wrapper {
            overflow-x: auto;
            max-height: 600px;
            overflow-y: auto;
            position: relative;
        }

        .holdings-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            min-width: 1200px;
        }

        /* Sticky header rows */
        .holdings-table thead {
            position: sticky;
            top: 0;
            z-index: 20;
        }

        .holdings-table thead tr:first-child th {
            position: sticky;
            top: 0;
            background: var(--bg-secondary);
            z-index: 20;
            padding: 0.75rem 1rem;
            text-align: center;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.03em;
            color: var(--accent-xrp);
            border-bottom: 1px solid var(--border);
            white-space: nowrap;
        }

        .holdings-table thead tr:nth-child(2) th {
            position: sticky;
            top: 38px;
            background: var(--bg-secondary);
            z-index: 20;
            padding: 0.5rem 1rem;
            text-align: right;
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            border-bottom: 2px solid var(--accent-xrp);
            white-space: nowrap;
        }

        .holdings-table th {
            background: var(--bg-secondary);
            padding: 1rem;
            text-align: right;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            border-bottom: 2px solid var(--accent-xrp);
            white-space: nowrap;
        }

        /* Sticky first column (date) */
        .holdings-table td:first-child,
        .holdings-table th:first-child {
            position: sticky;
            left: 0;
            background: var(--bg-card);
            z-index: 10;
            text-align: left;
        }

        .holdings-table thead th:first-child {
            background: var(--bg-secondary);
            z-index: 25;
        }

        .holdings-table th.etf-header {
            text-align: center;
            background: var(--bg-secondary);
        }

        .holdings-table th.sub-header {
            font-size: 0.65rem;
            color: var(--accent-xrp);
        }

        .holdings-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            text-align: right;
            background: var(--bg-card);
        }

        .holdings-table td:first-child {
            text-align: left;
            font-weight: 600;
            color: var(--accent-xrp);
        }

        .holdings-table tr:hover td {
            background: var(--bg-card-hover);
        }

        .holdings-table .value-cell {
            color: var(--text-muted);
            font-size: 0.75rem;
        }

        .holdings-table .xrp-cell {
            color: var(--text-primary);
        }

        .holdings-table .no-data {
            color: var(--text-muted);
            font-style: italic;
        }

        .etf-column-group {
            border-left: 1px solid var(--border);
        }

        /* Data Update Section */
        .data-update-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 2rem;
        }

        .data-update-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .update-methods {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .update-method {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 1.25rem;
        }

        .update-method h4 {
            font-size: 0.9rem;
            color: var(--accent-xrp);
            margin-bottom: 0.75rem;
        }

        .update-method p {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .update-method code {
            background: var(--bg-primary);
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-size: 0.8rem;
            color: var(--accent-xrp);
        }

        .csv-upload-area {
            border: 2px dashed var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1rem;
        }

        .csv-upload-area:hover {
            border-color: var(--accent-xrp);
            background: var(--accent-xrp-dim);
        }

        .csv-upload-area input {
            display: none;
        }

        .upload-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .upload-text {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Exchange Tab Styles */
        .exchange-controls-bar {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            align-items: center;
        }

        /* Holdings Chart Section */
        .holdings-chart-section {
            margin-bottom: 2rem;
        }

        .holdings-chart-container {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .holdings-chart-container:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .holdings-chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            background: var(--bg-secondary);
            border-bottom: 2px solid var(--accent-xrp);
            flex-wrap: wrap;
            gap: 1rem;
        }

        .holdings-chart-controls {
            display: flex;
            gap: 0.5rem;
        }

        .chart-type-btn {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
        }

        .chart-type-btn.active {
            background: var(--accent-xrp-dim);
            border-color: var(--accent-xrp);
            color: var(--accent-xrp);
        }

        .holdings-chart-wrapper {
            padding: 1.5rem;
            height: 350px;
        }

        .exchange-controls-bar {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .exchange-filter-input {
            flex: 1;
            min-width: 200px;
            padding: 0.7rem 1rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.9rem;
        }

        .exchange-filter-input:focus {
            outline: none;
            border-color: var(--accent-xrp);
        }

        .exchange-filter-input::placeholder {
            color: var(--text-muted);
        }

        .exchange-info-banner {
            display: flex;
            gap: 0.75rem;
            align-items: flex-start;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-left: 3px solid var(--accent-xrp);
            border-radius: 8px;
            padding: 1rem 1.25rem;
            margin-bottom: 1.5rem;
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .exchange-info-banner a {
            color: var(--accent-xrp);
            text-decoration: none;
        }

        .exchange-info-banner a:hover {
            text-decoration: underline;
        }

        .exchange-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem;
            color: var(--text-muted);
        }

        .exchange-loading .spinner {
            width: 40px;
            height: 40px;
            margin-bottom: 1rem;
        }

        .exchange-progress {
            width: 100%;
            max-width: 300px;
            height: 6px;
            background: var(--bg-secondary);
            border-radius: 3px;
            margin-top: 1rem;
            overflow: hidden;
        }

        .exchange-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-xrp), var(--accent-purple));
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        /* ============================================
           NEW UI/UX IMPROVEMENTS
           ============================================ */

        /* Dashboard Overview Section */
        .dashboard-overview {
            background: linear-gradient(135deg, var(--bg-card), var(--bg-secondary));
            border: 2px solid var(--accent-xrp);
            border-radius: 20px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(35, 247, 221, 0.1);
        }

        .dashboard-overview::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 20% 50%, rgba(35, 247, 221, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .dashboard-overview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .dashboard-overview-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--accent-xrp);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .xrp-mini-logo {
            display: inline-flex;
            width: 28px;
            height: 28px;
        }

        .xrp-mini-logo svg {
            width: 100%;
            height: 100%;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 250px;
            gap: 1.5rem;
        }

        @media (max-width: 900px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        .dashboard-metrics {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .dashboard-metric {
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 1.25rem;
            position: relative;
            border: 1px solid var(--border);
            transition: transform 0.3s ease, border-color 0.3s ease;
        }

        .dashboard-metric:hover {
            transform: translateY(-5px);
            border-color: var(--accent-xrp);
        }

        .dashboard-metric-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }

        .dashboard-metric-value {
            font-size: 1.8rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            color: var(--text-primary);
            transition: color 0.3s ease;
        }

        .dashboard-metric-value.animated {
            transition: all 0.5s ease;
        }

        .dashboard-metric-change {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.8rem;
            margin-top: 0.5rem;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
        }

        .dashboard-metric-change.positive {
            background: rgba(34, 197, 94, 0.15);
            color: var(--accent-green);
        }

        .dashboard-metric-change.negative {
            background: rgba(239, 68, 68, 0.15);
            color: var(--accent-red);
        }

        .dashboard-pie-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .dashboard-pie-chart {
            width: 200px;
            height: 200px;
        }

        .dashboard-pie-legend {
            display: flex;
            gap: 1.5rem;
            margin-top: 1rem;
            font-size: 0.85rem;
        }

        .pie-legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .pie-legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        /* Secondary Dashboard Row */
        .dashboard-secondary-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }
        @media (max-width: 900px) {
            .dashboard-secondary-grid { grid-template-columns: repeat(2, 1fr); }
        }
        @media (max-width: 500px) {
            .dashboard-secondary-grid { grid-template-columns: 1fr; }
        }
        
        .dashboard-metric-small {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            transition: all 0.3s ease;
        }
        .dashboard-metric-small:hover {
            border-color: var(--accent-xrp);
            transform: translateY(-2px);
        }
        .dashboard-metric-small.burn {
            border-left: 3px solid var(--accent-orange);
        }
        .dashboard-metric-icon {
            font-size: 1.5rem;
        }
        .dashboard-metric-info {
            flex: 1;
        }
        .dashboard-metric-info .dashboard-metric-label {
            font-size: 0.65rem;
            margin-bottom: 0.25rem;
        }
        .dashboard-metric-value.small {
            font-size: 1.1rem;
        }

        /* Animated Number Counter */
        .counter-value {
            display: inline-block;
        }

        @keyframes countUp {
            from { opacity: 0.5; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .counter-animate {
            animation: countUp 0.5s ease forwards;
        }

        /* Holdings Trend Chart */
        .trend-chart-section {
            margin-bottom: 2rem;
        }

        .trend-chart-container {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .trend-chart-container:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .trend-chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            background: var(--bg-secondary);
            border-bottom: 2px solid var(--accent-xrp);
            flex-wrap: wrap;
            gap: 1rem;
        }

        .trend-chart-wrapper {
            padding: 1.5rem;
            height: 300px;
        }

        /* Daily Change Indicators */
        .change-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.15rem 0.4rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .change-indicator.positive {
            background: rgba(34, 197, 94, 0.15);
            color: var(--accent-green);
        }

        .change-indicator.negative {
            background: rgba(239, 68, 68, 0.15);
            color: var(--accent-red);
        }

        .change-indicator.neutral {
            background: rgba(136, 136, 160, 0.15);
            color: var(--text-muted);
        }

        /* Mini Sparkline */
        .sparkline-container {
            width: 60px;
            height: 20px;
            display: inline-block;
            vertical-align: middle;
        }

        /* Exchange Charts Grid */
        .exchange-charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        @media (max-width: 1000px) {
            .exchange-charts-grid {
                grid-template-columns: 1fr;
            }
        }

        .exchange-chart-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .exchange-chart-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .exchange-chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            background: var(--bg-secondary);
            border-bottom: 2px solid var(--accent-xrp);
        }

        .exchange-chart-wrapper {
            padding: 1rem;
            height: 280px;
        }

        /* Treemap styles */
        .treemap-container {
            padding: 1rem;
            height: 280px;
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            align-content: flex-start;
        }

        .treemap-item {
            border-radius: 6px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0.5rem;
            transition: all 0.2s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .treemap-item:hover {
            transform: scale(1.05);
            z-index: 10;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .treemap-item-name {
            font-size: 0.7rem;
            font-weight: 600;
            color: rgba(0, 0, 0, 0.8);
            text-transform: uppercase;
        }

        .treemap-item-value {
            font-size: 0.65rem;
            color: rgba(0, 0, 0, 0.6);
            font-family: 'JetBrains Mono', monospace;
        }

        /* Top Dominance Section */
        .dominance-section {
            margin-bottom: 1.5rem;
        }

        .dominance-bars {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .dominance-bar-item {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .dominance-bar-label {
            width: 100px;
            font-size: 0.85rem;
            font-weight: 500;
            text-transform: capitalize;
        }

        .dominance-bar-track {
            flex: 1;
            height: 24px;
            background: var(--bg-secondary);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        .dominance-bar-fill {
            height: 100%;
            border-radius: 12px;
            transition: width 0.8s ease;
            display: flex;
            align-items: center;
            padding-left: 0.75rem;
        }

        .dominance-bar-value {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--bg-primary);
            font-family: 'JetBrains Mono', monospace;
        }

        .dominance-bar-percent {
            width: 50px;
            text-align: right;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-secondary);
            font-family: 'JetBrains Mono', monospace;
        }

        /* Comparison Mode */
        .comparison-toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .comparison-toggle:hover {
            border-color: var(--accent-purple);
        }

        .comparison-toggle.active {
            background: rgba(168, 85, 247, 0.15);
            border-color: var(--accent-purple);
            color: var(--accent-purple);
        }

        /* Chart Export Button */
        .chart-export-btn {
            padding: 0.4rem 0.8rem;
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-muted);
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .chart-export-btn:hover {
            border-color: var(--accent-xrp);
            color: var(--accent-xrp);
        }

        /* Fullscreen Chart Modal */
        .fullscreen-chart-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .fullscreen-chart-overlay.active {
            display: flex;
        }

        .fullscreen-chart-container {
            width: 100%;
            max-width: 1400px;
            height: 80vh;
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.5rem;
            position: relative;
        }

        .fullscreen-chart-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 2rem;
            cursor: pointer;
            z-index: 10;
        }

        .fullscreen-chart-close:hover {
            color: var(--text-primary);
        }

        .fullscreen-chart-canvas {
            width: 100%;
            height: calc(100% - 60px);
        }

        /* Horizontal Bar Chart adjustments */
        .horizontal-bar-wrapper {
            padding: 1rem;
            height: 350px;
        }

        /* Theme Toggle */
        /* Header Buttons */
        .header-buttons {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .language-switcher {
            display: flex;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
        }

        .lang-btn {
            background: transparent;
            border: none;
            padding: 0.5rem 0.75rem;
            font-size: 0.8rem;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .lang-btn:hover {
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .lang-btn.active {
            background: var(--accent-xrp);
            color: var(--bg-primary);
            font-weight: 600;
        }

        .help-button {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.35rem;
        }

        .help-button:hover {
            border-color: var(--accent-xrp);
            color: var(--accent-xrp);
            transform: translateY(-2px);
        }

        .header-theme-toggle {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 0.5rem 0.75rem;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .header-theme-toggle:hover {
            border-color: var(--accent-xrp);
        }

        .theme-toggle {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--bg-card);
            border: 2px solid var(--border);
            color: var(--text-primary);
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 100;
        }

        .theme-toggle:hover {
            border-color: var(--accent-xrp);
            transform: scale(1.1);
        }

        /* Light Mode */
        body.light-mode {
            --bg-primary: #f5f5f7;
            --bg-secondary: #e8e8ec;
            --bg-card: #ffffff;
            --bg-card-hover: #f0f0f4;
            --border: #d0d0d8;
            --text-primary: #1a1a2e;
            --text-secondary: #5a5a70;
            --text-muted: #8888a0;
        }

        body.light-mode .bg-grid {
            background-image: 
                linear-gradient(rgba(35, 247, 221, 0.08) 1px, transparent 1px),
                linear-gradient(90deg, rgba(35, 247, 221, 0.08) 1px, transparent 1px);
        }

        body.light-mode .bg-glow {
            background: radial-gradient(circle at 30% 20%, rgba(35, 247, 221, 0.15) 0%, transparent 50%),
                        radial-gradient(circle at 70% 80%, rgba(168, 85, 247, 0.1) 0%, transparent 50%);
        }

        /* Tooltip Styles */
        .custom-tooltip {
            position: absolute;
            background: var(--bg-card);
            border: 1px solid var(--accent-xrp);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            font-size: 0.85rem;
            pointer-events: none;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .custom-tooltip-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .custom-tooltip-value {
            color: var(--accent-xrp);
            font-family: 'JetBrains Mono', monospace;
        }

        /* ============================================
           NEWS TAB STYLES
           ============================================ */
        .news-container { padding: 0; }
        .news-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem; }
        .section-title { font-size: 1.3rem; font-weight: 700; display: flex; align-items: center; gap: 0.5rem; }
        .news-filters { display: flex; gap: 0.5rem; }

        .calendar-section { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; padding: 1.5rem; margin-bottom: 2rem; }
        .calendar-header { margin-bottom: 1rem; }
        .calendar-header h3 { font-size: 1.1rem; display: flex; align-items: center; gap: 0.5rem; }
        .calendar-events { display: flex; flex-direction: column; gap: 1rem; }
        .calendar-event { display: flex; align-items: center; gap: 1rem; padding: 1rem; background: var(--glass-bg); backdrop-filter: blur(var(--glass-blur)); -webkit-backdrop-filter: blur(var(--glass-blur)); border: 1px solid var(--glass-border); border-radius: 16px; border-left: 4px solid var(--accent-xrp); transition: all 0.3s ease; box-shadow: var(--glass-shadow); }
        .calendar-event:hover { transform: translateX(5px); border-color: rgba(35, 247, 221, 0.3); }
        .event-date { display: flex; flex-direction: column; align-items: center; min-width: 50px; }
        .event-day { font-size: 1.5rem; font-weight: 700; color: var(--accent-xrp); }
        .event-month { font-size: 0.7rem; text-transform: uppercase; color: var(--text-muted); }
        .event-details { flex: 1; }
        .event-title { font-weight: 600; margin-bottom: 0.25rem; }
        .event-desc { font-size: 0.85rem; color: var(--text-muted); }
        .event-tag { padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600; }
        .tag-important { background: rgba(239, 68, 68, 0.2); color: var(--accent-red); }
        .tag-report { background: rgba(59, 130, 246, 0.2); color: var(--accent-blue); }
        .tag-market { background: rgba(168, 85, 247, 0.2); color: var(--accent-purple); }

        /* News Feed - Modern Card Redesign */
        .news-feed { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); 
            gap: 1.25rem; 
        }
        
        .news-item { 
            background: var(--glass-bg); 
            backdrop-filter: blur(var(--glass-blur)); 
            -webkit-backdrop-filter: blur(var(--glass-blur)); 
            border: 1px solid var(--glass-border); 
            border-radius: 20px; 
            overflow: hidden;
            transition: all 0.3s ease; 
            cursor: pointer; 
            box-shadow: var(--glass-shadow);
            display: flex;
            flex-direction: column;
        }
        
        .news-item:hover { 
            border-color: rgba(35, 247, 221, 0.4); 
            transform: translateY(-8px) scale(1.02); 
            box-shadow: var(--glass-shadow), 0 20px 40px rgba(35, 247, 221, 0.15); 
        }
        
        .news-image {
            width: 100%;
            height: 140px;
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .news-image::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(35, 247, 221, 0.1), rgba(168, 85, 247, 0.1));
        }
        
        .news-image-icon {
            font-size: 3rem;
            z-index: 1;
            filter: grayscale(20%);
        }
        
        .news-sentiment-badge {
            position: absolute;
            top: 0.75rem;
            left: 0.75rem;
            padding: 0.3rem 0.7rem;
            border-radius: 20px;
            font-size: 0.65rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.03em;
            backdrop-filter: blur(8px);
            z-index: 2;
        }
        
        .news-sentiment-badge.bullish {
            background: rgba(34, 197, 94, 0.9);
            color: white;
            box-shadow: 0 2px 10px rgba(34, 197, 94, 0.4);
        }
        
        .news-sentiment-badge.bearish {
            background: rgba(239, 68, 68, 0.9);
            color: white;
            box-shadow: 0 2px 10px rgba(239, 68, 68, 0.4);
        }
        
        .news-sentiment-badge.neutral {
            background: rgba(234, 179, 8, 0.9);
            color: #1e293b;
            box-shadow: 0 2px 10px rgba(234, 179, 8, 0.4);
        }
        
        .news-source-badge {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            padding: 0.3rem 0.7rem;
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(8px);
            border-radius: 20px;
            font-size: 0.65rem;
            color: var(--text-secondary);
            font-weight: 500;
            z-index: 2;
        }
        
        .news-body {
            padding: 1.25rem;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .news-source { display: none; }
        
        .news-title { 
            font-size: 1rem; 
            font-weight: 600; 
            margin-bottom: 0.6rem; 
            line-height: 1.4; 
            color: var(--text-primary);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .news-summary { 
            color: var(--text-muted); 
            font-size: 0.85rem; 
            line-height: 1.5; 
            margin-bottom: 1rem;
            flex: 1;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .news-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 0.75rem;
            border-top: 1px solid var(--glass-border);
            margin-top: auto;
        }
        
        .news-time-new { 
            color: var(--text-muted); 
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }
        
        .news-impact {
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }
        
        .impact-dots {
            display: flex;
            gap: 3px;
        }
        
        .impact-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--border);
            transition: all 0.2s ease;
        }
        
        .impact-dot.active {
            background: var(--accent-xrp);
            box-shadow: 0 0 6px var(--accent-xrp);
        }
        
        .impact-dot.high {
            background: var(--accent-green);
            box-shadow: 0 0 6px var(--accent-green);
        }
        
        .impact-dot.medium {
            background: var(--accent-orange);
            box-shadow: 0 0 6px var(--accent-orange);
        }
        
        .news-tags { display: none; }
        .news-tag { display: none; }
        .news-load-more { text-align: center; margin-top: 1.5rem; grid-column: 1 / -1; }

        /* ============================================
           XRP LEDGER DATA SECTION
           ============================================ */
        .xrpl-section {
            background: var(--glass-bg);
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--glass-shadow);
        }
        
        .xrpl-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.25rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .xrpl-title {
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .xrpl-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
            color: var(--text-muted);
        }
        
        .xrpl-status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent-green);
            animation: xrplPulse 2s infinite;
        }
        
        @keyframes xrplPulse {
            0%, 100% { opacity: 1; box-shadow: 0 0 8px var(--accent-green); }
            50% { opacity: 0.5; box-shadow: none; }
        }
        
        .xrpl-stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        @media (max-width: 1400px) {
            .xrpl-stats-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        @media (max-width: 1000px) {
            .xrpl-stats-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .xrpl-stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 480px) {
            .xrpl-stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.75rem;
            }
        }
        
        .xrpl-stat-card {
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
            transition: all 0.3s ease;
            min-width: 0;
        }
        
        .xrpl-stat-card:hover {
            border-color: rgba(35, 247, 221, 0.3);
            transform: translateY(-3px);
        }
        
        .xrpl-stat-icon {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }
        
        .xrpl-stat-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1rem;
            font-weight: 700;
            color: var(--accent-xrp);
            margin-bottom: 0.25rem;
            word-break: break-word;
        }
        
        .xrpl-stat-label {
            font-size: 0.65rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.03em;
        }
        
        .xrpl-transactions {
            margin-top: 1rem;
        }
        
        .xrpl-tx-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }
        
        .xrpl-tx-title {
            font-size: 0.9rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .xrpl-tx-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            max-height: 280px;
            overflow-y: auto;
        }
        
        .xrpl-tx-item {
            display: grid;
            grid-template-columns: 80px 1fr auto auto auto;
            align-items: center;
            gap: 0.75rem;
            padding: 0.65rem 1rem;
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            font-size: 0.8rem;
            transition: all 0.2s ease;
        }
        
        .xrpl-tx-item:hover {
            border-color: rgba(35, 247, 221, 0.3);
            background: rgba(35, 247, 221, 0.05);
        }
        
        .xrpl-tx-type {
            padding: 0.2rem 0.5rem;
            border-radius: 6px;
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
            text-align: center;
        }
        
        .xrpl-tx-type.payment { background: rgba(34, 197, 94, 0.2); color: var(--accent-green); }
        .xrpl-tx-type.offer { background: rgba(59, 130, 246, 0.2); color: var(--accent-blue); }
        .xrpl-tx-type.trust { background: rgba(168, 85, 247, 0.2); color: var(--accent-purple); }
        .xrpl-tx-type.escrow { background: rgba(249, 115, 22, 0.2); color: var(--accent-orange); }
        .xrpl-tx-type.nftoken { background: rgba(236, 72, 153, 0.2); color: #ec4899; }
        .xrpl-tx-type.amm { background: rgba(234, 179, 8, 0.2); color: var(--accent-yellow); }
        .xrpl-tx-type.other { background: rgba(148, 163, 184, 0.2); color: var(--text-muted); }
        
        .xrpl-tx-hash {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            color: var(--text-secondary);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .xrpl-tx-amount {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            color: var(--accent-xrp);
            white-space: nowrap;
            font-size: 0.8rem;
        }
        
        .xrpl-tx-time {
            font-size: 0.7rem;
            color: var(--text-muted);
            white-space: nowrap;
        }
        
        .xrpl-tx-link {
            color: var(--accent-xrp);
            text-decoration: none;
            font-size: 0.75rem;
            opacity: 0.7;
            transition: opacity 0.2s;
        }
        
        .xrpl-tx-link:hover {
            opacity: 1;
        }
        
        @media (max-width: 768px) {
            .xrpl-tx-item {
                grid-template-columns: 70px 1fr auto;
            }
            .xrpl-tx-hash, .xrpl-tx-link {
                display: none;
            }
        }

        /* ============================================
           CANDLESTICK CHART
           ============================================ */
        .candlestick-section {
            background: var(--glass-bg);
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--glass-shadow);
        }
        
        .candlestick-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .candlestick-title {
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .candlestick-price-info {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }
        
        .candlestick-current-price {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-xrp);
        }
        
        .candlestick-change {
            padding: 0.3rem 0.8rem;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .candlestick-change.positive {
            background: rgba(34, 197, 94, 0.2);
            color: var(--accent-green);
        }
        
        .candlestick-change.negative {
            background: rgba(239, 68, 68, 0.2);
            color: var(--accent-red);
        }
        
        .candlestick-controls {
            display: flex;
            gap: 0.5rem;
        }
        
        .candlestick-btn {
            padding: 0.5rem 1rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
        }
        
        .candlestick-btn:hover {
            background: var(--bg-card-hover);
            border-color: var(--accent-xrp);
        }
        
        .candlestick-btn.active {
            background: var(--accent-xrp-dim);
            border-color: var(--accent-xrp);
            color: var(--accent-xrp);
        }
        
        .candlestick-chart-container {
            height: 350px;
            position: relative;
        }
        
        .candlestick-chart-container canvas {
            width: 100% !important;
            height: 100% !important;
        }
        
        .candlestick-legend {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--glass-border);
        }
        
        .candlestick-legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
            color: var(--text-muted);
        }
        
        .candlestick-legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }
        
        .candlestick-legend-color.bullish { background: var(--accent-green); }
        .candlestick-legend-color.bearish { background: var(--accent-red); }

        /* ============================================
           ETF HEAT MAP
           ============================================ */
        .heatmap-section {
            background: var(--glass-bg);
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--glass-shadow);
        }
        
        .heatmap-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.25rem;
        }
        
        .heatmap-title {
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .heatmap-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
            gap: 0.75rem;
        }
        
        .heatmap-cell {
            padding: 1rem 0.75rem;
            border-radius: 12px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .heatmap-cell::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.15), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .heatmap-cell:hover {
            transform: scale(1.08);
            box-shadow: 0 8px 25px rgba(0,0,0,0.4);
            z-index: 10;
        }
        
        .heatmap-cell:hover::before {
            opacity: 1;
        }
        
        /* Heat map color classes */
        .heatmap-cell.very-bullish { background: linear-gradient(135deg, #15803d, #22c55e); }
        .heatmap-cell.bullish { background: linear-gradient(135deg, #16a34a, #4ade80); }
        .heatmap-cell.slightly-bullish { background: linear-gradient(135deg, #65a30d, #84cc16); }
        .heatmap-cell.neutral { background: linear-gradient(135deg, #ca8a04, #eab308); }
        .heatmap-cell.slightly-bearish { background: linear-gradient(135deg, #ea580c, #f97316); }
        .heatmap-cell.bearish { background: linear-gradient(135deg, #dc2626, #ef4444); }
        .heatmap-cell.very-bearish { background: linear-gradient(135deg, #991b1b, #dc2626); }
        
        .heatmap-symbol {
            font-weight: 700;
            font-size: 0.95rem;
            color: white;
            text-shadow: 0 1px 3px rgba(0,0,0,0.4);
        }
        
        .heatmap-change {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.1rem;
            font-weight: 700;
            color: white;
            text-shadow: 0 1px 3px rgba(0,0,0,0.4);
            margin-top: 0.25rem;
        }
        
        .heatmap-price {
            font-size: 0.7rem;
            color: rgba(255,255,255,0.85);
            margin-top: 0.2rem;
        }
        
        .heatmap-legend {
            display: flex;
            justify-content: center;
            gap: 0.75rem;
            margin-top: 1.25rem;
            padding-top: 1rem;
            border-top: 1px solid var(--glass-border);
            flex-wrap: wrap;
        }
        
        .heatmap-legend-item {
            display: flex;
            align-items: center;
            gap: 0.35rem;
            font-size: 0.7rem;
            color: var(--text-muted);
        }
        
        .heatmap-legend-color {
            width: 14px;
            height: 14px;
            border-radius: 4px;
        }

        /* ============================================
           PORTFOLIO TAB STYLES
           ============================================ */
        .portfolio-container { padding: 0; }
        .portfolio-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem; }
        .portfolio-summary { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
        .portfolio-card { background: var(--glass-bg); backdrop-filter: blur(var(--glass-blur)); -webkit-backdrop-filter: blur(var(--glass-blur)); border: 1px solid var(--glass-border); border-radius: 16px; padding: 1.25rem; text-align: center; transition: all 0.3s ease; box-shadow: var(--glass-shadow); }
        .portfolio-card:hover { transform: translateY(-5px); border-color: rgba(35, 247, 221, 0.3); box-shadow: var(--glass-shadow), 0 0 20px rgba(35, 247, 221, 0.1); }
        .portfolio-card.highlight { border-color: rgba(35, 247, 221, 0.4); background: linear-gradient(135deg, var(--glass-bg), rgba(35, 247, 221, 0.15)); }
        .portfolio-card-label { font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; margin-bottom: 0.5rem; }
        .portfolio-card-value { font-size: 1.5rem; font-weight: 700; font-family: 'JetBrains Mono', monospace; }
        .portfolio-card-change { font-size: 0.85rem; margin-top: 0.5rem; }
        .portfolio-card-change.positive { color: var(--accent-green); }
        .portfolio-card-change.negative { color: var(--accent-red); }

        .add-holding-section, .holdings-list-section, .calculator-section, .gamification-section { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; padding: 1.5rem; margin-bottom: 1.5rem; }
        .add-holding-section h3, .holdings-list-section h3, .calculator-section h3, .gamification-section h3 { font-size: 1.1rem; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; }
        .add-holding-form, .calculator-form { display: flex; flex-wrap: wrap; gap: 1rem; align-items: flex-end; }
        .form-group { display: flex; flex-direction: column; gap: 0.5rem; min-width: 150px; flex: 1; }
        .form-group label { font-size: 0.8rem; color: var(--text-muted); }
        .form-group input, .form-group select { padding: 0.75rem; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-family: inherit; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: var(--accent-xrp); }

        .holdings-list { display: flex; flex-direction: column; gap: 0.75rem; }
        .holding-item { display: flex; align-items: center; gap: 1rem; padding: 1rem; background: var(--bg-secondary); border-radius: 10px; }
        .holding-asset { font-weight: 600; min-width: 60px; }
        .holding-amount { font-family: 'JetBrains Mono', monospace; }
        .holding-value { margin-left: auto; text-align: right; }
        .holding-pnl { font-size: 0.85rem; }
        .holding-pnl.positive { color: var(--accent-green); }
        .holding-pnl.negative { color: var(--accent-red); }
        .holding-delete { background: none; border: none; color: var(--accent-red); cursor: pointer; font-size: 1.2rem; opacity: 0.6; transition: opacity 0.2s; }
        .holding-delete:hover { opacity: 1; }
        .empty-portfolio { text-align: center; padding: 2rem; color: var(--text-muted); }
        .empty-portfolio span { font-size: 3rem; display: block; margin-bottom: 1rem; }

        .calculator-result { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-top: 1.5rem; padding: 1rem; background: var(--bg-secondary); border-radius: 10px; }
        .calc-result-item { display: flex; justify-content: space-between; }
        .calc-result-item span { color: var(--text-muted); }
        .calc-result-item strong { font-family: 'JetBrains Mono', monospace; }

        /* Gamification Styles */
        .streak-counter { display: flex; align-items: center; gap: 1rem; padding: 1rem; background: linear-gradient(135deg, var(--accent-orange), #ff6b35); border-radius: 12px; margin-bottom: 1.5rem; }
        .streak-icon { font-size: 2.5rem; }
        .streak-count { font-size: 2rem; font-weight: 700; }
        .streak-label { font-size: 0.85rem; opacity: 0.9; }
        .achievements-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; margin-bottom: 1.5rem; }
        .achievement { display: flex; flex-direction: column; align-items: center; gap: 0.5rem; padding: 1rem; background: var(--bg-secondary); border-radius: 10px; opacity: 0.4; transition: all 0.3s ease; }
        .achievement.unlocked { opacity: 1; background: linear-gradient(135deg, var(--bg-secondary), var(--accent-xrp-dim)); border: 1px solid var(--accent-xrp); }
        .achievement-icon { font-size: 2rem; }
        .achievement-name { font-size: 0.75rem; text-align: center; color: var(--text-muted); }
        .achievement.unlocked .achievement-name { color: var(--text-primary); }

        .prediction-game { padding: 1rem; background: var(--bg-secondary); border-radius: 12px; }
        .prediction-game h4 { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; }
        .prediction-desc { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 1rem; }
        .prediction-form { display: flex; gap: 0.5rem; margin-bottom: 1rem; }
        .prediction-form input { flex: 1; padding: 0.75rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); }
        .prediction-stats { display: flex; gap: 2rem; }
        .pred-stat { display: flex; gap: 0.5rem; }
        .pred-stat span { color: var(--text-muted); }

        /* ============================================
           AI INSIGHTS TAB STYLES
           ============================================ */
        .insights-container { padding: 0; }
        .insights-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem; }

        .sentiment-section, .ai-summary-section, .ma-section, .comparison-section, .key-metrics-section, .scenarios-section, .ta-explanation-section, .etf-guide-section, .daily-briefing-section { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; padding: 1.5rem; margin-bottom: 1.5rem; }
        .sentiment-section h3, .ai-summary-section h3, .ma-section h3, .comparison-section h3, .key-metrics-section h3, .scenarios-section h3, .ta-explanation-section h3, .etf-guide-section h3 { font-size: 1.1rem; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; }

        /* Daily Briefing Card */
        .briefing-card { background: linear-gradient(135deg, rgba(35, 247, 221, 0.1), rgba(168, 85, 247, 0.1)); border: 1px solid var(--accent-xrp); border-radius: 16px; padding: 1.5rem; }
        .briefing-header { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem; }
        .briefing-icon { font-size: 1.5rem; }
        .briefing-title { font-weight: 700; font-size: 1.2rem; color: var(--accent-xrp); }
        .briefing-date { margin-left: auto; font-size: 0.85rem; color: var(--text-muted); }
        .briefing-content { margin-bottom: 1rem; }
        .briefing-main { font-size: 1.1rem; line-height: 1.6; }
        .briefing-quick-stats { display: flex; gap: 1.5rem; flex-wrap: wrap; }
        .quick-stat { display: flex; flex-direction: column; }
        .quick-label { font-size: 0.75rem; color: var(--text-muted); }
        .quick-value { font-size: 1.1rem; font-weight: 700; font-family: 'JetBrains Mono', monospace; color: var(--accent-xrp); }

        /* Price Scenarios */
        .scenarios-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; }
        .scenario-card { border-radius: 12px; padding: 1.25rem; position: relative; overflow: hidden; }
        .scenario-card.bullish { background: linear-gradient(135deg, rgba(34, 197, 94, 0.15), rgba(34, 197, 94, 0.05)); border: 1px solid rgba(34, 197, 94, 0.3); }
        .scenario-card.base { background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(59, 130, 246, 0.05)); border: 1px solid rgba(59, 130, 246, 0.3); }
        .scenario-card.bearish { background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(239, 68, 68, 0.05)); border: 1px solid rgba(239, 68, 68, 0.3); }
        .scenario-header { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem; }
        .scenario-icon { font-size: 1.25rem; }
        .scenario-title { font-weight: 600; font-size: 0.95rem; }
        .scenario-card.bullish .scenario-title { color: var(--accent-green); }
        .scenario-card.base .scenario-title { color: var(--accent-blue); }
        .scenario-card.bearish .scenario-title { color: var(--accent-red); }
        .scenario-price { font-size: 1.5rem; font-weight: 700; font-family: 'JetBrains Mono', monospace; margin-bottom: 0.5rem; }
        .scenario-card.bullish .scenario-price { color: var(--accent-green); }
        .scenario-card.base .scenario-price { color: var(--accent-blue); }
        .scenario-card.bearish .scenario-price { color: var(--accent-red); }
        .scenario-condition { font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.75rem; line-height: 1.4; }
        .scenario-probability { font-size: 0.8rem; color: var(--text-muted); }
        .scenario-probability span { font-weight: 700; color: var(--text-primary); }

        /* Technical Analysis Explanation */
        .ta-card { background: var(--bg-secondary); border-radius: 12px; padding: 1.5rem; }
        .ta-signal-badge { display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; border-radius: 20px; font-weight: 700; font-size: 0.85rem; margin-bottom: 1rem; }
        .ta-signal-badge.bullish { background: rgba(34, 197, 94, 0.2); color: var(--accent-green); }
        .ta-signal-badge.bearish { background: rgba(239, 68, 68, 0.2); color: var(--accent-red); }
        .ta-signal-badge.neutral { background: rgba(249, 115, 22, 0.2); color: var(--accent-orange); }
        .ta-main-text { font-size: 1rem; line-height: 1.7; color: var(--text-secondary); margin-bottom: 1.5rem; }
        .ta-levels { display: flex; justify-content: space-between; gap: 1rem; flex-wrap: wrap; }
        .ta-level { flex: 1; min-width: 100px; text-align: center; padding: 1rem; border-radius: 10px; background: var(--bg-card); }
        .ta-level.support { border-left: 3px solid var(--accent-green); }
        .ta-level.current { border-left: 3px solid var(--accent-xrp); }
        .ta-level.resistance { border-left: 3px solid var(--accent-red); }
        .level-label { display: block; font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.25rem; }
        .level-value { display: block; font-size: 1.2rem; font-weight: 700; font-family: 'JetBrains Mono', monospace; }
        .ta-level.support .level-value { color: var(--accent-green); }
        .ta-level.current .level-value { color: var(--accent-xrp); }
        .ta-level.resistance .level-value { color: var(--accent-red); }

        /* ETF Guide Cards */
        .etf-guide-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; }
        .etf-guide-card { background: var(--bg-secondary); border-radius: 12px; padding: 1.25rem; transition: all 0.3s ease; border: 1px solid transparent; }
        .etf-guide-card:hover { border-color: var(--accent-xrp); transform: translateY(-3px); }
        .guide-header { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem; }
        .guide-icon { font-size: 1.5rem; }
        .guide-title { font-weight: 600; font-size: 0.95rem; color: var(--text-primary); }
        .guide-recommendation { margin-bottom: 0.75rem; }
        .guide-ticker { display: inline-block; background: var(--accent-xrp); color: var(--bg-primary); padding: 0.25rem 0.75rem; border-radius: 6px; font-weight: 700; font-family: 'JetBrains Mono', monospace; font-size: 0.9rem; margin-right: 0.5rem; }
        .guide-name { font-size: 0.85rem; color: var(--text-secondary); }
        .guide-reason { font-size: 0.85rem; color: var(--text-muted); line-height: 1.5; }

        .sentiment-gauge { margin-bottom: 1rem; }
        .gauge-container { height: 20px; background: linear-gradient(90deg, var(--accent-red), var(--accent-orange), var(--accent-green)); border-radius: 10px; position: relative; overflow: hidden; }
        .gauge-fill { position: absolute; top: 0; left: 0; height: 100%; background: rgba(0,0,0,0.6); border-radius: 10px 0 0 10px; transition: width 0.5s ease; }
        .gauge-labels { display: flex; justify-content: space-between; margin-top: 0.5rem; font-size: 0.75rem; color: var(--text-muted); }
        .sentiment-score { text-align: center; font-size: 1.1rem; }

        .ai-summary-card { background: var(--bg-secondary); border-radius: 12px; padding: 1.5rem; line-height: 1.7; }
        .ai-summary-card p { margin-bottom: 1rem; }
        .ai-summary-card ul { margin-left: 1.5rem; margin-bottom: 1rem; }
        .ai-summary-card li { margin-bottom: 0.5rem; color: var(--text-secondary); }
        .ai-disclaimer { font-size: 0.8rem; color: var(--text-muted); margin-top: 1rem; padding: 0.75rem; background: rgba(249, 115, 22, 0.1); border-radius: 8px; }

        .ma-chart-container { height: 250px; margin-bottom: 1.5rem; }
        .ma-indicators { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; }
        .ma-indicator { display: flex; flex-direction: column; gap: 0.25rem; padding: 1rem; background: var(--bg-secondary); border-radius: 10px; }
        .ma-label { font-size: 0.8rem; color: var(--text-muted); }
        .ma-value { font-size: 1.2rem; font-weight: 600; font-family: 'JetBrains Mono', monospace; }
        .ma-signal { font-size: 0.75rem; font-weight: 600; }
        .ma-signal.bullish { color: var(--accent-green); }
        .ma-signal.bearish { color: var(--accent-red); }

        .comparison-selectors { display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem; justify-content: center; flex-wrap: wrap; }
        .comparison-selectors select { padding: 0.75rem 1.5rem; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-family: inherit; font-size: 1rem; cursor: pointer; }
        .vs-badge { background: var(--accent-purple); color: white; padding: 0.5rem 1rem; border-radius: 20px; font-weight: 700; font-size: 0.85rem; }
        .comparison-chart-container { height: 250px; margin-bottom: 1.5rem; }
        .comparison-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; }
        .comp-stat { background: var(--bg-secondary); border-radius: 10px; padding: 1rem; }
        .comp-stat-label { font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.5rem; }
        .comp-stat-values { display: flex; justify-content: space-between; font-family: 'JetBrains Mono', monospace; font-weight: 600; }
        .comp-val-1 { color: var(--accent-xrp); }
        .comp-val-2 { color: var(--accent-orange); }
        .comp-stat-values .positive { color: var(--accent-green) !important; }
        .comp-stat-values .negative { color: var(--accent-red) !important; }

        .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; }
        .metric-card { background: var(--bg-secondary); border-radius: 12px; padding: 1.25rem; text-align: center; transition: all 0.3s ease; }
        .metric-card:hover { transform: translateY(-3px); }
        .metric-icon { font-size: 2rem; margin-bottom: 0.5rem; }
        .metric-label { font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.5rem; }
        .metric-value { font-size: 1.3rem; font-weight: 700; font-family: 'JetBrains Mono', monospace; }
        .metric-value.positive { color: var(--accent-green); }
        .metric-value.negative { color: var(--accent-red); }
        .metric-desc { font-size: 0.75rem; color: var(--text-muted); margin-top: 0.25rem; }

        /* Smart Insight Card */
        .smart-insight-section { margin-bottom: 1.5rem; }
        .smart-insight-card { background: linear-gradient(135deg, rgba(249, 115, 22, 0.15), rgba(239, 68, 68, 0.1)); backdrop-filter: blur(var(--glass-blur)); -webkit-backdrop-filter: blur(var(--glass-blur)); border: 2px solid var(--accent-orange); border-radius: 20px; padding: 1.5rem; position: relative; overflow: hidden; box-shadow: var(--glass-shadow), 0 0 30px rgba(249, 115, 22, 0.1); }
        .smart-insight-card::before { content: ''; position: absolute; top: -50%; right: -50%; width: 100%; height: 100%; background: radial-gradient(circle, rgba(249, 115, 22, 0.1) 0%, transparent 70%); pointer-events: none; }
        .smart-insight-badge { display: inline-block; background: var(--accent-orange); color: white; padding: 0.4rem 1rem; border-radius: 20px; font-weight: 700; font-size: 0.8rem; margin-bottom: 1rem; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .smart-insight-content h3 { font-size: 1.3rem; margin-bottom: 0.5rem; color: var(--text-primary); }
        .smart-insight-content p { color: var(--text-secondary); line-height: 1.6; }
        .smart-insight-action { margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.1); }
        .action-label { font-size: 0.8rem; color: var(--accent-orange); font-weight: 600; display: block; margin-bottom: 0.25rem; }
        .action-text { color: var(--text-primary); font-weight: 500; }

        /* AI News Section */
        .ai-news-section { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; padding: 1.5rem; margin-bottom: 1.5rem; }
        .ai-news-section h3 { font-size: 1.1rem; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; }
        .ai-news-feed { display: flex; flex-direction: column; gap: 1rem; }
        .ai-news-item { background: var(--glass-bg); backdrop-filter: blur(var(--glass-blur)); -webkit-backdrop-filter: blur(var(--glass-blur)); border: 1px solid var(--glass-border); border-radius: 16px; padding: 1.25rem; border-left: 4px solid var(--border); box-shadow: var(--glass-shadow); margin-bottom: 1rem; transition: all 0.3s ease; }
        .ai-news-item:hover { transform: translateY(-3px); box-shadow: var(--glass-shadow), 0 0 15px rgba(35, 247, 221, 0.08); }
        .ai-news-item.bullish { border-left-color: var(--accent-green); }
        .ai-news-item.bearish { border-left-color: var(--accent-red); }
        .ai-news-item.neutral { border-left-color: var(--accent-orange); }
        .ai-news-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem; }
        .ai-sentiment-badge { padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 700; }
        .ai-sentiment-badge.bullish { background: rgba(34, 197, 94, 0.2); color: var(--accent-green); }
        .ai-sentiment-badge.bearish { background: rgba(239, 68, 68, 0.2); color: var(--accent-red); }
        .ai-sentiment-badge.neutral { background: rgba(249, 115, 22, 0.2); color: var(--accent-orange); }
        .ai-news-time { font-size: 0.75rem; color: var(--text-muted); }
        .ai-news-title { font-size: 1rem; font-weight: 600; margin-bottom: 0.5rem; color: var(--text-primary); }
        .ai-news-original { font-size: 0.85rem; color: var(--text-muted); font-style: italic; margin-bottom: 0.75rem; padding-left: 0.75rem; border-left: 2px solid var(--border); }
        .ai-news-analysis { background: rgba(35, 247, 221, 0.05); border-radius: 8px; padding: 0.75rem; margin-bottom: 0.75rem; }
        .analysis-label { font-size: 0.75rem; font-weight: 600; color: var(--accent-xrp); display: block; margin-bottom: 0.25rem; }
        .ai-news-analysis p { font-size: 0.9rem; color: var(--text-secondary); line-height: 1.5; margin: 0; }
        .ai-news-impact { display: flex; align-items: center; gap: 0.75rem; font-size: 0.8rem; }
        .ai-news-impact span:first-child { color: var(--text-muted); }
        .impact-bar { flex: 1; height: 6px; background: var(--bg-card); border-radius: 3px; overflow: hidden; max-width: 150px; }
        .impact-fill { height: 100%; background: var(--accent-green); border-radius: 3px; transition: width 0.3s ease; }
        .impact-fill.neutral { background: var(--accent-orange); }
        .impact-fill.bearish { background: var(--accent-red); }
        .impact-value { font-weight: 600; color: var(--text-primary); }
        .news-feed-section { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; padding: 1.5rem; margin-bottom: 1.5rem; }
        .news-feed-section h3 { font-size: 1.1rem; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; }

        /* Portfolio Tracker */
        .portfolio-tracker-section { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; padding: 1.5rem; margin-bottom: 1.5rem; }
        .portfolio-tracker-section h3 { font-size: 1.1rem; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; }
        .portfolio-input-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; margin-bottom: 1.5rem; }
        .portfolio-input-group { display: flex; flex-direction: column; gap: 0.5rem; }
        .portfolio-input-group label { font-size: 0.85rem; color: var(--text-muted); }
        .portfolio-input-group input { padding: 0.75rem 1rem; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-family: 'JetBrains Mono', monospace; font-size: 1rem; transition: border-color 0.3s ease; }
        .portfolio-input-group input:focus { outline: none; border-color: var(--accent-xrp); }
        .portfolio-results { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem; }
        .portfolio-card { background: var(--bg-secondary); border-radius: 12px; padding: 1.25rem; text-align: center; }
        .portfolio-card.current { border-left: 3px solid var(--accent-xrp); }
        .portfolio-card.profit { border-left: 3px solid var(--accent-green); }
        .portfolio-card.target { border-left: 3px solid var(--accent-purple); }
        .portfolio-card.insight { border-left: 3px solid var(--accent-orange); text-align: left; }
        .portfolio-label { font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.5rem; }
        .portfolio-value { font-size: 1.5rem; font-weight: 700; font-family: 'JetBrains Mono', monospace; }
        .portfolio-card.current .portfolio-value { color: var(--accent-xrp); }
        .portfolio-card.profit .portfolio-value { color: var(--accent-green); }
        .portfolio-card.target .portfolio-value { color: var(--accent-purple); }
        .portfolio-change, .portfolio-pnl-pct, .portfolio-gain { font-size: 0.85rem; margin-top: 0.25rem; }
        .portfolio-change.positive, .portfolio-pnl-pct.positive, .portfolio-gain { color: var(--accent-green); }
        .portfolio-change.negative, .portfolio-pnl-pct.negative { color: var(--accent-red); }
        .portfolio-insight-text { font-size: 0.9rem; color: var(--text-secondary); line-height: 1.5; }
        .portfolio-save-row { display: flex; align-items: center; gap: 1rem; }
        .btn-save { background: var(--accent-xrp); color: var(--bg-primary); }
        .save-status { font-size: 0.85rem; color: var(--accent-green); }

        /* AI Chat Widget */
        .chat-toggle-btn { position: fixed; bottom: 24px; right: 24px; width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, var(--accent-xrp), var(--accent-purple)); border: none; cursor: pointer; box-shadow: 0 4px 20px rgba(35, 247, 221, 0.4); z-index: 1000; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; transition: all 0.3s ease; }
        .chat-toggle-btn:hover { transform: scale(1.1); box-shadow: 0 6px 30px rgba(35, 247, 221, 0.6); }
        .chat-toggle-btn.active { background: var(--accent-red); }
        
        .chat-widget { position: fixed; bottom: 100px; right: 24px; width: 380px; max-width: calc(100vw - 48px); height: 500px; max-height: calc(100vh - 150px); background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); z-index: 999; display: none; flex-direction: column; overflow: hidden; }
        .chat-widget.open { display: flex; animation: slideUp 0.3s ease; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        .chat-header { padding: 1rem 1.25rem; background: linear-gradient(135deg, var(--accent-xrp), var(--accent-purple)); display: flex; align-items: center; gap: 0.75rem; }
        .chat-header-icon { font-size: 1.5rem; }
        .chat-header-title { font-weight: 700; font-size: 1rem; color: var(--bg-primary); }
        .chat-header-subtitle { font-size: 0.75rem; color: rgba(0,0,0,0.6); }
        .chat-close-btn { margin-left: auto; background: rgba(0,0,0,0.2); border: none; width: 28px; height: 28px; border-radius: 50%; cursor: pointer; color: var(--bg-primary); font-size: 1.2rem; display: flex; align-items: center; justify-content: center; }
        
        .chat-messages { flex: 1; overflow-y: auto; padding: 1rem; display: flex; flex-direction: column; gap: 0.75rem; }
        .chat-message { max-width: 85%; padding: 0.75rem 1rem; border-radius: 12px; font-size: 0.9rem; line-height: 1.5; }
        .chat-message.user { background: var(--accent-xrp); color: var(--bg-primary); align-self: flex-end; border-bottom-right-radius: 4px; }
        .chat-message.assistant { background: var(--bg-secondary); color: var(--text-primary); align-self: flex-start; border-bottom-left-radius: 4px; }
        .chat-message.typing { background: var(--bg-secondary); color: var(--text-muted); }
        .typing-dots { display: inline-flex; gap: 4px; }
        .typing-dots span { width: 6px; height: 6px; background: var(--text-muted); border-radius: 50%; animation: typingBounce 1.4s infinite; }
        .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
        .typing-dots span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typingBounce { 0%, 60%, 100% { transform: translateY(0); } 30% { transform: translateY(-4px); } }
        
        .chat-suggestions { padding: 0.5rem 1rem; display: flex; flex-wrap: wrap; gap: 0.5rem; border-top: 1px solid var(--border); }
        .chat-suggestion { padding: 0.4rem 0.75rem; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 20px; font-size: 0.75rem; color: var(--text-secondary); cursor: pointer; transition: all 0.2s ease; }
        .chat-suggestion:hover { border-color: var(--accent-xrp); color: var(--accent-xrp); }
        
        .chat-input-area { padding: 0.75rem 1rem; border-top: 1px solid var(--border); display: flex; gap: 0.5rem; }
        .chat-input { flex: 1; padding: 0.75rem 1rem; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 24px; color: var(--text-primary); font-family: inherit; font-size: 0.9rem; outline: none; }
        .chat-input:focus { border-color: var(--accent-xrp); }
        .chat-send-btn { width: 40px; height: 40px; border-radius: 50%; background: var(--accent-xrp); border: none; cursor: pointer; color: var(--bg-primary); font-size: 1.1rem; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease; }
        .chat-send-btn:hover { background: var(--accent-green); }
        .chat-send-btn:disabled { background: var(--border); cursor: not-allowed; }

        /* Analytics Tab Styles */
        .analytics-container { padding: 1rem 0; }
        .analytics-header { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; margin-bottom: 1.5rem; }
        .analytics-controls { display: flex; gap: 0.75rem; flex-wrap: wrap; }
        .analytics-select { padding: 0.6rem 1rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-family: inherit; cursor: pointer; }
        .analytics-select:focus { outline: none; border-color: var(--accent-xrp); }
        
        .analytics-summary { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem; }
        .analytics-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; padding: 1.25rem; display: flex; align-items: center; gap: 1rem; transition: all 0.3s ease; }
        .analytics-card:hover { border-color: var(--accent-xrp); transform: translateY(-2px); }
        .analytics-card.highlight { background: linear-gradient(135deg, rgba(35, 247, 221, 0.1), rgba(168, 85, 247, 0.1)); border-color: var(--accent-xrp); }
        .analytics-card.flow-card { border-left: 3px solid var(--accent-orange); }
        .analytics-icon { font-size: 2rem; }
        .analytics-info { flex: 1; }
        .analytics-label { font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.25rem; }
        .analytics-value { font-size: 1.4rem; font-weight: 700; font-family: 'JetBrains Mono', monospace; color: var(--text-primary); }
        .analytics-subtext { font-size: 0.75rem; color: var(--text-muted); margin-top: 0.25rem; }
        .analytics-subtext.positive { color: var(--accent-green); }
        .analytics-subtext.negative { color: var(--accent-red); }
        
        .benchmark-notice { background: rgba(249, 115, 22, 0.1); border: 1px solid rgba(249, 115, 22, 0.3); border-radius: 8px; padding: 0.75rem 1rem; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.75rem; font-size: 0.9rem; color: var(--text-secondary); }
        
        .analytics-charts-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem; }
        @media (max-width: 900px) { .analytics-charts-grid { grid-template-columns: 1fr; } }
        
        .analytics-chart-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; padding: 1.25rem; }
        .analytics-chart-card.main-chart { min-height: 400px; }
        .chart-card-header { margin-bottom: 1rem; }
        .chart-card-header h3 { font-size: 1rem; color: var(--text-primary); display: flex; align-items: center; gap: 0.5rem; }
        .analytics-chart-container { height: 350px; position: relative; }
        
        .analytics-rankings { display: flex; flex-direction: column; gap: 0.5rem; max-height: 350px; overflow-y: auto; }
        .ranking-item { display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: var(--bg-secondary); border-radius: 8px; }
        .ranking-item.skeleton { height: 50px; animation: shimmer 1.5s infinite; }
        @keyframes shimmer { 0% { opacity: 0.5; } 50% { opacity: 0.8; } 100% { opacity: 0.5; } }
        .ranking-position { width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; background: var(--bg-card); border-radius: 50%; font-weight: 700; font-size: 0.85rem; }
        .ranking-position.gold { background: linear-gradient(135deg, #ffd700, #ffb800); color: #000; }
        .ranking-position.silver { background: linear-gradient(135deg, #c0c0c0, #a8a8a8); color: #000; }
        .ranking-position.bronze { background: linear-gradient(135deg, #cd7f32, #b87333); color: #000; }
        .ranking-info { flex: 1; }
        .ranking-name { font-weight: 600; font-size: 0.9rem; }
        .ranking-balance { font-size: 0.8rem; color: var(--text-muted); font-family: 'JetBrains Mono', monospace; }
        .ranking-share { font-size: 0.85rem; font-weight: 600; color: var(--accent-xrp); }
        
        .analytics-section { background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem; }
        .analytics-section h3 { font-size: 1.1rem; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; }
        
        .change-charts-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
        @media (max-width: 768px) { .change-charts-grid { grid-template-columns: 1fr; } }
        .change-chart-card { background: var(--bg-secondary); border-radius: 8px; padding: 1rem; }
        .change-chart-card h4 { font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem; text-align: center; }
        .change-chart-card canvas { max-height: 250px; }
        
        .flow-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
        @media (max-width: 768px) { .flow-grid { grid-template-columns: 1fr; } }
        .flow-card-section { background: var(--bg-secondary); border-radius: 8px; padding: 1rem; }
        .flow-card-section h4 { font-size: 0.9rem; margin-bottom: 1rem; }
        .flow-card-section.inflows { border-left: 3px solid var(--accent-green); }
        .flow-card-section.outflows { border-left: 3px solid var(--accent-red); }
        .flow-list { display: flex; flex-direction: column; gap: 0.5rem; }
        .flow-item { display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 0.75rem; background: var(--bg-card); border-radius: 6px; }
        .flow-item.skeleton { height: 40px; }
        .flow-item-name { font-weight: 500; }
        .flow-item-value { font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; }
        .flow-item-value.positive { color: var(--accent-green); }
        .flow-item-value.negative { color: var(--accent-red); }
        
        .wallet-details-controls { margin-bottom: 1rem; }
        .wallet-details-table { overflow-x: auto; }
        
        .analytics-export { display: flex; align-items: center; gap: 1rem; flex-wrap: wrap; padding: 1rem; background: var(--bg-card); border-radius: 12px; }
        .btn-export { background: var(--bg-secondary); border: 1px solid var(--border); color: var(--text-primary); padding: 0.6rem 1.25rem; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 0.5rem; transition: all 0.2s ease; }
        .btn-export:hover { border-color: var(--accent-xrp); color: var(--accent-xrp); }
        .export-note { font-size: 0.8rem; color: var(--text-muted); }

        /* Whale Watch Tab Styles */
        .whale-container { padding: 1rem 0; }
        .whale-header { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; margin-bottom: 1.5rem; }
        .whale-controls { display: flex; gap: 1rem; flex-wrap: wrap; align-items: center; }
        .whale-tabs { display: flex; gap: 4px; background: var(--bg-secondary); padding: 4px; border-radius: 8px; }
        .whale-tab { padding: 0.5rem 1rem; background: transparent; border: none; color: var(--text-muted); cursor: pointer; border-radius: 6px; font-family: inherit; transition: all 0.2s ease; }
        .whale-tab.active { background: var(--accent-xrp); color: var(--bg-primary); font-weight: 600; }
        .whale-tab:hover:not(.active) { color: var(--text-primary); }
        
        .whale-stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; margin-bottom: 1.5rem; }
        .whale-stat-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; padding: 1.25rem; display: flex; align-items: center; gap: 1rem; transition: all 0.3s ease; }
        .whale-stat-card:hover { border-color: var(--accent-xrp); transform: translateY(-2px); }
        .whale-stat-card.whale { border-left: 3px solid var(--accent-purple); }
        .whale-stat-icon { font-size: 1.75rem; }
        .whale-stat-info { flex: 1; }
        .whale-stat-label { font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.25rem; }
        .whale-stat-value { font-size: 1.25rem; font-weight: 700; font-family: 'JetBrains Mono', monospace; color: var(--accent-xrp); }
        
        .whale-notice { background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 8px; padding: 0.75rem 1rem; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.75rem; font-size: 0.85rem; color: var(--text-secondary); }
        
        .whale-main-grid { display: grid; grid-template-columns: 1fr 350px; gap: 1.5rem; margin-bottom: 1.5rem; }
        @media (max-width: 1100px) { .whale-main-grid { grid-template-columns: 1fr; } }
        
        .whale-card { background: var(--glass-bg); backdrop-filter: blur(var(--glass-blur)); -webkit-backdrop-filter: blur(var(--glass-blur)); border: 1px solid var(--glass-border); border-radius: 16px; overflow: hidden; box-shadow: var(--glass-shadow); }
        .whale-card-header { padding: 1rem 1.25rem; background: rgba(30, 41, 59, 0.5); border-bottom: 1px solid var(--glass-border); display: flex; justify-content: space-between; align-items: center; }
        .whale-card-header h3 { font-size: 1rem; font-weight: 600; display: flex; align-items: center; gap: 0.5rem; }
        .whale-badge { font-size: 0.7rem; padding: 0.25rem 0.75rem; background: rgba(35, 247, 221, 0.15); color: var(--accent-xrp); border-radius: 20px; font-weight: 600; }
        
        .whale-table-container { max-height: 600px; overflow-y: auto; }
        .whale-table { width: 100%; border-collapse: collapse; }
        .whale-table th { text-align: left; padding: 0.75rem 1rem; font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; border-bottom: 1px solid var(--border); background: var(--bg-secondary); position: sticky; top: 0; cursor: pointer; transition: all 0.2s ease; }
        .whale-table th:hover { color: var(--accent-xrp); background: var(--bg-card); }
        .whale-table th.sorted { color: var(--accent-xrp); }
        .whale-table th.sorted::after { content: ' '; }
        .whale-table th.sorted.asc::after { content: ' '; }
        .whale-table td { padding: 0.75rem 1rem; font-size: 0.85rem; border-bottom: 1px solid var(--border); transition: background 0.2s ease; }
        .whale-table tr:hover td { background: rgba(35, 247, 221, 0.05); }
        .whale-table .rank { font-family: 'JetBrains Mono', monospace; font-weight: 700; color: var(--text-muted); }
        .whale-table .rank.top-3 { color: var(--accent-yellow); text-shadow: 0 0 10px rgba(234, 179, 8, 0.5); }
        .whale-table .address { font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; color: var(--accent-blue); }
        .whale-table .address-name { font-size: 0.7rem; color: var(--text-muted); display: block; }
        .whale-table .balance { font-family: 'JetBrains Mono', monospace; font-weight: 600; text-align: right; }
        .whale-table .percentage { color: var(--accent-purple); text-align: right; }
        .whale-table .status-badge { display: inline-block; padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.7rem; }
        .whale-table .status-badge.whale { background: rgba(168, 85, 247, 0.2); color: var(--accent-purple); }
        .whale-table .status-badge.exchange { background: rgba(59, 130, 246, 0.2); color: var(--accent-blue); }
        .whale-table .status-badge.unknown { background: rgba(107, 114, 128, 0.2); color: var(--text-muted); }
        
        .whale-loading { text-align: center; padding: 3rem; }
        .whale-loading .spinner { margin: 0 auto 1rem; }
        .whale-loading p { color: var(--text-muted); }
        
        .whale-sidebar { display: flex; flex-direction: column; gap: 1rem; }
        .whale-chart-container { padding: 1rem; height: 200px; }
        
        .concentration-stats { padding: 1rem; }
        .concentration-item { margin-bottom: 1rem; }
        .concentration-item:last-child { margin-bottom: 0; }
        .conc-label { font-size: 0.75rem; color: var(--text-muted); display: block; margin-bottom: 0.25rem; }
        .conc-bar { height: 8px; background: var(--bg-secondary); border-radius: 4px; overflow: hidden; margin-bottom: 0.25rem; }
        .conc-fill { height: 100%; background: linear-gradient(90deg, var(--accent-xrp), var(--accent-purple)); border-radius: 4px; transition: width 0.5s ease; }
        .conc-value { font-size: 0.85rem; font-weight: 600; color: var(--accent-xrp); font-family: 'JetBrains Mono', monospace; }
        
        .whale-activity { padding: 1rem; max-height: 200px; overflow-y: auto; }
        .activity-item { display: flex; align-items: center; gap: 0.75rem; padding: 0.5rem; background: var(--bg-secondary); border-radius: 6px; margin-bottom: 0.5rem; font-size: 0.8rem; }
        .activity-item:last-child { margin-bottom: 0; }
        .activity-icon { font-size: 1rem; }
        .activity-text { color: var(--text-secondary); flex: 1; }
        .activity-time { font-size: 0.7rem; color: var(--text-muted); }
        
        .whale-info-banner { background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; padding: 0.75rem 1rem; display: flex; align-items: center; gap: 0.75rem; font-size: 0.85rem; color: var(--text-muted); }

        /* PDF Report Section */
        .report-section { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; padding: 1.5rem; margin-bottom: 1.5rem; }
        .report-section h3 { font-size: 1.1rem; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; }
        .report-preview { background: var(--bg-secondary); border-radius: 12px; padding: 1.5rem; margin-bottom: 1rem; }
        .report-preview-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border); }
        .report-preview-title { font-size: 1.2rem; font-weight: 700; color: var(--accent-xrp); }
        .report-preview-date { font-size: 0.85rem; color: var(--text-muted); }
        .report-sections-list { display: flex; flex-direction: column; gap: 0.5rem; margin-bottom: 1rem; }
        .report-section-item { display: flex; align-items: center; gap: 0.75rem; padding: 0.5rem; background: var(--bg-card); border-radius: 8px; }
        .report-section-icon { font-size: 1.1rem; }
        .report-section-name { font-size: 0.9rem; color: var(--text-secondary); }
        .report-section-check { margin-left: auto; color: var(--accent-green); }
        .report-actions { display: flex; gap: 1rem; flex-wrap: wrap; }
        .btn-generate-report { background: linear-gradient(135deg, var(--accent-xrp), var(--accent-purple)); color: var(--bg-primary); padding: 0.75rem 1.5rem; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 0.5rem; transition: all 0.3s ease; }
        .btn-generate-report:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(35, 247, 221, 0.4); }
        .btn-generate-report:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        .report-status { font-size: 0.85rem; color: var(--text-muted); display: flex; align-items: center; gap: 0.5rem; }
    </style>
</head>
<body>
    <!-- Animated Price Ticker -->
    <div class="price-ticker">
        <div class="ticker-track" id="tickerTrack"></div>
    </div>

    <div class="bg-grid"></div>
    <div class="bg-glow"></div>

    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon">
                    <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="32" cy="32" r="32" fill="#23292f"/>
                        <path d="M44.7 20h4.5l-9.6 9.3a10.8 10.8 0 01-15.2 0L14.8 20h4.5l7.4 7.1a7.2 7.2 0 0010.6 0L44.7 20zM19.3 44h-4.5l9.6-9.3a10.8 10.8 0 0115.2 0l9.6 9.3h-4.5l-7.4-7.1a7.2 7.2 0 00-10.6 0L19.3 44z" fill="#fff"/>
                    </svg>
                </div>
                <h1>XRP Analytics</h1>
            </div>
            <div class="xrp-price" id="xrpPrice">
                <span class="xrp-label">XRP Price</span>
                <span class="xrp-value">Loading...</span>
            </div>
            <a href="https://x.com/chachakobe4er" target="_blank" class="twitter-handle">
                <span class="twitter-icon"></span>
                <span class="twitter-name">XRP  Army</span>
                <span class="twitter-user">@chachakobe4er</span>
            </a>
            <a href="https://xrpexchange.streamlit.app/" target="_blank" class="site-link">
                <span class="site-link-icon"></span>
                <span class="site-link-name">XRP Exchange</span>
                <span class="site-link-desc">Holdings Tracker</span>
            </a>
            <div class="header-meta">
                <div class="last-updated" id="lastUpdated">Not yet loaded</div>
                <div class="status">
                    <span class="status-dot"></span>
                    <span id="statusText">Ready</span>
                </div>
                <div class="auto-refresh-info" id="autoRefreshInfo">Auto-refresh: every 5 minutes</div>
            </div>
        </header>

        <!-- Dashboard Overview Section -->
        <div class="dashboard-overview">
            <div class="dashboard-overview-header">
                <div class="dashboard-overview-title">
                    <span class="xrp-mini-logo"><svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><circle cx="32" cy="32" r="32" fill="#23292f"/><path d="M44.7 20h4.5l-9.6 9.3a10.8 10.8 0 01-15.2 0L14.8 20h4.5l7.4 7.1a7.2 7.2 0 0010.6 0L44.7 20zM19.3 44h-4.5l9.6-9.3a10.8 10.8 0 0115.2 0l9.6 9.3h-4.5l-7.4-7.1a7.2 7.2 0 00-10.6 0L19.3 44z" fill="#23f7dd"/></svg></span>
                    XRP Holdings - Exchange & SPOT ETFs
                </div>
                <div class="header-buttons">
                    <div class="language-switcher">
                        <button class="lang-btn active" onclick="setLanguage('en')" title="English">
                             EN
                        </button>
                        <button class="lang-btn" onclick="setLanguage('ko')" title="">
                             KO
                        </button>
                    </div>
                    <a href="help.html" class="help-button" title="How to Use This Dashboard" data-i18n="help">
                         Help
                    </a>
                    <button class="header-theme-toggle" onclick="toggleTheme()" title="Toggle Light/Dark Mode">
                        
                    </button>
                </div>
            </div>
            <div class="dashboard-grid">
                <div class="dashboard-metrics">
                    <div class="dashboard-metric">
                        <div class="dashboard-metric-label">Total XRP in Spot ETFs</div>
                        <div class="dashboard-metric-value animated" id="dashboardETFXRP">--</div>
                        <div class="dashboard-metric-change positive" id="dashboardETFChange">
                            <span></span> <span>Live Data</span>
                        </div>
                    </div>
                    <div class="dashboard-metric">
                        <div class="dashboard-metric-label">ETF Value (USD)</div>
                        <div class="dashboard-metric-value animated" id="dashboardETFValue">--</div>
                    </div>
                    <div class="dashboard-metric">
                        <div class="dashboard-metric-label">XRP on Exchanges</div>
                        <div class="dashboard-metric-value animated" id="dashboardExchangeXRP">--</div>
                        <div class="dashboard-metric-change neutral" id="dashboardExchangeChange">
                            <span></span> <span>Click Exchange tab</span>
                        </div>
                    </div>
                    <div class="dashboard-metric">
                        <div class="dashboard-metric-label">Exchange Value (USD)</div>
                        <div class="dashboard-metric-value animated" id="dashboardExchangeValue">--</div>
                    </div>
                </div>
                <div class="dashboard-pie-container">
                    <div class="dashboard-pie-chart">
                        <canvas id="dashboardPieChart"></canvas>
                    </div>
                    <div class="dashboard-pie-legend">
                        <div class="pie-legend-item">
                            <div class="pie-legend-dot" style="background: #23f7dd;"></div>
                            <span>ETFs</span>
                        </div>
                        <div class="pie-legend-item">
                            <div class="pie-legend-dot" style="background: #a855f7;"></div>
                            <span>Exchanges</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Top 10K & Burn Stats Row -->
            <div class="dashboard-secondary-grid">
                <div class="dashboard-metric-small">
                    <div class="dashboard-metric-icon"></div>
                    <div class="dashboard-metric-info">
                        <div class="dashboard-metric-label">Top 10K Holdings</div>
                        <div class="dashboard-metric-value small" id="dashboardTop10KXRP">--</div>
                        <div class="dashboard-metric-change neutral" id="dashboardTop10KChange">
                            <span></span> <span>Click Top 10K tab</span>
                        </div>
                    </div>
                </div>
                <div class="dashboard-metric-small">
                    <div class="dashboard-metric-icon"></div>
                    <div class="dashboard-metric-info">
                        <div class="dashboard-metric-label">Whale Accounts (1M)</div>
                        <div class="dashboard-metric-value small" id="dashboardWhaleCount">--</div>
                    </div>
                </div>
                <div class="dashboard-metric-small burn">
                    <div class="dashboard-metric-icon"></div>
                    <div class="dashboard-metric-info">
                        <div class="dashboard-metric-label">Total XRP Burned</div>
                        <div class="dashboard-metric-value small" id="burnTotal">--</div>
                    </div>
                </div>
                <div class="dashboard-metric-small">
                    <div class="dashboard-metric-icon"></div>
                    <div class="dashboard-metric-info">
                        <div class="dashboard-metric-label">Current Supply</div>
                        <div class="dashboard-metric-value small" id="currentSupply">--</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Tab Navigation -->
        <div class="main-tabs" style="flex-wrap: wrap;">
            <button class="main-tab active" onclick="switchMainTab('trading')">
                <span class="main-tab-icon"></span>
                ETF Trading
            </button>
            <button class="main-tab" onclick="switchMainTab('holdings')">
                <span class="main-tab-icon"></span>
                ETF Holdings
            </button>
            <button class="main-tab" onclick="switchMainTab('exchange')">
                <span class="main-tab-icon"></span>
                Exchange
            </button>
            <button class="main-tab" onclick="switchMainTab('analytics')">
                <span class="main-tab-icon"></span>
                Exchange Analytics
            </button>
            <button class="main-tab" onclick="switchMainTab('whales')">
                <span class="main-tab-icon"></span>
                Top 10K
            </button>
            <button class="main-tab" onclick="switchMainTab('news')">
                <span class="main-tab-icon"></span>
                News
            </button>
            <button class="main-tab" onclick="switchMainTab('insights')">
                <span class="main-tab-icon"></span>
                AI Insights
            </button>
        </div>

        <!-- Trading Tab Content -->
        <div id="tradingTab" class="tab-content active">
            <div class="controls">
                <button class="btn active" data-period="daily" onclick="setPeriod('daily')">Daily</button>
                <button class="btn" data-period="weekly" onclick="setPeriod('weekly')">Weekly</button>
                <button class="btn" data-period="monthly" onclick="setPeriod('monthly')">Monthly</button>
                <button class="btn" data-period="yearly" onclick="setPeriod('yearly')">Yearly</button>
                <button class="btn btn-chart" onclick="openChartModal()">
                     Charts
                </button>
                <button class="btn btn-refresh" id="refreshBtn" onclick="fetchData()">
                     Refresh Data
                </button>
            </div>

            <main id="mainContent">
                <div class="loading-container">
                    <div class="spinner"></div>
                    <p class="loading-text">Loading ETF data...</p>
                </div>
            </main>
        </div>

        <!-- Holdings Tab Content -->
        <div id="holdingsTab" class="tab-content">
            <div class="holdings-summary" id="holdingsSummary">
                <div class="summary-card highlight">
                    <div class="summary-label">Total XRP</div>
                    <div class="summary-value accent" id="totalXRP">Loading...</div>
                </div>
                <div class="summary-card highlight">
                    <div class="summary-label">Total Value</div>
                    <div class="summary-value accent" id="totalValue">Loading...</div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">Current XRP Price</div>
                    <div class="summary-value" id="holdingsXRPPrice">Loading...</div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">Active ETFs</div>
                    <div class="summary-value" id="activeETFs">--</div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">Last Updated</div>
                    <div class="summary-value" id="holdingsLastUpdated" style="font-size: 1rem;">--</div>
                </div>
            </div>

            <!-- Holdings Trend Chart (Historical) -->
            <div class="trend-chart-section">
                <div class="trend-chart-container">
                    <div class="trend-chart-header">
                        <div class="holdings-table-title">
                            <span></span>
                            Holdings Trend Over Time
                        </div>
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <button class="chart-export-btn" onclick="exportChart('trendChart')"> Export</button>
                            <button class="chart-export-btn" onclick="openFullscreenChart('trend')"> Fullscreen</button>
                        </div>
                    </div>
                    <div class="trend-chart-wrapper">
                        <canvas id="holdingsTrendChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Holdings Distribution Chart Section -->
            <div class="holdings-chart-section">
                <div class="holdings-chart-container">
                    <div class="holdings-chart-header">
                        <div class="holdings-table-title">
                            <span></span>
                            ETF Holdings Distribution
                        </div>
                        <div style="display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap;">
                            <div class="holdings-chart-controls">
                                <button class="btn chart-type-btn active" data-hchart="bar" onclick="switchHoldingsChart('bar')">Bar</button>
                                <button class="btn chart-type-btn" data-hchart="pie" onclick="switchHoldingsChart('pie')">Pie</button>
                                <button class="btn chart-type-btn" data-hchart="doughnut" onclick="switchHoldingsChart('doughnut')">Doughnut</button>
                            </div>
                            <button class="chart-export-btn" onclick="exportChart('distributionChart')"> Export</button>
                        </div>
                    </div>
                    <div class="holdings-chart-wrapper">
                        <canvas id="holdingsDistributionChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="holdings-table-container">
                <div class="holdings-table-header">
                    <div class="holdings-table-title">
                        <span></span>
                        Daily Holdings Data
                    </div>
                    <span style="font-size: 0.75rem; color: var(--text-muted);">Data updated manually</span>
                </div>
                <div class="holdings-table-wrapper">
                    <table class="holdings-table" id="holdingsTable">
                        <!-- Table will be populated by JavaScript -->
                    </table>
                </div>
            </div>

        </div>

        <!-- Exchange Holdings Tab Content -->
        <div id="exchangeTab" class="tab-content">
            <div class="holdings-summary">
                <div class="summary-card highlight">
                    <div class="summary-label">Total XRP on Exchanges</div>
                    <div class="summary-value accent" id="exchangeTotalXRP">--</div>
                </div>
                <div class="summary-card highlight">
                    <div class="summary-label">Total Value (USD)</div>
                    <div class="summary-value accent" id="exchangeTotalValue">--</div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">Exchanges Tracked</div>
                    <div class="summary-value" id="exchangeCount">43</div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">Wallets Tracked</div>
                    <div class="summary-value" id="walletCount">200+</div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">Data Status</div>
                    <div class="summary-value" id="exchangeStatus" style="font-size: 0.9rem;">
                        <span style="color: var(--accent-xrp);"> Ready</span>
                    </div>
                </div>
            </div>

            <div class="exchange-controls-bar">
                <button class="btn btn-refresh" id="fetchExchangeBtn" onclick="fetchExchangeData(true)">
                     Refresh Data
                </button>
                <a href="exchange.html" target="_blank" class="btn btn-chart">
                     Full Dashboard
                </a>
                <input type="text" id="exchangeFilter" class="exchange-filter-input" placeholder=" Filter exchanges..." onkeyup="filterExchangeTable()">
            </div>

            <!-- Exchange Charts Grid -->
            <div class="exchange-charts-grid">
                <!-- Horizontal Bar Chart -->
                <div class="exchange-chart-card">
                    <div class="exchange-chart-header">
                        <div class="holdings-table-title">
                            <span></span>
                            Top 10 Exchanges
                        </div>
                        <button class="chart-export-btn" onclick="exportChart('exchangeBarChart')"> Export</button>
                    </div>
                    <div class="horizontal-bar-wrapper">
                        <canvas id="exchangeHorizontalBarChart"></canvas>
                    </div>
                </div>

                <!-- Market Dominance Donut -->
                <div class="exchange-chart-card">
                    <div class="exchange-chart-header">
                        <div class="holdings-table-title">
                            <span></span>
                            Market Dominance
                        </div>
                    </div>
                    <div class="exchange-chart-wrapper">
                        <canvas id="exchangeDominanceChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Treemap Visualization -->
            <div class="exchange-chart-card" style="margin-bottom: 1.5rem;">
                <div class="exchange-chart-header">
                    <div class="holdings-table-title">
                        <span></span>
                        Holdings Treemap
                    </div>
                    <span style="color: var(--text-muted); font-size: 0.8rem;">Size = Market Share</span>
                </div>
                <div class="treemap-container" id="exchangeTreemap">
                    <div style="color: var(--text-muted); text-align: center; width: 100%; padding: 2rem;">
                        Loading treemap...
                    </div>
                </div>
            </div>

            <!-- Market Dominance Bars -->
            <div class="exchange-chart-card dominance-section" style="margin-bottom: 1.5rem;">
                <div class="exchange-chart-header">
                    <div class="holdings-table-title">
                        <span></span>
                        Top 5 Market Share
                    </div>
                </div>
                <div style="padding: 1.25rem;">
                    <div class="dominance-bars" id="dominanceBars">
                        <div style="color: var(--text-muted); text-align: center; padding: 1rem;">
                            Load exchange data to see dominance bars
                        </div>
                    </div>
                </div>
            </div>

            <div class="exchange-info-banner">
                <span></span>
                <span><strong>Live XRPL Data:</strong> Fetches real-time balances directly from the XRP Ledger. Data auto-loads when you visit this tab and is cached for 5 minutes.</span>
            </div>

            <div class="holdings-table-container">
                <div class="holdings-table-header">
                    <div class="holdings-table-title">
                        <span></span>
                        Exchange XRP Holdings
                    </div>
                    <span class="group-count" id="exchangeResultCount">0 exchanges loaded</span>
                </div>
                <div class="holdings-table-wrapper" style="max-height: 500px;">
                    <table class="holdings-table" id="exchangeTable">
                        <thead>
                            <tr>
                                <th style="text-align: left; min-width: 50px;">Rank</th>
                                <th style="text-align: left; min-width: 150px;">Exchange</th>
                                <th style="min-width: 120px;">Balance (XRP)</th>
                                <th style="min-width: 120px;">Value (USD)</th>
                                <th style="min-width: 100px;">Market Share</th>
                                <th style="min-width: 80px;">Wallets</th>
                            </tr>
                        </thead>
                        <tbody id="exchangeTableBody">
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 3rem; color: var(--text-muted);">
                                    Click "Fetch Live Data" to load exchange balances from the XRP Ledger
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="exchange-info-banner" style="margin-top: 1rem; background: var(--bg-secondary);">
                <span></span>
                <span><strong>Note:</strong> Data fetched from XRPL nodes (s1.ripple.com, s2.ripple.com, xrplcluster.com). Some requests may timeout - refresh to retry.</span>
            </div>
        </div>

        <!-- Analytics Tab Content -->
        <div id="analyticsTab" class="tab-content">
            <div class="analytics-container">
                <div class="analytics-header">
                    <h2 class="section-title"><span></span> Exchange Analytics</h2>
                    <div class="analytics-controls">
                        <select id="analyticsChartType" class="analytics-select" onchange="updateAnalyticsChart()">
                            <option value="bar">Bar Chart</option>
                            <option value="treemap">Treemap</option>
                            <option value="pie">Pie Chart</option>
                            <option value="horizontal">Horizontal Bar</option>
                        </select>
                        <select id="analyticsTopN" class="analytics-select" onchange="updateAnalyticsChart()">
                            <option value="5">Top 5</option>
                            <option value="10" selected>Top 10</option>
                            <option value="15">Top 15</option>
                            <option value="20">Top 20</option>
                        </select>
                        <button class="btn btn-refresh" onclick="refreshAnalytics()"> Refresh</button>
                    </div>
                </div>

                <!-- Analytics Summary Cards -->
                <div class="analytics-summary">
                    <div class="analytics-card highlight">
                        <div class="analytics-icon"></div>
                        <div class="analytics-info">
                            <div class="analytics-label">Total XRP on Exchanges</div>
                            <div class="analytics-value" id="analyticsTotalXRP">--</div>
                        </div>
                    </div>
                    <div class="analytics-card">
                        <div class="analytics-icon"></div>
                        <div class="analytics-info">
                            <div class="analytics-label">Exchanges Tracked</div>
                            <div class="analytics-value" id="analyticsExchangeCount">43</div>
                        </div>
                    </div>
                    <div class="analytics-card">
                        <div class="analytics-icon"></div>
                        <div class="analytics-info">
                            <div class="analytics-label">Top 3 Dominance</div>
                            <div class="analytics-value" id="analyticsTop3">--%</div>
                        </div>
                    </div>
                    <div class="analytics-card flow-card">
                        <div class="analytics-icon"></div>
                        <div class="analytics-info">
                            <div class="analytics-label">Net Flow (vs Feb 24)</div>
                            <div class="analytics-value" id="analyticsNetFlow">--</div>
                            <div class="analytics-subtext" id="analyticsFlowDirection">Loading...</div>
                        </div>
                    </div>
                </div>

                <!-- Historical Benchmark Notice -->
                <div class="benchmark-notice">
                    <span></span>
                    <span>Historical benchmark: <strong>February 24, 2025</strong> - Comparing current balances to this date</span>
                </div>

                <!-- Main Analytics Charts -->
                <div class="analytics-charts-grid">
                    <div class="analytics-chart-card main-chart">
                        <div class="chart-card-header">
                            <h3><span id="analyticsChartTitle">Top 10 Exchange Holdings</span></h3>
                        </div>
                        <div class="analytics-chart-container">
                            <canvas id="analyticsMainChart"></canvas>
                        </div>
                    </div>
                    <div class="analytics-chart-card">
                        <div class="chart-card-header">
                            <h3> Rankings</h3>
                        </div>
                        <div class="analytics-rankings" id="analyticsRankings">
                            <div class="ranking-item skeleton"></div>
                            <div class="ranking-item skeleton"></div>
                            <div class="ranking-item skeleton"></div>
                        </div>
                    </div>
                </div>

                <!-- Historical Change Analysis -->
                <div class="analytics-section">
                    <h3><span></span> Change Since Feb 24, 2025</h3>
                    <div class="change-charts-grid">
                        <div class="change-chart-card">
                            <h4>Absolute Change (XRP)</h4>
                            <canvas id="absoluteChangeChart"></canvas>
                        </div>
                        <div class="change-chart-card">
                            <h4>Percentage Change (%)</h4>
                            <canvas id="percentChangeChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Top Gainers & Losers -->
                <div class="analytics-section">
                    <h3><span></span> Inflows & Outflows</h3>
                    <div class="flow-grid">
                        <div class="flow-card-section inflows">
                            <h4> Top Inflows (Accumulating)</h4>
                            <div class="flow-list" id="topInflows">
                                <div class="flow-item skeleton"></div>
                            </div>
                        </div>
                        <div class="flow-card-section outflows">
                            <h4> Top Outflows (Distributing)</h4>
                            <div class="flow-list" id="topOutflows">
                                <div class="flow-item skeleton"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Wallet Details Section -->
                <div class="analytics-section">
                    <h3><span></span> Wallet Details</h3>
                    <div class="wallet-details-controls">
                        <select id="walletExchangeSelect" class="analytics-select" onchange="showWalletDetails()">
                            <option value="">Select an exchange...</option>
                        </select>
                    </div>
                    <div class="wallet-details-table" id="walletDetailsTable" style="display: none;">
                        <table class="holdings-table">
                            <thead>
                                <tr>
                                    <th>Wallet Name</th>
                                    <th>Address</th>
                                    <th>Balance (XRP)</th>
                                    <th>Historical</th>
                                    <th>Change</th>
                                </tr>
                            </thead>
                            <tbody id="walletDetailsBody"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Export Section -->
                <div class="analytics-export">
                    <button class="btn btn-export" onclick="exportAnalyticsCSV()">
                         Download CSV
                    </button>
                    <button class="btn btn-export" onclick="exportAnalyticsJSON()">
                         Download JSON
                    </button>
                    <span class="export-note">Export current exchange data with historical comparison</span>
                </div>
            </div>
        </div>

        <!-- Top 10K Tab Content -->
        <div id="whalesTab" class="tab-content">
            <div class="whale-container">
                <div class="whale-header">
                    <h2 class="section-title"><span></span> XRP Top 10K Rich List</h2>
                    <div class="whale-controls">
                        <div class="whale-tabs">
                            <button class="whale-tab active" data-count="25" onclick="setWhaleCount(25)">Top 25</button>
                            <button class="whale-tab" data-count="50" onclick="setWhaleCount(50)">Top 50</button>
                            <button class="whale-tab" data-count="100" onclick="setWhaleCount(100)">Top 100</button>
                            <button class="whale-tab" data-count="500" onclick="setWhaleCount(500)">Top 500</button>
                        </div>
                        <button class="btn btn-refresh" onclick="refreshWhaleData()"> Refresh</button>
                    </div>
                </div>

                <!-- Whale Stats Summary -->
                <div class="whale-stats-grid">
                    <div class="whale-stat-card">
                        <div class="whale-stat-icon"></div>
                        <div class="whale-stat-info">
                            <div class="whale-stat-label">Total XRP (Top 10K)</div>
                            <div class="whale-stat-value" id="whaleTotalXRP">--</div>
                        </div>
                    </div>
                    <div class="whale-stat-card">
                        <div class="whale-stat-icon"></div>
                        <div class="whale-stat-info">
                            <div class="whale-stat-label">Accounts Loaded</div>
                            <div class="whale-stat-value" id="whaleAccountCount">--</div>
                        </div>
                    </div>
                    <div class="whale-stat-card whale">
                        <div class="whale-stat-icon"></div>
                        <div class="whale-stat-info">
                            <div class="whale-stat-label">Whale Accounts (1M)</div>
                            <div class="whale-stat-value" id="whaleWhaleCount">--</div>
                        </div>
                    </div>
                    <div class="whale-stat-card">
                        <div class="whale-stat-icon"></div>
                        <div class="whale-stat-info">
                            <div class="whale-stat-label">Top 10 Dominance</div>
                            <div class="whale-stat-value" id="whaleTop10Pct">--%</div>
                        </div>
                    </div>
                    <div class="whale-stat-card">
                        <div class="whale-stat-icon"></div>
                        <div class="whale-stat-info">
                            <div class="whale-stat-label">Mean Balance</div>
                            <div class="whale-stat-value" id="whaleMeanBalance">--</div>
                        </div>
                    </div>
                    <div class="whale-stat-card">
                        <div class="whale-stat-icon"></div>
                        <div class="whale-stat-info">
                            <div class="whale-stat-label">Median Balance</div>
                            <div class="whale-stat-value" id="whaleMedianBalance">--</div>
                        </div>
                    </div>
                </div>

                <!-- Live Data Notice -->
                <div class="whale-notice">
                    <span></span>
                    <span><strong>Top 10,000 Wallets</strong> from XRPL  Stats calculated from full 10K dataset  Showing <span id="whaleShowingCount">25</span> accounts</span>
                </div>

                <!-- Main Content Grid -->
                <div class="whale-main-grid">
                    <!-- Rich List Table -->
                    <div class="whale-card rich-list-card">
                        <div class="whale-card-header">
                            <h3> Top Holders</h3>
                            <span class="whale-badge" id="whaleListBadge">TOP 25</span>
                        </div>
                        <div class="whale-table-container">
                            <table class="whale-table" id="whaleRichList">
                                <thead>
                                    <tr>
                                        <th class="sortable" data-sort="rank" onclick="sortWhaleTable('rank')">Rank</th>
                                        <th class="sortable" data-sort="address" onclick="sortWhaleTable('address')">Account</th>
                                        <th class="sortable" data-sort="balance" onclick="sortWhaleTable('balance')">Balance (XRP)</th>
                                        <th class="sortable" data-sort="percentage" onclick="sortWhaleTable('percentage')">% Share</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="whaleTableBody">
                                    <tr>
                                        <td colspan="5" class="whale-loading">
                                            <div class="spinner"></div>
                                            <p>Loading whale data...</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Distribution Charts -->
                    <div class="whale-sidebar">
                        <div class="whale-card">
                            <div class="whale-card-header">
                                <h3> Distribution</h3>
                            </div>
                            <div class="whale-chart-container">
                                <canvas id="whaleDistributionChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="whale-card">
                            <div class="whale-card-header">
                                <h3> Concentration</h3>
                            </div>
                            <div class="concentration-stats">
                                <div class="concentration-item">
                                    <span class="conc-label">Top 1</span>
                                    <div class="conc-bar"><div class="conc-fill" id="concTop1" style="width: 0%"></div></div>
                                    <span class="conc-value" id="concTop1Value">--%</span>
                                </div>
                                <div class="concentration-item">
                                    <span class="conc-label">Top 5</span>
                                    <div class="conc-bar"><div class="conc-fill" id="concTop5" style="width: 0%"></div></div>
                                    <span class="conc-value" id="concTop5Value">--%</span>
                                </div>
                                <div class="concentration-item">
                                    <span class="conc-label">Top 10</span>
                                    <div class="conc-bar"><div class="conc-fill" id="concTop10" style="width: 0%"></div></div>
                                    <span class="conc-value" id="concTop10Value">--%</span>
                                </div>
                                <div class="concentration-item">
                                    <span class="conc-label">Top 25</span>
                                    <div class="conc-bar"><div class="conc-fill" id="concTop25" style="width: 0%"></div></div>
                                    <span class="conc-value" id="concTop25Value">--%</span>
                                </div>
                            </div>
                        </div>

                        <div class="whale-card">
                            <div class="whale-card-header">
                                <h3> Recent Activity</h3>
                            </div>
                            <div class="whale-activity" id="whaleActivity">
                                <div class="activity-item">
                                    <span class="activity-icon"></span>
                                    <span class="activity-text">Waiting for data...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Known Addresses Info -->
                <div class="whale-info-banner">
                    <span></span>
                    <span>Some addresses are labeled with known exchange/entity names when identified. Unknown large holders are marked as "Unknown Whale".</span>
                </div>
            </div>
        </div>

        <!-- News Tab Content -->
        <div id="newsTab" class="tab-content">
            <div class="news-container">
                <div class="news-header">
                    <h2 class="section-title"><span></span> AI-Powered News Feed</h2>
                    <div class="news-filters">
                        <button class="btn active" data-news="xrp" onclick="filterNews('xrp')">XRP</button>
                        <button class="btn" data-news="crypto" onclick="filterNews('crypto')">Crypto</button>
                        <button class="btn" data-news="etf" onclick="filterNews('etf')">ETFs</button>
                        <button class="btn" data-news="all" onclick="filterNews('all')">All</button>
                    </div>
                </div>

                <!-- Smart Key Insight Card (NEW) -->
                <div class="smart-insight-section">
                    <div class="smart-insight-card" id="smartInsightCard">
                        <div class="smart-insight-badge" id="smartInsightBadge"> TODAY'S KEY INSIGHT</div>
                        <div class="smart-insight-content" id="smartInsightContent">
                            <h3 id="smartInsightTitle">Loading market insight...</h3>
                            <p id="smartInsightText">Analyzing market conditions...</p>
                        </div>
                        <div class="smart-insight-action" id="smartInsightAction">
                            <span class="action-label">What this means:</span>
                            <span class="action-text" id="smartActionText">--</span>
                        </div>
                    </div>
                </div>
                
                <!-- Calendar Section -->
                <div class="calendar-section">
                    <div class="calendar-header">
                        <h3><span></span> Upcoming Events</h3>
                    </div>
                    <div class="calendar-events" id="calendarEvents">
                        <div class="calendar-event">
                            <div class="event-date">
                                <span class="event-day">29</span>
                                <span class="event-month">JAN</span>
                            </div>
                            <div class="event-details">
                                <div class="event-title">FOMC Meeting</div>
                                <div class="event-desc">Federal Reserve interest rate decision - Jan 28-29</div>
                            </div>
                            <div class="event-tag tag-market">Market</div>
                        </div>
                        <div class="calendar-event">
                            <div class="event-date">
                                <span class="event-day">Q1</span>
                                <span class="event-month">2026</span>
                            </div>
                            <div class="event-details">
                                <div class="event-title">Ripple Q4 2025 XRP Markets Report</div>
                                <div class="event-desc">Quarterly report on XRP market activity and trends</div>
                            </div>
                            <div class="event-tag tag-report">Report</div>
                        </div>
                        <div class="calendar-event">
                            <div class="event-date">
                                <span class="event-day">19</span>
                                <span class="event-month">MAR</span>
                            </div>
                            <div class="event-details">
                                <div class="event-title">FOMC Meeting</div>
                                <div class="event-desc">Federal Reserve interest rate decision - Mar 18-19</div>
                            </div>
                            <div class="event-tag tag-market">Market</div>
                        </div>
                    </div>
                </div>

                <!-- AI News Analysis (Dynamic) -->
                <div class="ai-news-section">
                    <h3><span></span> AI News Analysis <button class="btn" style="margin-left: 1rem; padding: 0.4rem 0.8rem; font-size: 0.8rem;" onclick="refreshAIAnalysis()"> Refresh</button></h3>
                    <div class="ai-news-feed" id="aiNewsFeed">
                        <div class="ai-news-item neutral">
                            <div class="ai-news-header">
                                <span class="ai-sentiment-badge neutral"> LOADING</span>
                            </div>
                            <h4 class="ai-news-title">Analyzing latest crypto news...</h4>
                            <p class="ai-news-original">Please wait while we fetch and analyze the latest headlines.</p>
                        </div>
                    </div>
                </div>

                <!-- Live News Feed -->
                <div class="news-feed-section">
                    <h3><span></span> Latest Headlines <button class="btn" style="margin-left: 1rem; padding: 0.4rem 0.8rem; font-size: 0.8rem;" onclick="fetchLiveNews()"> Refresh</button></h3>
                    <div class="news-feed" id="newsFeed">
                        <div class="news-item" data-category="loading">
                            <div class="news-source">
                                <span class="source-icon"></span>
                                <span class="source-name">Loading</span>
                            </div>
                            <h3 class="news-title">Fetching latest crypto news...</h3>
                            <p class="news-summary">Please wait while we load the latest headlines.</p>
                        </div>
                    </div>
                </div>

                <div class="news-load-more">
                    <button class="btn" onclick="loadMoreNews()">Load More News</button>
                </div>
            </div>
        </div>

        <!-- AI Insights Tab Content -->
        <div id="insightsTab" class="tab-content">
            <div class="insights-container">
                <div class="insights-header">
                    <h2 class="section-title"><span></span> AI Market Insights</h2>
                    <button class="btn btn-refresh" onclick="generateInsights()"> Refresh Insights</button>
                </div>

                <!-- XRP Ledger Live Data Section -->
                <div class="xrpl-section">
                    <div class="xrpl-header">
                        <div class="xrpl-title">
                            <span></span> XRP Ledger Live Data
                        </div>
                        <div class="xrpl-status">
                            <span class="xrpl-status-dot"></span>
                            <span id="xrplStatusText">Connecting...</span>
                        </div>
                        <button class="btn" style="padding: 0.4rem 0.8rem; font-size: 0.8rem;" onclick="refreshXRPLData()"> Refresh</button>
                    </div>
                    
                    <div class="xrpl-stats-grid">
                        <div class="xrpl-stat-card">
                            <div class="xrpl-stat-icon"></div>
                            <div class="xrpl-stat-value" id="xrplXrpPrice">--</div>
                            <div class="xrpl-stat-label">XRP Price (USD)</div>
                        </div>
                        <div class="xrpl-stat-card">
                            <div class="xrpl-stat-icon"></div>
                            <div class="xrpl-stat-value" id="xrplLedgerIndex">--</div>
                            <div class="xrpl-stat-label">Ledger Index</div>
                        </div>
                        <div class="xrpl-stat-card">
                            <div class="xrpl-stat-icon"></div>
                            <div class="xrpl-stat-value" id="xrplSuccessPayments">--</div>
                            <div class="xrpl-stat-label">Successful Payments</div>
                        </div>
                        <div class="xrpl-stat-card">
                            <div class="xrpl-stat-icon"></div>
                            <div class="xrpl-stat-value" id="xrplTxCount">--</div>
                            <div class="xrpl-stat-label">Transactions (24h)</div>
                        </div>
                        <div class="xrpl-stat-card">
                            <div class="xrpl-stat-icon"></div>
                            <div class="xrpl-stat-value" id="xrplAccounts">--</div>
                            <div class="xrpl-stat-label">Accounts Created</div>
                        </div>
                        <div class="xrpl-stat-card">
                            <div class="xrpl-stat-icon"></div>
                            <div class="xrpl-stat-value" id="xrplCloseTime">--</div>
                            <div class="xrpl-stat-label">Ledger Interval</div>
                        </div>
                        <div class="xrpl-stat-card">
                            <div class="xrpl-stat-icon"></div>
                            <div class="xrpl-stat-value" id="xrplTPS">--</div>
                            <div class="xrpl-stat-label">TPS (tx/s)</div>
                        </div>
                        <div class="xrpl-stat-card">
                            <div class="xrpl-stat-icon"></div>
                            <div class="xrpl-stat-value" id="xrplBurnedTotal">--</div>
                            <div class="xrpl-stat-label">XRP Burned (All Time)</div>
                        </div>
                    </div>
                    
                    <div class="xrpl-transactions">
                        <div class="xrpl-tx-header">
                            <div class="xrpl-tx-title">
                                <span></span> Recent Transactions
                            </div>
                        </div>
                        <div class="xrpl-tx-list" id="xrplTxList">
                            <div class="xrpl-tx-item">
                                <span class="xrpl-tx-type other">Loading</span>
                                <span class="xrpl-tx-hash">Fetching latest transactions...</span>
                                <span class="xrpl-tx-amount">--</span>
                                <span class="xrpl-tx-time">--</span>
                                <span></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Portfolio Tracker (NEW) -->
                <div class="portfolio-tracker-section">
                    <h3><span></span> Your Portfolio Tracker</h3>
                    <div class="portfolio-input-row">
                        <div class="portfolio-input-group">
                            <label>Your XRP Holdings</label>
                            <input type="number" id="userXRPHoldings" placeholder="e.g. 10000" oninput="updatePortfolioTracker()">
                        </div>
                        <div class="portfolio-input-group">
                            <label>Average Buy Price ($)</label>
                            <input type="number" id="userAvgPrice" placeholder="e.g. 0.50" step="0.01" oninput="updatePortfolioTracker()">
                        </div>
                        <div class="portfolio-input-group">
                            <label>Target Price ($)</label>
                            <input type="number" id="userTargetPrice" placeholder="e.g. 5.00" step="0.01" oninput="updatePortfolioTracker()">
                        </div>
                    </div>
                    <div class="portfolio-results" id="portfolioResults" style="display: none;">
                        <div class="portfolio-card current">
                            <div class="portfolio-label">Current Value</div>
                            <div class="portfolio-value" id="portfolioCurrentValue">$0</div>
                            <div class="portfolio-change" id="portfolioChange">--</div>
                        </div>
                        <div class="portfolio-card profit">
                            <div class="portfolio-label">Unrealized P&L</div>
                            <div class="portfolio-value" id="portfolioPnL">$0</div>
                            <div class="portfolio-pnl-pct" id="portfolioPnLPct">0%</div>
                        </div>
                        <div class="portfolio-card target">
                            <div class="portfolio-label">Value at Target</div>
                            <div class="portfolio-value" id="portfolioTargetValue">$0</div>
                            <div class="portfolio-gain" id="portfolioTargetGain">+0%</div>
                        </div>
                        <div class="portfolio-card insight">
                            <div class="portfolio-label"> AI Insight</div>
                            <div class="portfolio-insight-text" id="portfolioInsight">Enter your holdings to see personalized insights</div>
                        </div>
                    </div>
                    <div class="portfolio-save-row">
                        <button class="btn btn-save" onclick="savePortfolio()"> Save Portfolio</button>
                        <span class="save-status" id="saveStatus"></span>
                    </div>
                </div>

                <!-- Daily Briefing Card (NEW) -->
                <div class="daily-briefing-section" id="dailyBriefing">
                    <div class="briefing-card" id="briefingCard">
                        <div class="briefing-header">
                            <span class="briefing-icon"></span>
                            <span class="briefing-title">Daily Briefing</span>
                            <span class="briefing-date" id="briefingDate">Jan 6, 2026</span>
                        </div>
                        <div class="briefing-content" id="briefingContent">
                            <p class="briefing-main">Loading market briefing...</p>
                        </div>
                        <div class="briefing-quick-stats">
                            <div class="quick-stat">
                                <span class="quick-label">Price</span>
                                <span class="quick-value" id="briefPrice">$--</span>
                            </div>
                            <div class="quick-stat">
                                <span class="quick-label">24h</span>
                                <span class="quick-value" id="brief24h">--%</span>
                            </div>
                            <div class="quick-stat">
                                <span class="quick-label">Sentiment</span>
                                <span class="quick-value" id="briefSentiment">--</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Market Sentiment -->
                <div class="sentiment-section">
                    <h3><span></span> Market Sentiment</h3>
                    <div class="sentiment-gauge">
                        <div class="gauge-container">
                            <div class="gauge-fill" id="sentimentGauge" style="width: 65%;"></div>
                        </div>
                        <div class="gauge-labels">
                            <span>Bearish</span>
                            <span>Neutral</span>
                            <span>Bullish</span>
                        </div>
                    </div>
                    <div class="sentiment-score">
                        <span>Current Sentiment:</span>
                        <strong id="sentimentText" style="color: var(--accent-green);">Bullish (65/100)</strong>
                    </div>
                </div>

                <!-- Price Scenarios (NEW) -->
                <div class="scenarios-section">
                    <h3><span></span> Price Scenarios (1-2 Weeks)</h3>
                    <div class="scenarios-grid">
                        <div class="scenario-card bullish">
                            <div class="scenario-header">
                                <span class="scenario-icon"></span>
                                <span class="scenario-title">Bullish Case</span>
                            </div>
                            <div class="scenario-price" id="scenarioBullish">$2.80 - $3.20</div>
                            <div class="scenario-condition" id="scenarioBullishText">If BTC breaks $100K and ETF inflows continue</div>
                            <div class="scenario-probability">Probability: <span id="probBullish">35%</span></div>
                        </div>
                        <div class="scenario-card base">
                            <div class="scenario-header">
                                <span class="scenario-icon"></span>
                                <span class="scenario-title">Base Case</span>
                            </div>
                            <div class="scenario-price" id="scenarioBase">$2.20 - $2.50</div>
                            <div class="scenario-condition" id="scenarioBaseText">Current trend continues with normal volatility</div>
                            <div class="scenario-probability">Probability: <span id="probBase">45%</span></div>
                        </div>
                        <div class="scenario-card bearish">
                            <div class="scenario-header">
                                <span class="scenario-icon"></span>
                                <span class="scenario-title">Bearish Case</span>
                            </div>
                            <div class="scenario-price" id="scenarioBearish">$1.80 - $2.00</div>
                            <div class="scenario-condition" id="scenarioBearishText">Market correction or negative regulatory news</div>
                            <div class="scenario-probability">Probability: <span id="probBearish">20%</span></div>
                        </div>
                    </div>
                </div>

                <!-- Technical Analysis Explanation (NEW) -->
                <div class="ta-explanation-section">
                    <h3><span></span> Technical Analysis Explained</h3>
                    <div class="ta-card" id="taExplanation">
                        <div class="ta-signal-badge" id="taSignalBadge">
                            <span class="ta-signal-icon"></span>
                            <span class="ta-signal-text">BULLISH SETUP</span>
                        </div>
                        <p class="ta-main-text" id="taMainText">
                            Loading technical analysis...
                        </p>
                        <div class="ta-levels">
                            <div class="ta-level support">
                                <span class="level-label"> Support</span>
                                <span class="level-value" id="taSupport">$1.95</span>
                            </div>
                            <div class="ta-level current">
                                <span class="level-label"> Current</span>
                                <span class="level-value" id="taCurrent">$2.15</span>
                            </div>
                            <div class="ta-level resistance">
                                <span class="level-label"> Resistance</span>
                                <span class="level-value" id="taResistance">$2.50</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AI Summary -->
                <div class="ai-summary-section">
                    <h3><span></span> AI Analysis</h3>
                    <div class="ai-summary-card" id="aiSummary">
                        <p><strong>XRP Market Overview:</strong> The XRP market shows strong bullish momentum with ETF trading volumes reaching new highs. Institutional interest continues to grow as spot ETFs gain mainstream adoption.</p>
                        <p><strong>Key Observations:</strong></p>
                        <ul>
                            <li>ETF trading volume up 15% from yesterday</li>
                            <li>Exchange holdings decreased by 2.3% (bullish signal)</li>
                            <li>On-chain activity showing accumulation patterns</li>
                            <li>Technical indicators suggest support at $1.95</li>
                        </ul>
                        <p><strong>Outlook:</strong> Short-term bullish with potential resistance at $2.50. Monitor SEC announcements for potential catalysts.</p>
                    </div>
                    <div class="ai-disclaimer">
                         AI-generated analysis for informational purposes only. Not financial advice.
                    </div>
                </div>

                <!-- Moving Averages -->
                <div class="ma-section">
                    <h3><span></span> Moving Averages & Trends</h3>
                    <div class="ma-chart-container">
                        <canvas id="maChart"></canvas>
                    </div>
                    <div class="ma-indicators">
                        <div class="ma-indicator">
                            <span class="ma-label">7-Day MA</span>
                            <span class="ma-value" id="ma7">$2.05</span>
                            <span class="ma-signal bullish" id="ma7Signal"> Above</span>
                        </div>
                        <div class="ma-indicator">
                            <span class="ma-label">30-Day MA</span>
                            <span class="ma-value" id="ma30">$1.92</span>
                            <span class="ma-signal bullish" id="ma30Signal"> Above</span>
                        </div>
                        <div class="ma-indicator">
                            <span class="ma-label">90-Day MA</span>
                            <span class="ma-value" id="ma90">$1.45</span>
                            <span class="ma-signal bullish" id="ma90Signal"> Above</span>
                        </div>
                    </div>
                </div>

                <!-- ETF Comparison Guide (NEW) -->
                <div class="etf-guide-section">
                    <h3><span></span> Which XRP ETF is Best For You?</h3>
                    <div class="etf-guide-grid">
                        <div class="etf-guide-card">
                            <div class="guide-header">
                                <span class="guide-icon"></span>
                                <span class="guide-title">Long-Term Holders</span>
                            </div>
                            <div class="guide-recommendation">
                                <span class="guide-ticker">GXRP</span>
                                <span class="guide-name">Grayscale XRP Trust</span>
                            </div>
                            <div class="guide-reason">Lowest expense ratio (0.35%) means more of your money stays invested over time.</div>
                        </div>
                        <div class="etf-guide-card">
                            <div class="guide-header">
                                <span class="guide-icon"></span>
                                <span class="guide-title">Active Traders</span>
                            </div>
                            <div class="guide-recommendation">
                                <span class="guide-ticker">XRP</span>
                                <span class="guide-name">Bitwise XRP ETF</span>
                            </div>
                            <div class="guide-reason">Highest daily volume and tightest spreads for quick entries and exits.</div>
                        </div>
                        <div class="etf-guide-card">
                            <div class="guide-header">
                                <span class="guide-icon"></span>
                                <span class="guide-title">High Risk/Reward</span>
                            </div>
                            <div class="guide-recommendation">
                                <span class="guide-ticker">XXRP</span>
                                <span class="guide-name">Teucrium 2x Long</span>
                            </div>
                            <div class="guide-reason">2x leveraged exposure. Double the gains, double the losses. Day trading only.</div>
                        </div>
                        <div class="etf-guide-card">
                            <div class="guide-header">
                                <span class="guide-icon"></span>
                                <span class="guide-title">Canadian Investors</span>
                            </div>
                            <div class="guide-recommendation">
                                <span class="guide-ticker">XRP.TO</span>
                                <span class="guide-name">Purpose XRP ETF</span>
                            </div>
                            <div class="guide-reason">No management fees until Feb 2026. Best for TFSA/RRSP accounts.</div>
                        </div>
                    </div>
                </div>

                <!-- Comparison Tool -->
                <div class="comparison-section">
                    <h3><span></span> ETF Comparison Tool</h3>
                    <div class="comparison-selectors">
                        <select id="compareETF1" onchange="updateComparison()">
                            <option value="XRP">XRP</option>
                            <option value="BTC">Bitcoin ETFs</option>
                            <option value="ETH">Ethereum ETFs</option>
                        </select>
                        <span class="vs-badge">VS</span>
                        <select id="compareETF2" onchange="updateComparison()">
                            <option value="BTC">Bitcoin ETFs</option>
                            <option value="XRP">XRP</option>
                            <option value="ETH">Ethereum ETFs</option>
                        </select>
                    </div>
                    <div class="comparison-chart-container">
                        <canvas id="comparisonChart"></canvas>
                    </div>
                    <div class="comparison-stats" id="comparisonStats">
                        <div class="comp-stat">
                            <div class="comp-stat-label">Daily Volume</div>
                            <div class="comp-stat-values">
                                <span class="comp-val-1">$125M</span>
                                <span class="comp-val-2">$2.1B</span>
                            </div>
                        </div>
                        <div class="comp-stat">
                            <div class="comp-stat-label">7D Change</div>
                            <div class="comp-stat-values">
                                <span class="comp-val-1 positive">+12.5%</span>
                                <span class="comp-val-2 positive">+8.2%</span>
                            </div>
                        </div>
                        <div class="comp-stat">
                            <div class="comp-stat-label">AUM</div>
                            <div class="comp-stat-values">
                                <span class="comp-val-1">$1.5B</span>
                                <span class="comp-val-2">$28B</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Key Metrics -->
                <div class="key-metrics-section">
                    <h3><span></span> Key Metrics</h3>
                    <div class="metrics-grid">
                        <div class="metric-card" id="metricVolume">
                            <div class="metric-icon"></div>
                            <div class="metric-label">Volume Trend</div>
                            <div class="metric-value positive" id="metricVolumeValue">+15.2%</div>
                            <div class="metric-desc">vs 7-day avg</div>
                        </div>
                        <div class="metric-card" id="metricFlow">
                            <div class="metric-icon"></div>
                            <div class="metric-label">Exchange Flow</div>
                            <div class="metric-value negative" id="metricFlowValue">-2.3M XRP</div>
                            <div class="metric-desc" id="metricFlowDesc">Net outflow (bullish)</div>
                        </div>
                        <div class="metric-card" id="metricRSI">
                            <div class="metric-icon"></div>
                            <div class="metric-label">RSI (14)</div>
                            <div class="metric-value" id="metricRSIValue">58</div>
                            <div class="metric-desc" id="metricRSIDesc">Neutral zone</div>
                        </div>
                        <div class="metric-card" id="metricSupport">
                            <div class="metric-icon"></div>
                            <div class="metric-label">Support Level</div>
                            <div class="metric-value" id="metricSupportValue">$1.95</div>
                            <div class="metric-desc">Strong support</div>
                        </div>
                    </div>
                </div>

                <!-- PDF Weekly Report Generator -->
                <div class="report-section">
                    <h3><span></span> Weekly Report Generator</h3>
                    <div class="report-preview">
                        <div class="report-preview-header">
                            <span class="report-preview-title"> XRP Weekly Report</span>
                            <span class="report-preview-date" id="reportDateRange">Jan 1-7, 2026</span>
                        </div>
                        <div class="report-sections-list">
                            <div class="report-section-item">
                                <span class="report-section-icon"></span>
                                <span class="report-section-name">Executive Summary & Price Performance</span>
                                <span class="report-section-check"></span>
                            </div>
                            <div class="report-section-item">
                                <span class="report-section-icon"></span>
                                <span class="report-section-name">ETF Holdings & Inflows</span>
                                <span class="report-section-check"></span>
                            </div>
                            <div class="report-section-item">
                                <span class="report-section-icon"></span>
                                <span class="report-section-name">Technical Analysis</span>
                                <span class="report-section-check"></span>
                            </div>
                            <div class="report-section-item">
                                <span class="report-section-icon"></span>
                                <span class="report-section-name">AI Market Outlook</span>
                                <span class="report-section-check"></span>
                            </div>
                            <div class="report-section-item">
                                <span class="report-section-icon"></span>
                                <span class="report-section-name">Key Levels & Recommendations</span>
                                <span class="report-section-check"></span>
                            </div>
                        </div>
                        <div class="report-actions">
                            <button class="btn-generate-report" onclick="generatePDFReport()">
                                <span></span> Generate PDF Report
                            </button>
                            <div class="report-status" id="reportStatus"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p>Data provided by <a href="https://finance.yahoo.com" target="_blank">Yahoo Finance</a> via yfinance</p>
            <p style="margin-top: 0.5rem;">Prices and volumes may be delayed  Auto-refreshes every 5 minutes</p>
        </footer>

        <!-- AI Chat Widget -->
        <button class="chat-toggle-btn" id="chatToggleBtn" onclick="toggleChat()"></button>
        
        <div class="chat-widget" id="chatWidget">
            <div class="chat-header">
                <span class="chat-header-icon"></span>
                <div>
                    <div class="chat-header-title">XRP AI Assistant</div>
                    <div class="chat-header-subtitle">Ask me anything about XRP</div>
                </div>
                <button class="chat-close-btn" onclick="toggleChat()"></button>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="chat-message assistant">
                     Hi! I'm your XRP AI assistant. I can help you with:
                    <br><br>
                     Current price & market analysis<br>
                     Technical indicators (MA, RSI, support/resistance)<br>
                     ETF holdings & institutional flow<br>
                     Trading insights & outlook
                    <br><br>
                    What would you like to know?
                </div>
            </div>
            <div class="chat-suggestions">
                <button class="chat-suggestion" onclick="askQuestion('What is the current XRP price?')">Current price?</button>
                <button class="chat-suggestion" onclick="askQuestion('Should I buy XRP now?')">Buy now?</button>
                <button class="chat-suggestion" onclick="askQuestion('What are the support levels?')">Support levels?</button>
                <button class="chat-suggestion" onclick="askQuestion('What is the market sentiment?')">Sentiment?</button>
            </div>
            <div class="chat-input-area">
                <input type="text" class="chat-input" id="chatInput" placeholder="Ask about XRP..." onkeypress="handleChatKeypress(event)">
                <button class="chat-send-btn" id="chatSendBtn" onclick="sendChatMessage()"></button>
            </div>
        </div>

        <!-- Chart Modal -->
        <div class="chart-overlay" id="chartOverlay">
            <div class="chart-modal">
                <div class="chart-header">
                    <h2> ETF Volume Comparison</h2>
                    <button class="chart-close" onclick="closeChartModal()"></button>
                </div>
                <div class="chart-controls">
                    <button class="chart-tab active" data-chart="price" onclick="switchChart('price')">Price</button>
                    <button class="chart-tab" data-chart="volume" onclick="switchChart('volume')">Volume</button>
                </div>
                <div class="chart-period-controls">
                    <button class="chart-period active" data-cperiod="1mo" onclick="setChartPeriod('1mo')">1 Month</button>
                    <button class="chart-period" data-cperiod="3mo" onclick="setChartPeriod('3mo')">3 Months</button>
                    <button class="chart-period" data-cperiod="6mo" onclick="setChartPeriod('6mo')">6 Months</button>
                    <button class="chart-period" data-cperiod="1y" onclick="setChartPeriod('1y')">1 Year</button>
                </div>
                <div class="chart-loading" id="chartLoading" style="display: none;">
                    <div class="spinner"></div>
                    <p>Loading chart data...</p>
                </div>
                <div class="chart-container">
                    <canvas id="etfChart"></canvas>
                </div>
                <div class="chart-legend" id="chartLegend"></div>
            </div>
        </div>

        <!-- Follow Popup Modal -->
        <div class="popup-overlay" id="popupOverlay">
            <div class="popup-modal">
                <button class="popup-close" onclick="closePopup()"></button>
                <div class="popup-icon"></div>
                <h2 class="popup-title">Join the XRP Army! </h2>
                <p class="popup-text">Stay updated with the latest XRP ETF news, analysis, and alpha!</p>
                <a href="https://x.com/chachakobe4er" target="_blank" class="popup-follow-btn" onclick="closePopup()">
                    <span class="popup-x-icon"></span>
                    Follow @chachakobe4er
                </a>
                <button class="popup-later" onclick="closePopup()">Maybe later</button>
            </div>
        </div>

        <!-- Fullscreen Chart Modal -->
        <div class="fullscreen-chart-overlay" id="fullscreenChartOverlay">
            <div class="fullscreen-chart-container">
                <button class="fullscreen-chart-close" onclick="closeFullscreenChart()"></button>
                <h2 style="margin-bottom: 1rem; color: var(--accent-xrp);" id="fullscreenChartTitle">Chart</h2>
                <div class="fullscreen-chart-canvas">
                    <canvas id="fullscreenChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        // =====================================================
        // INTERNATIONALIZATION (i18n) - Language Support
        // =====================================================
        const translations = {
            en: {
                // Dashboard Header
                dashboardTitle: "XRP Holdings - Exchange & SPOT ETFs",
                help: " Help",
                
                // Dashboard Metrics
                totalXRPinETFs: "Total XRP in Spot ETFs",
                etfValue: "ETF Value (USD)",
                xrpOnExchanges: "XRP on Exchanges",
                exchangeValue: "Exchange Value (USD)",
                top10kHoldings: "Top 10K Holdings",
                whaleAccounts: "Whale Accounts (1M)",
                totalBurned: "Total XRP Burned",
                currentSupply: "Current Supply",
                
                // Status
                liveData: "Live Data",
                loading: "Loading...",
                cached: "Cached",
                clickToLoad: "Click to load",
                activeETFs: "Active ETFs",
                accounts: "accounts",
                
                // Tab Names
                tabETFTrading: "ETF Trading",
                tabETFHoldings: "ETF Holdings",
                tabExchange: "Exchange",
                tabAnalytics: "Exchange Analytics",
                tabTop10K: "Top 10K",
                tabNews: "News",
                tabAIInsights: "AI Insights",
                
                // ETF Trading
                etfTradingTitle: "XRP ETF Trading Dashboard",
                spotETFs: "XRP Spot ETFs",
                futuresETFs: "Futures ETFs",
                indexETFs: "Index ETFs",
                canadaETFs: "Canada ETFs",
                daily: "Daily",
                weekly: "Weekly",
                monthly: "Monthly",
                yearly: "Yearly",
                symbol: "Symbol",
                description: "Description",
                price: "Price",
                volume: "Volume",
                shares: "Shares",
                compareVolume: " Compare Volume",
                portfolio: " Portfolio",
                
                // ETF Holdings
                holdingsTitle: "XRP Spot ETF Holdings Tracker",
                holdingsSubtitle: "Daily Updated  Track institutional XRP accumulation",
                date: "Date",
                dailyChange: "Daily Change",
                totalHoldings: "Total Holdings",
                canary: "Canary",
                bitwise: "Bitwise",
                franklin: "Franklin",
                grayscale: "Grayscale",
                shares21: "21Shares",
                total: "Total",
                
                // Exchange
                exchangeTitle: "Exchange XRP Holdings",
                exchangeSubtitle: "Real-time balances from XRPL  Click Fetch to load",
                fetchData: " Fetch Live Data",
                refreshData: " Refresh Data",
                fetching: " Fetching...",
                totalXRP: "Total XRP",
                valueUSD: "Value (USD)",
                exchanges: "Exchanges",
                rank: "Rank",
                exchange: "Exchange",
                balance: "Balance",
                marketShare: "Market Share",
                wallets: "Wallets",
                walletDetails: "Wallet Details",
                walletName: "Wallet Name",
                historical: "Historical",
                
                // Analytics
                analyticsTitle: "Exchange Analytics",
                analyticsSubtitle: "Historical comparison and flow analysis",
                historicalComparison: "Historical Comparison",
                comparedTo: "Compared to",
                currentBalance: "Current Balance",
                historicalBalance: "Historical Balance",
                change: "Change",
                netFlow: "Net Flow",
                topInflows: "Top Inflows",
                topOutflows: "Top Outflows",
                exportCSV: " Export CSV",
                exportJSON: " Export JSON",
                balanceDistribution: "Balance Distribution",
                absoluteChanges: "Absolute Changes",
                percentChanges: "Percent Changes",
                
                // Top 10K
                top10kTitle: "XRP Top 10K Rich List",
                top10kSubtitle: "Top 10,000 Wallets  Stats calculated from full 10K dataset",
                showing: "Showing",
                address: "Address",
                name: "Name",
                accountsLoaded: "Accounts Loaded",
                whaleCount: "Whale Count",
                meanBalance: "Mean Balance",
                medianBalance: "Median Balance",
                top10Dominance: "Top 10 Dominance",
                concentration: "Concentration",
                distribution: "Distribution",
                recentActivity: "Recent Activity",
                top1: "Top 1",
                top5: "Top 5",
                top10: "Top 10",
                top25: "Top 25",
                
                // News
                newsTitle: "XRP News Feed",
                newsSubtitle: "AI-curated updates  Sorted by relevance",
                allNews: "All",
                xrpNews: "XRP News",
                cryptoNews: "Crypto News",
                etfNews: "ETF News",
                
                // AI Insights Tab - Full Content
                aiTitle: "AI Market Insights",
                aiSubtitle: "Powered by Claude AI  Analysis based on current data",
                generateAnalysis: " Generate Analysis",
                generateReport: " Generate PDF Report",
                askQuestion: "Ask a question about XRP, ETFs, or market data...",
                chatPlaceholder: "Type your question here...",
                send: "Send",
                marketOverview: "Market Overview",
                technicalAnalysis: "Technical Analysis",
                institutionalFlow: "Institutional Flow",
                outlook: "Outlook",
                
                // Portfolio Tracker
                yourPortfolio: "Your Portfolio Tracker",
                yourXRPHoldings: "Your XRP Holdings",
                avgBuyPrice: "Average Buy Price ($)",
                targetPrice: "Target Price ($)",
                savePortfolio: " Save Portfolio",
                currentValue: "Current Value",
                unrealizedPnL: "Unrealized P&L",
                valueAtTarget: "Value at Target",
                aiInsight: " AI Insight",
                enterHoldings: "Enter your holdings to see personalized insights",
                
                // Daily Briefing
                dailyBriefing: "Daily Briefing",
                sentiment: "Sentiment",
                
                // Market Sentiment
                marketSentiment: "Market Sentiment",
                bearish: "Bearish",
                neutral: "Neutral",
                bullish: "Bullish",
                currentSentiment: "Current Sentiment",
                
                // Price Scenarios
                priceScenarios: "Price Scenarios (1-2 Weeks)",
                bullishCase: "Bullish Case",
                baseCase: "Base Case",
                bearishCase: "Bearish Case",
                probability: "Probability",
                
                // Technical Analysis Explained
                taExplained: "Technical Analysis Explained",
                support: "Support",
                current: "Current",
                resistance: "Resistance",
                bullishSetup: "BULLISH SETUP",
                bearishSetup: "BEARISH SETUP",
                neutralSetup: "NEUTRAL",
                
                // AI Analysis
                aiAnalysis: "AI Analysis",
                xrpMarketOverview: "XRP Market Overview",
                keyObservations: "Key Observations",
                aiDisclaimer: " AI-generated analysis for informational purposes only. Not financial advice.",
                
                // Moving Averages
                movingAverages: "Moving Averages & Trends",
                dayMA7: "7-Day MA",
                dayMA30: "30-Day MA",
                dayMA90: "90-Day MA",
                above: " Above",
                below: " Below",
                
                // ETF Guide
                whichETFBest: "Which XRP ETF is Best For You?",
                longTermHolders: "Long-Term Holders",
                activeTraders: "Active Traders",
                highRiskReward: "High Risk/Reward",
                canadianInvestors: "Canadian Investors",
                
                // Comparison Tool
                etfComparison: "ETF Comparison Tool",
                dailyVolume: "Daily Volume",
                day7Change: "7D Change",
                aum: "AUM",
                
                // Dynamic AI Analysis Content
                aiMarketOverview: "Market Overview",
                aiPriceAction: "Price Action",
                aiTechnicalAnalysis: "Technical Analysis",
                aiETFExchange: "ETF & Exchange Data",
                aiOutlook: "Outlook",
                change24h: "24h Change",
                change7d: "7d Change",
                change30d: "30d Change",
                totalXRPinSpotETFs: "Total XRP in Spot ETFs",
                totalXRPonExchanges: "Total XRP on Exchanges",
                exchangeDataClick: "Click Exchange tab to load",
                
                // Sentiment texts
                stronglyBullish: "strongly bullish",
                bullishText: "bullish",
                neutralText: "neutral",
                bearishText: "bearish",
                stronglyBearish: "strongly bearish",
                
                // Trend/momentum
                upward: "upward",
                downward: "downward",
                strong: "strong",
                moderate: "moderate",
                momentum: "momentum",
                
                // MA Analysis
                maAboveBoth: "Price is trading above both 7-day and 30-day moving averages, indicating bullish momentum.",
                maAbove7: "Price is above the 7-day MA but near the 30-day MA, suggesting consolidation.",
                maBelowBoth: "Price is below both moving averages, indicating bearish pressure.",
                maTestingLevels: "Price is testing key moving average levels.",
                
                // Outlook texts
                outlookBullish: "Conditions favor continued upside. Watch for resistance levels.",
                outlookNeutral: "Market is in consolidation. Wait for clearer directional signals.",
                outlookBearish: "Caution advised. Look for support levels to hold before entering positions.",
                
                // News
                hoursAgo: "hours ago",
                minutesAgo: "minutes ago",
                justNow: "just now",
                
                // Daily Briefing dynamic content
                strongDayUp: " Strong day! XRP is up",
                upToday: " XRP is up",
                downToday: " XRP is down",
                volatileDay: " Volatile day - XRP dropped",
                tradingAt: "trading at",
                droppedTo: "to",
                bullishSentiment: "Market sentiment remains bullish. ETF inflows continue to drive institutional interest.",
                consolidatingSentiment: "Market is consolidating. Watch for a breakout above resistance or breakdown below support.",
                bearishSentiment: "Bearish sentiment prevails. Consider waiting for clearer signals before entering positions.",
                
                // Price Scenarios dynamic
                bullishCondition1: "Current momentum continues with strong ETF inflows",
                bullishCondition2: "Breakout above resistance with positive catalysts",
                bullishCondition3: "Major reversal with unexpected positive news",
                baseCondition: "Current trend continues with normal volatility",
                bearishCondition: "Market correction or negative regulatory news",
                
                // TA Explanation dynamic
                bullishSetupDesc: "XRP is showing a <strong>bullish technical setup</strong>. The price is trading above all major moving averages, indicating strong upward momentum.",
                goldenCross: "The 7-day MA is above the 30-day MA, forming a 'golden cross' pattern which historically signals continued upside.",
                watchResistance: "Watch for resistance and support at the 7-day MA.",
                bearishSetupDesc: "XRP is showing a <strong>bearish technical setup</strong>. The price has fallen below key moving averages, suggesting downward pressure.",
                waitForReclaim: "Consider waiting for price to reclaim the 30-day MA before entering long positions.",
                consolidationDesc: "XRP is in a <strong>consolidation phase</strong>. The price is testing key moving average levels.",
                breakAbove: "A break above the 30-day MA would be bullish, while a breakdown below could signal further downside.",
                
                // Common
                refresh: "Refresh",
                export: "Export",
                download: "Download",
                close: "Close",
                yes: "Yes",
                no: "No",
                error: "Error",
                success: "Success",
                unknown: "Unknown",
                noData: "No data available"
            },
            ko: {
                // Dashboard Header
                dashboardTitle: "XRP  -  &  ETF",
                help: " ",
                
                // Dashboard Metrics
                totalXRPinETFs: " ETF  XRP",
                etfValue: "ETF  (USD)",
                xrpOnExchanges: " XRP",
                exchangeValue: "  (USD)",
                top10kHoldings: " 10K ",
                whaleAccounts: "  (100)",
                totalBurned: "  XRP",
                currentSupply: " ",
                
                // Status
                liveData: " ",
                loading: " ...",
                cached: "",
                clickToLoad: " ",
                activeETFs: " ETF",
                accounts: "",
                
                // Tab Names
                tabETFTrading: "ETF ",
                tabETFHoldings: "ETF ",
                tabExchange: "",
                tabAnalytics: " ",
                tabTop10K: " 10K",
                tabNews: "",
                tabAIInsights: "AI ",
                
                // ETF Trading
                etfTradingTitle: "XRP ETF  ",
                spotETFs: "XRP  ETF",
                futuresETFs: " ETF",
                indexETFs: " ETF",
                canadaETFs: " ETF",
                daily: "",
                weekly: "",
                monthly: "",
                yearly: "",
                symbol: "",
                description: "",
                price: "",
                volume: "",
                shares: "",
                compareVolume: "  ",
                portfolio: " ",
                
                // ETF Holdings
                holdingsTitle: "XRP  ETF  ",
                holdingsSubtitle: "    XRP  ",
                date: "",
                dailyChange: " ",
                totalHoldings: " ",
                canary: "",
                bitwise: "",
                franklin: "",
                grayscale: "",
                shares21: "21",
                total: "",
                
                // Exchange
                exchangeTitle: " XRP ",
                exchangeSubtitle: "XRPL      ",
                fetchData: "   ",
                refreshData: "  ",
                fetching: "  ...",
                totalXRP: " XRP",
                valueUSD: " (USD)",
                exchanges: "",
                rank: "",
                exchange: "",
                balance: "",
                marketShare: " ",
                wallets: "",
                walletDetails: " ",
                walletName: " ",
                historical: "",
                
                // Analytics
                analyticsTitle: " ",
                analyticsSubtitle: "    ",
                historicalComparison: "  ",
                comparedTo: " ",
                currentBalance: " ",
                historicalBalance: " ",
                change: "",
                netFlow: " ",
                topInflows: " ",
                topOutflows: " ",
                exportCSV: " CSV ",
                exportJSON: " JSON ",
                balanceDistribution: " ",
                absoluteChanges: " ",
                percentChanges: " ",
                
                // Top 10K
                top10kTitle: "XRP  10K  ",
                top10kSubtitle: " 10,000    10K   ",
                showing: " ",
                address: "",
                name: "",
                accountsLoaded: " ",
                whaleCount: " ",
                meanBalance: " ",
                medianBalance: " ",
                top10Dominance: " 10 ",
                concentration: "",
                distribution: "",
                recentActivity: " ",
                top1: " 1",
                top5: " 5",
                top10: " 10",
                top25: " 25",
                
                // News
                newsTitle: "XRP  ",
                newsSubtitle: "AI     ",
                allNews: "",
                xrpNews: "XRP ",
                cryptoNews: " ",
                etfNews: "ETF ",
                
                // AI Insights Tab - Full Content
                aiTitle: "AI  ",
                aiSubtitle: "Claude AI      ",
                generateAnalysis: "  ",
                generateReport: " PDF  ",
                askQuestion: "XRP  ...",
                chatPlaceholder: "  ...",
                send: "",
                marketOverview: " ",
                technicalAnalysis: " ",
                institutionalFlow: "  ",
                outlook: "",
                
                // Portfolio Tracker
                yourPortfolio: "  ",
                yourXRPHoldings: " XRP ",
                avgBuyPrice: "  ($)",
                targetPrice: " ($)",
                savePortfolio: "  ",
                currentValue: " ",
                unrealizedPnL: " ",
                valueAtTarget: " ",
                aiInsight: " AI ",
                enterHoldings: "    ",
                
                // Daily Briefing
                dailyBriefing: " ",
                sentiment: "",
                
                // Market Sentiment
                marketSentiment: " ",
                bearish: "",
                neutral: "",
                bullish: "",
                currentSentiment: " ",
                
                // Price Scenarios
                priceScenarios: "  (1-2)",
                bullishCase: " ",
                baseCase: " ",
                bearishCase: " ",
                probability: "",
                
                // Technical Analysis Explained
                taExplained: "  ",
                support: "",
                current: "",
                resistance: "",
                bullishSetup: " ",
                bearishSetup: " ",
                neutralSetup: "",
                
                // AI Analysis
                aiAnalysis: "AI ",
                xrpMarketOverview: "XRP  ",
                keyObservations: " ",
                aiDisclaimer: " AI     .   .",
                
                // Moving Averages
                movingAverages: " & ",
                dayMA7: "7 MA",
                dayMA30: "30 MA",
                dayMA90: "90 MA",
                above: " ",
                below: " ",
                
                // ETF Guide
                whichETFBest: " XRP ETF ?",
                longTermHolders: " ",
                activeTraders: " ",
                highRiskReward: "/",
                canadianInvestors: " ",
                
                // Comparison Tool
                etfComparison: "ETF  ",
                dailyVolume: " ",
                day7Change: "7 ",
                aum: "",
                
                // Dynamic AI Analysis Content
                aiMarketOverview: " ",
                aiPriceAction: " ",
                aiTechnicalAnalysis: " ",
                aiETFExchange: "ETF &  ",
                aiOutlook: "",
                change24h: "24 ",
                change7d: "7 ",
                change30d: "30 ",
                totalXRPinSpotETFs: " ETF  XRP",
                totalXRPonExchanges: "  XRP",
                exchangeDataClick: "   ",
                
                // Sentiment texts
                stronglyBullish: " ",
                bullishText: "",
                neutralText: "",
                bearishText: "",
                stronglyBearish: " ",
                
                // Trend/momentum
                upward: "",
                downward: "",
                strong: "",
                moderate: "",
                momentum: "",
                
                // MA Analysis
                maAboveBoth: " 7 30       .",
                maAbove7: " 7 MA   30 MA    .",
                maBelowBoth: "       .",
                maTestingLevels: "     .",
                
                // Outlook texts
                outlookBullish: "  .  .",
                outlookNeutral: "  .     .",
                outlookBearish: " .     .",
                
                // News
                hoursAgo: " ",
                minutesAgo: " ",
                justNow: "",
                
                // Daily Briefing dynamic content
                strongDayUp: "  ! XRP  24 ",
                upToday: " XRP ",
                downToday: " XRP ",
                volatileDay: "    - XRP",
                tradingAt: "  ",
                droppedTo: " ",
                bullishSentiment: "    . ETF      .",
                consolidatingSentiment: "  .      .",
                bearishSentiment: "  .         .",
                
                // Price Scenarios dynamic
                bullishCondition1: "   ETF   ",
                bullishCondition2: "    ",
                bullishCondition3: "    ",
                baseCondition: "     ",
                bearishCondition: "     ",
                
                // TA Explanation dynamic
                bullishSetupDesc: "XRP <strong>  </strong>  .           .",
                goldenCross: "7 MA 30 MA       ''   .",
                watchResistance: " 7 MA  .",
                bearishSetupDesc: "XRP <strong>  </strong>  .        .",
                waitForReclaim: "     30 MA     .",
                consolidationDesc: "XRP <strong> </strong> .      .",
                breakAbove: "30 MA   ,       .",
                
                // Common
                refresh: "",
                export: "",
                download: "",
                close: "",
                yes: "",
                no: "",
                error: "",
                success: "",
                unknown: "  ",
                noData: " "
            }
        };

        // Current language
        let currentLanguage = localStorage.getItem('xrp-tracker-lang') || 'en';

        // Get translation
        function t(key) {
            return translations[currentLanguage][key] || translations['en'][key] || key;
        }

        // Set language
        function setLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('xrp-tracker-lang', lang);
            
            // Update button states
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent.includes(lang.toUpperCase())) {
                    btn.classList.add('active');
                }
            });
            
            // Apply translations to static elements
            applyTranslations();
            
            // Refresh dynamic content with new language
            refreshDynamicContent();
        }
        
        // Refresh all dynamic content after language change
        function refreshDynamicContent() {
            // Only refresh if functions and data are available
            try {
                if (typeof currentXRPPrice !== 'undefined' && currentXRPPrice > 0) {
                    // Refresh AI analysis
                    if (typeof generateAISummary === 'function' && document.getElementById('aiSummary')) {
                        generateAISummary();
                    }
                    
                    // Refresh daily briefing
                    if (typeof updateDailyBriefing === 'function' && document.getElementById('briefingContent')) {
                        updateDailyBriefing();
                    }
                    
                    // Refresh price scenarios
                    if (typeof updatePriceScenarios === 'function' && document.getElementById('scenarioBullish')) {
                        updatePriceScenarios();
                    }
                    
                    // Refresh TA explanation
                    if (typeof updateTAExplanation === 'function' && document.getElementById('taMainText')) {
                        updateTAExplanation();
                    }
                }
            } catch (e) {
                console.log('Language refresh - dynamic content not ready yet:', e.message);
            }
        }

        // Apply translations to the page
        function applyTranslations() {
            // ===== DASHBOARD OVERVIEW =====
            const titleEl = document.querySelector('.dashboard-overview-title');
            if (titleEl) {
                titleEl.innerHTML = `<span></span> ${t('dashboardTitle')}`;
            }
            
            // Main dashboard metric labels
            const mainMetrics = document.querySelectorAll('.dashboard-metrics .dashboard-metric');
            const mainLabels = [t('totalXRPinETFs'), t('etfValue'), t('xrpOnExchanges'), t('exchangeValue')];
            mainMetrics.forEach((metric, i) => {
                const label = metric.querySelector('.dashboard-metric-label');
                if (label && mainLabels[i]) label.textContent = mainLabels[i];
            });
            
            // Secondary dashboard row
            const secondaryMetrics = document.querySelectorAll('.dashboard-secondary-grid .dashboard-metric-small');
            const secondaryLabels = [t('top10kHoldings'), t('whaleAccounts'), t('totalBurned'), t('currentSupply')];
            secondaryMetrics.forEach((metric, i) => {
                const label = metric.querySelector('.dashboard-metric-label');
                if (label && secondaryLabels[i]) label.textContent = secondaryLabels[i];
            });
            
            // ===== TABS =====
            const tabIcons = ['', '', '', '', '', '', ''];
            const tabKeys = ['tabETFTrading', 'tabETFHoldings', 'tabExchange', 'tabAnalytics', 'tabTop10K', 'tabNews', 'tabAIInsights'];
            document.querySelectorAll('.main-tab').forEach((tab, i) => {
                if (tabKeys[i]) {
                    tab.innerHTML = `<span class="main-tab-icon">${tabIcons[i]}</span>${t(tabKeys[i])}`;
                }
            });
            
            // Help link
            const helpLink = document.querySelector('.help-button');
            if (helpLink) {
                helpLink.innerHTML = t('help');
                helpLink.href = currentLanguage === 'ko' ? 'help-ko.html' : 'help.html';
            }

            // ===== ETF TRADING TAB =====
            translateETFTradingTab();
            
            // ===== ETF HOLDINGS TAB =====
            translateETFHoldingsTab();
            
            // ===== EXCHANGE TAB =====
            translateExchangeTab();
            
            // ===== ANALYTICS TAB =====
            translateAnalyticsTab();
            
            // ===== TOP 10K TAB =====
            translateTop10KTab();
            
            // ===== NEWS TAB =====
            translateNewsTab();
            
            // ===== AI INSIGHTS TAB =====
            translateAITab();

            console.log(`Language applied: ${currentLanguage}`);
        }
        
        function translateETFTradingTab() {
            // Section title
            const header = document.querySelector('#tradingTab .section-header');
            if (header) {
                const h2 = header.querySelector('h2');
                if (h2) h2.textContent = t('etfTradingTitle');
            }
            
            // Period buttons
            document.querySelectorAll('.period-btn').forEach(btn => {
                const period = btn.getAttribute('data-period');
                if (period === 'daily') btn.textContent = t('daily');
                else if (period === 'weekly') btn.textContent = t('weekly');
                else if (period === 'monthly') btn.textContent = t('monthly');
                else if (period === 'yearly') btn.textContent = t('yearly');
            });
            
            // ETF Group titles
            document.querySelectorAll('.group-title').forEach(gt => {
                const span = gt.querySelector('span:last-child');
                if (span) {
                    const text = span.getAttribute('data-original') || span.textContent.trim();
                    span.setAttribute('data-original', text);
                    if (text.includes('Spot')) span.textContent = t('spotETFs');
                    else if (text.includes('Futures')) span.textContent = t('futuresETFs');
                    else if (text.includes('Index')) span.textContent = t('indexETFs');
                    else if (text.includes('Canada')) span.textContent = t('canadaETFs');
                }
            });
            
            // Table headers in each ETF group
            document.querySelectorAll('.etf-group table thead tr').forEach(row => {
                const ths = row.querySelectorAll('th');
                const headers = [t('symbol'), t('description'), t('price'), t('volume'), t('shares')];
                ths.forEach((th, i) => {
                    if (headers[i]) th.textContent = headers[i];
                });
            });
            
            // Action buttons
            document.querySelectorAll('.section-actions button').forEach(btn => {
                if (btn.textContent.includes('Compare') || btn.textContent.includes('')) {
                    btn.textContent = t('compareVolume');
                } else if (btn.textContent.includes('Portfolio') || btn.textContent.includes('')) {
                    btn.textContent = t('portfolio');
                }
            });
        }
        
        function translateETFHoldingsTab() {
            const header = document.querySelector('#holdingsTab .section-header');
            if (header) {
                const h2 = header.querySelector('h2');
                const subtitle = header.querySelector('.section-subtitle');
                if (h2) h2.textContent = t('holdingsTitle');
                if (subtitle) subtitle.textContent = t('holdingsSubtitle');
            }
            
            // Holdings table headers
            const table = document.querySelector('#holdingsTab table');
            if (table) {
                const ths = table.querySelectorAll('thead th');
                const headers = [t('date'), t('canary'), t('bitwise'), t('franklin'), t('grayscale'), t('shares21'), t('total'), t('dailyChange')];
                ths.forEach((th, i) => {
                    if (headers[i]) th.textContent = headers[i];
                });
            }
        }
        
        function translateExchangeTab() {
            const header = document.querySelector('#exchangeTab .section-header');
            if (header) {
                const h2 = header.querySelector('h2');
                const subtitle = header.querySelector('.section-subtitle');
                if (h2) h2.textContent = t('exchangeTitle');
                if (subtitle) subtitle.textContent = t('exchangeSubtitle');
            }
            
            // Fetch button
            const fetchBtn = document.getElementById('fetchExchangeBtn');
            if (fetchBtn && !fetchBtn.disabled) {
                fetchBtn.textContent = t('fetchData');
            }
            
            // Summary labels
            document.querySelectorAll('#exchangeTab .exchange-metric-label').forEach((label, i) => {
                const labels = [t('totalXRP'), t('valueUSD'), t('exchanges')];
                if (labels[i]) label.textContent = labels[i];
            });
            
            // Table headers
            const table = document.querySelector('#exchangeTab .exchange-table');
            if (table) {
                const ths = table.querySelectorAll('thead th');
                const headers = [t('rank'), t('exchange'), t('balance'), t('valueUSD'), t('marketShare'), t('wallets')];
                ths.forEach((th, i) => {
                    if (headers[i]) th.textContent = headers[i];
                });
            }
            
            // Wallet details section
            const walletTitle = document.querySelector('#exchangeTab .wallet-details-section h3');
            if (walletTitle) walletTitle.innerHTML = `<span></span> ${t('walletDetails')}`;
            
            const walletTable = document.querySelector('#walletDetailsTable table');
            if (walletTable) {
                const ths = walletTable.querySelectorAll('thead th');
                const headers = [t('walletName'), t('address'), t('balance'), t('historical'), t('change')];
                ths.forEach((th, i) => {
                    if (headers[i]) th.textContent = headers[i];
                });
            }
        }
        
        function translateAnalyticsTab() {
            const header = document.querySelector('#analyticsTab .section-header');
            if (header) {
                const h2 = header.querySelector('h2');
                const subtitle = header.querySelector('.section-subtitle');
                if (h2) h2.textContent = t('analyticsTitle');
                if (subtitle) subtitle.textContent = t('analyticsSubtitle');
            }
            
            // Table headers
            const table = document.querySelector('#analyticsTab .analytics-table');
            if (table) {
                const ths = table.querySelectorAll('thead th');
                const headers = [t('exchange'), t('currentBalance'), t('historicalBalance'), t('change'), '%', t('netFlow')];
                ths.forEach((th, i) => {
                    if (headers[i]) th.textContent = headers[i];
                });
            }
            
            // Export buttons
            document.querySelectorAll('#analyticsTab button').forEach(btn => {
                if (btn.textContent.includes('CSV')) btn.textContent = t('exportCSV');
                else if (btn.textContent.includes('JSON')) btn.textContent = t('exportJSON');
            });
            
            // Chart titles
            document.querySelectorAll('#analyticsTab .chart-card h4').forEach((title, i) => {
                const titles = [t('balanceDistribution'), t('absoluteChanges'), t('percentChanges')];
                if (titles[i]) title.textContent = titles[i];
            });
            
            // Flow section titles
            document.querySelectorAll('#analyticsTab .flow-section h4').forEach(title => {
                if (title.textContent.includes('Inflow') || title.textContent.includes('')) {
                    title.innerHTML = ` ${t('topInflows')}`;
                } else if (title.textContent.includes('Outflow') || title.textContent.includes('')) {
                    title.innerHTML = ` ${t('topOutflows')}`;
                }
            });
        }
        
        function translateTop10KTab() {
            const header = document.querySelector('#whaleTab .section-header');
            if (header) {
                const h2 = header.querySelector('h2');
                const subtitle = header.querySelector('.section-subtitle');
                if (h2) h2.textContent = t('top10kTitle');
                if (subtitle) subtitle.textContent = t('top10kSubtitle');
            }
            
            // Stats labels
            document.querySelectorAll('#whaleTab .whale-stat-label').forEach((label, i) => {
                const labels = [t('totalXRP'), t('accountsLoaded'), t('whaleCount'), t('meanBalance'), t('medianBalance'), t('top10Dominance')];
                if (labels[i]) label.textContent = labels[i];
            });
            
            // Table headers
            const table = document.querySelector('#whaleTab .whale-table');
            if (table) {
                const ths = table.querySelectorAll('thead th');
                const headers = [t('rank'), t('address'), t('balance'), t('marketShare'), t('name')];
                ths.forEach((th, i) => {
                    if (headers[i]) th.textContent = headers[i];
                });
            }
            
            // Concentration labels
            document.querySelectorAll('#whaleTab .concentration-label').forEach((label, i) => {
                const labels = [t('top1'), t('top5'), t('top10'), t('top25')];
                if (labels[i]) label.textContent = labels[i];
            });
            
            // Section titles
            document.querySelectorAll('#whaleTab .whale-section-title').forEach(title => {
                const text = title.textContent.trim();
                if (text.includes('Concentration') || text.includes('')) title.textContent = t('concentration');
                else if (text.includes('Distribution') || text.includes('')) title.textContent = t('distribution');
                else if (text.includes('Activity') || text.includes('')) title.textContent = t('recentActivity');
            });
            
            // Showing X selector label
            const showingLabel = document.querySelector('#whaleTab .whale-controls label');
            if (showingLabel) showingLabel.textContent = t('showing') + ':';
        }
        
        function translateNewsTab() {
            const header = document.querySelector('#newsTab .section-header');
            if (header) {
                const h2 = header.querySelector('h2');
                const subtitle = header.querySelector('.section-subtitle');
                if (h2) h2.textContent = t('newsTitle');
                if (subtitle) subtitle.textContent = t('newsSubtitle');
            }
            
            // Filter buttons
            document.querySelectorAll('#newsTab .news-filter-btn').forEach(btn => {
                const filter = btn.getAttribute('data-filter');
                if (filter === 'all') btn.textContent = t('allNews');
                else if (filter === 'xrp') btn.textContent = t('xrpNews');
                else if (filter === 'crypto') btn.textContent = t('cryptoNews');
                else if (filter === 'etf') btn.textContent = t('etfNews');
            });
        }
        
        function translateAITab() {
            const header = document.querySelector('#aiTab .section-header');
            if (header) {
                const h2 = header.querySelector('h2');
                const subtitle = header.querySelector('.section-subtitle');
                if (h2) h2.textContent = t('aiTitle');
                if (subtitle) subtitle.textContent = t('aiSubtitle');
            }
            
            // Generate analysis button
            document.querySelectorAll('#aiTab button').forEach(btn => {
                if (btn.textContent.includes('Generate') || btn.textContent.includes(' ')) {
                    btn.textContent = t('generateAnalysis');
                } else if (btn.textContent.includes('PDF') || btn.textContent.includes('')) {
                    btn.textContent = t('generateReport');
                } else if (btn.textContent.includes('Send') || btn.textContent.includes('')) {
                    btn.textContent = t('send');
                } else if (btn.textContent.includes('Save') || btn.textContent.includes('')) {
                    btn.textContent = t('savePortfolio');
                }
            });
            
            // Panel titles
            document.querySelectorAll('#aiTab .ai-panel-title').forEach((title, i) => {
                const titles = [t('marketOverview'), t('technicalAnalysis'), t('institutionalFlow'), t('outlook')];
                if (titles[i]) title.textContent = titles[i];
            });
            
            // Chat input placeholder
            const chatInput = document.querySelector('#aiTab input[type="text"]');
            if (chatInput) chatInput.placeholder = t('chatPlaceholder');
            
            // Portfolio Tracker Section
            const portfolioTitle = document.querySelector('.portfolio-tracker-section h3');
            if (portfolioTitle) portfolioTitle.innerHTML = `<span></span> ${t('yourPortfolio')}`;
            
            // Portfolio labels
            const portfolioLabels = document.querySelectorAll('.portfolio-input-group label');
            const plLabels = [t('yourXRPHoldings'), t('avgBuyPrice'), t('targetPrice')];
            portfolioLabels.forEach((label, i) => {
                if (plLabels[i]) label.textContent = plLabels[i];
            });
            
            // Portfolio result labels
            const portfolioResultLabels = document.querySelectorAll('.portfolio-card .portfolio-label');
            const prLabels = [t('currentValue'), t('unrealizedPnL'), t('valueAtTarget'), t('aiInsight')];
            portfolioResultLabels.forEach((label, i) => {
                if (prLabels[i]) label.textContent = prLabels[i];
            });
            
            // Daily Briefing
            const briefingTitle = document.querySelector('.briefing-title');
            if (briefingTitle) briefingTitle.textContent = t('dailyBriefing');
            
            // Quick stat labels (Price, 24h, Sentiment)
            const quickLabels = document.querySelectorAll('.quick-label');
            const qlLabels = [t('price'), t('day7Change').replace('7D', '24h'), t('sentiment')];
            quickLabels.forEach((label, i) => {
                if (i === 0) label.textContent = t('price');
                else if (i === 1) label.textContent = '24h';
                else if (i === 2) label.textContent = t('sentiment');
            });
            
            // Market Sentiment Section
            const sentimentTitle = document.querySelector('.sentiment-section h3');
            if (sentimentTitle) sentimentTitle.innerHTML = `<span></span> ${t('marketSentiment')}`;
            
            // Gauge labels
            const gaugeLabels = document.querySelectorAll('.gauge-labels span');
            if (gaugeLabels.length >= 3) {
                gaugeLabels[0].textContent = t('bearish');
                gaugeLabels[1].textContent = t('neutral');
                gaugeLabels[2].textContent = t('bullish');
            }
            
            // Current Sentiment label
            const sentimentScore = document.querySelector('.sentiment-score span');
            if (sentimentScore) sentimentScore.textContent = t('currentSentiment') + ':';
            
            // Price Scenarios Section
            const scenariosTitle = document.querySelector('.scenarios-section h3');
            if (scenariosTitle) scenariosTitle.innerHTML = `<span></span> ${t('priceScenarios')}`;
            
            // Scenario titles
            document.querySelectorAll('.scenario-title').forEach(title => {
                const text = title.textContent.trim();
                if (text.includes('Bullish') || text.includes('')) title.textContent = t('bullishCase');
                else if (text.includes('Base') || text.includes('')) title.textContent = t('baseCase');
                else if (text.includes('Bearish') || text.includes('')) title.textContent = t('bearishCase');
            });
            
            // Probability labels
            document.querySelectorAll('.scenario-probability').forEach(prob => {
                const span = prob.querySelector('span');
                if (span) {
                    const pct = span.textContent;
                    prob.innerHTML = `${t('probability')}: <span>${pct}</span>`;
                }
            });
            
            // Technical Analysis Explained Section
            const taTitle = document.querySelector('.ta-explanation-section h3');
            if (taTitle) taTitle.innerHTML = `<span></span> ${t('taExplained')}`;
            
            // TA level labels
            document.querySelectorAll('.level-label').forEach(label => {
                const text = label.textContent;
                if (text.includes('Support') || text.includes('')) label.innerHTML = ` ${t('support')}`;
                else if (text.includes('Current') || text.includes('')) label.innerHTML = ` ${t('current')}`;
                else if (text.includes('Resistance') || text.includes('')) label.innerHTML = ` ${t('resistance')}`;
            });
            
            // AI Analysis Section
            const aiAnalysisTitle = document.querySelector('.ai-summary-section h3');
            if (aiAnalysisTitle) aiAnalysisTitle.innerHTML = `<span></span> ${t('aiAnalysis')}`;
            
            // AI Disclaimer
            const aiDisclaimer = document.querySelector('.ai-disclaimer');
            if (aiDisclaimer) aiDisclaimer.textContent = t('aiDisclaimer');
            
            // Moving Averages Section
            const maTitle = document.querySelector('.ma-section h3');
            if (maTitle) maTitle.innerHTML = `<span></span> ${t('movingAverages')}`;
            
            // MA labels
            document.querySelectorAll('.ma-label').forEach(label => {
                const text = label.textContent;
                if (text.includes('7')) label.textContent = t('dayMA7');
                else if (text.includes('30')) label.textContent = t('dayMA30');
                else if (text.includes('90')) label.textContent = t('dayMA90');
            });
            
            // MA signals
            document.querySelectorAll('.ma-signal').forEach(signal => {
                const text = signal.textContent;
                if (text.includes('Above') || text.includes('')) signal.textContent = t('above');
                else if (text.includes('Below') || text.includes('')) signal.textContent = t('below');
            });
            
            // ETF Guide Section
            const guideTitle = document.querySelector('.etf-guide-section h3');
            if (guideTitle) guideTitle.innerHTML = `<span></span> ${t('whichETFBest')}`;
            
            // Guide card titles
            document.querySelectorAll('.guide-title').forEach(title => {
                const text = title.textContent.trim();
                if (text.includes('Long') || text.includes('')) title.textContent = t('longTermHolders');
                else if (text.includes('Active') || text.includes('')) title.textContent = t('activeTraders');
                else if (text.includes('High Risk') || text.includes('')) title.textContent = t('highRiskReward');
                else if (text.includes('Canadian') || text.includes('')) title.textContent = t('canadianInvestors');
            });
            
            // Comparison Tool Section
            const compTitle = document.querySelector('.comparison-section h3');
            if (compTitle) compTitle.innerHTML = `<span></span> ${t('etfComparison')}`;
            
            // Comparison stat labels
            document.querySelectorAll('.comp-stat-label').forEach(label => {
                const text = label.textContent.trim();
                if (text.includes('Volume') || text.includes('')) label.textContent = t('dailyVolume');
                else if (text.includes('7D') || text.includes('7')) label.textContent = t('day7Change');
                else if (text.includes('AUM') || text.includes('')) label.textContent = t('aum');
            });
        }

        // Initialize language on page load
        function initLanguage() {
            // Set active button based on saved language
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent.includes(currentLanguage.toUpperCase())) {
                    btn.classList.add('active');
                }
            });
            
            // Apply translations
            applyTranslations();
        }

        // =====================================================
        // XRP SPOT ETF HOLDINGS DATA
        // UPDATE THIS ARRAY DAILY - Add new entries at the TOP
        // =====================================================
        const holdingsData = [
	    {       
         date: "1/22/2026",
                canary: { xrp: 181885628.7, value: 356203723.94 },
                bitwise: { xrp: null, value: null },
                franklin: { xrp: null, value: null },
                grayscale: { xrp: null, value: null },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
			{
                date: "1/21/2026",
                canary: { xrp: 181888120.32, value: 346082528.08 },
                bitwise: { xrp: 155612822.31, value: 304733477.69 },
                franklin: { xrp: 141195688.45, value: 276500692.78 },
                grayscale: { xrp: 112335702.5031, value: 221414905 },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },     
      	    {      
			    date: "1/20/2026",
                canary: { xrp: null, value: null },
                bitwise: { xrp: null, value: null },
                franklin: { xrp: 140652628.11, value: 267622568.56 },
                grayscale: { xrp: null, value: null },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
		{
                date: "1/16/2026",
                canary: { xrp: 181474831.52, value: 374525942.54 },
                bitwise: { xrp: null, value: null },
                franklin: { xrp: 139566507.43, value: 287747059.7 },
                grayscale: { xrp: 141437713.5104, value: 293932037 },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
	    {    
                date: "1/15/2026",
                canary: { xrp: 181477317.51, value: 389931601.22 },
                bitwise: { xrp: 152926509.81, value: 315589850.52 },
                franklin: { xrp: 139023447.09, value: 286898517.05 },
                grayscale: { xrp: 137945472.1925, value: 284340243 },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },		
            {    
                date: "1/14/2026",
                canary: { xrp: null, value: null},
                bitwise: { xrp: 149456430.08, value: 321101161.78 },
                franklin: { xrp: 137394266.07, value: 295186084.88 },
                grayscale: { xrp: 134647244.2807, value: 289447546 },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
			{    
                date: "1/13/2026",
                canary: { xrp: 181801494.5, value: 375660973.11},
                bitwise: { xrp: 148896734.97, value: 317915374.71 },
                franklin: { xrp: null, value: null },
                grayscale: { xrp: 130960989.5561, value: 279370828 },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {   
                date: "1/12/2026",
                canary: { xrp: 180526673.59, value: 376375187.55 },
                bitwise: { xrp: 147777337.98, value: 305378913.4 },
                franklin: { xrp: 136308145.39, value: 281678056.28 },
                grayscale: { xrp: 130184935.9299, value: 268546007 },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null }, 
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },           
	    {   
                date: "1/9/2026",
                canary: { xrp: null, value: null },
                bitwise: { xrp: null, value: null },
                franklin: { xrp: 134135904.03, value: 279619705.54 },
                grayscale: { xrp: 129990922.5234, value: 270795790 },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null }, 
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "1/8/2026",
                canary: { xrp: 179897875.12, value: 392454590.39 },
                bitwise: { xrp: 144083290.75, value: 305619390.52},
                franklin: { xrp: null, value: null },
                grayscale: { xrp: 128632828.5777, value: 273478410 },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null }, 
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },   
            {
                date: "1/7/2026",
                canary: { xrp: 179474539.89, value: 404985914.53 },
                bitwise: { xrp: 141956329.77, value: 309674894.28 },
                franklin: { xrp: null, value: null },
                grayscale: { xrp: 127856775.0514, value: 277801447 },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
			{
                date: "1/6/2026",
                canary: { xrp: 178412485, value: 413665760.07 },
                bitwise: { xrp: 140836864.35, value: 317753316.61 },
                franklin: { xrp: 131963663, value: 297733776.44 },
                grayscale: { xrp: 127080721, value: 286761079 },
                shares21: { xrp: 118288356.64, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "1/5/2026",
                canary: { xrp: 175640703, value: 349221200.58 },
                bitwise: { xrp: 139269597, value: 322867313 },
                franklin: { xrp: 128705301, value: 298376211.39 },
                grayscale: { xrp: 122812426, value: 284468090 },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "1/2/2026",
                canary: { xrp: 175547917, value: 319148921.70 },
                bitwise: { xrp: 132104912, value: 262824043 },
                franklin: { xrp: 123274697, value: 245256242.88 },
                grayscale: { xrp: null, value: null },
                shares21: { xrp: 139950038.34, value: 272364268.68 },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "12/31/2025",
                canary: { xrp: 175552727, value: 328418423.11 },
                bitwise: { xrp: null, value: null },
                franklin: { xrp: 118387154, value: 215197065.61 },
                grayscale: { xrp: null, value: null },
                shares21: { xrp: 136925159.19, value: 246367782.25 },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "12/30/2025",
                canary: { xrp: 175555131, value: null },
                bitwise: { xrp: 131223200, value: 245443810 },
                franklin: { xrp: 116214913, value: 217371859.35 },
                grayscale: { xrp: 122230386, value: 228252534 },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "12/29/2025",
                canary: { xrp: 175557536, value: 324731233 },
                bitwise: { xrp: 125625472, value: 232284011 },
                franklin: { xrp: 113499611, value: 209863051 },
                grayscale: { xrp: null, value: null },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "12/26/2025",
                canary: { xrp: 176203556, value: 328519019 },
                bitwise: { xrp: null, value: null },
                franklin: { xrp: null, value: null },
                grayscale: { xrp: null, value: null },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "12/24/2025",
                canary: { xrp: 176208383, value: 332060117 },
                bitwise: { xrp: null, value: null },
                franklin: { xrp: 111870430, value: 208556687 },
                grayscale: { xrp: null, value: null },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "12/23/2025",
                canary: { xrp: 175784910, value: 333629564 },
                bitwise: { xrp: null, value: null },
                franklin: { xrp: 105896766, value: 199553984 },
                grayscale: { xrp: 121454333, value: 228341918 },
                shares21: { xrp: 135739074, value: 255426264 },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "12/22/2025",
                canary: { xrp: 175787318, value: 335859777 },
                bitwise: { xrp: 122826582, value: 230048700 },
                franklin: { xrp: 101552284, value: 192683272 },
                grayscale: { xrp: 116603997, value: 221122690 },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "12/19/2025",
                canary: { xrp: 175794542, value: 318653801 },
                bitwise: { xrp: 112749910, value: 215424487 },
                franklin: { xrp: null, value: null },
                grayscale: { xrp: 115633930, value: 220682384 },
                shares21: { xrp: 132421082, value: 232394226 },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "12/18/2025",
                canary: { xrp: 174412723, value: 326809327 },
                bitwise: { xrp: 112190079, value: 203322080 },
                franklin: { xrp: 96664740, value: 175185509 },
                grayscale: { xrp: 110007542, value: 198205098 },
                shares21: { xrp: 128419942, value: 230206632 },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "12/17/2025",
                canary: { xrp: 174415112, value: 336316637 },
                bitwise: { xrp: 110174688, value: 206425499 },
                franklin: { xrp: null, value: null },
                grayscale: { xrp: null, value: null },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: 330324, value: 618901 }
            },
            {
                date: "12/16/2025",
                canary: { xrp: 171648969, value: 323681379 },
                bitwise: { xrp: 107487501, value: 200245575 },
                franklin: { xrp: 92863318, value: 179048835 },
                grayscale: { xrp: 108261421, value: 208683308 },
                shares21: { xrp: 123052427, value: 231256177 },
                rex: { xrp: 30484262, value: null },
                nciq: { xrp: 3647484, value: null },
                bitw: { xrp: 30843614, value: null },
                gdlc: { xrp: 14176113, value: null },
                ezpz: { xrp: 330366, value: 636976 }
            },
              {
                date: "12/15/2025",
                canary: { xrp: 171651320.69, value: 343704992.08 },
                bitwise: { xrp: null, value: null },
                franklin: { xrp: 91777197.5, value: 173030303.76 },
                grayscale: { xrp: null, value: null },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "12/12/2025",
                canary: { xrp: 170806472.44, value: 344979028.04 },
                bitwise: { xrp: 104240482.45, value: 208697785.10 },
                franklin: { xrp: 87432714.78, value: 175047289.60 },
                grayscale: { xrp: 107679380.77, value: 215496914.00 },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "12/11/2025",
                canary: { xrp: 168998494.45, value: 352018456.00 },
                bitwise: { xrp: 100321667.32, value: 202633716.52 },
                franklin: { xrp: 83088232.06, value: 167824934.64 },
                grayscale: { xrp: 106903327.14, value: 216461064.00 },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {   
                date: "12/10/2025",
                canary: { xrp: 169000809.53, value: 357526113.56 },
                bitwise: { xrp: 97858412.09, value: 203872344.26 },
                franklin: { xrp: null, value: null },
                grayscale: { xrp: 105351219.89, value: 217442600.00 },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {   
                date: "12/9/2025",
                canary: { xrp: 169003124.65, value: 352338559.27 },
                bitwise: { xrp: 94499427.69, value: 199863454.60 },
                franklin: { xrp: null, value: null },
                grayscale: { xrp: null, value: null },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "12/8/2025",
                canary: { xrp: 166130110.94, value: 337172024.75 },
                bitwise: { xrp: 93827630.81, value: 195604338.52 },
                franklin: { xrp: 78200689.00, value: 163026540.36 },
                grayscale: { xrp: 104381152.86, value: 217916115.00 },
                shares21: { xrp: 293666.01, value: 612211.41 },
                rex: { xrp: 30484262.00, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: 30843614.13, value: null }
            },
            {
                date: "12/5/2025",
                canary: { xrp: 165497950.17, value: 347155947.69 },
                bitwise: { xrp: 91812240.18, value: 186318251.45 },
                franklin: { xrp: 62994999.47, value: 127838272.22 },
                grayscale: { xrp: null, value: null },
                shares21: { xrp: 256964.03, value: 521467.39 },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "12/4/2025",
                canary: { xrp: 163050728.88, value: 356991092.25 },
                bitwise:  { xrp: 90692578.71, value: 190260333.18 },
                franklin: { xrp: 61908878.79, value: 129876160.45 },
                grayscale: { xrp: 103023059.01, value: 217045890.00 },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "12/3/2025",
                canary: { xrp: 162413956.75, value: 351249740.82 },
                bitwise: { xrp: 88901120.37, value: 194641001.95 },
                franklin: { xrp: 59193577.09, value: 129599099.61 },
                grayscale: { xrp: 85173825.61, value: 187358142.00 },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: 31454262.00, value: 67601059.18 },
                bitw: { xrp: 14176112.75, value: 3647484.00 },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "12/2/2025",
                canary: { xrp: 161351157.49, value: 324690322.59 },
                bitwise: { xrp: 87109662.02, value: 188363319.88 },
                franklin: { xrp: 57021335.73, value: 123301225.74 },
                grayscale: { xrp: 64026364.30, value: 138593133.00 },
                shares21: { xrp: 220261.36, value: 476286.55 },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "12/1/2025",
                canary: { xrp: 158690770.98, value: 346639994.17 },
                bitwise: { xrp: 83414779.18, value: 167832204.03 },
                franklin: { xrp: 53219913.35, value: 107079530.05 },
                grayscale: { xrp: null, value: null },
                shares21: { xrp: 220251.36, value: 443170.26 },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "11/28/2025",
                canary: { xrp: 155821569.95, value: 346199221.99 },
                bitwise: { xrp: 81847253.13, value: 178427011.82 },
                franklin: { xrp: 39100344.50, value: 85406491.49 },
                grayscale: { xrp: 38028567.82, value: 83255563.00 },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {           
                date: "11/26/2025",
                canary: { xrp: 151671903.56, value: 331617876.65 },
                bitwise: { xrp: 80503659.37, value: 178833244.05 },
                franklin: { xrp: 34212801.44, value: 76001343.50 },
                grayscale: { xrp: 29436381.00, value: 64297594.51 },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "11/25/2025",
                canary: { xrp: 149330703.49, value: 337624027.47 },
                bitwise: { xrp: 77144674.98, value: 168686089.21 },
                franklin: { xrp: 32040560.08, value: 70060529.48 },
                grayscale: { xrp: 36088433.75, value: 79394554.00 },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "11/24/2025",
                canary: { xrp: 146137326.55, value: 283102051.52 },
                bitwise: { xrp: 67403620.22, value: 152328137.50 },
                franklin: { xrp: 6016355.74, value: 13476637.00 },
                grayscale: { xrp: null, value: null },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "11/21/2025",
                canary: { xrp: 138900072.25, value: 278082806.15 },
                bitwise: { xrp: 59565989.97, value: 115360261.46 },
                franklin: { xrp: 6017179.98, value: 11673329.00 },
                grayscale: { xrp: null, value: null },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "11/20/2025",
                canary: { xrp: 138582415.26, value: 281877879.88 },
                bitwise: { xrp: 53743696.21, value: 107600791.63 },
                franklin: { xrp: null, value: null },
                grayscale: { xrp: null, value: null },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "11/19/2025",
                canary: { xrp: 132193030.95, value: 295175008.55 },
                bitwise: { xrp: 1119660.33, value: 2277445.11 },
                franklin: { xrp: null, value: null },
                grayscale: { xrp: null, value: null },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "11/18/2025",
                canary: { xrp: 124418674.67, value: 265019864.27 },
                bitwise: { xrp: null, value: null },
                franklin: { xrp: null, value: null },
                grayscale: { xrp: null, value: null },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "11/14/2025",
                canary: { xrp: 108765777.15, value: 250410904.89 },
                bitwise: { xrp: null, value: null },
                franklin: { xrp: null, value: null },
                grayscale: { xrp: null, value: null },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            },
            {
                date: "11/13/2025",
                canary: { xrp: 2237132.88, value: 5250000.40 },
                bitwise: { xrp: null, value: null },
                franklin: { xrp: null, value: null },
                grayscale: { xrp: null, value: null },
                shares21: { xrp: null, value: null },
                rex: { xrp: null, value: null },
                nciq: { xrp: null, value: null },
                bitw: { xrp: null, value: null },
                gdlc: { xrp: null, value: null },
                ezpz: { xrp: null, value: null }
            }
        ];

        // ETF column definitions for the holdings table
        const etfColumns = [
            { key: 'canary', name: 'Canary XRP', ticker: 'XRPC' },
            { key: 'bitwise', name: 'Bitwise XRP', ticker: 'XRP' },
            { key: 'franklin', name: 'Franklin XRP', ticker: 'XRPZ' },
            { key: 'grayscale', name: 'Grayscale XRP', ticker: 'GXRP' },
            { key: 'shares21', name: '21Shares XRP', ticker: 'TOXR' },
            { key: 'rex', name: 'Rex Shares', ticker: 'XRPR' },
            { key: 'nciq', name: 'NCIQ', ticker: 'NCIQ' },
            { key: 'bitw', name: 'BITW', ticker: 'BITW' },
            { key: 'gdlc', name: 'Grayscale GDLC', ticker: 'GDLC' },
            { key: 'ezpz', name: 'Franklin EZPZ', ticker: 'EZPZ' }
        ];

        // Tab switching function
        function switchMainTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.main-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.closest('.main-tab').classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            if (tabName === 'trading') {
                document.getElementById('tradingTab').classList.add('active');
            } else if (tabName === 'holdings') {
                document.getElementById('holdingsTab').classList.add('active');
                renderHoldingsTable();
                updateHoldingsSummary();
                // Render charts after a small delay to ensure canvas is visible
                setTimeout(() => {
                    renderHoldingsChart();
                    renderHoldingsTrendChart();
                    updateDashboardOverview();
                }, 100);
            } else if (tabName === 'exchange') {
                document.getElementById('exchangeTab').classList.add('active');
                // Auto-load exchange data if not already loaded
                if (Object.keys(exchangeData).length === 0 && !isExchangeFetching) {
                    fetchExchangeData();
                } else if (Object.keys(exchangeData).length > 0) {
                    // Re-render charts if data already exists
                    setTimeout(() => {
                        renderExchangeCharts();
                    }, 100);
                }
            } else if (tabName === 'analytics') {
                document.getElementById('analyticsTab').classList.add('active');
                initAnalytics();
                // Load exchange data if not already loaded
                if (Object.keys(exchangeData).length === 0 && !isExchangeFetching) {
                    fetchExchangeData().then(() => {
                        setTimeout(() => updateAnalytics(), 500);
                    });
                } else if (Object.keys(exchangeData).length > 0) {
                    setTimeout(() => updateAnalytics(), 100);
                }
            } else if (tabName === 'whales') {
                document.getElementById('whalesTab').classList.add('active');
                // Auto-load whale data if not already loaded
                if (whaleData.length === 0 && !isWhaleFetching) {
                    fetchWhaleData();
                } else if (whaleData.length > 0) {
                    setTimeout(() => renderWhaleTable(), 100);
                }
            } else if (tabName === 'news') {
                document.getElementById('newsTab').classList.add('active');
            } else if (tabName === 'insights') {
                document.getElementById('insightsTab').classList.add('active');
                // Auto-fetch real data when visiting insights tab
                setTimeout(() => {
                    if (xrpPriceHistory.length === 0) {
                        generateInsights(); // This fetches real data
                    } else {
                        renderMAChart();
                        renderComparisonChart();
                    }
                }, 100);
            }
        }

        // Format number for holdings display
        function formatHoldingsNumber(num) {
            if (num === null || num === undefined) return '';
            if (num >= 1e9) return (num / 1e9).toFixed(2) + 'B';
            if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';
            if (num >= 1e3) return (num / 1e3).toFixed(1) + 'K';
            return num.toLocaleString();
        }

        function formatHoldingsCurrency(num) {
            if (num === null || num === undefined) return '';
            return '$' + formatHoldingsNumber(num);
        }

        // Calculate and update summary statistics
        function updateHoldingsSummary() {
            // Get the most recent value for each ETF (they may report on different days)
            let totalXRP = 0;
            let activeCount = 0;
            let latestDate = holdingsData[0].date;

            // For each ETF, find its most recent data point
            etfColumns.forEach(col => {
                for (const row of holdingsData) {
                    const data = row[col.key];
                    if (data && data.xrp) {
                        totalXRP += data.xrp;
                        activeCount++;
                        break; // Found most recent for this ETF, move to next
                    }
                }
            });

            // Update the summary cards
            document.getElementById('totalXRP').textContent = formatHoldingsNumber(totalXRP);
            document.getElementById('holdingsLastUpdated').textContent = latestDate;
            document.getElementById('activeETFs').textContent = activeCount;
            
            // Use live XRP price to calculate total value
            if (currentXRPPrice && totalXRP > 0) {
                const totalValue = totalXRP * currentXRPPrice;
                document.getElementById('totalValue').textContent = formatHoldingsCurrency(totalValue);
                document.getElementById('holdingsXRPPrice').textContent = '$' + currentXRPPrice.toFixed(4);
            } else {
                document.getElementById('totalValue').textContent = 'Loading...';
                document.getElementById('holdingsXRPPrice').textContent = 'Loading...';
            }
        }

        // Render the holdings table
        function renderHoldingsTable() {
            const table = document.getElementById('holdingsTable');
            
            // Build header rows
            let headerRow1 = '<tr><th rowspan="2">Date</th>';
            let headerRow2 = '<tr>';
            
            etfColumns.forEach(col => {
                headerRow1 += `<th colspan="2" class="etf-header">${col.name}<br><span style="color: var(--accent-xrp); font-size: 0.65rem;">${col.ticker}</span></th>`;
                headerRow2 += `<th class="sub-header">XRP</th><th class="sub-header">Value</th>`;
            });
            
            headerRow1 += '</tr>';
            headerRow2 += '</tr>';

            // Build data rows
            let dataRows = '';
            holdingsData.forEach(row => {
                dataRows += `<tr><td>${row.date}</td>`;
                etfColumns.forEach(col => {
                    const data = row[col.key] || {};
                    const xrpVal = data.xrp !== null && data.xrp !== undefined 
                        ? formatHoldingsNumber(data.xrp) 
                        : '<span class="no-data"></span>';
                    const valueVal = data.value !== null && data.value !== undefined 
                        ? formatHoldingsCurrency(data.value) 
                        : '<span class="no-data"></span>';
                    dataRows += `<td class="xrp-cell etf-column-group">${xrpVal}</td><td class="value-cell">${valueVal}</td>`;
                });
                dataRows += '</tr>';
            });

            table.innerHTML = `
                <thead>
                    ${headerRow1}
                    ${headerRow2}
                </thead>
                <tbody>
                    ${dataRows}
                </tbody>
            `;
        }

        function refreshHoldingsDisplay() {
            renderHoldingsTable();
            updateHoldingsSummary();
            renderHoldingsChart();
            renderHoldingsTrendChart();
            updateDashboardOverview();
        }

        // Holdings Distribution Chart
        let holdingsDistributionChart = null;
        let currentHoldingsChartType = 'bar';

        function switchHoldingsChart(type) {
            currentHoldingsChartType = type;
            document.querySelectorAll('.chart-type-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.hchart === type);
            });
            renderHoldingsChart();
        }

        function getLatestETFHoldings() {
            const holdings = [];
            
            etfColumns.forEach(col => {
                for (const row of holdingsData) {
                    const data = row[col.key];
                    if (data && data.xrp) {
                        holdings.push({
                            name: col.name,
                            ticker: col.ticker,
                            xrp: data.xrp,
                            value: data.value || (currentXRPPrice ? data.xrp * currentXRPPrice : 0)
                        });
                        break;
                    }
                }
            });
            
            return holdings.sort((a, b) => b.xrp - a.xrp);
        }

        function renderHoldingsChart() {
            const canvas = document.getElementById('holdingsDistributionChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const holdings = getLatestETFHoldings();
            
            if (holdings.length === 0) return;

            // Destroy existing chart
            if (holdingsDistributionChart) {
                holdingsDistributionChart.destroy();
            }

            const labels = holdings.map(h => h.ticker);
            const data = holdings.map(h => h.xrp);
            const colors = [
                '#23f7dd', '#a855f7', '#22c55e', '#f97316', '#3b82f6',
                '#ef4444', '#eab308', '#ec4899', '#14b8a6', '#8b5cf6'
            ];

            const chartConfig = {
                type: currentHoldingsChartType,
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'XRP Holdings',
                        data: data,
                        backgroundColor: currentHoldingsChartType === 'bar' 
                            ? colors.slice(0, data.length).map(c => c + '80')
                            : colors.slice(0, data.length),
                        borderColor: colors.slice(0, data.length),
                        borderWidth: currentHoldingsChartType === 'bar' ? 2 : 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: currentHoldingsChartType !== 'bar',
                            position: 'right',
                            labels: {
                                color: '#8888a0',
                                font: { size: 11 },
                                padding: 15
                            }
                        },
                        tooltip: {
                            backgroundColor: '#16161f',
                            borderColor: '#23f7dd',
                            borderWidth: 1,
                            titleColor: '#ffffff',
                            bodyColor: '#8888a0',
                            padding: 12,
                            callbacks: {
                                label: function(context) {
                                    const holding = holdings[context.dataIndex];
                                    const xrpFormatted = formatHoldingsNumber(context.raw);
                                    let label = `${holding.name}: ${xrpFormatted} XRP`;
                                    if (currentXRPPrice) {
                                        const value = context.raw * currentXRPPrice;
                                        label += ` ($${formatHoldingsNumber(value)})`;
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: currentHoldingsChartType === 'bar' ? {
                        x: {
                            ticks: { 
                                color: '#8888a0',
                                font: { size: 11 }
                            },
                            grid: { color: '#2a2a3a' }
                        },
                        y: {
                            ticks: {
                                color: '#8888a0',
                                callback: function(value) {
                                    return formatHoldingsNumber(value);
                                }
                            },
                            grid: { color: '#2a2a3a' }
                        }
                    } : {}
                }
            };

            holdingsDistributionChart = new Chart(ctx, chartConfig);
        }

        // =====================================================
        // NEW UI/UX ENHANCEMENT FUNCTIONS
        // =====================================================

        // Dashboard Overview Chart
        let dashboardPieChart = null;

        function updateDashboardOverview() {
            // Get ETF totals and count active ETFs
            let etfTotalXRP = 0;
            let activeETFCount = 0;
            etfColumns.forEach(col => {
                for (const row of holdingsData) {
                    const data = row[col.key];
                    if (data && data.xrp) {
                        etfTotalXRP += data.xrp;
                        activeETFCount++;
                        break;
                    }
                }
            });

            // Get Exchange totals
            let exchangeTotalXRP = 0;
            let exchangeLoaded = Object.keys(exchangeData).length > 0;
            if (exchangeLoaded) {
                for (const data of Object.values(exchangeData)) {
                    exchangeTotalXRP += data.total || 0;
                }
            }

            // Update dashboard metrics with animation
            animateValue('dashboardETFXRP', etfTotalXRP);
            if (currentXRPPrice) {
                animateValue('dashboardETFValue', etfTotalXRP * currentXRPPrice, true);
            }
            
            // Update ETF change indicator to show active count
            document.getElementById('dashboardETFChange').innerHTML = 
                `<span style="color: var(--accent-green);"></span> <span>${activeETFCount} Active ETFs</span>`;
            
            // Update Exchange section with proper loading states
            const exchangeChangeEl = document.getElementById('dashboardExchangeChange');
            if (isExchangeFetching) {
                // Currently loading
                document.getElementById('dashboardExchangeXRP').textContent = 'Loading...';
                document.getElementById('dashboardExchangeValue').textContent = 'Loading...';
                exchangeChangeEl.innerHTML = 
                    `<span style="color: var(--accent-orange);"></span> <span>Loading exchange data...</span>`;
            } else if (exchangeLoaded && exchangeTotalXRP > 0) {
                // Data loaded
                animateValue('dashboardExchangeXRP', exchangeTotalXRP);
                if (currentXRPPrice) {
                    animateValue('dashboardExchangeValue', exchangeTotalXRP * currentXRPPrice, true);
                }
                exchangeChangeEl.innerHTML = 
                    `<span style="color: var(--accent-green);"></span> <span>Live data loaded</span>`;
            } else {
                // Not loaded yet
                document.getElementById('dashboardExchangeXRP').textContent = '--';
                document.getElementById('dashboardExchangeValue').textContent = '--';
                exchangeChangeEl.innerHTML = 
                    `<span style="color: var(--text-muted);"></span> <span>Click Exchange tab to load</span>`;
            }

            // Update Top 10K section
            const top10KChangeEl = document.getElementById('dashboardTop10KChange');
            if (isWhaleFetching) {
                document.getElementById('dashboardTop10KXRP').textContent = 'Loading...';
                document.getElementById('dashboardWhaleCount').textContent = '--';
                if (top10KChangeEl) top10KChangeEl.innerHTML = 
                    `<span style="color: var(--accent-orange);"></span> <span>Loading...</span>`;
            } else if (whaleDataFull.length > 0) {
                const top10KTotal = whaleDataFull.reduce((sum, w) => sum + w.balance, 0);
                const whaleCount = whaleDataFull.filter(w => w.balance >= 1000000).length;
                document.getElementById('dashboardTop10KXRP').textContent = formatHoldingsNumber(top10KTotal);
                document.getElementById('dashboardWhaleCount').textContent = whaleCount.toLocaleString();
                if (top10KChangeEl) top10KChangeEl.innerHTML = 
                    `<span style="color: var(--accent-green);"></span> <span>${whaleDataFull.length.toLocaleString()} accounts</span>`;
            } else {
                document.getElementById('dashboardTop10KXRP').textContent = '--';
                document.getElementById('dashboardWhaleCount').textContent = '--';
                if (top10KChangeEl) top10KChangeEl.innerHTML = 
                    `<span style="color: var(--text-muted);"></span> <span>Click Top 10K tab</span>`;
            }

            // Update burn data
            if (burnData) {
                document.getElementById('burnTotal').textContent = formatHoldingsNumber(burnData.totalBurned);
                document.getElementById('currentSupply').textContent = formatHoldingsNumber(burnData.currentSupply);
            }

            // Render pie chart
            renderDashboardPie(etfTotalXRP, exchangeTotalXRP);
        }

        function animateValue(elementId, value, isCurrency = false) {
            const el = document.getElementById(elementId);
            if (!el) return;
            
            el.classList.add('counter-animate');
            
            const formatted = isCurrency 
                ? '$' + formatHoldingsNumber(value) 
                : formatHoldingsNumber(value);
            
            el.textContent = formatted;
            
            setTimeout(() => {
                el.classList.remove('counter-animate');
            }, 500);
        }

        function renderDashboardPie(etfXRP, exchangeXRP) {
            const canvas = document.getElementById('dashboardPieChart');
            if (!canvas) return;

            if (dashboardPieChart) {
                dashboardPieChart.destroy();
            }

            const ctx = canvas.getContext('2d');
            
            // If no exchange data yet, show only ETF
            const data = exchangeXRP > 0 
                ? [etfXRP, exchangeXRP] 
                : [etfXRP, 0];

            dashboardPieChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['ETFs', 'Exchanges'],
                    datasets: [{
                        data: data,
                        backgroundColor: ['#23f7dd', '#a855f7'],
                        borderColor: ['#23f7dd', '#a855f7'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    cutout: '60%',
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: '#16161f',
                            borderColor: '#23f7dd',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    return formatHoldingsNumber(context.raw) + ' XRP';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Holdings Trend Chart (Historical)
        let holdingsTrendChart = null;

        function renderHoldingsTrendChart() {
            const canvas = document.getElementById('holdingsTrendChart');
            if (!canvas) return;

            if (holdingsTrendChart) {
                holdingsTrendChart.destroy();
            }

            const ctx = canvas.getContext('2d');
            
            // Prepare data - reverse to show chronological order
            const reversedData = [...holdingsData].reverse();
            const labels = reversedData.map(row => row.date);
            
            // Calculate total XRP for each date
            const totals = reversedData.map(row => {
                let total = 0;
                etfColumns.forEach(col => {
                    if (row[col.key] && row[col.key].xrp) {
                        total += row[col.key].xrp;
                    }
                });
                return total;
            });

            // Get data for each ETF
            const datasets = [];
            const colors = [
                '#23f7dd', '#a855f7', '#22c55e', '#f97316', '#3b82f6',
                '#ef4444', '#eab308', '#ec4899', '#14b8a6', '#8b5cf6'
            ];

            etfColumns.forEach((col, index) => {
                const data = reversedData.map(row => {
                    return row[col.key]?.xrp || null;
                });
                
                // Only add if there's some data
                if (data.some(v => v !== null)) {
                    datasets.push({
                        label: col.ticker,
                        data: data,
                        borderColor: colors[index % colors.length],
                        backgroundColor: colors[index % colors.length] + '20',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.3,
                        spanGaps: true,
                        pointRadius: 3,
                        pointHoverRadius: 6
                    });
                }
            });

            holdingsTrendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                color: '#8888a0',
                                font: { size: 10 },
                                boxWidth: 12,
                                padding: 10
                            }
                        },
                        tooltip: {
                            backgroundColor: '#16161f',
                            borderColor: '#23f7dd',
                            borderWidth: 1,
                            titleColor: '#ffffff',
                            bodyColor: '#8888a0',
                            padding: 12,
                            callbacks: {
                                label: function(context) {
                                    if (context.raw === null) return null;
                                    return `${context.dataset.label}: ${formatHoldingsNumber(context.raw)} XRP`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#8888a0', font: { size: 10 } },
                            grid: { color: '#2a2a3a' }
                        },
                        y: {
                            ticks: {
                                color: '#8888a0',
                                callback: (value) => formatHoldingsNumber(value)
                            },
                            grid: { color: '#2a2a3a' }
                        }
                    }
                }
            });
        }

        // Exchange Charts
        let exchangeHorizontalBarChart = null;
        let exchangeDominanceChart = null;

        function renderExchangeCharts() {
            if (Object.keys(exchangeData).length === 0) return;

            renderExchangeHorizontalBar();
            renderExchangeDominanceDonut();
            renderExchangeTreemap();
            renderDominanceBars();
            updateDashboardOverview();
        }

        function renderExchangeHorizontalBar() {
            const canvas = document.getElementById('exchangeHorizontalBarChart');
            if (!canvas) return;

            if (exchangeHorizontalBarChart) {
                exchangeHorizontalBarChart.destroy();
            }

            const sorted = Object.entries(exchangeData)
                .sort((a, b) => b[1].total - a[1].total)
                .slice(0, 10);

            const labels = sorted.map(([name]) => name);
            const data = sorted.map(([_, d]) => d.total);
            const colors = [
                '#23f7dd', '#a855f7', '#22c55e', '#f97316', '#3b82f6',
                '#ef4444', '#eab308', '#ec4899', '#14b8a6', '#8b5cf6'
            ];

            const ctx = canvas.getContext('2d');
            exchangeHorizontalBarChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'XRP Balance',
                        data: data,
                        backgroundColor: colors,
                        borderColor: colors,
                        borderWidth: 1,
                        borderRadius: 4
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: '#16161f',
                            borderColor: '#23f7dd',
                            borderWidth: 1,
                            callbacks: {
                                label: (ctx) => formatHoldingsNumber(ctx.raw) + ' XRP'
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: '#8888a0',
                                callback: (v) => formatHoldingsNumber(v)
                            },
                            grid: { color: '#2a2a3a' }
                        },
                        y: {
                            ticks: { color: '#8888a0', font: { size: 11 } },
                            grid: { display: false }
                        }
                    }
                }
            });
        }

        function renderExchangeDominanceDonut() {
            const canvas = document.getElementById('exchangeDominanceChart');
            if (!canvas) return;

            if (exchangeDominanceChart) {
                exchangeDominanceChart.destroy();
            }

            const sorted = Object.entries(exchangeData)
                .sort((a, b) => b[1].total - a[1].total);
            
            const top5 = sorted.slice(0, 5);
            const othersTotal = sorted.slice(5).reduce((sum, [_, d]) => sum + d.total, 0);

            const labels = [...top5.map(([name]) => name), 'Others'];
            const data = [...top5.map(([_, d]) => d.total), othersTotal];
            const colors = ['#23f7dd', '#a855f7', '#22c55e', '#f97316', '#3b82f6', '#64748b'];

            const ctx = canvas.getContext('2d');
            exchangeDominanceChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors,
                        borderColor: '#16161f',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '50%',
                    plugins: {
                        legend: {
                            display: true,
                            position: 'right',
                            labels: {
                                color: '#8888a0',
                                font: { size: 10 },
                                padding: 8,
                                boxWidth: 12
                            }
                        },
                        tooltip: {
                            backgroundColor: '#16161f',
                            borderColor: '#23f7dd',
                            borderWidth: 1,
                            callbacks: {
                                label: (ctx) => {
                                    const total = ctx.dataset.data.reduce((a, b) => a + b, 0);
                                    const pct = ((ctx.raw / total) * 100).toFixed(1);
                                    return `${formatHoldingsNumber(ctx.raw)} XRP (${pct}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function renderExchangeTreemap() {
            const container = document.getElementById('exchangeTreemap');
            if (!container) return;

            const sorted = Object.entries(exchangeData)
                .sort((a, b) => b[1].total - a[1].total)
                .slice(0, 15);

            const total = sorted.reduce((sum, [_, d]) => sum + d.total, 0);
            const colors = [
                '#23f7dd', '#a855f7', '#22c55e', '#f97316', '#3b82f6',
                '#ef4444', '#eab308', '#ec4899', '#14b8a6', '#8b5cf6',
                '#06b6d4', '#f43f5e', '#84cc16', '#6366f1', '#10b981'
            ];

            let html = '';
            sorted.forEach(([name, data], index) => {
                const share = (data.total / total) * 100;
                const size = Math.max(60, Math.sqrt(share) * 35);
                const color = colors[index % colors.length];
                
                html += `
                    <div class="treemap-item" 
                         style="background: ${color}; width: ${size}px; height: ${size}px; flex: 0 0 ${size}px;"
                         title="${name}: ${formatHoldingsNumber(data.total)} XRP (${share.toFixed(1)}%)">
                        <div class="treemap-item-name">${name.slice(0, 8)}</div>
                        <div class="treemap-item-value">${share.toFixed(1)}%</div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function renderDominanceBars() {
            const container = document.getElementById('dominanceBars');
            if (!container) return;

            const sorted = Object.entries(exchangeData)
                .sort((a, b) => b[1].total - a[1].total)
                .slice(0, 5);

            const total = Object.values(exchangeData).reduce((sum, d) => sum + d.total, 0);
            const colors = ['#23f7dd', '#a855f7', '#22c55e', '#f97316', '#3b82f6'];

            let html = '';
            sorted.forEach(([name, data], index) => {
                const share = (data.total / total) * 100;
                const color = colors[index];
                
                html += `
                    <div class="dominance-bar-item">
                        <div class="dominance-bar-label">${name}</div>
                        <div class="dominance-bar-track">
                            <div class="dominance-bar-fill" style="width: ${share}%; background: ${color};">
                                <span class="dominance-bar-value">${formatHoldingsNumber(data.total)}</span>
                            </div>
                        </div>
                        <div class="dominance-bar-percent">${share.toFixed(1)}%</div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Theme Toggle
        function toggleTheme() {
            document.body.classList.toggle('light-mode');
            localStorage.setItem('theme', document.body.classList.contains('light-mode') ? 'light' : 'dark');
        }

        // Load saved theme
        if (localStorage.getItem('theme') === 'light') {
            document.body.classList.add('light-mode');
        }

        // Chart Export Function
        function exportChart(chartId) {
            let canvas;
            switch(chartId) {
                case 'trendChart':
                    canvas = document.getElementById('holdingsTrendChart');
                    break;
                case 'distributionChart':
                    canvas = document.getElementById('holdingsDistributionChart');
                    break;
                case 'exchangeBarChart':
                    canvas = document.getElementById('exchangeHorizontalBarChart');
                    break;
                default:
                    return;
            }

            if (canvas) {
                const link = document.createElement('a');
                link.download = `${chartId}_${new Date().toISOString().split('T')[0]}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
            }
        }

        // Fullscreen Chart
        let fullscreenChartInstance = null;

        function openFullscreenChart(type) {
            const overlay = document.getElementById('fullscreenChartOverlay');
            const canvas = document.getElementById('fullscreenChart');
            const title = document.getElementById('fullscreenChartTitle');
            
            overlay.classList.add('active');
            
            if (fullscreenChartInstance) {
                fullscreenChartInstance.destroy();
            }

            const ctx = canvas.getContext('2d');
            
            if (type === 'trend') {
                title.textContent = ' Holdings Trend Over Time';
                
                const reversedData = [...holdingsData].reverse();
                const labels = reversedData.map(row => row.date);
                const colors = [
                    '#23f7dd', '#a855f7', '#22c55e', '#f97316', '#3b82f6',
                    '#ef4444', '#eab308', '#ec4899', '#14b8a6', '#8b5cf6'
                ];
                
                const datasets = [];
                etfColumns.forEach((col, index) => {
                    const data = reversedData.map(row => row[col.key]?.xrp || null);
                    if (data.some(v => v !== null)) {
                        datasets.push({
                            label: col.name,
                            data: data,
                            borderColor: colors[index % colors.length],
                            backgroundColor: colors[index % colors.length] + '20',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.3,
                            spanGaps: true,
                            pointRadius: 4,
                            pointHoverRadius: 8
                        });
                    }
                });

                fullscreenChartInstance = new Chart(ctx, {
                    type: 'line',
                    data: { labels, datasets },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top',
                                labels: { color: '#8888a0', font: { size: 12 } }
                            },
                            tooltip: {
                                backgroundColor: '#16161f',
                                borderColor: '#23f7dd',
                                borderWidth: 1,
                                titleFont: { size: 14 },
                                bodyFont: { size: 12 },
                                padding: 15
                            }
                        },
                        scales: {
                            x: { ticks: { color: '#8888a0' }, grid: { color: '#2a2a3a' } },
                            y: { 
                                ticks: { 
                                    color: '#8888a0',
                                    callback: (v) => formatHoldingsNumber(v)
                                }, 
                                grid: { color: '#2a2a3a' } 
                            }
                        }
                    }
                });
            }
        }

        function closeFullscreenChart() {
            document.getElementById('fullscreenChartOverlay').classList.remove('active');
            if (fullscreenChartInstance) {
                fullscreenChartInstance.destroy();
                fullscreenChartInstance = null;
            }
        }

        // Close fullscreen on escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeFullscreenChart();
            }
        });

        // CSV Upload handler
        function handleCSVUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const csv = e.target.result;
                    const lines = csv.split('\n');
                    const headers = lines[0].split(',').map(h => h.trim());
                    
                    console.log('CSV Headers:', headers);
                    console.log('CSV has', lines.length - 1, 'data rows');
                    
                    // Parse and add to holdings data
                    // This is a basic implementation - you would expand this
                    // to properly map your CSV columns to the data structure
                    
                    alert('CSV uploaded successfully! Check console for parsed data. To fully integrate, update the holdingsData array in the HTML file.');
                } catch (error) {
                    alert('Error parsing CSV: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        // =====================================================
        // EXCHANGE HOLDINGS DATA AND FUNCTIONS
        // =====================================================

        const RIPPLED_URLS = [
            "https://s1.ripple.com:51234",
            "https://s2.ripple.com:51234",
            "https://xrplcluster.com"
        ];

        const EXCHANGES = {
             "robinhood": {
        "rEAKseZ7yNgaDuxH74PkqB12cVWohpi7R6": "Robinhood1",
        "r4ZuQtPNXGRMKfPjAsn2J7gRqoQuWnTPFP": "Robinhood2"
    },
    "bitflyer": {
        "rpY7bZBkA98P8zds5LdBktAKj9ifekPdkE": "BitFlyer 3",
        "rhWVCsCXrkwTeLBg6DyDr7abDaHz3zAKmn": "BitFlyer 4"
    },
    "bitpoint": {
        "rwPbLSqTDYwvCsGZEzDTNo3SgzCwEjQdWZ": "BitPoint 1",
        "rfmMjAXq65hpAxEf1RLNQq6RgYTSVkQUW5": "BitPoint 2"
    },
    "bitget": {
        "rGDreBvnHrX1get7na3J4oowN19ny4GzFn": "Bitget Global"
    },
    "bitso": {
        "rLSn6Z3T8uCxbcd1oxwfGQN1Fdn5CyGujK": "Bitso 3"
    },
    "binance": {
        "rEb8TK3gBgk5auZkwc6sHnwrGVJH8DuaLh": "Binance 1",
        "rNU4eAowPuixS5ZCWaRL72UUeKgxcKExpK": "Binance 10",
        "rNxp4h8apvRis6mJf9Sh8C6iRxfrDWN7AV": "Binance 11",
        "rPJ5GFpyDLv7gqeB1uZVUBwDwi41kaXN5A": "Binance 12",
        "rPz2qA93PeRCyHyFCqyNggnyycJR1N4iNf": "Binance 13",
        "rhWj9gaovwu2hZxYW7p388P8GRbuXFLQkK": "Binance 14",
        "rarG6FaeYhnzSKSS5EEPofo4gFsPn2bZKk": "Binance 15",
        "rs8ZPbYqgecRcDzQpJYAMhSxSi5htsjnza": "Binance 5",
        "rDAE53VfMvftPB4ogpWGWvzkQxfht6JPxr": "Binance 6",
        "rfQ9EcLkU6WnNmkS3EwUkFeXeN47Rk8Cvi": "Binance 18",
        "rBtttd61FExHC68vsZ8dqmS3DfjFEceA1A": "Binance 9",
        "rLoqMgpjwGEQinYEM623za8c2nC2Uah8v7": "Binance 21",
        "rQUp2PKzH3vCtKs5H9tsPPE1rTsN6fhjqn": "Binance 22",
        "rEeEWeP88cpKUddKk37B2EZeiHBGiBXY3": "Binance US 1",
        "rMvYS27SYs5dXdFsUgpvv1CSrPsCz7ePF5": "Binance US 2",
        "r3ZVNKgkkT3A7hbEZ8HxnNnLDCCmZiZECV": "Binance US 3",
        "rPCpZwPKogNodbjRxGDnefVXu9Q9R4PN4Q": "Binance US 4",
        "rP3mUZyCDzZkTSd1VHoBbFt8HGm8fyq8qV": "Binance 17",
        "rDecw8UhrZZUiaWc91e571b3TL41MUioh7": "Binance 16",
        "rJpj1Mv21gJzsbsVnkp1U4nqchZbmZ9pM5": "Binance (XRP-BF2 Reserve)",
        "rfxbaKNt5SnMw5rPRRm4C53YK76MEnVXro": "Binance Charity2"
    },
    "bitpanda": {
        "rUEfYyerfok6Yo38tTTTZKeRefNh9iB1Bd": "Bitpanda1",
        "rhVWrjB9EGDeK4zuJ1x2KXSjjSpsDQSaU6": "Bitpanda2",
        "r3T75fuLjX51mmfb5Sk1kMNuhBgBPJsjza": "Bitpanda3",
        "rbrCJQZVk6jYra1MPuSvX3Vpe4to9fAvh":  "Bitpanda4"
    },

    "bitstamp": {
        "rDsbeomae4FXwgQTJp9Rs64Qg9vDiTCdBv": "Bitstamp1",
        "rUobSiUpYH2S97Mgb4E7b7HuzQj2uzZ3aD": "Bitstamp2",
        "rBMFF7vhe2pxYS5wo3dpXMDrbbRudB7hGf": "Bitstamp3",
        "rEXmdJZRfjXN3XGVdz99dGSZpQyJqUeirE": "Bitstamp"
    },
    "bitbank": {
        "rLbKbPyuvs4wc1h13BEPHgbFGsRXMeFGL6": "Bitbank1",
        "rw7m3CtVHwGSdhFjV4MyJozmZJv3DYQnsA": "Bitbank2",
        "rwggnsfxvCmDb3YP9Hs1TaGvrPR7ngrn7Z": "Bitbank3",
        "r97KeayHuEsDwyU1yPBVtMLLoQr79QcRFe": "Bitbank4"
    },
    "bitfinex": {
        "rLW9gnQo7BQhU6igk5keqYnH3TVrCxGRzm": "Bitfinex1",
        "rE3hWEGquaixF2XwirNbA1ds4m55LxNZPk": "Bitfinex2"
    },
    "bitrue": {
        "rKq7xLeTaDFCg9cdy9MmgxpPWS8EZf2fNq": "Bitrue1",
        "raLPjTYeGezfdb6crXZzcC8RkLBEwbBHJ5": "Bitrue2",
        "rfKsmLP6sTfVGDvga6rW6XbmSFUzc3G9f3": "Bitrue3",
        "rNYW2bie6KwUSYhhtcnXWzRy5nLCa1UNCn": "Bitrue Insurance Fund",
        "r4DbbWjsZQ2hCcxmjncr7MRjpXTBPckGa9": "Bitrue Cold2"
    },
    "bithumb": {
        "rPMM1dRp7taeRkbT74Smx2a25kTAHdr4N5": "Bithumb1",
        "rNTkgxs5WG5mU5Sz26YoDVrHim5Y5ohC7": "Bithumb2",
        "r9hUMZBc3MWRc4YdsdZgNCW5Qef8wNSXpb": "Bithumb3",
        "r9LHiNDZvpLoWPoKnbH2JWjFET8zoYT4Y5": "Bithumb4",
        "rD7XQw67JWBXuo2WPX2gZRsGKNsDUGTbx5": "Bithumb",
        "rZcBQae9iSJqFYBpNCfxGLXH7xuEzizxR": "Bithumb10",
        "rrsSUzrT2mYAMiL46pm7cwn6MmMmxVkEWM": "Bithumb11",
        "rPyCQm8E5j78PDbrfKF24fRC7qUAk1kDMZ": "Bithumb12",
        "rw3fRcmn5PJyPKuvtAwHDSpEqoW2JKmKbu": "Bithumb13"
    },
    "bitkub": {
        "rE3Cc3i6163Qzo7oc6avFQAxQE4gyCWhGP": "Bitkub 3"
    },
    "BTC Markes": {
        "r94JFtstbXmyG21h3RHKcNfkAHxAQ6HSGC": "BTC Markets 1",
        "rL3ggCUKaiR1iywkGW6PACbn3Y8g5edWiY": "BTC Markets 2",
        "rU7xJs7QmjbiyxpEozNYUFQxaRD5kueY7z": "BTC Markets 3",
        "rwWZxJQ8R2mvvtaFUJHhF6kfV64atBiPww": "BTC Markets 4",
        "r3zUhJWabAMMLT5n631r2wDh9RP3dN1bRy": "BTC Markets 5",
        "rKRYAqMFTTGMZ47eXJVRKcqLJgnPQbXisg": "BTC Markets 6"
    },

    "bybit": {
        "rMrgNBrkE6FdCjWih5VAWkGMrmerrWpiZt": "Bybit 1",
        "rNFKfGBzMspdKfaZdpnEyhkFyw7C1mtQ8x": "Bybit 2",
        "rJn2zAPdFA193sixJwuFixRkYDUtx3apQh": "Bybit 3",
        "rMvCasZ9cohYrSZRNYPTZfoaaSUQMfgQ8G": "Bybit 4",
        "rwBHqnCgNRnk3Kyoc6zon6Wt4Wujj3HNGe": "Bybit 5",
        "raQxZLtqurEXvH5sgijrif7yXMNwvFRkJN": "Bybit 6"
    },
    "coincheck": {
        "rNQEMJA4PsoSrZRn9J6RajAYhcDzzhf8ok": "Coincheck 1",
        "rwgvfze315jjAAxT2TyyDqAPzL68HpAp6v": "Coincheck 2",
        "r99QSej32nAcjQAri65vE5ZXjw6xpUQ2Eh": "Coincheck 3"
    },
    "coinbase": {
        "rLNaPoKeeBjZe2qs6x52yVPZpZ8td4dc6w": "Coinbase1",
        "rw2ciyaNshpHe7bCHo4bRWq6pqqynnWKQg": "Coinbase2",
        "rUfghnh1VAWajpAmxgrzLPiCXJ7RwdJUgt": "Coinbase3",
        "rwpTh9DDa52XkM9nTKp2QrJuCGV5d1mQVP": "Coinbase4",
        "r3YsZdkznVzYBv141qhwXHDWoPUXLdksNw": "Coinbase5",
        "r4sRyacXpbh4HbagmgfoQq8Q3j8ZJzbZ1J": "Coinbase6",
        "rUjfTQpvBr6wsGGxMw6sRmRQGG76nvp8Ln": "Coinbase7",
        "rRmgo6NW1W7GHjC5qEpcpQnq8NE74ZS1P": "Coinbase10",
        "rHrHuQM3E114yMyPjeULWfQmbwVBrHsBEy": "Coinbase11",
        "rLBunuhuRY7aUCnDkSQhaf5ewCvdcWUYjR": "Coinbase12",
        "rDw1Z5BqJejpKCGfncHJ9rwRq2kYLo4sJG": "Coinbase13",
        "rwnYLUsoBQX3ECa1A5bSKLdbPoHKnqf63J": "Coinbase14",
        "rsTtGH7a9mom5X8Y9D3kxroXWvA912RgUZ": "Coinbase (Cold 176)",
        "r9mkuV6bpvok7SZ8Zargiw5KzZHDFbaApy": "Coinbase (Cold 285)",
        "rNaJVWotxZ9nGTBiHRWR6LR1deXHa8FRLf": "Coinbase (Cold 418)",
        "rGG4LZruYFJ34PNCi1doapgA1hynz3gxX7": "Coinbase (Cold 125)",
        "rnVcQzWJP2sJbJF3GgvdAeqveW1V7dT2Vq": "Coinbase (Cold 283)",
        "r417XbsvuBJpkMC4eHtGpvAHxgC24mb6Nc": "Coinbase (Cold 193)",
        "rPeuuqP9rNhskesoA3ferKfp6VT5SvLAzU": "Coinbase (Cold 299)",
        "raMRJ2d3djqwSUBK28W31R7aJQfK21zU1C": "Coinbase (Cold 456)",
        "rBRaRTaq99U216NSDt7dFRrfzAtZzyrgS6": "Coinbase (Cold 188)",
        "rsVDKTbUceVQqNKrSzYj8HtkVcS7TuRWSN": "Coinbase (Cold 36)",
        "rBj8PDBTKKuXWJaWbaEtdkV8hq4oxRWhsB": "Coinbase (Cold 392)",
        "rMJbEvjzqVeGJHs5ySZvuF2dHhWKx69t6G": "Coinbase (Cold 100)",
        "rw4rHH5LrTUZ5WDXieCPT14E89PwnmXtoV": "Coinbase (Cold 48)",
        "rNbMpc8JgLKnXs51KVYAmt4zbDvE8kgQEi": "Coinbase (Cold 232)",
        "rnaxGortNCoxkWUq18jCGmQDeCrLBmiz42": "Coinbase (Cold 92)",
        "rMsfxSZfdj3F1vBeVRte6b83LMV4AtZAHX": "Coinbase (Cold 434)",
        "rf9CWxJKUwHm4eZo3Z8SHi6Z1D6RoqFqqq": "Coinbase (Cold 196)",
        "rKmcvfZ4AeVCsJDNLZg3Xwbs86F33sC6bR": "Coinbase (Cold 78)",
        "rnYzsCmvD35kBntkY5g4kf7hStMGKSQfwz": "Coinbase (Cold 149)",
        "rJQC2RzzALgus6ZZgu34nXnpz67v3bRSzi": "Coinbase (Cold 210)",
        "r939VcVXx5Zx9wJ1TL61StPEKaqaYf75XQ": "Coinbase (Cold 104)",
        "r9rg8WT6KPXE8FGYbsGG6YaEG6wrbLxqF9": "Coinbase (Cold 206)",
        "rGoDpsHfkkSvNatyXHZPiJk7qydd7uahQz": "Coinbase (Cold 183)",
        "raQ3drgGw2eFHTnck6SZxKe2JhQr8Lm8w1": "Coinbase (Cold 108)",
        "rnWnrbjNw5Ezdqy51a769Rror8U3xRkYxK": "Coinbase (Cold 137)",
        "rwTjgH22nenAtDpPWy4g7xPhBqhVU845Az": "Coinbase (Cold 265)",
        "rBAzrxLFZSqni5K67kPqX3WN7VLDTcUVWJ": "Coinbase (Cold 375)",
        "rnioNuMG47FKY7sZ82EtKt1kBfD4Lg5M4S": "Coinbase (Cold 122)",
        "rMAxoQbdkCHYpH9VTmdiyrR1F7T4Yvyk2k": "Coinbase (Cold 400)",
        "rUejaQ5zgB7fMKhj72SPK7xAdGo6ujx2ca": "Coinbase (Cold 87)",
        "rGK3t5Ppw46RciqcHtrUtvcvhD7M99HJvU": "Coinbase (Cold 379)",
        "rUb2Ds39TAXnnbKekuUmJsZk11BaenHWHG": "Coinbase (Cold 353)",
        "rJZkhPxEbvpyuM1tPV2YfkSgSmFPwP4Af6": "Coinbase (Cold 414)",
        "r9gGyhLJNhWRUPEXbcGXR7HowrAgQL4i4B": "Coinbase (Cold 155)",
        "rHCwZG3cNaKSr3aANX36m4McU3pLAj91Jr": "Coinbase (Cold 197)",
        "rLex7Hn4VFotWPCzE1xXnPtx1GfqTzLnJi": "Coinbase (Cold 394)",
        "rEe4cm8ZvQSMS4h4Jwuj3RtCVwqATwZ1sK": "Coinbase (Cold 396)",
        "ram3dNqeea6s9HpyH8ANoFMSTW78Gk3gBv": "Coinbase (Cold 146)",
        "rGthywLPxJPsmCZaWuA7K6xZ5EYJLjoq7e": "Coinbase (Cold 345)",
        "rKt48W1Eg5M6DWD1CkDDYioA7Civ8zEjiy": "Coinbase (Cold 324)",
        "rEEKHC9pyscnFz5hqMEe8dMQY5j1ymLC3Y": "Coinbase (Cold 259)",
        "rnkzrdCPPHhHTEu5XMfmLw2Z5wq9ZNJxFM": "Coinbase (Cold 333)",
        "rNdTXdz2fABUprp4LrvknEiqYXkvpzN4kx": "Coinbase (Cold 248)",
        "rMgdeXXHKpnFi9FUZQgZRc73gDFjVK8PMN": "Coinbase (Cold 290)",
        "rs4qVgzVsYTeTv9Fh5URf6CDeNn22AxXax": "Coinbase (Cold 43)",
        "rUFDke2TLvmLQaAH6LZYmURAfQ1SCQDSLt": "Coinbase (Cold 135)",
        "rJUkHKXn7fonFnYs5aP1igXZ3Y1xzKB1": "Coinbase (Cold 321)",
        "rL2kYqQW7BThQrEVzf1SgohWnXV7adWfqf": "Coinbase (Cold 298)",
        "rHvCuXyoLzurq45ZNy91kzDmGJLqjf42Z8": "Coinbase (Cold 74)",
        "r4VDPsS5yatqpkdBoJxNWh3TWWXTnmR62r": "Coinbase (Cold 31)",
        "rQrYaxwU6vFvA37maEVcs1hLGgxFDxaKZn": "Coinbase (Cold 395)",
        "raon8BEsrawPug1yEs8ChX4ccEC4bhbEbw": "Coinbase (Cold 136)",
        "rNqCrZDNfW3apqmrk94AuAdy35eW5jB2pP": "Coinbase (Cold 181)",
        "rfJL7vFfPsXLhjTctNJJf443tASrrs1Nap": "Coinbase (Cold 409)",
        "rME6BCc8wFqLFtD6yGDMChPEpChN59VCym": "Coinbase (Cold 300)",
        "rNx5iPejwegrf6CXgWNsZMGXgj4C2e2QGo": "Coinbase (Cold 187)",
        "r4pUXa53aRzH11u2ZrPLk1tuM5mFayXwZM": "Coinbase (Cold 403)",
        "rKrur5amu1cx5ZMdfZ7QdwTLyQta7dXzWW": "Coinbase (Cold 141)",
        "rhDUYzz8faQi1NkAkD4UqPGhHVtMML4uY1": "Coinbase (Cold 233)",
        "rH2JhAxcApv8tEJa62jzGZFYgf77NduFDP": "Coinbase (Cold 143)",
        "rp8XdQLjn41ao7CNHyorP4hS8fbPbACoEw": "Coinbase (Cold 247)",
        "rJT8GJhJaiugYSgZW6HuZmaGXYKudNXFbw": "Coinbase (Cold 384)",
        "rsXm9nBire6zqajappuFPLJuydvHDuqz8g": "Coinbase (Cold 124)",
        "rhhJhWUpU7A1enRxKAmWqyV5c9Y1xrVQTm": "Coinbase (Cold 157)",
        "rPQmWocoQACFezEbQmmcRPSEhRxqp1Ksz9": "Coinbase (Cold 302)",
        "rGCc2ah3xtnizjpH3gd2wQm6R837eaULa4": "Coinbase (Cold 438)",
        "r9ZMdQ63S8NvgdCyLpfhkdbWDfQ57eKD9c": "CoinbaseCold366"
    },
    "coinone": {
        "rp2diYfVtpbgEMyaoWnuaWgFCAkqCAEg28": "Coinone1",
        "rPsmHDMkheWZvbAkTA8A9bVnUdadPn7XBK": "Coinone2",
        "rhuCPEoLFYbpbwyhXioSumPKrnfCi3AXJZ": "Coinone3",
        "rMksM39efoP4XyAqEjzFUEowwnVbQTh6KW": "Coinone4",
        "rDKw32dPXHfoeGoD3kVtm76ia1WbxYtU7D": "Coinone5"
    },
    "coinjar": {
        "rPvKH3CoiKnne5wAYphhsWgqAEMf1tRAE7": "Coinjar"
    },
    "crypto.com": {
        "r4DymtkgUAh2wqRxVfdd3Xtswzim6eC6c5": "Crypto.com 1",
        "rPHNKf25y3aqATYfrMv9LQnTRHQUYELXfn": "Crypto.com 2",
        "rJmXYcKCGJSayp4sAdp6Eo4CdSFtDVv7WG": "Crypto.com 3",
        "rKNwXQh9GMjaU8uTqKLECsqyib47g5dMvo": "Crypto.com 4",
        "rKV8HEL3vLc6q9waTiJcewdRdSFyx67QFb": "Crypto Exchange"
    },
    "Doppler Finance": {
        "rprFy94qJB5riJpMmnPDp3ttmVKfcrFiuq": "Doppler Finance 1",
        "rEPQxsSVER2r4HeVR4APrVCB45K68rqgp2": "Doppler Finance 2"
    },

    "firi": {
        "raJHqa1o57DwjtrLCZjdkMKRtfHnbrwSse": "Firi"
    },
    "etoro": {
        "rsdvR9WZzKszBogBJrpLPE64WWyEW4ffzS": "eToro1",
        "raQ9yYPNDQwyeqAAX9xJgjjQ7wUtLxJ5JV": "eToro2",
        "rBMe3zVBLgeh2QN4CeX6B17zwbcN6JEmZB": "eToro3",
        "rEvwSpejhGTbdAXbxRTpGAzPBQkBRZxN5s": "eToro4",
        "rM9EyDmjxeukZGT6wfkxncqeM3ABJsro3a": "eToro5"
    },
    "gate.io": {
        "rHcFoo6a9qT5NHiVn1THQRhsEGcxtYCV4d": "Gate.io 1",
        "rLzxZuZuAHM7k3FzfmhGkXVwScM4QSxoY7": "Gate.io 2",
        "rNnWmrc1EtNRe5SEQEs9pFibcjhpvAiVKF": "Gate.io 3",
        "rNu9U5sSouNoFunHp9e9trsLV6pvsSf54z": "Gate.io 4"
    },
    "gemini": {
        "raBQUYdAhnnojJQ6Xi3eXztZ74ot24RDq1": "Gemini1",
        "raq2gccLh11AwvBrpYcHntUTv4xQNRpyyG": "Gemini2",
        "rBYpyCjNwBDQFrgEdVfyosSgQS6iL6sTHe": "Gemini3"
    },
    "kraken": {
        "rLHzPsX6oXkzU2qL12kHCH8G8cnZv1rBJh": "Kraken1",
        "rUeDDFNp2q7Ymvyv75hFGC8DAcygVyJbNF": "Kraken2",
        "rGZjPjMkfhAqmc1ssEiT753uAgyftHRo2m": "Kraken3",
        "rp7TCczQuQo61dUo1oAgwdpRxLrA8vDaNV": "Kraken4",
        "rEvuKRoEbZSbM5k5Qe5eTD9BixZXsfkxHf": "Kraken5",
        "rnJrjec2vrTJAAQUTMTjj7U6xdXrk9N4mT": "Kraken6",
        "rHapXGCL7KXTovvpEqLfDiZ6WV7vMhPWGJ": "Kraken7"
    },
    "KuCoin": {
         "rLpvuHZFE46NUyZH5XaMvmYRJZF7aory7t": "Kucoin11",
         "rNFugeoj3ZN8Wv6xhuLegUBBPXKCyWLRkB": "Kucoin5",
         "rBxszqhQkhPALtkSpGuVeqR6hNtZ8xTH3T": "Kucoin7",
         "rp4gqz1XdqMsWRZbzPdPAQWw1tg5LuwUVP": "Kucoin8"
    },
    "luno": {
        "rsRy14FvipgqudiGmptJBhr1RtpsgfzKMM": "Luno1",
        "rsbfd5ZYWqy6XXf6hndPbRjDAzfmWc1CeQ": "Luno2"
    },
    "mexc": {
        "rs2dgzYeqYqsk8bvkQR5YPyqsXYcA24MP2": "Mexc"
    },
    "mercadobitcoin": {
        "rnW8je5SsuFjkMSWkgfXvqZH3gLTpXxfFH": "Mercado Bitcoin 1",
        "rPEPYN8sHU3cytBwVm69qPbVztaoj7wNf": "Mercado Bitcoin 3"
    },
    "okx": {
        "rUzWJkXyEtT8ekSSxkBYPqCvHpngcy6Fks": "Okx"
    },
    "paribu": {
        "rM9e4hDCEu4hY8SESypL9ymM2sMauDCncf": "Paribu 3"
    },
    "tradeogre": {
        "rhsZa1NR9GqA7NtQjDe5HtYWZxPAZ4oGrE": "TradeOgre"
    },
    "uphold": {
        "rQrQMKhcw3WnptGeWiYSwX5Tz3otyJqPnq": "Uphold2",
        "rMdG3ju8pgyVh29ELPWaDuA74CpWW6Fxns": "Uphold3",
        "rBEc94rUFfLfTDwwGN7rQGBHc883c2QHhx": "Uphold4",
        "rsX8cp4aj9grKVD9V1K2ouUBXgYsjgUtBL": "Uphold8",
        "rErKXcbZj9BKEMih6eH6ExvBoHn9XLnTWe": "Uphold9",
        "rKe7pZPwdKEubmEDCAu9djJVsQfK4Atmzr": "Uphold11",
        "rsXT3AQqhHDusFs3nQQuwcA1yXRLZJAXKw": "uphold12"
    },
    "upbit": {
        "raQwCVAJVqjrVm1Nj5SFRcX8i22BhdC9WA": "Upbit1",
        "rfL1mn4VTCoHdhHhHMwqpShCFUaDBRk6Z5": "Upbit12",
        "rwa7YXssGVAL9yPKw6QJtCen2UqZbRQqpM": "Upbit13",
        "rNcAdhSLXBrJ3aZUq22HaNtNEPpB5fR8Ri": "Upbit14",
        "r38a3PtqW3M7LRESgaR4dyHjg3AxAmiZCt": "Upbit15",
        "rMNUAfSz2spLEbaBwPnGtxTzZCajJifnzH": "Upbit16",
        "rJWbw1u3oDDRcYLFqiWFjhGWRKVcBAWdgp": "Upbit17",
        "rs48xReB6gjKtTnTfii93iwUhjhTJsW78B": "Upbit18",
        "rJo4m69u9Wd1F8fN2RbgAsJEF6a4hW1nSi": "Upbit19",
        "rLgn612WAgRoZ285YmsQ4t7kb8Ui3csdoU": "Upbit20",
        "r4G689g4KePYLKkyyumM1iUppTP4nhZwVC": "Upbit21",
        "rDxJNbV23mu9xsWoQHoBqZQvc77YcbJXwb": "Upbit22",
        "rHHQeqjz2QyNj1DVoAbcvfaKLv7RxpHMNE": "Upbit23"
    },
     "sbi": {
        "rNRc2S2GSefSkTkAiyjE6LDzMonpeHp6jS": "SBI VC TRADE 4",
        "raSZXZApFg7Nj1B5G6BnhoL6HcTqVMopJ3": "SBI VC Trade 5",
        "r39uEuRjzLaSgvkjTfcejodbSrXLM3cYnX": "SBI VC Trade 6",
        "rDDyH5nfvozKZQCwiBrWfcE528sWsBPWET": "SBI VC Trade 1",
        "rKcVYzVK1f4PhRFjLhWP7QmteG5FpPgRub": "SBI VC Trade 2",
        "rUaESVd1yLMy5VyoJvwwuqE8ZiCb2PEqBR": "SBI VC Trade 3"
    },

    "stake": {
        "rnqZnvzoJjdg7n1P9pmumJ7FQ5wxNH3gYC": "Stake1",
        "razLtrbzXVXYvViLqUKLh8YenGLJid9ZTW": "Stake2",
        "rBA7oBScBPccjDcemGhkmCY82v2ZeLa2K2f": "Stake3",
        "rBndy89HdamJ3UHNekAS6ALjW9WoCE2W5s": "Stake4"
    },
    "korbit": {
        "rBTjeJu1Rvnbq476Y7PDnvnXUeERV9CxEQ": "Korbit1",
        "rJRarS792K6LTqHsFkZGzM1Ue6G8jZ2AfK": "Korbit2",
        "rGU8q9qNCCQG2eMgJpLJJ1YFF5JAbntqau": "Korbit3",
        "r9WGxuEbUSh3ziYt34mBRViPbqVxZmwsu3": "Korbit4",
        "rNWWbLxbZRKd51NNZCEjoSNovrrx7yiPyt": "Korbit5",
        "rGq74nAmw1ARejUNLYEBGxiQBaoNtryEe9": "Korbit6",
        "rsYFhEk4uFvwvvKJomHL7KhdF29r2sw9KD": "Korbit7",
        "rwnXZEUe7o29SPcWZwnZukR8fdXmFMWHAN": "Korbit8"
    },
    "swissbirg": {
        "rfyE1wqH1YY3u6BcauQwYuoD13GVtJErXq": "SwissBirg 3"
    },
    "virtune": {
        "rnaiDK2aDkDCCoRk3n9oyzbrtBcGPdHL2t": "Virtune"
    },
    "Evernorth": {
        "rsT3yYMkuicxW1hYsy787mg5XHhkz2uQRk": "Evernorth1",
        "rKXXrAgpkHQN8m4HxAQCYmDCPPUByc9mVq": "Evernorth2",
        "rKhjV48GdbgxAAfSvusqGNktGwAxnzzXpv": "Evernorth3",
        "rGJBNGkDeRPNvNJCi57Ht1ncdht9SuctLe": "Evernorth4",
        "rJX1qoSGYmx5NWJEpsBGKvxmYpGR7mDtop": "Evernorth5", 
        "rJuyHPDFpfeVhxfxZboTf7BYu1ptGus1v3": "Evernorth6",
        "rUgQciCPP1AiwQ9f5zstYu9RzVfsKQRGc2": "Evernorth7",
        "rPhQdyEaz4kcSoYKTAQhvkvdYxWKKw2vSC": "Evernorth8",
        "rGy4zJtGfGtF7dtjZmBraQTcfZSQgwqpaa": "Evernorth9"
		}
        };

        // Historical Balances - February 24, 2025 Benchmark
        const HISTORICAL_BALANCES = {
            "r38a3PtqW3M7LRESgaR4dyHjg3AxAmiZCt": 500000022,
            "r4G689g4KePYLKkyyumM1iUppTP4nhZwVC": 500000023,
            "rDxJNbV23mu9xsWoQHoBqZQvc77YcbJXwb": 980472688,
            "rJWbw1u3oDDRcYLFqiWFjhGWRKVcBAWdgp": 500000022,
            "rJo4m69u9Wd1F8fN2RbgAsJEF6a4hW1nSi": 500000022,
            "rLgn612WAgRoZ285YmsQ4t7kb8Ui3csdoU": 500000022,
            "rMNUAfSz2spLEbaBwPnGtxTzZCajJifnzH": 500000022,
            "rNcAdhSLXBrJ3aZUq22HaNtNEPpB5fR8Ri": 500000070,
            "raQwCVAJVqjrVm1Nj5SFRcX8i22BhdC9WA": 5380330,
            "rfL1mn4VTCoHdhHhHMwqpShCFUaDBRk6Z5": 500000113,
            "rs48xReB6gjKtTnTfii93iwUhjhTJsW78B": 500000022,
            "rwa7YXssGVAL9yPKw6QJtCen2UqZbRQqpM": 500000111,
            "rEb8TK3gBgk5auZkwc6sHnwrGVJH8DuaLh": 7375,
            "rNU4eAowPuixS5ZCWaRL72UUeKgxcKExpK": 6152514,
            "rNxp4h8apvRis6mJf9Sh8C6iRxfrDWN7AV": 268204,
            "rPJ5GFpyDLv7gqeB1uZVUBwDwi41kaXN5A": 109917943,
            "rPz2qA93PeRCyHyFCqyNggnyycJR1N4iNf": 661827727,
            "rhWj9gaovwu2hZxYW7p388P8GRbuXFLQkK": 4831865,
            "rLHzPsX6oXkzU2qL12kHCH8G8cnZv1rBJh": 25860812,
            "rUeDDFNp2q7Ymvyv75hFGC8DAcygVyJbNF": 265582363,
            "rp7TCczQuQo61dUo1oAgwdpRxLrA8vDaNV": 290523350,
            "rJn2zAPdFA193sixJwuFixRkYDUtx3apQh": 4653377,
            "rMvCasZ9cohYrSZRNYPTZfoaaSUQMfgQ8G": 116576792,
            "raQxZLtqurEXvH5sgijrif7yXMNwvFRkJN": 147378587,
            "rwBHqnCgNRnk3Kyoc6zon6Wt4Wujj3HNGe": 57941994,
            "rNRc2S2GSefSkTkAiyjE6LDzMonpeHp6jS": 318277941
        };
        const HISTORICAL_DATE = "Feb 24, 2025";

        let exchangeData = {};
        let walletBalances = {}; // Store individual wallet balances
        let isExchangeFetching = false;
        let exchangeDataTimestamp = null;
        let lastManualRefresh = null;
        const EXCHANGE_CACHE_DURATION = 60 * 60 * 1000; // 1 hour cache
        const MANUAL_REFRESH_COOLDOWN = 15 * 60 * 1000; // 15 min cooldown for manual refresh
        
        // Analytics data
        let analyticsData = {};
        let analyticsChart = null;
        let absoluteChangeChart = null;
        let percentChangeChart = null;

        // Top 10K Rich List data
        let whaleDataFull = []; // Full 10K dataset
        let whaleData = []; // Currently displayed subset
        let isWhaleFetching = false;
        let whaleDataTimestamp = null;
        let lastWhaleManualRefresh = null;
        let whaleCount = 25; // Display count
        let whaleSortColumn = 'rank';
        let whaleSortAsc = true;
        let whaleDistributionChart = null;
        let burnData = null; // XRP burn tracking data
        const WHALE_CACHE_DURATION = 60 * 60 * 1000; // 1 hour cache
        const WHALE_REFRESH_COOLDOWN = 15 * 60 * 1000; // 15 min cooldown
        const RICH_LIST_API = 'https://api.xrpscan.com/api/v1/richlist';
        const LEDGER_API = 'https://api.xrpscan.com/api/v1/ledgers';
        
        // localStorage cache keys
        const CACHE_KEYS = {
            exchangeData: 'xrp_etf_exchange_data',
            exchangeTimestamp: 'xrp_etf_exchange_timestamp',
            exchangeLastRefresh: 'xrp_etf_exchange_last_refresh',
            whaleData: 'xrp_etf_whale_data',
            whaleTimestamp: 'xrp_etf_whale_timestamp',
            whaleLastRefresh: 'xrp_etf_whale_last_refresh',
            burnData: 'xrp_etf_burn_data'
        };
        
        // localStorage helper functions
        function saveToCache(key, data) {
            try {
                localStorage.setItem(key, JSON.stringify(data));
            } catch (e) {
                console.warn('localStorage save failed:', e);
            }
        }
        
        function loadFromCache(key) {
            try {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : null;
            } catch (e) {
                console.warn('localStorage load failed:', e);
                return null;
            }
        }

        // Known addresses for labeling
        const KNOWN_ADDRESSES = {
            "rEb8TK3gBgk5auZkwc6sHnwrGVJH8DuaLh": "Binance",
            "rPz2qA93PeRCyHyFCqyNggnyycJR1N4iNf": "Binance",
            "rPJ5GFpyDLv7gqeB1uZVUBwDwi41kaXN5A": "Binance",
            "rLHzPsX6oXkzU2qL12kHCH8G8cnZv1rBJh": "Uphold",
            "rUeDDFNp2q7Ymvyv75hFGC8DAcygVyJbNF": "Uphold",
            "rp7TCczQuQo61dUo1oAgwdpRxLrA8vDaNV": "Uphold",
            "rNRc2S2GSefSkTkAiyjE6LDzMonpeHp6jS": "Bitso",
            "raQxZLtqurEXvH5sgijrif7yXMNwvFRkJN": "Kraken",
            "rMvCasZ9cohYrSZRNYPTZfoaaSUQMfgQ8G": "Bitstamp",
            "rwBHqnCgNRnk3Kyoc6zon6Wt4Wujj3HNGe": "Coinbase",
            "rEAKseZ7yNgaDuxH74PkqB12cVWohpi7R6": "Robinhood",
            "r4ZuQtPNXGRMKfPjAsn2J7gRqoQuWnTPFP": "Robinhood",
            "rDsbeomae4FXwgQTJp9Rs64Qg9vDiTCdBv": "Bitstamp",
            "rLW9gnQo7BQhU6igk5keqYnH3TVrCxGRzm": "Bitfinex",
            "rhub8VRN55s94qWKDv6jmDy1pUykJzF3wq": "GateHub",
            "rHWcuuZoFvDS6gNbmHSdpb7u1hZzxvCoMt": "GateHub",
            "rKq7xLeTaDFCg9cdy9MmgxpPWS8EZf2fNq": "Bitrue",
            "rPMM1dRp7taeRkbT74Smx2a25kTAHdr4N5": "Bithumb",
            "rGDreBvnHrX1get7na3J4oowN19ny4GzFn": "Bitget",
            "rN7n3473SaZBCG4dFL83w7a1RXtXtbk2D9": "Ripple",
            "rHb9CJAWyB4rj91VRWn96DkukG4bwdtyTh": "Genesis",
            "rrrrrrrrrrrrrrrrrrrrrhoLvTp": "Escrow"
        };

        async function fetchSingleBalance(address) {
            for (const url of RIPPLED_URLS) {
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            method: 'account_info',
                            params: [{
                                account: address,
                                ledger_index: 'validated',
                                strict: true
                            }]
                        })
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        if (data.result && data.result.account_data) {
                            return parseInt(data.result.account_data.Balance) / 1000000;
                        }
                    }
                } catch (error) {
                    continue;
                }
            }
            return null;
        }

        async function fetchExchangeData(forceRefresh = false) {
            // Try to load from localStorage first
            if (!exchangeDataTimestamp && !forceRefresh) {
                const cachedData = loadFromCache(CACHE_KEYS.exchangeData);
                const cachedTime = loadFromCache(CACHE_KEYS.exchangeTimestamp);
                const cachedRefresh = loadFromCache(CACHE_KEYS.exchangeLastRefresh);
                if (cachedData && cachedTime) {
                    const cacheAge = Date.now() - cachedTime;
                    if (cacheAge < EXCHANGE_CACHE_DURATION) {
                        exchangeData = cachedData;
                        exchangeDataTimestamp = cachedTime;
                        lastManualRefresh = cachedRefresh;
                        console.log('Loaded exchange data from localStorage');
                    }
                }
            }
            
            // Check manual refresh cooldown
            if (forceRefresh && lastManualRefresh) {
                const cooldownRemaining = MANUAL_REFRESH_COOLDOWN - (Date.now() - lastManualRefresh);
                if (cooldownRemaining > 0) {
                    const mins = Math.ceil(cooldownRemaining / 60000);
                    const statusEl = document.getElementById('exchangeStatus');
                    statusEl.innerHTML = `<span style="color: var(--accent-orange);"> Refresh in ${mins}m</span>`;
                    
                    // Show toast notification
                    showToast(`Please wait ${mins} minutes before refreshing again`, 'warning');
                    return;
                }
            }
            
            // Check if we have cached data that's still valid
            if (!forceRefresh && exchangeDataTimestamp && Object.keys(exchangeData).length > 0) {
                const cacheAge = Date.now() - exchangeDataTimestamp;
                if (cacheAge < EXCHANGE_CACHE_DURATION) {
                    // Use cached data
                    renderExchangeTable();
                    const remainingMs = EXCHANGE_CACHE_DURATION - cacheAge;
                    const remainingMins = Math.ceil(remainingMs / 60000);
                    const displayTime = remainingMins > 60 
                        ? `${Math.floor(remainingMins / 60)}h ${remainingMins % 60}m` 
                        : `${remainingMins}m`;
                    document.getElementById('exchangeStatus').innerHTML = 
                        `<span style="color: var(--accent-green);"> Cached (${displayTime})</span>`;
                    updateDashboardOverview();
                    return;
                }
            }

            if (isExchangeFetching) return;
            isExchangeFetching = true;
            
            // Update global status
            updateStatus('loading', 'Loading exchanges...');
            updateDashboardOverview(); // Update dashboard to show loading

            const btn = document.getElementById('fetchExchangeBtn');
            const statusEl = document.getElementById('exchangeStatus');
            const tableBody = document.getElementById('exchangeTableBody');
            
            btn.disabled = true;
            btn.textContent = ' Fetching...';
            statusEl.innerHTML = '<span style="color: var(--accent-orange);"> Fetching...</span>';
            
            tableBody.innerHTML = `
                <tr>
                    <td colspan="6" style="text-align: center; padding: 3rem;">
                        <div class="spinner" style="margin: 0 auto 1rem;"></div>
                        <p style="color: var(--text-muted);">Fetching balances from XRPL nodes...</p>
                        <div class="exchange-progress">
                            <div class="exchange-progress-bar" id="exchangeProgressBar" style="width: 0%"></div>
                        </div>
                        <p id="exchangeProgressText" style="color: var(--text-muted); font-size: 0.8rem; margin-top: 0.5rem;">0 / 0</p>
                    </td>
                </tr>
            `;

            exchangeData = {};
            walletBalances = {}; // Store individual wallet balances
            let totalAddresses = 0;
            let fetchedAddresses = 0;

            // Count total addresses
            for (const [exchange, wallets] of Object.entries(EXCHANGES)) {
                totalAddresses += Object.keys(wallets).length;
            }

            // Fetch balances for each exchange
            for (const [exchangeName, wallets] of Object.entries(EXCHANGES)) {
                let exchangeTotal = 0;
                let walletCount = 0;
                let successCount = 0;
                const walletData = {}; // Store individual wallet data for this exchange

                for (const [address, walletName] of Object.entries(wallets)) {
                    const balance = await fetchSingleBalance(address);
                    fetchedAddresses++;
                    
                    // Update progress
                    const progress = (fetchedAddresses / totalAddresses) * 100;
                    document.getElementById('exchangeProgressBar').style.width = progress + '%';
                    document.getElementById('exchangeProgressText').textContent = 
                        `${fetchedAddresses} / ${totalAddresses} wallets`;

                    if (balance !== null) {
                        exchangeTotal += balance;
                        successCount++;
                        walletData[address] = {
                            name: walletName,
                            balance: balance
                        };
                        // Also store in global wallet balances
                        walletBalances[address] = balance;
                    } else {
                        walletData[address] = {
                            name: walletName,
                            balance: null
                        };
                    }
                    walletCount++;
                }

                exchangeData[exchangeName] = {
                    total: exchangeTotal,
                    walletCount: walletCount,
                    successCount: successCount,
                    wallets: walletData // Store individual wallet data
                };
            }

            renderExchangeTable();
            
            // Save timestamp for cache
            exchangeDataTimestamp = Date.now();
            lastManualRefresh = Date.now();
            
            // Save to localStorage for persistence
            saveToCache(CACHE_KEYS.exchangeData, exchangeData);
            saveToCache(CACHE_KEYS.exchangeTimestamp, exchangeDataTimestamp);
            saveToCache(CACHE_KEYS.exchangeLastRefresh, lastManualRefresh);
            console.log('Exchange data saved to localStorage');
            
            // Calculate next refresh time
            const nextRefreshMins = Math.ceil(MANUAL_REFRESH_COOLDOWN / 60000);
            
            btn.disabled = false;
            btn.textContent = ' Refresh Data';
            statusEl.innerHTML = `<span style="color: var(--accent-green);"> Live</span> <span style="color: var(--text-muted); font-size: 0.75rem;">(cached for 1h)</span>`;
            isExchangeFetching = false;
            
            // Update global status and dashboard
            updateStatus('success', 'Live');
            updateDashboardOverview();
            
            // Start countdown timer for button
            startRefreshCountdown();
        }
        
        function startRefreshCountdown() {
            const btn = document.getElementById('fetchExchangeBtn');
            const statusEl = document.getElementById('exchangeStatus');
            
            const updateCountdown = () => {
                if (!lastManualRefresh) return;
                
                const cooldownRemaining = MANUAL_REFRESH_COOLDOWN - (Date.now() - lastManualRefresh);
                
                if (cooldownRemaining <= 0) {
                    btn.disabled = false;
                    btn.textContent = ' Refresh Data';
                    statusEl.innerHTML = '<span style="color: var(--accent-green);"> Ready to refresh</span>';
                    return;
                }
                
                const mins = Math.floor(cooldownRemaining / 60000);
                const secs = Math.floor((cooldownRemaining % 60000) / 1000);
                
                btn.disabled = true;
                btn.textContent = ` ${mins}:${secs.toString().padStart(2, '0')}`;
                
                setTimeout(updateCountdown, 1000);
            };
            
            updateCountdown();
        }
        
        function showToast(message, type = 'info') {
            // Remove existing toast
            const existingToast = document.querySelector('.toast-notification');
            if (existingToast) existingToast.remove();
            
            const toast = document.createElement('div');
            toast.className = 'toast-notification';
            toast.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: ${type === 'warning' ? 'rgba(249, 115, 22, 0.95)' : 'rgba(35, 247, 221, 0.95)'};
                color: ${type === 'warning' ? 'white' : '#0f172a'};
                padding: 1rem 1.5rem;
                border-radius: 12px;
                font-size: 0.9rem;
                font-weight: 500;
                z-index: 10000;
                box-shadow: 0 10px 40px rgba(0,0,0,0.3);
                animation: slideInToast 0.3s ease;
            `;
            toast.textContent = message;
            
            // Add animation keyframes if not exists
            if (!document.getElementById('toastStyles')) {
                const style = document.createElement('style');
                style.id = 'toastStyles';
                style.textContent = `
                    @keyframes slideInToast {
                        from { opacity: 0; transform: translateX(100px); }
                        to { opacity: 1; transform: translateX(0); }
                    }
                `;
                document.head.appendChild(style);
            }
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideInToast 0.3s ease reverse';
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }

        function renderExchangeTable() {
            const tableBody = document.getElementById('exchangeTableBody');
            
            // Sort exchanges by total balance
            const sortedExchanges = Object.entries(exchangeData)
                .sort((a, b) => b[1].total - a[1].total);

            // Calculate grand total
            let grandTotal = sortedExchanges.reduce((sum, [_, data]) => sum + data.total, 0);

            // Update summary
            document.getElementById('exchangeTotalXRP').textContent = formatHoldingsNumber(grandTotal);
            if (currentXRPPrice) {
                document.getElementById('exchangeTotalValue').textContent = 
                    formatHoldingsCurrency(grandTotal * currentXRPPrice);
            }
            document.getElementById('exchangeCount').textContent = sortedExchanges.length;
            document.getElementById('exchangeResultCount').textContent = 
                `${sortedExchanges.length} exchanges loaded`;

            // Build table rows
            let rows = '';
            sortedExchanges.forEach(([name, data], index) => {
                const marketShare = grandTotal > 0 ? (data.total / grandTotal * 100) : 0;
                const valueUSD = currentXRPPrice ? data.total * currentXRPPrice : 0;
                
                rows += `
                    <tr>
                        <td style="text-align: left; font-weight: 600; color: var(--accent-xrp);">#${index + 1}</td>
                        <td style="text-align: left; text-transform: capitalize;">${name}</td>
                        <td>${formatHoldingsNumber(data.total)}</td>
                        <td>${currentXRPPrice ? formatHoldingsCurrency(valueUSD) : ''}</td>
                        <td>${marketShare.toFixed(2)}%</td>
                        <td>${data.successCount}/${data.walletCount}</td>
                    </tr>
                `;
            });

            // Add total row
            rows += `
                <tr class="total-row">
                    <td></td>
                    <td style="text-align: left;"><strong>TOTAL</strong></td>
                    <td><strong>${formatHoldingsNumber(grandTotal)}</strong></td>
                    <td><strong>${currentXRPPrice ? formatHoldingsCurrency(grandTotal * currentXRPPrice) : ''}</strong></td>
                    <td><strong>100%</strong></td>
                    <td></td>
                </tr>
            `;

            tableBody.innerHTML = rows;
            
            // Render exchange charts
            renderExchangeCharts();
        }

        function filterExchangeTable() {
            const filter = document.getElementById('exchangeFilter').value.toLowerCase();
            const rows = document.querySelectorAll('#exchangeTableBody tr:not(.total-row)');
            
            rows.forEach(row => {
                const exchangeName = row.cells[1]?.textContent.toLowerCase() || '';
                row.style.display = exchangeName.includes(filter) ? '' : 'none';
            });
        }

        // =====================================================
        // EXISTING ETF TRADING TRACKER CODE BELOW
        // =====================================================

        const descriptions = {
            'EZPZ': 'Franklin Templeton',
            'GDLC': 'Grayscale Digital Large Cap',
            'NCIQ': 'Hashdex Nasdaq Crypto Index',
            'BITW': 'Bitwise 10 Crypto Index',
            'GXRP': 'Grayscale',
            'XRP': 'Bitwise XRP',
            'XRPC': 'Canary Capital XRP',
            'XRPZ': 'Franklin XRP',
            'TOXR': '21Shares',
            'UXRP': 'ProShares Ultra',
            'XRPI': 'Volatility Shares Trust',
            'XRPM': 'Amplify',
            'XRPR': 'REX-Osprey',
            'XRPK': 'T-REX 2X Long',
            'XRPT': 'Volatility Shares 2x',
            'XXRP': 'Teucrium 2x Long',
            'XRP.TO': 'Purpose',
            'XRPP-B.TO': 'Purpose',
            'XRPP-U.TO': 'Purpose USD Non-Hedged',
            'XRPP.TO': 'Purpose CAD Hedged',
            'XRPQ-U.TO': '3iQ USD',
            'XRPQ.TO': '3iQ',
            'XRP.NE': 'Canada ETF',
            'XRPP.NE': 'Purpose NEO'
        };

        const groupIcons = {
            'Spot ETFs': { icon: '', class: 'spot' },
            'Futures ETFs': { icon: '', class: 'futures' },
            'Index ETFs': { icon: '', class: 'index' },
            'Canada ETFs': { icon: '', class: 'canada' }
        };

        // Order of groups (Spot first)
        const groupOrder = ['Spot ETFs', 'Futures ETFs', 'Index ETFs', 'Canada ETFs'];

        // Default API URL
        const API_URL = 'https://xrp-gtve.onrender.com';

        let currentPeriod = 'daily';
        let cachedData = null;
        let autoRefreshInterval = null;

        // Global variable to store current XRP price
        let currentXRPPrice = null;

        async function fetchXRPPrice() {
            try {
                // Try CoinGecko first
                const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=ripple&vs_currencies=usd&include_24hr_change=true');
                
                if (!response.ok) {
                    throw new Error('CoinGecko API error');
                }
                
                const data = await response.json();
                
                if (data.ripple && data.ripple.usd) {
                    const price = data.ripple.usd;
                    const change = data.ripple.usd_24h_change || 0;
                    
                    // Store price globally
                    currentXRPPrice = price;
                    
                    const priceEl = document.getElementById('xrpPrice');
                    const changeClass = change >= 0 ? 'positive' : 'negative';
                    const changeSymbol = change >= 0 ? '+' : '';
                    
                    priceEl.innerHTML = `
                        <span class="xrp-label">XRP Price</span>
                        <span class="xrp-value">$${price.toFixed(4)}</span>
                        <span class="xrp-change ${changeClass}">${changeSymbol}${change.toFixed(2)}% (24h)</span>
                    `;
                    
                    // Update holdings summary if on that tab
                    updateHoldingsSummary();
                } else {
                    throw new Error('Invalid data');
                }
            } catch (error) {
                console.error('Error fetching XRP price:', error);
                // Try backup API (Binance)
                try {
                    const binanceResponse = await fetch('https://api.binance.com/api/v3/ticker/24hr?symbol=XRPUSDT');
                    const binanceData = await binanceResponse.json();
                    
                    const price = parseFloat(binanceData.lastPrice);
                    const change = parseFloat(binanceData.priceChangePercent);
                    
                    // Store price globally
                    currentXRPPrice = price;
                    
                    const priceEl = document.getElementById('xrpPrice');
                    const changeClass = change >= 0 ? 'positive' : 'negative';
                    const changeSymbol = change >= 0 ? '+' : '';
                    
                    priceEl.innerHTML = `
                        <span class="xrp-label">XRP Price</span>
                        <span class="xrp-value">$${price.toFixed(4)}</span>
                        <span class="xrp-change ${changeClass}">${changeSymbol}${change.toFixed(2)}% (24h)</span>
                    `;
                    
                    // Update holdings summary if on that tab
                    updateHoldingsSummary();
                } catch (backupError) {
                    console.error('Backup API also failed:', backupError);
                    document.getElementById('xrpPrice').innerHTML = `
                        <span class="xrp-label">XRP Price</span>
                        <span class="xrp-value">--</span>
                    `;
                }
            }
        }

        function formatNumber(num) {
            if (num >= 1e9) return (num / 1e9).toFixed(2) + 'B';
            if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';
            if (num >= 1e3) return (num / 1e3).toFixed(1) + 'K';
            return num.toLocaleString();
        }

        function formatCurrency(num) {
            return '$' + formatNumber(num);
        }

        function setPeriod(period) {
            currentPeriod = period;
            document.querySelectorAll('.controls .btn[data-period]').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.period === period);
            });
            if (cachedData) {
                renderData(cachedData);
            }
        }

        function startAutoRefresh() {
            // Clear existing interval
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
            // Set up auto-refresh every 5 minutes (300000 ms)
            autoRefreshInterval = setInterval(() => {
                console.log('Auto-refreshing data...');
                fetchXRPPrice();
                fetchData(true); // silent refresh
            }, 300000);
        }

        function updateStatus(status, text) {
            const statusDot = document.querySelector('.status-dot');
            const statusText = document.getElementById('statusText');
            
            statusDot.className = 'status-dot ' + status;
            statusText.textContent = text;
        }

        async function fetchData(silent = false) {
            const refreshBtn = document.getElementById('refreshBtn');
            
            refreshBtn.disabled = true;
            refreshBtn.textContent = ' Loading...';
            updateStatus('loading', 'Loading ETF data...');
            
            if (!silent) {
                document.getElementById('mainContent').innerHTML = `
                    <div class="loading-container">
                        <div class="spinner"></div>
                        <p class="loading-text">Fetching ETF data...</p>
                    </div>
                `;
            }

            try {
                const response = await fetch(`${API_URL}/api/etf-data`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const data = await response.json();
                cachedData = data;
                
                const now = new Date().toLocaleTimeString();
                document.getElementById('lastUpdated').textContent = `Last updated: ${data.timestamp} (fetched ${now})`;
                updateStatus('success', data.cached ? 'Cached' : 'Live');
                
                renderData(data);
            } catch (error) {
                console.error('Fetch error:', error);
                if (!silent) {
                    showError(`Failed to fetch data: ${error.message}`);
                }
                updateStatus('error', 'Error');
            } finally {
                refreshBtn.disabled = false;
                refreshBtn.textContent = ' Refresh Data';
            }
        }

        function showError(message) {
            document.getElementById('mainContent').innerHTML = `
                <div class="error-container">
                    <div class="error-icon"></div>
                    <p class="error-message">${message}</p>
                    <p class="error-hint">Make sure your API URL is correct and the server is running.</p>
                    <button class="btn btn-refresh" onclick="fetchData()">Try Again</button>
                </div>
            `;
        }

        function renderData(data) {
            const groups = data.data;
            let html = '<div class="etf-groups">';

            let grandTotalShares = 0;
            let grandTotalDollars = 0;
            
            // Collect all ETFs for ranking
            let allETFs = [];

            // Render in specified order
            for (const groupName of groupOrder) {
                const etfs = groups[groupName] || [];
                const groupInfo = groupIcons[groupName] || { icon: '', class: 'index' };
                
                // Calculate group totals and collect ETFs
                let groupTotalShares = 0;
                let groupTotalDollars = 0;

                etfs.forEach(etf => {
                    const periodData = etf[currentPeriod] || etf.daily || {};
                    groupTotalShares += periodData.shares || 0;
                    groupTotalDollars += periodData.dollars || 0;
                    
                    // Add to all ETFs list for ranking
                    allETFs.push({
                        symbol: etf.symbol,
                        price: etf.price,
                        shares: periodData.shares || 0,
                        dollars: periodData.dollars || 0,
                        group: groupName
                    });
                });

                grandTotalShares += groupTotalShares;
                grandTotalDollars += groupTotalDollars;
                
                // Sort ETFs by volume (dollars) within each group
                const sortedETFs = [...etfs].sort((a, b) => {
                    const aData = a[currentPeriod] || a.daily || {};
                    const bData = b[currentPeriod] || b.daily || {};
                    return (bData.dollars || 0) - (aData.dollars || 0);
                });

                html += `
                    <div class="etf-group">
                        <div class="group-header">
                            <div class="group-title">
                                <div class="group-icon ${groupInfo.class}">${groupInfo.icon}</div>
                                <span class="group-name">${groupName}</span>
                            </div>
                            <span class="group-count">${etfs.length} ETFs</span>
                        </div>
                        <div class="table-wrapper">
                            <table>
                                <thead>
                                    <tr>
                                        <th style="width: 50px;">#</th>
                                        <th>Symbol</th>
                                        <th class="right">Price</th>
                                        <th class="right">Volume (Shares)</th>
                                        <th class="right">Volume ($)</th>
                                    </tr>
                                </thead>
                                <tbody>
                `;

                if (sortedETFs.length === 0) {
                    html += `
                        <tr>
                            <td colspan="5" class="no-data">No data available for this group</td>
                        </tr>
                    `;
                } else {
                    sortedETFs.forEach((etf, index) => {
                        const periodData = etf[currentPeriod] || etf.daily || {};
                        const desc = descriptions[etf.symbol] || etf.description || '';
                        const rank = index + 1;
                        const rankColor = rank === 1 ? 'var(--accent-xrp)' : rank === 2 ? 'var(--accent-purple)' : rank === 3 ? 'var(--accent-orange)' : 'var(--text-muted)';
                        
                        html += `
                            <tr>
                                <td style="text-align: center; font-weight: 700; color: ${rankColor};">${rank}</td>
                                <td>
                                    <div class="symbol-cell">
                                        <div>
                                            <div class="symbol-badge">${etf.symbol}</div>
                                            <div class="symbol-desc">${desc}</div>
                                        </div>
                                    </div>
                                </td>
                                <td class="volume-cell">
                                    <span class="price">$${etf.price.toFixed(2)}</span>
                                </td>
                                <td class="volume-cell">
                                    <div class="volume-shares">${formatNumber(periodData.shares || 0)}</div>
                                </td>
                                <td class="volume-cell">
                                    <div class="volume-shares">${formatCurrency(periodData.dollars || 0)}</div>
                                </td>
                            </tr>
                        `;
                    });

                    // Add total row for each group
                    html += `
                        <tr class="total-row">
                            <td></td>
                            <td>
                                <div class="symbol-badge">TOTAL</div>
                            </td>
                            <td></td>
                            <td class="volume-cell">
                                <div class="volume-shares">${formatNumber(groupTotalShares)}</div>
                            </td>
                            <td class="volume-cell">
                                <div class="volume-shares">${formatCurrency(groupTotalDollars)}</div>
                            </td>
                        </tr>
                    `;
                }

                html += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            }

            html += '</div>';
            
            // Sort all ETFs by volume for top rankings
            allETFs.sort((a, b) => b.dollars - a.dollars);
            const top10 = allETFs.slice(0, 10);
            
            // Top Volume Rankings Section
            html += `
                <div class="etf-group" style="border: 2px solid var(--accent-xrp); margin-top: 2rem;">
                    <div class="group-header" style="background: linear-gradient(135deg, var(--bg-secondary), var(--accent-xrp-dim));">
                        <div class="group-title">
                            <div class="group-icon spot" style="background: linear-gradient(135deg, var(--accent-xrp), var(--accent-purple));"></div>
                            <span class="group-name">Top 10 ETFs by Volume (${currentPeriod.charAt(0).toUpperCase() + currentPeriod.slice(1)})</span>
                        </div>
                    </div>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th style="width: 60px;">Rank</th>
                                    <th>Symbol</th>
                                    <th>Category</th>
                                    <th class="right">Price</th>
                                    <th class="right">Volume ($)</th>
                                    <th class="right">Market Share</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            top10.forEach((etf, index) => {
                const rank = index + 1;
                const medal = rank === 1 ? '' : rank === 2 ? '' : rank === 3 ? '' : `#${rank}`;
                const rankStyle = rank <= 3 ? 'font-size: 1.2rem;' : 'color: var(--text-muted); font-weight: 600;';
                const marketShare = grandTotalDollars > 0 ? ((etf.dollars / grandTotalDollars) * 100).toFixed(2) : 0;
                const desc = descriptions[etf.symbol] || '';
                
                html += `
                    <tr>
                        <td style="text-align: center; ${rankStyle}">${medal}</td>
                        <td>
                            <div class="symbol-cell">
                                <div>
                                    <div class="symbol-badge">${etf.symbol}</div>
                                    <div class="symbol-desc">${desc}</div>
                                </div>
                            </div>
                        </td>
                        <td style="color: var(--text-secondary); font-size: 0.85rem;">${etf.group}</td>
                        <td class="volume-cell">
                            <span class="price">$${etf.price.toFixed(2)}</span>
                        </td>
                        <td class="volume-cell">
                            <div class="volume-shares" style="color: var(--accent-xrp);">${formatCurrency(etf.dollars)}</div>
                        </td>
                        <td class="volume-cell">
                            <div class="volume-shares">${marketShare}%</div>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                            </tbody>
                        </table>
                    </div>
                </div>
            `;

            // Grand Total Section
            html += `
                <div class="grand-total">
                    <h3> Grand Total (${currentPeriod.charAt(0).toUpperCase() + currentPeriod.slice(1)})</h3>
                    <div class="grand-total-grid">
                        <div class="grand-total-item">
                            <div class="grand-total-label">Total Volume (Shares)</div>
                            <div class="grand-total-value">${formatNumber(grandTotalShares)}</div>
                        </div>
                        <div class="grand-total-item">
                            <div class="grand-total-label">Total Volume ($)</div>
                            <div class="grand-total-value">${formatCurrency(grandTotalDollars)}</div>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('mainContent').innerHTML = html;
        }

        // Popup functions
        function showPopup() {
            document.getElementById('popupOverlay').classList.add('active');
        }

        function closePopup() {
            document.getElementById('popupOverlay').classList.remove('active');
            localStorage.setItem('popup_closed', Date.now());
        }

        function shouldShowPopup() {
            const lastClosed = localStorage.getItem('popup_closed');
            if (!lastClosed) return true;
            const hoursSinceClosed = (Date.now() - parseInt(lastClosed)) / (1000 * 60 * 60);
            return hoursSinceClosed > 24;
        }

        // Chart variables
        let etfChart = null;
        let currentChartType = 'price';
        let currentChartPeriod = '1mo';
        let historicalData = null;

        const chartColors = [
            '#23f7dd', '#a855f7', '#22c55e', '#f97316', '#3b82f6', 
            '#ef4444', '#eab308', '#ec4899', '#14b8a6', '#8b5cf6',
            '#06b6d4', '#f43f5e', '#84cc16', '#6366f1', '#10b981',
            '#f59e0b', '#64748b', '#0ea5e9', '#d946ef', '#78716c'
        ];

        function openChartModal() {
            document.getElementById('chartOverlay').classList.add('active');
            fetchHistoricalData();
        }

        function closeChartModal() {
            document.getElementById('chartOverlay').classList.remove('active');
        }

        function switchChart(type) {
            currentChartType = type;
            document.querySelectorAll('.chart-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.chart === type);
            });
            if (historicalData) {
                renderChart();
            }
        }

        function setChartPeriod(period) {
            currentChartPeriod = period;
            document.querySelectorAll('.chart-period').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.cperiod === period);
            });
            fetchHistoricalData();
        }

        async function fetchHistoricalData() {
            document.getElementById('chartLoading').style.display = 'flex';
            document.getElementById('etfChart').style.display = 'none';
            document.getElementById('chartLegend').innerHTML = '';

            try {
                const response = await fetch(`${API_URL}/api/historical?period=${currentChartPeriod}`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                historicalData = await response.json();
                renderChart();
            } catch (error) {
                console.error('Error fetching historical data:', error);
                document.getElementById('chartLegend').innerHTML = `
                    <div style="color: var(--accent-red); text-align: center; width: 100%;">
                        Failed to load chart data. Please try again.
                    </div>
                `;
            } finally {
                document.getElementById('chartLoading').style.display = 'none';
                document.getElementById('etfChart').style.display = 'block';
            }
        }

        function renderChart() {
            if (!historicalData || !historicalData.data) return;

            const ctx = document.getElementById('etfChart').getContext('2d');
            
            // Destroy existing chart
            if (etfChart) {
                etfChart.destroy();
            }

            const datasets = [];
            let colorIndex = 0;
            let allDates = new Set();

            // Collect all dates and prepare datasets
            for (const [symbol, data] of Object.entries(historicalData.data)) {
                data.forEach(d => allDates.add(d.date));
            }

            const sortedDates = Array.from(allDates).sort();

            // Create dataset for each ETF
            for (const [symbol, data] of Object.entries(historicalData.data)) {
                const color = chartColors[colorIndex % chartColors.length];
                
                // Create a map for quick lookup
                const dataMap = {};
                data.forEach(d => {
                    dataMap[d.date] = currentChartType === 'price' ? d.price : d.volume;
                });

                // Fill in data for all dates
                const values = sortedDates.map(date => dataMap[date] || null);

                datasets.push({
                    label: symbol,
                    data: values,
                    borderColor: color,
                    backgroundColor: color + '20',
                    pointBackgroundColor: color,
                    pointBorderColor: color,
                    pointRadius: 0,
                    pointHoverRadius: 5,
                    borderWidth: 2,
                    fill: false,
                    tension: 0.3,
                    spanGaps: true
                });
                colorIndex++;
            }

            // Sort datasets by latest value for legend
            datasets.sort((a, b) => {
                const aLast = a.data.filter(v => v !== null).pop() || 0;
                const bLast = b.data.filter(v => v !== null).pop() || 0;
                return bLast - aLast;
            });

            const chartTitle = currentChartType === 'price' ? 'Price Comparison' : 'Volume Comparison';

            etfChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: sortedDates.map(d => {
                        const date = new Date(d);
                        return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                    }),
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: '#16161f',
                            borderColor: '#23f7dd',
                            borderWidth: 1,
                            titleColor: '#ffffff',
                            bodyColor: '#8888a0',
                            padding: 12,
                            callbacks: {
                                label: function(context) {
                                    if (context.raw === null) return null;
                                    let value = context.raw;
                                    if (currentChartType === 'price') {
                                        return context.dataset.label + ': $' + value.toFixed(2);
                                    } else {
                                        return context.dataset.label + ': ' + formatNumber(value);
                                    }
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: '#8888a0',
                                maxRotation: 45,
                                minRotation: 45,
                                maxTicksLimit: 10
                            },
                            grid: {
                                color: '#2a2a3a'
                            }
                        },
                        y: {
                            ticks: {
                                color: '#8888a0',
                                callback: function(value) {
                                    if (currentChartType === 'price') {
                                        return '$' + value.toFixed(2);
                                    }
                                    return formatNumber(value);
                                }
                            },
                            grid: {
                                color: '#2a2a3a'
                            }
                        }
                    }
                }
            });

            // Render interactive legend
            const legendHtml = datasets.map((d, i) => {
                const lastValue = d.data.filter(v => v !== null).pop() || 0;
                const valueStr = currentChartType === 'price' 
                    ? '$' + lastValue.toFixed(2) 
                    : formatNumber(lastValue);
                return `
                    <div class="legend-item" onclick="toggleDataset(${i})" style="cursor: pointer; opacity: 1;" data-index="${i}">
                        <div class="legend-color" style="background: ${d.borderColor}"></div>
                        <span>${d.label}: ${valueStr}</span>
                    </div>
                `;
            }).join('');
            document.getElementById('chartLegend').innerHTML = legendHtml;
        }

        function toggleDataset(index) {
            if (!etfChart) return;
            const meta = etfChart.getDatasetMeta(index);
            meta.hidden = !meta.hidden;
            etfChart.update();
            
            // Update legend opacity
            const legendItem = document.querySelector(`.legend-item[data-index="${index}"]`);
            if (legendItem) {
                legendItem.style.opacity = meta.hidden ? '0.4' : '1';
            }
        }

        // Close modals on escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeChartModal();
                closePopup();
            }
        });

        // =====================================================
        // NEWS TAB FUNCTIONS
        // =====================================================
        let currentNewsFilter = 'xrp';

        function filterNews(category) {
            currentNewsFilter = category;
            
            // Update active button
            document.querySelectorAll('.news-filters .btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.news === category);
            });
            
            // Filter news items
            const newsItems = document.querySelectorAll('.news-item');
            newsItems.forEach(item => {
                const itemCategory = item.dataset.category || '';
                
                if (category === 'all') {
                    item.style.display = 'block';
                } else if (itemCategory.includes(category)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // News loading state
        let newsLoading = false;
        let newsPage = 1;
        let cachedNews = [];

        // Fetch live news from CryptoCompare API
        async function fetchLiveNews() {
            const newsFeed = document.getElementById('newsFeed');
            
            try {
                newsFeed.innerHTML = `
                    <div class="news-item">
                        <div class="news-source"><span class="source-icon"></span><span class="source-name">Loading...</span></div>
                        <h3 class="news-title">Fetching latest news...</h3>
                    </div>
                `;
                
                // Fetch from CryptoCompare News API (free, no key required)
                const response = await fetch('https://min-api.cryptocompare.com/data/v2/news/?lang=EN&categories=XRP,Ripple,ETF,Regulation,BTC,ETH&excludeCategories=Sponsored');
                const data = await response.json();
                
                if (data.Data && data.Data.length > 0) {
                    cachedNews = data.Data;
                    renderNews(data.Data.slice(0, 10));
                    // Also update AI Analysis section
                    renderAIAnalysis(data.Data.slice(0, 4));
                } else {
                    throw new Error('No news data');
                }
                
            } catch (error) {
                console.error('News fetch error:', error);
                // Fallback to static news
                newsFeed.innerHTML = `
                    <div class="news-item" data-category="xrp">
                        <div class="news-source"><span class="source-icon"></span><span class="source-name">XRP News</span><span class="news-time">Latest</span></div>
                        <h3 class="news-title">XRP ETFs Continue Trading on Major Exchanges</h3>
                        <p class="news-summary">Multiple XRP spot ETFs are actively trading, marking continued institutional adoption.</p>
                        <div class="news-tags"><span class="news-tag">XRP</span><span class="news-tag">ETF</span></div>
                    </div>
                    <div class="news-item" data-category="crypto">
                        <div class="news-source"><span class="source-icon"></span><span class="source-name">Crypto Market</span><span class="news-time">Recent</span></div>
                        <h3 class="news-title">Crypto Market Shows Continued Growth</h3>
                        <p class="news-summary">Digital assets maintain momentum as institutional interest grows.</p>
                        <div class="news-tags"><span class="news-tag">Crypto</span><span class="news-tag">Market</span></div>
                    </div>
                `;
                renderAIAnalysisFallback();
            }
        }
        
        function refreshAIAnalysis() {
            if (cachedNews.length > 0) {
                renderAIAnalysis(cachedNews.slice(0, 4));
            } else {
                fetchLiveNews();
            }
        }
        
        function renderAIAnalysis(newsItems) {
            const aiNewsFeed = document.getElementById('aiNewsFeed');
            if (!aiNewsFeed) return;
            
            // Sentiment keywords
            const bullishWords = ['surge', 'rally', 'gain', 'rise', 'soar', 'jump', 'bullish', 'record', 'high', 'growth', 'adoption', 'approval', 'partnership', 'launch', 'breakout', 'pump'];
            const bearishWords = ['drop', 'crash', 'fall', 'plunge', 'bearish', 'decline', 'loss', 'sell', 'dump', 'fear', 'concern', 'hack', 'scam', 'fraud', 'lawsuit', 'ban', 'reject'];
            
            // AI analysis templates
            const bullishAnalysis = [
                "Strong positive momentum detected. Historical patterns suggest potential upward movement in the coming days. Institutional interest appears to be increasing.",
                "This development signals growing confidence from major players. Market sentiment is shifting positively, which typically supports price appreciation.",
                "Favorable news for the broader crypto ecosystem. Such developments often catalyze increased trading volume and renewed investor interest.",
                "Positive catalyst identified. This type of news has historically preceded bullish price action in similar market conditions."
            ];
            
            const bearishAnalysis = [
                "Caution warranted. This development may create short-term selling pressure. Monitor for further developments before making decisions.",
                "Potential headwind identified. Market may experience increased volatility. Risk management is advisable in current conditions.",
                "Negative sentiment driver detected. Historical precedent suggests possible price consolidation or correction in near term.",
                "This news may weigh on market sentiment temporarily. However, long-term fundamentals remain unchanged for patient investors."
            ];
            
            const neutralAnalysis = [
                "Mixed signals in this development. Market impact likely to be limited without follow-up catalysts. Continue monitoring for clarity.",
                "Neutral news event. Neither strongly bullish nor bearish implications. Market likely to continue current trend absent new information.",
                "Informational update with limited immediate price impact. May become significant if combined with other market-moving events.",
                "Standard market development. No strong directional bias detected. Focus on broader market trends for guidance."
            ];
            
            aiNewsFeed.innerHTML = newsItems.map((item, index) => {
                const title = item.title.toLowerCase();
                const body = (item.body || '').toLowerCase();
                const combined = title + ' ' + body;
                
                // Score sentiment
                let bullishScore = bullishWords.filter(word => combined.includes(word)).length;
                let bearishScore = bearishWords.filter(word => combined.includes(word)).length;
                
                let sentiment, sentimentClass, sentimentIcon, analysis, impactPercent, impactLabel;
                
                if (bullishScore > bearishScore + 1) {
                    sentiment = 'BULLISH';
                    sentimentClass = 'bullish';
                    sentimentIcon = '';
                    analysis = bullishAnalysis[index % bullishAnalysis.length];
                    impactPercent = 60 + Math.random() * 30;
                    impactLabel = impactPercent > 75 ? 'High' : 'Medium';
                } else if (bearishScore > bullishScore + 1) {
                    sentiment = 'BEARISH';
                    sentimentClass = 'bearish';
                    sentimentIcon = '';
                    analysis = bearishAnalysis[index % bearishAnalysis.length];
                    impactPercent = 50 + Math.random() * 35;
                    impactLabel = impactPercent > 70 ? 'High' : 'Medium';
                } else {
                    sentiment = 'NEUTRAL';
                    sentimentClass = 'neutral';
                    sentimentIcon = '';
                    analysis = neutralAnalysis[index % neutralAnalysis.length];
                    impactPercent = 20 + Math.random() * 40;
                    impactLabel = impactPercent > 45 ? 'Medium' : 'Low';
                }
                
                const timeAgo = getTimeAgo(item.published_on * 1000);
                
                return `
                    <div class="ai-news-item ${sentimentClass}">
                        <div class="ai-news-header">
                            <span class="ai-sentiment-badge ${sentimentClass}">${sentimentIcon} ${sentiment}</span>
                            <span class="ai-news-time">${timeAgo}</span>
                        </div>
                        <h4 class="ai-news-title">${item.title}</h4>
                        <p class="ai-news-original">Source: ${item.source_info?.name || item.source}</p>
                        <div class="ai-news-analysis">
                            <span class="analysis-label"> AI Analysis:</span>
                            <p>${analysis}</p>
                        </div>
                        <div class="ai-news-impact">
                            <span>Impact Score:</span>
                            <div class="impact-bar">
                                <div class="impact-fill ${sentimentClass}" style="width: ${impactPercent}%;"></div>
                            </div>
                            <span class="impact-value">${impactLabel}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function renderAIAnalysisFallback() {
            const aiNewsFeed = document.getElementById('aiNewsFeed');
            if (!aiNewsFeed) return;
            
            aiNewsFeed.innerHTML = `
                <div class="ai-news-item neutral">
                    <div class="ai-news-header">
                        <span class="ai-sentiment-badge neutral"> NEUTRAL</span>
                        <span class="ai-news-time">Just now</span>
                    </div>
                    <h4 class="ai-news-title">Market Analysis Unavailable</h4>
                    <p class="ai-news-original">Unable to fetch latest news for analysis.</p>
                    <div class="ai-news-analysis">
                        <span class="analysis-label"> AI Analysis:</span>
                        <p>Click refresh to load the latest AI-powered news analysis.</p>
                    </div>
                </div>
            `;
        }
        
        function renderNews(newsItems) {
            const newsFeed = document.getElementById('newsFeed');
            
            const categoryIcons = {
                'xrp': '',
                'ripple': '',
                'etf': '',
                'bitcoin': '',
                'btc': '',
                'ethereum': '',
                'eth': '',
                'regulation': '',
                'defi': '',
                'nft': '',
                'default': ''
            };
            
            newsFeed.innerHTML = newsItems.map(item => {
                const timeAgo = getTimeAgo(item.published_on * 1000);
                const categories = (item.categories || '').toLowerCase();
                const category = categories.includes('xrp') || categories.includes('ripple') ? 'xrp' :
                                categories.includes('etf') ? 'etf' :
                                categories.includes('btc') || categories.includes('bitcoin') ? 'crypto' : 'crypto';
                
                // Get icon based on category
                let icon = categoryIcons['default'];
                for (const [key, value] of Object.entries(categoryIcons)) {
                    if (categories.includes(key)) {
                        icon = value;
                        break;
                    }
                }
                
                // Determine sentiment from title
                const title = item.title.toLowerCase();
                const bullishWords = ['surge', 'rally', 'gain', 'bullish', 'soar', 'jump', 'rise', 'record', 'high', 'growth', 'approval'];
                const bearishWords = ['drop', 'crash', 'fall', 'bearish', 'plunge', 'decline', 'low', 'sell', 'dump', 'reject'];
                
                const bullishCount = bullishWords.filter(w => title.includes(w)).length;
                const bearishCount = bearishWords.filter(w => title.includes(w)).length;
                
                const sentiment = bullishCount > bearishCount ? 'bullish' : 
                                 bearishCount > bullishCount ? 'bearish' : 'neutral';
                
                const sentimentLabel = sentiment === 'bullish' ? ' Bullish' : 
                                      sentiment === 'bearish' ? ' Bearish' : ' Neutral';
                
                // Calculate impact (based on source reputation and recency)
                const hoursAgo = (Date.now() - item.published_on * 1000) / 3600000;
                const impactScore = Math.max(1, Math.min(3, Math.ceil(3 - hoursAgo / 8)));
                
                return `
                    <div class="news-item ${sentiment}" data-category="${category}" onclick="window.open('${item.url}', '_blank')">
                        <div class="news-image">
                            <span class="news-image-icon">${icon}</span>
                            <span class="news-sentiment-badge ${sentiment}">${sentimentLabel}</span>
                            <span class="news-source-badge">${item.source_info?.name || item.source}</span>
                        </div>
                        <div class="news-body">
                            <h3 class="news-title">${item.title}</h3>
                            <p class="news-summary">${item.body?.substring(0, 120) || ''}...</p>
                            <div class="news-footer">
                                <span class="news-time-new"> ${timeAgo}</span>
                                <div class="news-impact">
                                    <div class="impact-dots">
                                        <span class="impact-dot ${impactScore >= 1 ? 'active' : ''} ${impactScore >= 3 ? 'high' : impactScore >= 2 ? 'medium' : ''}"></span>
                                        <span class="impact-dot ${impactScore >= 2 ? 'active' : ''} ${impactScore >= 3 ? 'high' : impactScore >= 2 ? 'medium' : ''}"></span>
                                        <span class="impact-dot ${impactScore >= 3 ? 'active high' : ''}"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function getTimeAgo(timestamp) {
            const seconds = Math.floor((Date.now() - timestamp) / 1000);
            if (seconds < 60) return 'Just now';
            if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;
            if (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;
            return `${Math.floor(seconds / 86400)}d ago`;
        }
        
        // Load news on page load
        setTimeout(fetchLiveNews, 1000);

        async function loadMoreNews() {
            if (newsLoading) return;
            
            const btn = document.querySelector('.news-load-more .btn');
            btn.disabled = true;
            btn.innerHTML = ' Loading...';
            newsLoading = true;
            
            try {
                // Load more from cached news
                const startIdx = 10 + (newsPage - 1) * 5;
                const endIdx = startIdx + 5;
                
                if (cachedNews.length > startIdx) {
                    const moreNews = cachedNews.slice(startIdx, endIdx);
                    const newsFeed = document.getElementById('newsFeed');
                    
                    moreNews.forEach(item => {
                        const timeAgo = getTimeAgo(item.published_on * 1000);
                        const categories = (item.categories || '').toLowerCase();
                        const category = categories.includes('xrp') || categories.includes('ripple') ? 'xrp' :
                                        categories.includes('etf') ? 'etf' : 'crypto';
                        
                        const newsItem = document.createElement('div');
                        newsItem.className = 'news-item';
                        newsItem.dataset.category = category;
                        newsItem.onclick = () => window.open(item.url, '_blank');
                        newsItem.innerHTML = `
                            <div class="news-source">
                                <span class="source-icon"></span>
                                <span class="source-name">${item.source_info?.name || item.source}</span>
                                <span class="news-time">${timeAgo}</span>
                            </div>
                            <h3 class="news-title">${item.title}</h3>
                            <p class="news-summary">${item.body?.substring(0, 150) || ''}...</p>
                            <div class="news-tags">
                                ${(item.categories || '').split('|').slice(0, 3).map(tag => `<span class="news-tag">${tag}</span>`).join('')}
                            </div>
                        `;
                        newsFeed.appendChild(newsItem);
                    });
                    
                    newsPage++;
                    btn.innerHTML = ' Load More News';
                    filterNews(currentNewsFilter);
                } else {
                    // Fetch more from API
                    const response = await fetch('https://min-api.cryptocompare.com/data/v2/news/?lang=EN&categories=XRP,Ripple,ETF,BTC,ETH');
                    const data = await response.json();
                    if (data.Data) {
                        cachedNews = [...cachedNews, ...data.Data];
                        loadMoreNews(); // Recursively load now that we have more
                        return;
                    }
                    btn.innerHTML = 'No More News';
                }
                
            } catch (error) {
                console.error('Error loading news:', error);
                btn.innerHTML = ' Error - Try Again';
            } finally {
                btn.disabled = false;
                newsLoading = false;
            }
        }

        function generateMoreNews(page) {
            // Generate dynamic news based on current market data
            const price = currentXRPPrice || 2.15;
            const change = insightsData.priceChange24h || 0;
            
            const newsTemplates = [
                {
                    icon: '', source: 'Market Watch', time: `${page * 2}h ago`,
                    title: `XRP ${change >= 0 ? 'Rallies' : 'Dips'} as Crypto Markets ${change >= 0 ? 'Surge' : 'Correct'}`,
                    summary: `XRP is trading at $${price.toFixed(4)}, ${change >= 0 ? 'up' : 'down'} ${Math.abs(change).toFixed(2)}% in the last 24 hours amid broader market movements.`,
                    category: 'xrp crypto', tags: ['XRP', 'Market']
                },
                {
                    icon: '', source: 'ETF Daily', time: `${page * 2 + 1}h ago`,
                    title: 'XRP ETF Trading Volume Continues to Grow',
                    summary: 'Spot XRP ETFs see steady trading activity as institutional investors continue to allocate to digital assets.',
                    category: 'xrp etf', tags: ['ETF', 'Institutional']
                },
                {
                    icon: '', source: 'Crypto Law', time: `${page * 2 + 2}h ago`,
                    title: 'Regulatory Clarity Boosting XRP Adoption',
                    summary: 'Following legal clarity, XRP adoption continues to expand with new partnerships and use cases emerging globally.',
                    category: 'xrp', tags: ['Regulation', 'Adoption']
                },
                {
                    icon: '', source: 'Blockchain News', time: `${page * 2 + 3}h ago`,
                    title: 'XRPL Sees Increased Developer Activity',
                    summary: 'The XRP Ledger ecosystem grows with new DeFi protocols and NFT marketplaces launching on the network.',
                    category: 'xrp crypto', tags: ['XRPL', 'Development']
                }
            ];
            
            return newsTemplates;
        }

        // =====================================================
        // PORTFOLIO TAB FUNCTIONS
        // =====================================================
        let portfolio = [];

        function loadPortfolio() {
            const saved = localStorage.getItem('xrp_portfolio');
            if (saved) {
                portfolio = JSON.parse(saved);
            }
            renderPortfolioList();
        }

        function savePortfolio() {
            localStorage.setItem('xrp_portfolio', JSON.stringify(portfolio));
            checkAchievements();
            alert('Portfolio saved!');
        }

        function addHolding() {
            const asset = document.getElementById('holdingAsset').value;
            const amount = parseFloat(document.getElementById('holdingAmount').value);
            const price = parseFloat(document.getElementById('holdingPrice').value);
            const date = document.getElementById('holdingDate').value;

            if (!amount || !price) {
                alert('Please enter amount and price');
                return;
            }

            portfolio.push({
                id: Date.now(),
                asset,
                amount,
                buyPrice: price,
                date: date || new Date().toISOString().split('T')[0]
            });

            // Clear form
            document.getElementById('holdingAmount').value = '';
            document.getElementById('holdingPrice').value = '';
            
            savePortfolio();
            renderPortfolioList();
            updatePortfolioDisplay();
        }

        function removeHolding(id) {
            portfolio = portfolio.filter(h => h.id !== id);
            savePortfolio();
            renderPortfolioList();
            updatePortfolioDisplay();
        }

        function renderPortfolioList() {
            const container = document.getElementById('portfolioHoldingsList');
            
            if (portfolio.length === 0) {
                container.innerHTML = `
                    <div class="empty-portfolio">
                        <span></span>
                        <p>No holdings yet. Add your first holding above!</p>
                    </div>
                `;
                return;
            }

            let html = '';
            portfolio.forEach(holding => {
                const currentPrice = holding.asset === 'XRP' ? currentXRPPrice : currentXRPPrice; // Simplified
                const currentValue = holding.amount * currentPrice;
                const costBasis = holding.amount * holding.buyPrice;
                const pnl = currentValue - costBasis;
                const pnlPercent = costBasis > 0 ? ((pnl / costBasis) * 100).toFixed(2) : 0;
                const pnlClass = pnl >= 0 ? 'positive' : 'negative';

                html += `
                    <div class="holding-item">
                        <div class="holding-asset">${holding.asset}</div>
                        <div class="holding-amount">${holding.amount.toLocaleString()}</div>
                        <div class="holding-value">
                            <div>$${currentValue.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</div>
                            <div class="holding-pnl ${pnlClass}">${pnl >= 0 ? '+' : ''}$${pnl.toFixed(2)} (${pnlPercent}%)</div>
                        </div>
                        <button class="holding-delete" onclick="removeHolding(${holding.id})"></button>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function updatePortfolioDisplay() {
            let totalValue = 0;
            let totalCost = 0;
            let totalXRP = 0;

            portfolio.forEach(holding => {
                const currentPrice = holding.asset === 'XRP' ? currentXRPPrice : currentXRPPrice;
                totalValue += holding.amount * currentPrice;
                totalCost += holding.amount * holding.buyPrice;
                if (holding.asset === 'XRP') totalXRP += holding.amount;
            });

            const pnl = totalValue - totalCost;
            const pnlPercent = totalCost > 0 ? ((pnl / totalCost) * 100).toFixed(2) : 0;
            const avgPrice = totalXRP > 0 ? (totalCost / totalXRP) : 0;

            document.getElementById('portfolioTotalValue').textContent = '$' + totalValue.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
            document.getElementById('portfolioTotalXRP').textContent = totalXRP.toLocaleString();
            document.getElementById('portfolioAvgPrice').textContent = '$' + avgPrice.toFixed(4);
            document.getElementById('portfolioPnL').textContent = (pnl >= 0 ? '+$' : '-$') + Math.abs(pnl).toFixed(2);
            document.getElementById('portfolioPnL').style.color = pnl >= 0 ? 'var(--accent-green)' : 'var(--accent-red)';
            
            const changeEl = document.getElementById('portfolioChange');
            changeEl.textContent = (pnl >= 0 ? '+' : '') + pnlPercent + '%';
            changeEl.className = 'portfolio-card-change ' + (pnl >= 0 ? 'positive' : 'negative');
        }

        function calculateWhatIf() {
            const investment = parseFloat(document.getElementById('calcInvestment').value) || 0;
            const buyPrice = parseFloat(document.getElementById('calcBuyPrice').value) || 0;
            const currentPrice = parseFloat(document.getElementById('calcCurrentPrice').value) || currentXRPPrice;

            if (buyPrice <= 0) {
                alert('Please enter a valid buy price');
                return;
            }

            const xrpPurchased = investment / buyPrice;
            const currentValue = xrpPurchased * currentPrice;
            const profit = currentValue - investment;
            const roi = ((profit / investment) * 100).toFixed(2);

            document.getElementById('calcXRP').textContent = xrpPurchased.toLocaleString(undefined, {maximumFractionDigits: 2});
            document.getElementById('calcValue').textContent = '$' + currentValue.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
            document.getElementById('calcProfit').textContent = (profit >= 0 ? '+$' : '-$') + Math.abs(profit).toFixed(2);
            document.getElementById('calcProfit').style.color = profit >= 0 ? 'var(--accent-green)' : 'var(--accent-red)';
            document.getElementById('calcROI').textContent = roi + '%';
            document.getElementById('calcROI').style.color = profit >= 0 ? 'var(--accent-green)' : 'var(--accent-red)';
        }

        // Gamification Functions
        function updateStreak() {
            const lastVisit = localStorage.getItem('last_visit_date');
            const today = new Date().toDateString();
            let streak = parseInt(localStorage.getItem('visit_streak') || '0');

            if (lastVisit !== today) {
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                
                if (lastVisit === yesterday.toDateString()) {
                    streak++;
                } else if (lastVisit !== today) {
                    streak = 1;
                }
                
                localStorage.setItem('last_visit_date', today);
                localStorage.setItem('visit_streak', streak);
            }

            document.getElementById('streakCount').textContent = streak;
            checkAchievements();
        }

        function checkAchievements() {
            const streak = parseInt(localStorage.getItem('visit_streak') || '0');
            
            // Week streak achievement
            if (streak >= 7) {
                document.getElementById('achWeekStreak')?.classList.add('unlocked');
            }
            
            // Portfolio pro achievement
            if (portfolio.length >= 1) {
                document.getElementById('achPortfolio')?.classList.add('unlocked');
            }
            
            // Whale achievement (10000+ XRP)
            const totalXRP = portfolio.reduce((sum, h) => sum + (h.asset === 'XRP' ? h.amount : 0), 0);
            if (totalXRP >= 10000) {
                document.getElementById('achWhale')?.classList.add('unlocked');
            }
        }

        function submitPrediction() {
            const prediction = parseFloat(document.getElementById('pricePrediction').value);
            if (!prediction) {
                alert('Please enter a prediction');
                return;
            }

            const predictions = JSON.parse(localStorage.getItem('price_predictions') || '[]');
            predictions.push({
                date: new Date().toISOString(),
                prediction,
                actualPrice: null
            });
            localStorage.setItem('price_predictions', JSON.stringify(predictions));
            
            alert('Prediction submitted! Check back tomorrow to see your score.');
            document.getElementById('pricePrediction').value = '';
        }

        // =====================================================
        // AI INSIGHTS TAB FUNCTIONS
        // =====================================================
        let maChart = null;
        let comparisonChart = null;
        let xrpPriceHistory = [];
        let insightsData = {
            sentiment: 50,
            priceChange24h: 0,
            priceChange7d: 0,
            priceChange30d: 0,
            ma7: 0,
            ma30: 0,
            ma90: 0,
            volume24h: 0
        };

        async function fetchXRPMarketData() {
            try {
                const response = await fetch('https://api.coingecko.com/api/v3/coins/ripple?localization=false&tickers=false&community_data=false&developer_data=false');
                if (!response.ok) throw new Error('Failed to fetch market data');
                
                const data = await response.json();
                
                insightsData.priceChange24h = data.market_data.price_change_percentage_24h || 0;
                insightsData.priceChange7d = data.market_data.price_change_percentage_7d || 0;
                insightsData.priceChange30d = data.market_data.price_change_percentage_30d || 0;
                insightsData.volume24h = data.market_data.total_volume.usd || 0;
                
                return true;
            } catch (error) {
                console.error('Error fetching market data:', error);
                // Use fallback simulated data based on current price
                if (currentXRPPrice > 0) {
                    // Generate reasonable estimates based on typical XRP volatility
                    insightsData.priceChange24h = (Math.random() * 6 - 2).toFixed(2) * 1; // -2% to +4%
                    insightsData.priceChange7d = (Math.random() * 15 - 5).toFixed(2) * 1; // -5% to +10%
                    insightsData.priceChange30d = (Math.random() * 20 - 5).toFixed(2) * 1; // -5% to +15%
                    insightsData.volume24h = 500000000 + Math.random() * 1000000000; // $500M - $1.5B
                }
                return false;
            }
        }

        async function fetchXRPPriceHistory() {
            try {
                // Fetch 90 days of price history from CoinGecko
                const response = await fetch('https://api.coingecko.com/api/v3/coins/ripple/market_chart?vs_currency=usd&days=90&interval=daily');
                if (!response.ok) throw new Error('Failed to fetch price history');
                
                const data = await response.json();
                xrpPriceHistory = data.prices.map(p => ({
                    date: new Date(p[0]),
                    price: p[1]
                }));
                
                return true;
            } catch (error) {
                console.error('Error fetching XRP price history:', error);
                // Generate fallback price history based on current price
                if (currentXRPPrice > 0) {
                    const basePrice = currentXRPPrice;
                    xrpPriceHistory = [];
                    for (let i = 90; i >= 0; i--) {
                        const date = new Date();
                        date.setDate(date.getDate() - i);
                        // Add some variance around current price
                        const variance = (Math.random() - 0.5) * 0.3; // +/- 15%
                        xrpPriceHistory.push({
                            date: date,
                            price: basePrice * (1 + variance - (i * 0.001)) // slight uptrend
                        });
                    }
                    return true;
                }
                return false;
            }
        }

        function calculateMovingAverages() {
            if (xrpPriceHistory.length < 7) return;
            
            const prices = xrpPriceHistory.map(p => p.price);
            const len = prices.length;
            
            // 7-day MA
            if (len >= 7) {
                insightsData.ma7 = prices.slice(-7).reduce((a, b) => a + b, 0) / 7;
            }
            
            // 30-day MA
            if (len >= 30) {
                insightsData.ma30 = prices.slice(-30).reduce((a, b) => a + b, 0) / 30;
            }
            
            // 90-day MA
            if (len >= 90) {
                insightsData.ma90 = prices.slice(-90).reduce((a, b) => a + b, 0) / 90;
            }
        }

        function calculateSentiment() {
            // Calculate sentiment based on multiple factors
            let score = 50; // Start neutral
            
            // Price momentum (weight: 40%)
            if (insightsData.priceChange24h > 5) score += 15;
            else if (insightsData.priceChange24h > 2) score += 10;
            else if (insightsData.priceChange24h > 0) score += 5;
            else if (insightsData.priceChange24h > -2) score -= 5;
            else if (insightsData.priceChange24h > -5) score -= 10;
            else score -= 15;
            
            // 7-day trend (weight: 30%)
            if (insightsData.priceChange7d > 10) score += 12;
            else if (insightsData.priceChange7d > 5) score += 8;
            else if (insightsData.priceChange7d > 0) score += 4;
            else if (insightsData.priceChange7d > -5) score -= 4;
            else if (insightsData.priceChange7d > -10) score -= 8;
            else score -= 12;
            
            // MA crossover signals (weight: 30%)
            if (currentXRPPrice && insightsData.ma7 && insightsData.ma30) {
                if (currentXRPPrice > insightsData.ma7 && insightsData.ma7 > insightsData.ma30) {
                    score += 13; // Strong bullish
                } else if (currentXRPPrice > insightsData.ma7) {
                    score += 8; // Bullish
                } else if (currentXRPPrice < insightsData.ma7 && insightsData.ma7 < insightsData.ma30) {
                    score -= 13; // Strong bearish
                } else if (currentXRPPrice < insightsData.ma7) {
                    score -= 8; // Bearish
                }
            }
            
            // Clamp between 0 and 100
            insightsData.sentiment = Math.max(0, Math.min(100, score));
        }

        async function fetchClaudeInsights() {
            // Get ETF totals
            let etfTotal = 0;
            etfColumns.forEach(col => {
                for (const row of holdingsData) {
                    if (row[col.key]?.xrp) {
                        etfTotal += row[col.key].xrp;
                        break;
                    }
                }
            });
            
            // Get exchange totals
            let exchangeTotal = 0;
            Object.values(exchangeData).forEach(data => {
                exchangeTotal += data.total || 0;
            });

            // Get ETF volume from cached data
            let etfVolume = 0;
            if (cachedData && cachedData.data) {
                const xrpETFs = cachedData.data['XRP Spot ETFs'] || [];
                xrpETFs.forEach(etf => {
                    etfVolume += (etf.daily?.dollars || 0);
                });
            }

            const marketData = {
                currentPrice: currentXRPPrice || 0,
                priceChange24h: insightsData.priceChange24h,
                priceChange7d: insightsData.priceChange7d,
                priceChange30d: insightsData.priceChange30d,
                volume24h: insightsData.volume24h,
                ma7: insightsData.ma7,
                ma30: insightsData.ma30,
                ma90: insightsData.ma90,
                etfHoldings: etfTotal,
                exchangeHoldings: exchangeTotal,
                etfVolume: etfVolume,
                sentimentScore: insightsData.sentiment
            };

            try {
                const response = await fetch(`${API_URL}/api/ai-insights`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        marketData,
                        language: currentLanguage // Send language preference to API
                    })
                });

                if (!response.ok) throw new Error('API request failed');

                const data = await response.json();
                
                if (data.success && data.analysis) {
                    return {
                        success: true,
                        analysis: data.analysis,
                        cached: data.cached || false
                    };
                }
                
                throw new Error('Invalid response');
            } catch (error) {
                console.log('Claude API unavailable, using fallback:', error.message);
                return { success: false };
            }
        }

        function generateAISummary() {
            // Safety check for required data
            if (typeof insightsData === 'undefined') return;
            
            const sentiment = insightsData.sentiment;
            const change24h = insightsData.priceChange24h;
            const change7d = insightsData.priceChange7d;
            const change30d = insightsData.priceChange30d;
            const price = currentXRPPrice || 0;
            
            let sentimentText = '';
            if (sentiment >= 70) sentimentText = t('stronglyBullish');
            else if (sentiment >= 60) sentimentText = t('bullishText');
            else if (sentiment >= 45) sentimentText = t('neutralText');
            else if (sentiment >= 35) sentimentText = t('bearishText');
            else sentimentText = t('stronglyBearish');
            
            let trendText = change7d >= 0 ? t('upward') : t('downward');
            let momentumText = Math.abs(change24h) > 3 ? t('strong') : t('moderate');
            
            // Price vs MA analysis
            let maAnalysis = '';
            if (price > insightsData.ma7 && price > insightsData.ma30) {
                maAnalysis = t('maAboveBoth');
            } else if (price > insightsData.ma7) {
                maAnalysis = t('maAbove7');
            } else if (price < insightsData.ma7 && price < insightsData.ma30) {
                maAnalysis = t('maBelowBoth');
            } else {
                maAnalysis = t('maTestingLevels');
            }
            
            // ETF analysis
            let etfTotal = 0;
            etfColumns.forEach(col => {
                for (const row of holdingsData) {
                    if (row[col.key]?.xrp) {
                        etfTotal += row[col.key].xrp;
                        break;
                    }
                }
            });
            
            let exchangeTotal = 0;
            Object.values(exchangeData).forEach(data => {
                exchangeTotal += data.total || 0;
            });
            
            // Outlook
            let outlookText = '';
            if (sentiment >= 60) outlookText = t('outlookBullish');
            else if (sentiment >= 45) outlookText = t('outlookNeutral');
            else outlookText = t('outlookBearish');
            
            const html = `
                <p><strong>${t('aiMarketOverview')}:</strong> XRP ${currentLanguage === 'ko' ? '' : 'is currently trading at'} <span style="color: var(--accent-xrp);">$${price.toFixed(4)}</span> ${currentLanguage === 'ko' ? '  ' : 'with'} ${momentumText} ${trendText} ${t('momentum')}${currentLanguage === 'ko' ? ' ' : ''}. ${currentLanguage === 'ko' ? '  ' : 'The overall market sentiment is'} <span style="color: ${sentiment >= 50 ? 'var(--accent-green)' : 'var(--accent-red)'};">${sentimentText}</span>${currentLanguage === 'ko' ? '' : ''}.</p>
                
                <p><strong>${t('aiPriceAction')}:</strong></p>
                <ul>
                    <li>${t('change24h')}: <span style="color: ${change24h >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'};">${change24h >= 0 ? '+' : ''}${change24h.toFixed(2)}%</span></li>
                    <li>${t('change7d')}: <span style="color: ${change7d >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'};">${change7d >= 0 ? '+' : ''}${change7d.toFixed(2)}%</span></li>
                    <li>${t('change30d')}: <span style="color: ${change30d >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'};">${change30d >= 0 ? '+' : ''}${change30d.toFixed(2)}%</span></li>
                </ul>
                
                <p><strong>${t('aiTechnicalAnalysis')}:</strong> ${maAnalysis}</p>
                
                <p><strong>${t('aiETFExchange')}:</strong></p>
                <ul>
                    <li>${t('totalXRPinSpotETFs')}: <span style="color: var(--accent-xrp);">${formatHoldingsNumber(etfTotal)} XRP</span> (~$${formatHoldingsNumber(etfTotal * price)})</li>
                    ${exchangeTotal > 0 ? `<li>${t('totalXRPonExchanges')}: <span style="color: var(--accent-purple);">${formatHoldingsNumber(exchangeTotal)} XRP</span></li>` : `<li>${currentLanguage === 'ko' ? ' :    ' : 'Exchange data: Click Exchange tab to load'}</li>`}
                </ul>
                
                <p><strong>${t('aiOutlook')}:</strong> ${outlookText}</p>
            `;
            
            document.getElementById('aiSummary').innerHTML = html;
        }

        async function generateInsights() {
            const btn = document.querySelector('.insights-header .btn-refresh');
            if (!btn) return;
            
            btn.disabled = true;
            btn.textContent = ' Loading...';
            
            try {
                // Fetch real market data first - with error handling for each
                let priceHistoryOk = false;
                let marketDataOk = false;
                
                try {
                    priceHistoryOk = await fetchXRPPriceHistory();
                } catch (e) {
                    console.log('Price history fetch failed:', e.message);
                }
                
                try {
                    marketDataOk = await fetchXRPMarketData();
                } catch (e) {
                    console.log('Market data fetch failed:', e.message);
                }
                
                // Calculate metrics if we have any data
                if (priceHistoryOk || currentXRPPrice > 0) {
                    calculateMovingAverages();
                    calculateSentiment();
                }
                
                // Update UI components that don't need Claude
                try { updateSentimentGauge(); } catch(e) { console.log('Sentiment gauge error:', e); }
                try { renderMAChart(); } catch(e) { console.log('MA chart error:', e); }
                try { updateKeyMetrics(); } catch(e) { console.log('Key metrics error:', e); }
                try { renderComparisonChart(); } catch(e) { console.log('Comparison chart error:', e); }
                
                // Update new AI features
                try { updateDailyBriefing(); } catch(e) { console.log('Daily briefing error:', e); }
                try { updatePriceScenarios(); } catch(e) { console.log('Price scenarios error:', e); }
                try { updateTAExplanation(); } catch(e) { console.log('TA explanation error:', e); }
                try { updateDynamicColors(); } catch(e) { console.log('Dynamic colors error:', e); }
                try { updateSmartInsight(); } catch(e) { console.log('Smart insight error:', e); }
                try { updatePortfolioTracker(); } catch(e) { console.log('Portfolio tracker error:', e); }
                
                // Try to get Claude AI analysis
                btn.textContent = ' AI Analyzing...';
                const claudeResult = await fetchClaudeInsights();
                
                if (claudeResult.success) {
                    // Use Claude's analysis - format it nicely
                    const formattedAnalysis = claudeResult.analysis
                        .split('\n\n')
                        .map(para => `<p>${para}</p>`)
                        .join('');
                    
                    document.getElementById('aiSummary').innerHTML = formattedAnalysis + 
                        `<div style="margin-top: 1rem; font-size: 0.75rem; color: var(--text-muted);">
                             Analysis by Claude AI ${claudeResult.cached ? '(cached)' : ''}
                        </div>`;
                } else {
                    // Fallback to template-based summary
                    generateAISummary();
                }
                
                btn.textContent = ' Refresh Insights';
            } catch (error) {
                console.error('Error generating insights:', error);
                btn.textContent = ' Error - Retry';
                // Still try to show fallback summary
                generateAISummary();
            } finally {
                btn.disabled = false;
            }
        }

        // NEW: Daily Briefing Update
        function updateDailyBriefing() {
            // Safety check for required data
            if (typeof insightsData === 'undefined') return;
            
            const price = currentXRPPrice || 0;
            const change24h = insightsData.priceChange24h || 0;
            const change7d = insightsData.priceChange7d || 0;
            const sentiment = insightsData.sentiment || 50;
            
            // Set date based on language
            const today = new Date();
            const dateOptions = currentLanguage === 'ko' 
                ? { year: 'numeric', month: 'long', day: 'numeric' }
                : { month: 'short', day: 'numeric', year: 'numeric' };
            document.getElementById('briefingDate').textContent = today.toLocaleDateString(currentLanguage === 'ko' ? 'ko-KR' : 'en-US', dateOptions);
            
            // Determine greeting based on time
            const hour = today.getHours();
            let greeting = '';
            if (hour >= 17) greeting = '';
            else if (hour >= 12) greeting = '';
            else greeting = '';
            document.querySelector('.briefing-icon').textContent = greeting;
            
            // Generate briefing text
            let briefingText = '';
            if (change24h >= 5) {
                briefingText = `${t('strongDayUp')} ${change24h.toFixed(1)}% ${currentLanguage === 'ko' ? ',' : 'in the last 24 hours,'} $${price.toFixed(4)}${currentLanguage === 'ko' ? t('tradingAt') : ''}. `;
            } else if (change24h >= 0) {
                briefingText = `${t('upToday')} ${change24h.toFixed(1)}% ${currentLanguage === 'ko' ? ',' : 'today at'} $${price.toFixed(4)}. `;
            } else if (change24h >= -5) {
                briefingText = `${t('downToday')} ${Math.abs(change24h).toFixed(1)}% ${currentLanguage === 'ko' ? ',' : 'today at'} $${price.toFixed(4)}. `;
            } else {
                briefingText = `${t('volatileDay')} ${Math.abs(change24h).toFixed(1)}% ${t('droppedTo')} $${price.toFixed(4)}. `;
            }
            
            // Add context
            if (sentiment >= 60) {
                briefingText += t('bullishSentiment');
            } else if (sentiment >= 40) {
                briefingText += t('consolidatingSentiment');
            } else {
                briefingText += t('bearishSentiment');
            }
            
            document.getElementById('briefingContent').innerHTML = `<p class="briefing-main">${briefingText}</p>`;
            
            // Update quick stats
            document.getElementById('briefPrice').textContent = `$${price.toFixed(4)}`;
            document.getElementById('briefPrice').style.color = change24h >= 0 ? 'var(--accent-green)' : 'var(--accent-red)';
            
            const brief24hEl = document.getElementById('brief24h');
            brief24hEl.textContent = `${change24h >= 0 ? '+' : ''}${change24h.toFixed(1)}%`;
            brief24hEl.style.color = change24h >= 0 ? 'var(--accent-green)' : 'var(--accent-red)';
            
            let sentimentEmoji = sentiment >= 60 ? '' : (sentiment >= 40 ? '' : '');
            let sentimentWord = sentiment >= 60 ? t('bullishText') : (sentiment >= 40 ? t('neutralText') : t('bearishText'));
            document.getElementById('briefSentiment').textContent = `${sentimentEmoji} ${sentimentWord}`;
        }

        // NEW: Price Scenarios Update
        function updatePriceScenarios() {
            // Safety check for required data
            if (typeof insightsData === 'undefined') return;
            
            const price = currentXRPPrice || 2.0;
            const change7d = insightsData.priceChange7d || 0;
            const sentiment = insightsData.sentiment || 50;
            
            // Calculate scenario prices based on current price and momentum
            const momentum = change7d / 100;
            
            // Bullish case: +30-50% from current
            const bullishLow = price * 1.25;
            const bullishHigh = price * 1.45;
            document.getElementById('scenarioBullish').textContent = `$${bullishLow.toFixed(2)} - $${bullishHigh.toFixed(2)}`;
            
            // Base case: -5% to +15%
            const baseLow = price * 0.95;
            const baseHigh = price * 1.15;
            document.getElementById('scenarioBase').textContent = `$${baseLow.toFixed(2)} - $${baseHigh.toFixed(2)}`;
            
            // Bearish case: -15% to -25%
            const bearishLow = price * 0.75;
            const bearishHigh = price * 0.90;
            document.getElementById('scenarioBearish').textContent = `$${bearishLow.toFixed(2)} - $${bearishHigh.toFixed(2)}`;
            
            // Update conditions based on market context
            if (sentiment >= 60) {
                document.getElementById('scenarioBullishText').textContent = t('bullishCondition1');
                document.getElementById('probBullish').textContent = '40%';
                document.getElementById('probBase').textContent = '45%';
                document.getElementById('probBearish').textContent = '15%';
            } else if (sentiment >= 40) {
                document.getElementById('scenarioBullishText').textContent = t('bullishCondition2');
                document.getElementById('probBullish').textContent = '25%';
                document.getElementById('probBase').textContent = '50%';
                document.getElementById('probBearish').textContent = '25%';
            } else {
                document.getElementById('scenarioBullishText').textContent = t('bullishCondition3');
                document.getElementById('probBullish').textContent = '15%';
                document.getElementById('probBase').textContent = '40%';
                document.getElementById('probBearish').textContent = '45%';
            }
            
            // Update base and bearish conditions
            document.getElementById('scenarioBaseText').textContent = t('baseCondition');
            document.getElementById('scenarioBearishText').textContent = t('bearishCondition');
        }

        // NEW: Technical Analysis Explanation Update
        function updateTAExplanation() {
            // Safety check for required data
            if (typeof insightsData === 'undefined') return;
            
            const price = currentXRPPrice || 0;
            const ma7 = insightsData.ma7 || 0;
            const ma30 = insightsData.ma30 || 0;
            const ma90 = insightsData.ma90 || 0;
            const change24h = insightsData.priceChange24h || 0;
            
            // Determine overall signal
            let signal = 'neutral';
            let signalText = t('neutralSetup');
            let signalIcon = '';
            
            const aboveMA7 = price > ma7;
            const aboveMA30 = price > ma30;
            const aboveMA90 = ma90 > 0 ? price > ma90 : true;
            
            if (aboveMA7 && aboveMA30 && aboveMA90) {
                signal = 'bullish';
                signalText = t('bullishSetup');
                signalIcon = '';
            } else if (!aboveMA7 && !aboveMA30) {
                signal = 'bearish';
                signalText = t('bearishSetup');
                signalIcon = '';
            }
            
            // Update signal badge
            const badge = document.getElementById('taSignalBadge');
            badge.className = `ta-signal-badge ${signal}`;
            badge.innerHTML = `<span class="ta-signal-icon">${signalIcon}</span><span class="ta-signal-text">${signalText}</span>`;
            
            // Generate explanation based on language
            let explanation = '';
            if (signal === 'bullish') {
                if (currentLanguage === 'ko') {
                    explanation = `XRP <strong>  </strong>  .  ($${price.toFixed(4)})          . `;
                    if (ma7 > ma30) {
                        explanation += `7 MA ($${ma7.toFixed(4)}) 30 MA ($${ma30.toFixed(4)})       ""   . `;
                    }
                    explanation += `$${(price * 1.15).toFixed(2)}  7 MA  .`;
                } else {
                    explanation = `XRP is showing a <strong>bullish technical setup</strong>. The price ($${price.toFixed(4)}) is trading above all major moving averages, indicating strong upward momentum. `;
                    if (ma7 > ma30) {
                        explanation += `The 7-day MA ($${ma7.toFixed(4)}) is above the 30-day MA ($${ma30.toFixed(4)}), forming a "golden cross" pattern which historically signals continued upside. `;
                    }
                    explanation += `Watch for resistance at $${(price * 1.15).toFixed(2)} and support at the 7-day MA.`;
                }
            } else if (signal === 'bearish') {
                if (currentLanguage === 'ko') {
                    explanation = `XRP <strong>  </strong>  .  ($${price.toFixed(4)})       . `;
                    explanation += `7 MA ($${ma7.toFixed(4)})    .      30 MA ($${ma30.toFixed(4)})     .`;
                } else {
                    explanation = `XRP is showing a <strong>bearish technical setup</strong>. The price ($${price.toFixed(4)}) has fallen below key moving averages, suggesting downward pressure. `;
                    explanation += `The 7-day MA ($${ma7.toFixed(4)}) may act as resistance. Consider waiting for price to reclaim the 30-day MA ($${ma30.toFixed(4)}) before entering long positions.`;
                }
            } else {
                if (currentLanguage === 'ko') {
                    explanation = `XRP <strong> </strong> .  ($${price.toFixed(4)})     . `;
                    explanation += `30 MA ($${ma30.toFixed(4)})    , ${(ma30 * 0.95).toFixed(4)}       .`;
                } else {
                    explanation = `XRP is in a <strong>consolidation phase</strong>. The price ($${price.toFixed(4)}) is testing key moving average levels. `;
                    explanation += `A break above the 30-day MA ($${ma30.toFixed(4)}) would be bullish, while a breakdown below ${(ma30 * 0.95).toFixed(4)} could signal further downside.`;
                }
            }
            
            document.getElementById('taMainText').innerHTML = explanation;
            
            // Update price levels
            const support = Math.min(ma7, ma30) * 0.98;
            const resistance = price * 1.15;
            
            document.getElementById('taSupport').textContent = `$${support.toFixed(2)}`;
            document.getElementById('taCurrent').textContent = `$${price.toFixed(4)}`;
            document.getElementById('taResistance').textContent = `$${resistance.toFixed(2)}`;
        }

        // NEW: Dynamic Colors based on sentiment
        function updateDynamicColors() {
            const sentiment = insightsData.sentiment || 50;
            const change24h = insightsData.priceChange24h || 0;
            
            // Update briefing card border color
            const briefingCard = document.getElementById('briefingCard');
            if (briefingCard) {
                if (sentiment >= 60) {
                    briefingCard.style.borderColor = 'var(--accent-green)';
                    briefingCard.style.background = 'linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(34, 197, 94, 0.05))';
                } else if (sentiment >= 40) {
                    briefingCard.style.borderColor = 'var(--accent-xrp)';
                    briefingCard.style.background = 'linear-gradient(135deg, rgba(35, 247, 221, 0.1), rgba(168, 85, 247, 0.1))';
                } else {
                    briefingCard.style.borderColor = 'var(--accent-red)';
                    briefingCard.style.background = 'linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(239, 68, 68, 0.05))';
                }
            }
            
            // Update MA signal colors
            const updateMASignal = (elementId, maValue) => {
                const el = document.getElementById(elementId);
                if (el && maValue) {
                    const isAbove = currentXRPPrice > maValue;
                    el.className = `ma-signal ${isAbove ? 'bullish' : 'bearish'}`;
                    el.textContent = isAbove ? ' Above' : ' Below';
                }
            };
            
            updateMASignal('ma7Signal', insightsData.ma7);
            updateMASignal('ma30Signal', insightsData.ma30);
            updateMASignal('ma90Signal', insightsData.ma90);
        }

        // NEW: Portfolio Tracker
        function updatePortfolioTracker() {
            const holdings = parseFloat(document.getElementById('userXRPHoldings').value) || 0;
            const avgPrice = parseFloat(document.getElementById('userAvgPrice').value) || 0;
            const targetPrice = parseFloat(document.getElementById('userTargetPrice').value) || 0;
            const currentPrice = currentXRPPrice || 0;
            
            // Show results section if user has entered holdings
            const resultsDiv = document.getElementById('portfolioResults');
            if (holdings > 0) {
                resultsDiv.style.display = 'grid';
            } else {
                resultsDiv.style.display = 'none';
                return;
            }
            
            // Calculate values
            const currentValue = holdings * currentPrice;
            const costBasis = holdings * avgPrice;
            const pnl = currentValue - costBasis;
            const pnlPct = avgPrice > 0 ? ((currentPrice - avgPrice) / avgPrice) * 100 : 0;
            const targetValue = holdings * targetPrice;
            const targetGain = avgPrice > 0 ? ((targetPrice - avgPrice) / avgPrice) * 100 : 0;
            
            // Update current value
            document.getElementById('portfolioCurrentValue').textContent = `$${currentValue.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            
            const changeEl = document.getElementById('portfolioChange');
            const change24h = insightsData.priceChange24h || 0;
            const dailyChange = currentValue * (change24h / 100);
            changeEl.textContent = `${change24h >= 0 ? '+' : ''}$${dailyChange.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})} today`;
            changeEl.className = `portfolio-change ${change24h >= 0 ? 'positive' : 'negative'}`;
            
            // Update P&L
            const pnlEl = document.getElementById('portfolioPnL');
            pnlEl.textContent = `${pnl >= 0 ? '+' : ''}$${pnl.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            pnlEl.style.color = pnl >= 0 ? 'var(--accent-green)' : 'var(--accent-red)';
            
            const pnlPctEl = document.getElementById('portfolioPnLPct');
            pnlPctEl.textContent = `${pnlPct >= 0 ? '+' : ''}${pnlPct.toFixed(1)}%`;
            pnlPctEl.className = `portfolio-pnl-pct ${pnlPct >= 0 ? 'positive' : 'negative'}`;
            
            // Update target value
            if (targetPrice > 0) {
                document.getElementById('portfolioTargetValue').textContent = `$${targetValue.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                document.getElementById('portfolioTargetGain').textContent = `+${targetGain.toFixed(0)}% from cost`;
            }
            
            // Generate AI insight
            let insight = '';
            if (pnlPct >= 100) {
                insight = ` Amazing! You've more than doubled your investment. Consider taking some profits to lock in gains while letting winners run.`;
            } else if (pnlPct >= 50) {
                insight = ` Strong gains! Your portfolio is up ${pnlPct.toFixed(0)}%. The market is in your favor - consider your exit strategy.`;
            } else if (pnlPct >= 0) {
                insight = ` You're in profit! With ${pnlPct.toFixed(1)}% gains, you're ahead of your cost basis. Stay patient and stick to your plan.`;
            } else if (pnlPct >= -20) {
                insight = ` Small drawdown of ${Math.abs(pnlPct).toFixed(1)}%. This is normal volatility. If your thesis hasn't changed, this could be an accumulation opportunity.`;
            } else {
                insight = ` Significant drawdown. You're down ${Math.abs(pnlPct).toFixed(1)}%. Review your investment thesis. Don't panic sell, but don't average down without a plan.`;
            }
            
            if (targetPrice > 0 && currentPrice > 0) {
                const toTarget = ((targetPrice - currentPrice) / currentPrice) * 100;
                insight += ` Your target is ${toTarget.toFixed(0)}% away from current price.`;
            }
            
            document.getElementById('portfolioInsight').textContent = insight;
        }

        function savePortfolio() {
            const holdings = document.getElementById('userXRPHoldings').value;
            const avgPrice = document.getElementById('userAvgPrice').value;
            const targetPrice = document.getElementById('userTargetPrice').value;
            
            localStorage.setItem('xrp_portfolio', JSON.stringify({
                holdings, avgPrice, targetPrice
            }));
            
            document.getElementById('saveStatus').textContent = ' Saved!';
            setTimeout(() => {
                document.getElementById('saveStatus').textContent = '';
            }, 2000);
        }

        function loadPortfolio() {
            const saved = localStorage.getItem('xrp_portfolio');
            if (saved) {
                const data = JSON.parse(saved);
                document.getElementById('userXRPHoldings').value = data.holdings || '';
                document.getElementById('userAvgPrice').value = data.avgPrice || '';
                document.getElementById('userTargetPrice').value = data.targetPrice || '';
                updatePortfolioTracker();
            }
        }

        // NEW: Smart Insight Card
        function updateSmartInsight() {
            const price = currentXRPPrice || 0;
            const change24h = insightsData.priceChange24h || 0;
            const change7d = insightsData.priceChange7d || 0;
            const sentiment = insightsData.sentiment || 50;
            const ma7 = insightsData.ma7 || 0;
            const ma30 = insightsData.ma30 || 0;
            
            let badge = ' TODAY\'S KEY INSIGHT';
            let title = '';
            let text = '';
            let action = '';
            let cardColor = 'var(--accent-orange)';
            
            // Determine the most important insight
            if (Math.abs(change24h) >= 10) {
                // Big price move
                if (change24h >= 10) {
                    badge = ' MAJOR BREAKOUT';
                    title = `XRP Surges ${change24h.toFixed(1)}% in 24 Hours!`;
                    text = `Massive bullish momentum with price jumping to $${price.toFixed(4)}. This is one of the strongest daily moves in recent weeks.`;
                    action = 'Consider taking partial profits if you\'re in significant profit. FOMO buying at highs is risky.';
                    cardColor = 'var(--accent-green)';
                } else {
                    badge = ' SHARP DECLINE';
                    title = `XRP Drops ${Math.abs(change24h).toFixed(1)}% - Key Levels to Watch`;
                    text = `Significant selling pressure has pushed XRP to $${price.toFixed(4)}. Watch for support at the 30-day MA.`;
                    action = 'Don\'t panic sell. If fundamentals unchanged, this could be a buying opportunity.';
                    cardColor = 'var(--accent-red)';
                }
            } else if (ma7 > ma30 && price > ma7 && sentiment >= 60) {
                // Golden cross / bullish setup
                badge = ' BULLISH MOMENTUM';
                title = 'Technical Setup Favors Bulls';
                text = `XRP ($${price.toFixed(4)}) is trading above all key moving averages with positive momentum. The 7-day MA is above 30-day MA - a bullish signal.`;
                action = 'Trend is your friend. Consider holding positions or adding on dips to support.';
                cardColor = 'var(--accent-green)';
            } else if (ma7 < ma30 && price < ma7) {
                // Death cross / bearish setup
                badge = ' CAUTION ADVISED';
                title = 'Technical Weakness Detected';
                text = `XRP has fallen below key moving averages. The 7-day MA crossing below 30-day MA suggests near-term weakness.`;
                action = 'Be patient. Wait for price to reclaim MAs before adding positions.';
                cardColor = 'var(--accent-red)';
            } else if (change7d >= 15) {
                // Strong weekly performance
                badge = ' WEEKLY WINNER';
                title = `XRP Up ${change7d.toFixed(1)}% This Week`;
                text = `Strong weekly performance puts XRP among the top performers. Momentum traders are taking notice.`;
                action = 'Weekly trends often continue. Trail stops to protect profits.';
                cardColor = 'var(--accent-green)';
            } else {
                // Default: consolidation
                badge = ' CONSOLIDATION ZONE';
                title = 'Market Awaiting Catalyst';
                text = `XRP is trading at $${price.toFixed(4)} in a consolidation phase. Volume and volatility are relatively muted.`;
                action = 'Good time to accumulate if you believe in long-term thesis. Set alerts for breakout levels.';
                cardColor = 'var(--accent-orange)';
            }
            
            // Update the card
            const card = document.getElementById('smartInsightCard');
            if (card) {
                card.style.borderColor = cardColor;
                card.style.background = `linear-gradient(135deg, ${cardColor}22, ${cardColor}11)`;
            }
            
            document.getElementById('smartInsightBadge').textContent = badge;
            document.getElementById('smartInsightBadge').style.background = cardColor;
            document.getElementById('smartInsightTitle').textContent = title;
            document.getElementById('smartInsightText').textContent = text;
            document.getElementById('smartActionText').textContent = action;
        }

        function updateSentimentGauge() {
            const score = insightsData.sentiment;
            let sentimentLabel = '';
            let color = '';
            
            if (score >= 70) { sentimentLabel = 'Bullish'; color = 'var(--accent-green)'; }
            else if (score >= 55) { sentimentLabel = 'Slightly Bullish'; color = '#22c55e99'; }
            else if (score >= 45) { sentimentLabel = 'Neutral'; color = 'var(--accent-orange)'; }
            else if (score >= 30) { sentimentLabel = 'Slightly Bearish'; color = '#ef444499'; }
            else { sentimentLabel = 'Bearish'; color = 'var(--accent-red)'; }
            
            document.getElementById('sentimentGauge').style.width = (100 - score) + '%';
            document.getElementById('sentimentText').textContent = `${sentimentLabel} (${Math.round(score)}/100)`;
            document.getElementById('sentimentText').style.color = color;
        }

        function updateKeyMetrics() {
            // Volume trend
            const volumeEl = document.querySelector('.metric-card:nth-child(1) .metric-value');
            if (volumeEl && insightsData.volume24h) {
                const volInM = insightsData.volume24h / 1000000;
                volumeEl.textContent = '$' + volInM.toFixed(0) + 'M';
            }
            
            // Update 24h change in metrics
            const change24h = insightsData.priceChange24h;
            const trendEl = document.querySelector('.metric-card:nth-child(1) .metric-value');
            if (trendEl) {
                trendEl.textContent = (change24h >= 0 ? '+' : '') + change24h.toFixed(1) + '%';
                trendEl.className = 'metric-value ' + (change24h >= 0 ? 'positive' : 'negative');
            }
        }

        function renderMAChart() {
            const canvas = document.getElementById('maChart');
            if (!canvas) return;

            if (maChart) maChart.destroy();

            const ctx = canvas.getContext('2d');
            
            // Use real price history data
            let labels = [];
            let priceData = [];
            let ma7Data = [];
            let ma30Data = [];
            
            if (xrpPriceHistory.length > 0) {
                // Use last 30 days of real data
                const last30Days = xrpPriceHistory.slice(-30);
                
                labels = last30Days.map(p => p.date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
                priceData = last30Days.map(p => p.price);
                
                // Calculate rolling MAs
                for (let i = 0; i < last30Days.length; i++) {
                    const dayIndex = xrpPriceHistory.length - 30 + i;
                    
                    // 7-day MA
                    if (dayIndex >= 6) {
                        const slice = xrpPriceHistory.slice(dayIndex - 6, dayIndex + 1);
                        ma7Data.push(slice.reduce((a, b) => a + b.price, 0) / 7);
                    } else {
                        ma7Data.push(null);
                    }
                    
                    // 30-day MA
                    if (dayIndex >= 29) {
                        const slice = xrpPriceHistory.slice(dayIndex - 29, dayIndex + 1);
                        ma30Data.push(slice.reduce((a, b) => a + b.price, 0) / 30);
                    } else {
                        ma30Data.push(null);
                    }
                }
            } else {
                // Fallback to simulated data if fetch failed
                let price = currentXRPPrice || 2.0;
                for (let i = 30; i >= 0; i--) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    labels.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
                    price = price * (1 + (Math.random() - 0.48) * 0.03);
                    priceData.push(price);
                }
            }

            maChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels,
                    datasets: [
                        {
                            label: 'XRP Price',
                            data: priceData,
                            borderColor: '#23f7dd',
                            backgroundColor: 'rgba(35, 247, 221, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 2
                        },
                        {
                            label: '7-Day MA',
                            data: ma7Data,
                            borderColor: '#a855f7',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            fill: false,
                            tension: 0.4,
                            pointRadius: 0
                        },
                        {
                            label: '30-Day MA',
                            data: ma30Data,
                            borderColor: '#f97316',
                            borderWidth: 2,
                            borderDash: [10, 5],
                            fill: false,
                            tension: 0.4,
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: { color: '#a0a0c0' }
                        },
                        tooltip: {
                            backgroundColor: '#16161f',
                            borderColor: '#23f7dd',
                            borderWidth: 1,
                            callbacks: {
                                label: (ctx) => ctx.dataset.label + ': $' + ctx.raw.toFixed(4)
                            }
                        }
                    },
                    scales: {
                        x: { ticks: { color: '#707085' }, grid: { color: '#2a2a3a' } },
                        y: { 
                            ticks: { 
                                color: '#707085',
                                callback: (v) => '$' + v.toFixed(2)
                            }, 
                            grid: { color: '#2a2a3a' } 
                        }
                    }
                }
            });

            // Update MA indicator values
            const latestPrice = priceData[priceData.length - 1] || currentXRPPrice;
            const latest7MA = insightsData.ma7 || ma7Data.filter(x => x).pop() || 0;
            const latest30MA = insightsData.ma30 || ma30Data.filter(x => x).pop() || 0;
            const latest90MA = insightsData.ma90 || 0;
            
            document.getElementById('ma7').textContent = '$' + latest7MA.toFixed(4);
            document.getElementById('ma30').textContent = '$' + latest30MA.toFixed(4);
            document.getElementById('ma90').textContent = '$' + latest90MA.toFixed(4);
            
            // Update MA signals
            const ma7Signal = document.querySelector('.ma-indicator:nth-child(1) .ma-signal');
            const ma30Signal = document.querySelector('.ma-indicator:nth-child(2) .ma-signal');
            const ma90Signal = document.querySelector('.ma-indicator:nth-child(3) .ma-signal');
            
            if (ma7Signal && latestPrice) {
                ma7Signal.textContent = latestPrice > latest7MA ? ' Above' : ' Below';
                ma7Signal.className = 'ma-signal ' + (latestPrice > latest7MA ? 'bullish' : 'bearish');
            }
            if (ma30Signal && latestPrice) {
                ma30Signal.textContent = latestPrice > latest30MA ? ' Above' : ' Below';
                ma30Signal.className = 'ma-signal ' + (latestPrice > latest30MA ? 'bullish' : 'bearish');
            }
            if (ma90Signal && latestPrice && latest90MA) {
                ma90Signal.textContent = latestPrice > latest90MA ? ' Above' : ' Below';
                ma90Signal.className = 'ma-signal ' + (latestPrice > latest90MA ? 'bullish' : 'bearish');
            }
        }

        function renderComparisonChart() {
            const canvas = document.getElementById('comparisonChart');
            if (!canvas) return;

            if (comparisonChart) comparisonChart.destroy();

            const ctx = canvas.getContext('2d');
            
            // Use real data from cached ETF data if available
            let xrpVolume = 0;
            let btcVolume = 0;
            let ethVolume = 0;
            
            if (cachedData && cachedData.data) {
                // Calculate XRP ETF volume
                const xrpETFs = cachedData.data['XRP Spot ETFs'] || [];
                xrpETFs.forEach(etf => {
                    xrpVolume += (etf.daily?.dollars || 0);
                });
                
                // Calculate BTC ETF volume
                const btcETFs = cachedData.data['Bitcoin Spot ETFs'] || [];
                btcETFs.forEach(etf => {
                    btcVolume += (etf.daily?.dollars || 0);
                });
                
                // Calculate ETH ETF volume
                const ethETFs = cachedData.data['Ethereum Spot ETFs'] || [];
                ethETFs.forEach(etf => {
                    ethVolume += (etf.daily?.dollars || 0);
                });
            }
            
            // Convert to millions
            xrpVolume = xrpVolume / 1000000;
            btcVolume = btcVolume / 1000000;
            ethVolume = ethVolume / 1000000;
            
            const etf1 = document.getElementById('compareETF1').value;
            const etf2 = document.getElementById('compareETF2').value;
            
            const volumeMap = {
                'XRP': xrpVolume || 125,
                'BTC': btcVolume || 2100,
                'ETH': ethVolume || 450
            };
            
            const colorMap = {
                'XRP': { bg: '#23f7dd80', border: '#23f7dd' },
                'BTC': { bg: '#f9731680', border: '#f97316' },
                'ETH': { bg: '#a855f780', border: '#a855f7' }
            };
            
            comparisonChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: [etf1 + ' ETFs', etf2 + ' ETFs'],
                    datasets: [{
                        label: 'Daily Volume ($M)',
                        data: [volumeMap[etf1], volumeMap[etf2]],
                        backgroundColor: [colorMap[etf1].bg, colorMap[etf2].bg],
                        borderColor: [colorMap[etf1].border, colorMap[etf2].border],
                        borderWidth: 2,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: '#16161f',
                            borderColor: '#23f7dd',
                            borderWidth: 1,
                            callbacks: {
                                label: (ctx) => 'Volume: $' + ctx.raw.toFixed(1) + 'M'
                            }
                        }
                    },
                    scales: {
                        x: { ticks: { color: '#707085' }, grid: { display: false } },
                        y: { 
                            ticks: { 
                                color: '#707085',
                                callback: (v) => '$' + v + 'M'
                            }, 
                            grid: { color: '#2a2a3a' } 
                        }
                    }
                }
            });
            
            // Update comparison stats
            updateComparisonStats(etf1, etf2, volumeMap);
        }

        function updateComparisonStats(etf1, etf2, volumeMap) {
            const statsContainer = document.getElementById('comparisonStats');
            if (!statsContainer) return;
            
            // Get change percentages (use real data if available)
            const changeMap = {
                'XRP': insightsData.priceChange7d || 12.5,
                'BTC': 8.2,
                'ETH': 5.4
            };
            
            // AUM estimates
            const aumMap = {
                'XRP': 1.5,
                'BTC': 28,
                'ETH': 8
            };
            
            statsContainer.innerHTML = `
                <div class="comp-stat">
                    <div class="comp-stat-label">Daily Volume</div>
                    <div class="comp-stat-values">
                        <span class="comp-val-1">$${volumeMap[etf1]?.toFixed(0) || ''}M</span>
                        <span class="comp-val-2">$${volumeMap[etf2]?.toFixed(0) || ''}M</span>
                    </div>
                </div>
                <div class="comp-stat">
                    <div class="comp-stat-label">7D Change</div>
                    <div class="comp-stat-values">
                        <span class="comp-val-1 ${changeMap[etf1] >= 0 ? 'positive' : 'negative'}">${changeMap[etf1] >= 0 ? '+' : ''}${changeMap[etf1]?.toFixed(1)}%</span>
                        <span class="comp-val-2 ${changeMap[etf2] >= 0 ? 'positive' : 'negative'}">${changeMap[etf2] >= 0 ? '+' : ''}${changeMap[etf2]?.toFixed(1)}%</span>
                    </div>
                </div>
                <div class="comp-stat">
                    <div class="comp-stat-label">Est. AUM</div>
                    <div class="comp-stat-values">
                        <span class="comp-val-1">$${aumMap[etf1]}B</span>
                        <span class="comp-val-2">$${aumMap[etf2]}B</span>
                    </div>
                </div>
            `;
        }

        function updateComparison() {
            renderComparisonChart();
        }

        // =====================================================
        // AI CHAT ASSISTANT
        // =====================================================
        let chatHistory = [];
        
        function toggleChat() {
            const widget = document.getElementById('chatWidget');
            const btn = document.getElementById('chatToggleBtn');
            widget.classList.toggle('open');
            btn.classList.toggle('active');
            btn.textContent = widget.classList.contains('open') ? '' : '';
            
            if (widget.classList.contains('open')) {
                document.getElementById('chatInput').focus();
            }
        }
        
        function handleChatKeypress(event) {
            if (event.key === 'Enter') {
                sendChatMessage();
            }
        }
        
        function askQuestion(question) {
            document.getElementById('chatInput').value = question;
            sendChatMessage();
        }
        
        async function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;
            
            // Add user message
            addChatMessage(message, 'user');
            input.value = '';
            
            // Show typing indicator
            const typingId = showTypingIndicator();
            
            // Generate AI response
            try {
                const response = await generateChatResponse(message);
                removeTypingIndicator(typingId);
                addChatMessage(response, 'assistant');
            } catch (error) {
                removeTypingIndicator(typingId);
                addChatMessage("Sorry, I couldn't process that. Please try again.", 'assistant');
            }
        }
        
        function addChatMessage(text, type) {
            const container = document.getElementById('chatMessages');
            const msg = document.createElement('div');
            msg.className = `chat-message ${type}`;
            msg.innerHTML = text;
            container.appendChild(msg);
            container.scrollTop = container.scrollHeight;
            
            chatHistory.push({ role: type, content: text });
        }
        
        function showTypingIndicator() {
            const container = document.getElementById('chatMessages');
            const typing = document.createElement('div');
            typing.className = 'chat-message assistant typing';
            typing.id = 'typing-' + Date.now();
            typing.innerHTML = '<div class="typing-dots"><span></span><span></span><span></span></div>';
            container.appendChild(typing);
            container.scrollTop = container.scrollHeight;
            return typing.id;
        }
        
        function removeTypingIndicator(id) {
            const typing = document.getElementById(id);
            if (typing) typing.remove();
        }
        
        async function generateChatResponse(question) {
            const price = currentXRPPrice || 0;
            const change24h = insightsData.priceChange24h || 0;
            const change7d = insightsData.priceChange7d || 0;
            const change30d = insightsData.priceChange30d || 0;
            const ma7 = insightsData.ma7 || 0;
            const ma30 = insightsData.ma30 || 0;
            const ma90 = insightsData.ma90 || 0;
            const sentiment = insightsData.sentiment || 50;
            const volume24h = insightsData.volume24h || 0;
            
            // Try Claude AI first
            try {
                const response = await fetchClaudeChatResponse(question, {
                    currentPrice: price,
                    priceChange24h: change24h,
                    priceChange7d: change7d,
                    priceChange30d: change30d,
                    ma7: ma7,
                    ma30: ma30,
                    ma90: ma90,
                    sentiment: sentiment,
                    volume24h: volume24h
                });
                
                if (response.success) {
                    return response.reply;
                }
            } catch (error) {
                console.log('Claude AI not available, using local response');
            }
            
            // Fallback to local responses if Claude unavailable
            return generateLocalResponse(question, { price, change24h, change7d, ma7, ma30, sentiment });
        }
        
        async function fetchClaudeChatResponse(question, marketData) {
            const API_URL = window.API_URL || 'https://xrp-gtve.onrender.com';
            
            const response = await fetch(`${API_URL}/api/chat`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    question: question,
                    marketData: marketData,
                    chatHistory: chatHistory.slice(-6), // Last 6 messages for context
                    language: currentLanguage // Send language preference
                })
            });
            
            if (!response.ok) {
                throw new Error('Chat API not available');
            }
            
            return await response.json();
        }
        
        function generateLocalResponse(question, data) {
            const { price, change24h, change7d, ma7, ma30, sentiment } = data;
            const q = question.toLowerCase();
            
            // Price questions
            if (q.includes('price') || q.includes('cost') || q.includes('worth') || q.includes('trading')) {
                return ` <strong>XRP is currently trading at $${price.toFixed(4)}</strong><br><br>
                     24h Change: <span style="color: ${change24h >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'}">${change24h >= 0 ? '+' : ''}${change24h.toFixed(2)}%</span><br>
                     7d Change: <span style="color: ${change7d >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'}">${change7d >= 0 ? '+' : ''}${change7d.toFixed(2)}%</span><br>
                     7-Day MA: $${ma7.toFixed(4)}<br>
                     30-Day MA: $${ma30.toFixed(4)}`;
            }
            
            // Buy/sell questions
            if (q.includes('buy') || q.includes('sell') || q.includes('should i') || q.includes('invest')) {
                let advice = '';
                if (sentiment >= 65 && price > ma7 && price > ma30) {
                    advice = ` <strong>Technical Setup: BULLISH</strong><br><br>
                        The current setup looks favorable:<br>
                         Price is above all moving averages <br>
                         Sentiment: ${sentiment}/100 (Bullish) <br>
                         Momentum is positive <br><br>
                        <em>However, consider dollar-cost averaging rather than going all-in. Set a stop-loss below $${(ma30 * 0.95).toFixed(2)} to manage risk.</em>`;
                } else if (sentiment <= 40 || price < ma30) {
                    advice = ` <strong>Technical Setup: CAUTIOUS</strong><br><br>
                        Current conditions suggest patience:<br>
                         Price is ${price < ma30 ? 'below' : 'near'} key MAs <br>
                         Sentiment: ${sentiment}/100 <br><br>
                        <em>Consider waiting for price to reclaim the 30-day MA ($${ma30.toFixed(4)}) before adding positions.</em>`;
                } else {
                    advice = ` <strong>Technical Setup: NEUTRAL</strong><br><br>
                        Mixed signals currently:<br>
                         Price: $${price.toFixed(4)}<br>
                         Sentiment: ${sentiment}/100 (Neutral)<br><br>
                        <em>No strong directional bias. Good time to set alerts for breakout levels.</em>`;
                }
                return advice + `<br><br> <em>Not financial advice. Always DYOR.</em>`;
            }
            
            // Support/resistance questions
            if (q.includes('support') || q.includes('resistance') || q.includes('level') || q.includes('target')) {
                const support = Math.min(ma7, ma30) * 0.98;
                const resistance = price * 1.15;
                return ` <strong>Key Price Levels</strong><br><br>
                    <span style="color: var(--accent-green)"> Support:</span> $${support.toFixed(2)} / $${ma30.toFixed(4)}<br>
                    <span style="color: var(--accent-red)"> Resistance:</span> $${(price * 1.10).toFixed(2)} / $${resistance.toFixed(2)}<br><br>
                    <em>Watch for volume confirmation at these levels.</em>`;
            }
            
            // Sentiment questions
            if (q.includes('sentiment') || q.includes('mood') || q.includes('feeling') || q.includes('bullish') || q.includes('bearish')) {
                let sentimentEmoji = sentiment >= 65 ? '' : (sentiment >= 45 ? '' : '');
                let sentimentWord = sentiment >= 65 ? 'Bullish' : (sentiment >= 45 ? 'Neutral' : 'Bearish');
                return `${sentimentEmoji} <strong>Market Sentiment: ${sentimentWord} (${sentiment}/100)</strong><br><br>
                     Price vs MA7: ${price > ma7 ? 'Above ' : 'Below '}<br>
                     Price vs MA30: ${price > ma30 ? 'Above ' : 'Below '}<br>
                     7d Momentum: ${change7d >= 0 ? 'Positive ' : 'Negative '}`;
            }
            
            // ETF questions
            if (q.includes('etf') || q.includes('holdings') || q.includes('institutional') || q.includes('grayscale') || q.includes('bitwise')) {
                return ` <strong>XRP ETF Overview</strong><br><br>
                    US Spot ETFs now trading:<br>
                     <strong>GXRP</strong> - Grayscale (lowest fees)<br>
                     <strong>XRP</strong> - Bitwise (highest volume)<br>
                     <strong>XRPC</strong> - Canary Capital<br>
                     <strong>XRPZ</strong> - Franklin<br>
                     <strong>TOXR</strong> - 21Shares<br>
                     <strong>XRPR</strong> - REX-Osprey<br><br>
                    Check the <strong>ETF Holdings</strong> tab for details.`;
            }
            
            // Technical analysis
            if (q.includes('technical') || q.includes('analysis') || q.includes('ta') || q.includes('indicator') || q.includes('ma') || q.includes('moving')) {
                const signal = (price > ma7 && price > ma30) ? 'BULLISH' : ((price < ma7 && price < ma30) ? 'BEARISH' : 'NEUTRAL');
                return ` <strong>Technical Analysis: ${signal}</strong><br><br>
                     Price: $${price.toFixed(4)}<br>
                     7-Day MA: $${ma7.toFixed(4)} (${price > ma7 ? 'Above ' : 'Below '})<br>
                     30-Day MA: $${ma30.toFixed(4)} (${price > ma30 ? 'Above ' : 'Below '})<br>
                     Trend: ${change7d >= 0 ? 'Uptrend ' : 'Downtrend '}<br><br>
                    ${ma7 > ma30 ? ' Golden Cross (7MA > 30MA) - Bullish' : ' Watch for Golden Cross'}`;
            }
            
            // News/events
            if (q.includes('news') || q.includes('event') || q.includes('happening') || q.includes('update')) {
                return ` <strong>Latest Updates</strong><br><br>
                     XRP Spot ETFs are actively trading in the US<br>
                     Institutional adoption continues to grow<br>
                     Check the <strong>News</strong> tab for detailed headlines<br><br>
                    <em>AI News Analysis available in the News tab!</em>`;
            }
            
            // Ripple/XRP questions
            if (q.includes('ripple') || q.includes('xrp') || q.includes('what is')) {
                return ` <strong>About XRP</strong><br><br>
                    XRP is a digital asset built for payments. Key facts:<br>
                     Created by Ripple Labs<br>
                     Fast transactions (~3-5 seconds)<br>
                     Low fees (~$0.0002)<br>
                     Used by banks & financial institutions<br>
                     Current price: <strong>$${price.toFixed(4)}</strong>`;
            }
            
            // Prediction questions
            if (q.includes('predict') || q.includes('future') || q.includes('moon') || q.includes('when') || q.includes('will it')) {
                return ` <strong>Price Outlook</strong><br><br>
                    Based on current technicals:<br>
                     <span style="color: var(--accent-green)">Bullish target:</span> $${(price * 1.3).toFixed(2)} - $${(price * 1.5).toFixed(2)}<br>
                     <span style="color: var(--accent-blue)">Base case:</span> $${(price * 0.95).toFixed(2)} - $${(price * 1.15).toFixed(2)}<br>
                     <span style="color: var(--accent-red)">Support:</span> $${(Math.min(ma7, ma30) * 0.95).toFixed(2)}<br><br>
                     <em>Predictions are speculative. Markets are unpredictable!</em>`;
            }
            
            // Help/default
            return ` I can answer questions about:<br><br>
                 <strong>Price</strong> - "What's the price?" "How is XRP doing?"<br>
                 <strong>Analysis</strong> - "Technical analysis" "Should I buy?"<br>
                 <strong>Levels</strong> - "Support levels?" "Price targets?"<br>
                 <strong>Sentiment</strong> - "Market mood?" "Bullish or bearish?"<br>
                 <strong>ETFs</strong> - "ETF info" "Institutional holdings"<br>
                 <strong>Outlook</strong> - "Price prediction?" "Future?"<br><br>
                <em>Ask me anything! </em>`;
        }

        // =====================================================
        // ANALYTICS TAB FUNCTIONS
        // =====================================================
        
        function initAnalytics() {
            // Populate exchange selector for wallet details
            const select = document.getElementById('walletExchangeSelect');
            if (select) {
                select.innerHTML = '<option value="">Select an exchange...</option>';
                Object.keys(EXCHANGES).sort().forEach(exchange => {
                    const option = document.createElement('option');
                    option.value = exchange;
                    option.textContent = exchange.charAt(0).toUpperCase() + exchange.slice(1);
                    select.appendChild(option);
                });
            }
        }
        
        async function refreshAnalytics() {
            if (Object.keys(exchangeData).length === 0) {
                // Need to fetch exchange data first
                updateStatus('loading', 'Loading exchange data...');
                await fetchExchangeData(true);
            }
            updateAnalytics();
        }
        
        function updateAnalytics() {
            if (Object.keys(exchangeData).length === 0) {
                return;
            }
            
            // Build analytics data with historical comparison
            analyticsData = {};
            let totalXRP = 0;
            
            Object.entries(exchangeData).forEach(([name, data]) => {
                const current = data.total || 0;
                let historical = 0;
                
                // Calculate historical total for this exchange
                if (EXCHANGES[name]) {
                    Object.keys(EXCHANGES[name]).forEach(address => {
                        if (HISTORICAL_BALANCES[address]) {
                            historical += HISTORICAL_BALANCES[address];
                        }
                    });
                }
                
                const change = historical > 0 ? current - historical : 0;
                const changePct = historical > 0 ? ((current - historical) / historical) * 100 : 0;
                
                analyticsData[name] = {
                    current: current,
                    historical: historical,
                    change: change,
                    changePct: changePct,
                    walletCount: data.walletCount || 0
                };
                
                totalXRP += current;
            });
            
            // Update summary cards
            document.getElementById('analyticsTotalXRP').textContent = formatHoldingsNumber(totalXRP);
            document.getElementById('analyticsExchangeCount').textContent = Object.keys(analyticsData).length;
            
            // Calculate top 3 dominance
            const sorted = Object.entries(analyticsData).sort((a, b) => b[1].current - a[1].current);
            const top3Total = sorted.slice(0, 3).reduce((sum, [_, data]) => sum + data.current, 0);
            const top3Pct = totalXRP > 0 ? (top3Total / totalXRP) * 100 : 0;
            document.getElementById('analyticsTop3').textContent = top3Pct.toFixed(1) + '%';
            
            // Calculate net flow
            let netFlow = 0;
            Object.values(analyticsData).forEach(data => {
                if (data.historical > 0) {
                    netFlow += data.change;
                }
            });
            
            const flowEl = document.getElementById('analyticsNetFlow');
            const flowDirEl = document.getElementById('analyticsFlowDirection');
            flowEl.textContent = (netFlow >= 0 ? '+' : '') + formatHoldingsNumber(netFlow);
            flowEl.style.color = netFlow >= 0 ? 'var(--accent-green)' : 'var(--accent-red)';
            flowDirEl.textContent = netFlow >= 0 ? ' Net Inflow (Accumulation)' : ' Net Outflow (Distribution)';
            flowDirEl.className = 'analytics-subtext ' + (netFlow >= 0 ? 'positive' : 'negative');
            
            // Update charts and rankings
            updateAnalyticsChart();
            updateAnalyticsRankings(sorted, totalXRP);
            updateChangeCharts(sorted);
            updateFlowLists(sorted);
        }
        
        function updateAnalyticsChart() {
            const chartType = document.getElementById('analyticsChartType').value;
            const topN = parseInt(document.getElementById('analyticsTopN').value);
            
            document.getElementById('analyticsChartTitle').textContent = `Top ${topN} Exchange Holdings`;
            
            const sorted = Object.entries(analyticsData)
                .sort((a, b) => b[1].current - a[1].current)
                .slice(0, topN);
            
            const labels = sorted.map(([name, _]) => name.charAt(0).toUpperCase() + name.slice(1));
            const data = sorted.map(([_, d]) => d.current);
            const colors = generateColors(topN);
            
            const ctx = document.getElementById('analyticsMainChart').getContext('2d');
            
            if (analyticsChart) {
                analyticsChart.destroy();
            }
            
            let chartConfig;
            
            if (chartType === 'bar') {
                chartConfig = {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'XRP Balance',
                            data: data,
                            backgroundColor: colors,
                            borderColor: colors.map(c => c.replace('0.8', '1')),
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: (ctx) => formatHoldingsNumber(ctx.raw) + ' XRP'
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: { callback: (v) => formatHoldingsNumber(v), color: '#94a3b8' },
                                grid: { color: 'rgba(255,255,255,0.1)' }
                            },
                            x: {
                                ticks: { color: '#94a3b8' },
                                grid: { display: false }
                            }
                        }
                    }
                };
            } else if (chartType === 'horizontal') {
                chartConfig = {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'XRP Balance',
                            data: data,
                            backgroundColor: colors,
                            borderWidth: 0
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            x: {
                                ticks: { callback: (v) => formatHoldingsNumber(v), color: '#94a3b8' },
                                grid: { color: 'rgba(255,255,255,0.1)' }
                            },
                            y: {
                                ticks: { color: '#94a3b8' },
                                grid: { display: false }
                            }
                        }
                    }
                };
            } else if (chartType === 'pie') {
                chartConfig = {
                    type: 'doughnut',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: colors,
                            borderWidth: 2,
                            borderColor: '#1e293b'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'right', labels: { color: '#94a3b8' } }
                        }
                    }
                };
            } else if (chartType === 'treemap') {
                // Treemap using nested rectangles (simplified version)
                chartConfig = {
                    type: 'doughnut',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: colors,
                            borderWidth: 2,
                            borderColor: '#1e293b'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { position: 'right', labels: { color: '#94a3b8' } } }
                    }
                };
            }
            
            analyticsChart = new Chart(ctx, chartConfig);
        }
        
        function updateAnalyticsRankings(sorted, totalXRP) {
            const container = document.getElementById('analyticsRankings');
            container.innerHTML = '';
            
            sorted.slice(0, 10).forEach(([name, data], index) => {
                const share = totalXRP > 0 ? (data.current / totalXRP) * 100 : 0;
                const posClass = index === 0 ? 'gold' : (index === 1 ? 'silver' : (index === 2 ? 'bronze' : ''));
                
                container.innerHTML += `
                    <div class="ranking-item">
                        <div class="ranking-position ${posClass}">${index + 1}</div>
                        <div class="ranking-info">
                            <div class="ranking-name">${name.charAt(0).toUpperCase() + name.slice(1)}</div>
                            <div class="ranking-balance">${formatHoldingsNumber(data.current)} XRP</div>
                        </div>
                        <div class="ranking-share">${share.toFixed(1)}%</div>
                    </div>
                `;
            });
        }
        
        function updateChangeCharts(sorted) {
            // Filter to only exchanges with historical data
            const withHistory = sorted.filter(([_, d]) => d.historical > 0).slice(0, 10);
            
            const labels = withHistory.map(([name, _]) => name.charAt(0).toUpperCase() + name.slice(1));
            const absChanges = withHistory.map(([_, d]) => d.change);
            const pctChanges = withHistory.map(([_, d]) => d.changePct);
            
            // Absolute change chart
            const absCtx = document.getElementById('absoluteChangeChart').getContext('2d');
            if (absoluteChangeChart) absoluteChangeChart.destroy();
            
            absoluteChangeChart = new Chart(absCtx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        data: absChanges,
                        backgroundColor: absChanges.map(v => v >= 0 ? 'rgba(34, 197, 94, 0.7)' : 'rgba(239, 68, 68, 0.7)'),
                        borderWidth: 0
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { ticks: { callback: (v) => formatHoldingsNumber(v), color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                        y: { ticks: { color: '#94a3b8' }, grid: { display: false } }
                    }
                }
            });
            
            // Percentage change chart
            const pctCtx = document.getElementById('percentChangeChart').getContext('2d');
            if (percentChangeChart) percentChangeChart.destroy();
            
            percentChangeChart = new Chart(pctCtx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        data: pctChanges,
                        backgroundColor: pctChanges.map(v => v >= 0 ? 'rgba(34, 197, 94, 0.7)' : 'rgba(239, 68, 68, 0.7)'),
                        borderWidth: 0
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { ticks: { callback: (v) => v.toFixed(1) + '%', color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                        y: { ticks: { color: '#94a3b8' }, grid: { display: false } }
                    }
                }
            });
        }
        
        function updateFlowLists(sorted) {
            const withHistory = sorted.filter(([_, d]) => d.historical > 0);
            
            // Top inflows (positive change)
            const inflows = withHistory.filter(([_, d]) => d.change > 0).sort((a, b) => b[1].change - a[1].change).slice(0, 5);
            const inflowsContainer = document.getElementById('topInflows');
            inflowsContainer.innerHTML = inflows.length === 0 
                ? '<div class="flow-item"><span>No inflows detected</span></div>'
                : inflows.map(([name, data]) => `
                    <div class="flow-item">
                        <span class="flow-item-name">${name.charAt(0).toUpperCase() + name.slice(1)}</span>
                        <span class="flow-item-value positive">+${formatHoldingsNumber(data.change)} XRP</span>
                    </div>
                `).join('');
            
            // Top outflows (negative change)
            const outflows = withHistory.filter(([_, d]) => d.change < 0).sort((a, b) => a[1].change - b[1].change).slice(0, 5);
            const outflowsContainer = document.getElementById('topOutflows');
            outflowsContainer.innerHTML = outflows.length === 0
                ? '<div class="flow-item"><span>No outflows detected</span></div>'
                : outflows.map(([name, data]) => `
                    <div class="flow-item">
                        <span class="flow-item-name">${name.charAt(0).toUpperCase() + name.slice(1)}</span>
                        <span class="flow-item-value negative">${formatHoldingsNumber(data.change)} XRP</span>
                    </div>
                `).join('');
        }
        
        function showWalletDetails() {
            const exchange = document.getElementById('walletExchangeSelect').value;
            const tableDiv = document.getElementById('walletDetailsTable');
            const tbody = document.getElementById('walletDetailsBody');
            
            if (!exchange) {
                tableDiv.style.display = 'none';
                return;
            }
            
            tableDiv.style.display = 'block';
            tbody.innerHTML = '';
            
            const wallets = EXCHANGES[exchange] || {};
            const exchangeInfo = exchangeData[exchange] || {};
            const walletData = exchangeInfo.wallets || {};
            
            // Show wallet addresses with current and historical balances
            Object.entries(wallets).forEach(([address, name]) => {
                // Get current balance from fetched data
                const currentWallet = walletData[address];
                const currentBalance = currentWallet ? currentWallet.balance : (walletBalances[address] || null);
                
                // Get historical balance
                const historical = HISTORICAL_BALANCES[address] || 0;
                
                // Calculate change if we have both values
                let changeDisplay = 'N/A';
                let changeClass = '';
                if (currentBalance !== null && historical > 0) {
                    const change = currentBalance - historical;
                    const changePct = (change / historical * 100).toFixed(2);
                    if (change > 0) {
                        changeDisplay = `+${formatHoldingsNumber(change)} (+${changePct}%)`;
                        changeClass = 'style="color: var(--accent-green);"';
                    } else if (change < 0) {
                        changeDisplay = `${formatHoldingsNumber(change)} (${changePct}%)`;
                        changeClass = 'style="color: var(--accent-red);"';
                    } else {
                        changeDisplay = '0 (0%)';
                    }
                } else if (currentBalance !== null && historical === 0) {
                    changeDisplay = 'No historical data';
                }
                
                tbody.innerHTML += `
                    <tr>
                        <td style="color: var(--accent-xrp);">${name}</td>
                        <td style="font-family: 'JetBrains Mono', monospace; font-size: 0.75rem;">
                            <a href="https://xrpscan.com/account/${address}" target="_blank" style="color: var(--text-secondary); text-decoration: none;">
                                ${address.substring(0, 8)}...${address.substring(address.length - 6)}
                            </a>
                        </td>
                        <td style="font-weight: 600;">${currentBalance !== null ? formatHoldingsNumber(currentBalance) : ''}</td>
                        <td>${historical > 0 ? formatHoldingsNumber(historical) : 'N/A'}</td>
                        <td ${changeClass}>${changeDisplay}</td>
                    </tr>
                `;
            });
        }
        
        function generateColors(count) {
            const baseColors = [
                'rgba(35, 247, 221, 0.8)',
                'rgba(168, 85, 247, 0.8)',
                'rgba(59, 130, 246, 0.8)',
                'rgba(34, 197, 94, 0.8)',
                'rgba(249, 115, 22, 0.8)',
                'rgba(236, 72, 153, 0.8)',
                'rgba(234, 179, 8, 0.8)',
                'rgba(139, 92, 246, 0.8)',
                'rgba(20, 184, 166, 0.8)',
                'rgba(244, 63, 94, 0.8)'
            ];
            const colors = [];
            for (let i = 0; i < count; i++) {
                colors.push(baseColors[i % baseColors.length]);
            }
            return colors;
        }
        
        function exportAnalyticsCSV() {
            if (Object.keys(analyticsData).length === 0) {
                alert('No data to export. Please load exchange data first.');
                return;
            }
            
            let csv = 'Exchange,Current Balance (XRP),Historical Balance (XRP),Change (XRP),Change (%),Wallet Count\n';
            
            Object.entries(analyticsData)
                .sort((a, b) => b[1].current - a[1].current)
                .forEach(([name, data]) => {
                    csv += `${name},${data.current},${data.historical},${data.change},${data.changePct.toFixed(2)},${data.walletCount}\n`;
                });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `xrp_exchange_analytics_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        function exportAnalyticsJSON() {
            if (Object.keys(analyticsData).length === 0) {
                alert('No data to export. Please load exchange data first.');
                return;
            }
            
            const exportData = {
                timestamp: new Date().toISOString(),
                historicalBenchmark: HISTORICAL_DATE,
                exchanges: analyticsData
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `xrp_exchange_analytics_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // =====================================================
        // WHALE WATCH FUNCTIONS
        // =====================================================
        
        function setWhaleCount(count) {
            whaleCount = count;
            document.querySelectorAll('.whale-tab').forEach(tab => {
                tab.classList.toggle('active', parseInt(tab.dataset.count) === count);
            });
            document.getElementById('whaleListBadge').textContent = `TOP ${count}`;
            document.getElementById('whaleShowingCount').textContent = count;
            
            // Just re-render from cached full data
            if (whaleDataFull.length > 0) {
                whaleData = whaleDataFull.slice(0, count);
                renderWhaleTable();
            }
        }
        
        async function refreshWhaleData() {
            await fetchWhaleData(true);
        }
        
        async function fetchWhaleData(forceRefresh = false) {
            if (isWhaleFetching) return;
            
            // Try to load from localStorage first
            if (!whaleDataTimestamp && !forceRefresh) {
                const cachedData = loadFromCache(CACHE_KEYS.whaleData);
                const cachedTime = loadFromCache(CACHE_KEYS.whaleTimestamp);
                const cachedRefresh = loadFromCache(CACHE_KEYS.whaleLastRefresh);
                const cachedBurn = loadFromCache(CACHE_KEYS.burnData);
                if (cachedData && cachedTime) {
                    const cacheAge = Date.now() - cachedTime;
                    if (cacheAge < WHALE_CACHE_DURATION) {
                        whaleDataFull = cachedData;
                        whaleDataTimestamp = cachedTime;
                        lastWhaleManualRefresh = cachedRefresh;
                        if (cachedBurn) burnData = cachedBurn;
                        console.log('Loaded whale data from localStorage');
                    }
                }
            }
            
            // Check manual refresh cooldown
            if (forceRefresh && lastWhaleManualRefresh) {
                const cooldownRemaining = WHALE_REFRESH_COOLDOWN - (Date.now() - lastWhaleManualRefresh);
                if (cooldownRemaining > 0) {
                    const mins = Math.ceil(cooldownRemaining / 60000);
                    showToast(`Please wait ${mins} minutes before refreshing Top 10K data`, 'warning');
                    return;
                }
            }
            
            // Use cached data if available and not forcing refresh
            if (!forceRefresh && whaleDataFull.length > 0) {
                whaleData = whaleDataFull.slice(0, whaleCount);
                renderWhaleTable();
                updateWhaleStats();
                if (burnData) updateBurnDisplay();
                return;
            }
            
            isWhaleFetching = true;
            updateStatus('loading', 'Loading Top 10K...');
            
            // Show loading in dashboard
            document.getElementById('dashboardTop10KXRP').textContent = 'Loading...';
            document.getElementById('dashboardWhaleCount').textContent = '...';
            const top10KChangeEl = document.getElementById('dashboardTop10KChange');
            if (top10KChangeEl) {
                top10KChangeEl.innerHTML = `<span style="color: var(--accent-orange);"></span> <span>Fetching 10K wallets...</span>`;
            }
            
            const tbody = document.getElementById('whaleTableBody');
            tbody.innerHTML = `
                <tr>
                    <td colspan="5" class="whale-loading">
                        <div class="spinner"></div>
                        <p>Fetching Top 10,000 XRP accounts from XRPL...</p>
                        <p style="font-size: 0.75rem; color: var(--text-muted);">Running rich list script...</p>
                    </td>
                </tr>
            `;
            
            try {
                // Fetch rich list and burn data from backend API
                const refreshParam = forceRefresh ? '?refresh=true' : '';
                
                const [richListResponse, burnResponse] = await Promise.all([
                    fetch(`${API_URL}/api/richlist${refreshParam}`),
                    fetch(`${API_URL}/api/burn${refreshParam}`)
                ]);
                
                // Process rich list data
                if (richListResponse.ok) {
                    const richListData = await richListResponse.json();
                    
                    if (richListData.accounts && richListData.accounts.length > 0) {
                        whaleDataFull = richListData.accounts.map(acc => ({
                            rank: acc.rank,
                            address: acc.address,
                            balance: acc.balance,
                            name: KNOWN_ADDRESSES[acc.address] || acc.name || 'Unknown'
                        }));
                        
                        // Store stats
                        if (richListData.stats) {
                            whaleStats = richListData.stats;
                        }
                        
                        console.log('Rich list loaded from API:', {
                            accounts: whaleDataFull.length,
                            total: richListData.stats?.total_xrp?.toLocaleString(),
                            cached: richListData.cached
                        });
                    }
                } else {
                    console.warn('Rich list API error, using fallback...');
                    whaleDataFull = await fetchRichListFallback();
                }
                
                // Process burn data
                if (burnResponse.ok) {
                    const burnInfo = await burnResponse.json();
                    // Validate the data - current_supply should be ~99+ billion, not 0
                    if (burnInfo.current_supply && burnInfo.current_supply > 99000000000) {
                        burnData = {
                            currentSupply: burnInfo.current_supply,
                            totalBurned: burnInfo.total_burned,
                            burns: burnInfo.burns,
                            ledgerIndex: burnInfo.ledger_index
                        };
                        console.log('Burn data loaded from API:', burnData);
                    } else {
                        console.warn('Invalid burn data from API, using fallback');
                        burnData = await fetchBurnDataFallback();
                    }
                } else {
                    // Fallback burn data
                    burnData = await fetchBurnDataFallback();
                }
                
                // Set display subset
                whaleData = whaleDataFull.slice(0, whaleCount);
                
                // Save to localStorage
                whaleDataTimestamp = Date.now();
                lastWhaleManualRefresh = Date.now();
                saveToCache(CACHE_KEYS.whaleData, whaleDataFull);
                saveToCache(CACHE_KEYS.whaleTimestamp, whaleDataTimestamp);
                saveToCache(CACHE_KEYS.whaleLastRefresh, lastWhaleManualRefresh);
                saveToCache(CACHE_KEYS.burnData, burnData);
                console.log('Whale data saved to localStorage');
                
                renderWhaleTable();
                updateWhaleStats();
                renderWhaleCharts();
                updateBurnDisplay();
                updateStatus('success', 'Live');
                
            } catch (error) {
                console.error('Whale fetch error:', error);
                
                // Try fallback
                try {
                    whaleDataFull = await fetchRichListFallback();
                    burnData = await fetchBurnDataFallback();
                    whaleData = whaleDataFull.slice(0, whaleCount);
                    
                    // Save fallback to localStorage too
                    whaleDataTimestamp = Date.now();
                    lastWhaleManualRefresh = Date.now();
                    saveToCache(CACHE_KEYS.whaleData, whaleDataFull);
                    saveToCache(CACHE_KEYS.whaleTimestamp, whaleDataTimestamp);
                    saveToCache(CACHE_KEYS.whaleLastRefresh, lastWhaleManualRefresh);
                    saveToCache(CACHE_KEYS.burnData, burnData);
                    
                    renderWhaleTable();
                    updateWhaleStats();
                    renderWhaleCharts();
                    updateBurnDisplay();
                    updateStatus('success', 'Fallback');
                } catch (fallbackError) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="5" class="whale-loading">
                                <p style="color: var(--accent-red);"> Error loading data. Click refresh to try again.</p>
                                <p style="font-size: 0.75rem; color: var(--text-muted);">${error.message}</p>
                            </td>
                        </tr>
                    `;
                    updateStatus('error', 'Error');
                }
            } finally {
                isWhaleFetching = false;
            }
        }
        
        // Store whale stats from API
        let whaleStats = {};
        
        async function fetchFromXRPScan() {
            // This is now handled by the backend API
            return null;
        }
        
        async function fetchBurnDataFallback() {
            try {
                // Try direct XRPScan API as fallback
                const response = await fetch('https://api.xrpscan.com/api/v1/ledgers', {
                    method: 'GET',
                    headers: { 'Accept': 'application/json' }
                });
                
                if (!response.ok) throw new Error('XRPScan unavailable');
                
                const data = await response.json();
                
                const initialSupplyXRP = 100000000000;
                let currentTotalXRP;
                
                if (data.total_coins) {
                    currentTotalXRP = parseFloat(data.total_coins) / 1000000;
                } else {
                    currentTotalXRP = 99985728746;
                }
                
                const totalBurned = initialSupplyXRP - currentTotalXRP;
                
                return {
                    currentSupply: currentTotalXRP,
                    totalBurned: totalBurned,
                    ledgerIndex: data.current_ledger || 0
                };
            } catch (error) {
                console.warn('Burn fallback failed:', error);
                return {
                    currentSupply: 99985728746,
                    totalBurned: 14271254,
                    ledgerIndex: 0
                };
            }
        }
        
        function updateBurnDisplay() {
            if (!burnData) return;
            
            // Update burn stats in the UI
            const burnTotalEl = document.getElementById('burnTotal');
            const supplyEl = document.getElementById('currentSupply');
            
            // Format with commas for readability
            if (burnTotalEl) {
                burnTotalEl.textContent = Math.round(burnData.totalBurned).toLocaleString();
            }
            if (supplyEl) {
                supplyEl.textContent = formatHoldingsNumber(burnData.currentSupply);
            }
            
            // Log burn details including periodic data
            console.log('Burn display updated:', {
                total: burnData.totalBurned?.toLocaleString(),
                supply: burnData.currentSupply?.toLocaleString(),
                burns: burnData.burns
            });
        }
        
        async function fetchRichListFallback() {
            // No fake data - return empty with error message
            console.error('Rich list API failed - no fallback data available');
            showToast('Unable to load Top Holders data. Please try again later.', 'error');
            return [];
        }
        
        function generateRandomAddress() {
            const chars = '123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz';
            let result = '';
            for (let i = 0; i < 33; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }
        
        function renderWhaleTable() {
            const tbody = document.getElementById('whaleTableBody');
            
            if (whaleData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="whale-loading">
                            <p>No data loaded. Click Refresh to load.</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Sort data
            const sorted = [...whaleData].sort((a, b) => {
                let aVal = a[whaleSortColumn];
                let bVal = b[whaleSortColumn];
                if (whaleSortColumn === 'percentage') {
                    aVal = a.balance;
                    bVal = b.balance;
                }
                return whaleSortAsc ? aVal - bVal : bVal - aVal;
            });
            
            // Calculate total for percentage
            const total = whaleData.reduce((sum, w) => sum + w.balance, 0);
            
            tbody.innerHTML = sorted.slice(0, whaleCount).map(whale => {
                const pct = total > 0 ? (whale.balance / total * 100) : 0;
                const isExchange = KNOWN_ADDRESSES[whale.address] && !KNOWN_ADDRESSES[whale.address].includes('Whale');
                const statusClass = isExchange ? 'exchange' : (whale.balance >= 1000000 ? 'whale' : 'unknown');
                const statusText = isExchange ? ' Exchange' : (whale.balance >= 1000000 ? ' Whale' : ' Holder');
                
                return `
                    <tr>
                        <td class="rank ${whale.rank <= 3 ? 'top-3' : ''}">#${whale.rank}</td>
                        <td>
                            <span class="address">${whale.address.substring(0, 8)}...${whale.address.substring(whale.address.length - 6)}</span>
                            <span class="address-name">${whale.name}</span>
                        </td>
                        <td class="balance">${formatHoldingsNumber(whale.balance)}</td>
                        <td class="percentage">${pct.toFixed(2)}%</td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                    </tr>
                `;
            }).join('');
        }
        
        function sortWhaleTable(column) {
            if (whaleSortColumn === column) {
                whaleSortAsc = !whaleSortAsc;
            } else {
                whaleSortColumn = column;
                whaleSortAsc = column === 'rank';
            }
            
            // Update header styles
            document.querySelectorAll('.whale-table th').forEach(th => {
                th.classList.remove('sorted', 'asc');
                if (th.dataset.sort === column) {
                    th.classList.add('sorted');
                    if (whaleSortAsc) th.classList.add('asc');
                }
            });
            
            renderWhaleTable();
        }
        
        function updateWhaleStats() {
            // Use FULL dataset for stats, not just displayed subset
            if (whaleDataFull.length === 0) return;
            
            // Use API stats if available, otherwise calculate
            let total, whaleAccounts, mean, median;
            
            if (whaleStats && whaleStats.total_xrp) {
                // Use stats from API
                total = whaleStats.total_xrp;
                whaleAccounts = whaleStats.whale_count;
                mean = whaleStats.mean_balance;
                median = whaleStats.median_balance;
            } else {
                // Calculate from data
                total = whaleDataFull.reduce((sum, w) => sum + w.balance, 0);
                whaleAccounts = whaleDataFull.filter(w => w.balance >= 1000000).length;
                const balances = whaleDataFull.map(w => w.balance).sort((a, b) => a - b);
                mean = total / whaleDataFull.length;
                median = balances[Math.floor(balances.length / 2)];
            }
            
            document.getElementById('whaleTotalXRP').textContent = formatHoldingsNumber(total);
            document.getElementById('whaleAccountCount').textContent = whaleDataFull.length.toLocaleString();
            document.getElementById('whaleWhaleCount').textContent = whaleAccounts.toLocaleString();
            document.getElementById('whaleMeanBalance').textContent = formatHoldingsNumber(mean);
            document.getElementById('whaleMedianBalance').textContent = formatHoldingsNumber(median);
            
            // Top 10 dominance (from full dataset)
            const top10Total = whaleDataFull.slice(0, 10).reduce((sum, w) => sum + w.balance, 0);
            const top10Pct = total > 0 ? (top10Total / total * 100) : 0;
            document.getElementById('whaleTop10Pct').textContent = top10Pct.toFixed(1) + '%';
            
            // Update concentration bars (from full dataset)
            updateConcentrationBar('concTop1', whaleDataFull[0]?.balance || 0, total);
            updateConcentrationBar('concTop5', whaleDataFull.slice(0, 5).reduce((s, w) => s + w.balance, 0), total);
            updateConcentrationBar('concTop10', top10Total, total);
            updateConcentrationBar('concTop25', whaleDataFull.slice(0, 25).reduce((s, w) => s + w.balance, 0), total);
            
            // Update activity
            updateWhaleActivity();
            
            // Update main dashboard as well
            updateDashboardOverview();
        }
        
        function updateConcentrationBar(id, value, total) {
            const pct = total > 0 ? (value / total * 100) : 0;
            document.getElementById(id).style.width = Math.min(pct, 100) + '%';
            document.getElementById(id + 'Value').textContent = pct.toFixed(1) + '%';
        }
        
        function updateWhaleActivity() {
            const container = document.getElementById('whaleActivity');
            const now = new Date();
            
            container.innerHTML = `
                <div class="activity-item">
                    <span class="activity-icon"></span>
                    <span class="activity-text">10K rich list loaded</span>
                    <span class="activity-time">${now.toLocaleTimeString()}</span>
                </div>
                <div class="activity-item">
                    <span class="activity-icon"></span>
                    <span class="activity-text">${whaleDataFull.filter(w => w.balance >= 100000000).length} accounts with 100M+ XRP</span>
                </div>
                <div class="activity-item">
                    <span class="activity-icon"></span>
                    <span class="activity-text">${whaleDataFull.filter(w => w.balance >= 1000000).length.toLocaleString()} accounts with 1M+ XRP</span>
                </div>
                <div class="activity-item">
                    <span class="activity-icon"></span>
                    <span class="activity-text">${whaleDataFull.filter(w => KNOWN_ADDRESSES[w.address]).length} known exchange wallets</span>
                </div>
            `;
        }
        
        function renderWhaleCharts() {
            // Use FULL dataset for distribution charts
            if (whaleDataFull.length === 0) return;
            
            const ctx = document.getElementById('whaleDistributionChart')?.getContext('2d');
            if (!ctx) return;
            
            if (whaleDistributionChart) {
                whaleDistributionChart.destroy();
            }
            
            // Distribution by size (from full 10K)
            const ranges = [
                { label: '100M+', min: 100000000, count: 0 },
                { label: '50-100M', min: 50000000, max: 100000000, count: 0 },
                { label: '10-50M', min: 10000000, max: 50000000, count: 0 },
                { label: '1-10M', min: 1000000, max: 10000000, count: 0 },
                { label: '<1M', max: 1000000, count: 0 }
            ];
            
            whaleDataFull.forEach(whale => {
                for (const range of ranges) {
                    const aboveMin = !range.min || whale.balance >= range.min;
                    const belowMax = !range.max || whale.balance < range.max;
                    if (aboveMin && belowMax) {
                        range.count++;
                        break;
                    }
                }
            });
            
            whaleDistributionChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ranges.map(r => `${r.label} (${r.count.toLocaleString()})`),
                    datasets: [{
                        data: ranges.map(r => r.count),
                        backgroundColor: [
                            'rgba(168, 85, 247, 0.8)',
                            'rgba(35, 247, 221, 0.8)',
                            'rgba(59, 130, 246, 0.8)',
                            'rgba(34, 197, 94, 0.8)',
                            'rgba(107, 114, 128, 0.8)'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: '#94a3b8', font: { size: 10 } }
                        }
                    }
                }
            });
        }

        // =====================================================
        // PDF REPORT GENERATOR
        // =====================================================
        async function generatePDFReport() {
            const btn = document.querySelector('.btn-generate-report');
            const status = document.getElementById('reportStatus');
            
            btn.disabled = true;
            btn.innerHTML = '<span></span> Generating...';
            status.textContent = 'Creating your report...';
            
            try {
                // Gather all data
                const price = currentXRPPrice || 0;
                const change24h = insightsData.priceChange24h || 0;
                const change7d = insightsData.priceChange7d || 0;
                const change30d = insightsData.priceChange30d || 0;
                const ma7 = insightsData.ma7 || 0;
                const ma30 = insightsData.ma30 || 0;
                const sentiment = insightsData.sentiment || 50;
                
                // Date range
                const today = new Date();
                const weekAgo = new Date(today);
                weekAgo.setDate(weekAgo.getDate() - 7);
                const dateRange = `${weekAgo.toLocaleDateString('en-US', {month: 'short', day: 'numeric'})} - ${today.toLocaleDateString('en-US', {month: 'short', day: 'numeric', year: 'numeric'})}`;
                
                // Generate HTML content for PDF
                const reportHTML = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>XRP Weekly Report - ${dateRange}</title>
                    <style>
                        * { margin: 0; padding: 0; box-sizing: border-box; }
                        body { font-family: 'Segoe UI', Arial, sans-serif; background: #0a0a0f; color: #ffffff; padding: 40px; }
                        .report-container { max-width: 800px; margin: 0 auto; }
                        .header { text-align: center; margin-bottom: 40px; padding-bottom: 20px; border-bottom: 2px solid #23f7dd; }
                        .header h1 { font-size: 2.5rem; color: #23f7dd; margin-bottom: 10px; }
                        .header .date { color: #a0a0c0; font-size: 1.1rem; }
                        .section { background: #16161f; border-radius: 12px; padding: 24px; margin-bottom: 24px; }
                        .section h2 { color: #23f7dd; font-size: 1.3rem; margin-bottom: 16px; display: flex; align-items: center; gap: 10px; }
                        .metrics-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px; }
                        .metric-box { background: #12121a; border-radius: 8px; padding: 16px; text-align: center; }
                        .metric-label { font-size: 0.8rem; color: #707085; margin-bottom: 4px; }
                        .metric-value { font-size: 1.4rem; font-weight: 700; }
                        .metric-value.green { color: #22c55e; }
                        .metric-value.red { color: #ef4444; }
                        .metric-value.cyan { color: #23f7dd; }
                        .analysis-text { line-height: 1.7; color: #a0a0c0; }
                        .levels-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
                        .level-box { background: #12121a; border-radius: 8px; padding: 16px; text-align: center; }
                        .level-box.support { border-left: 3px solid #22c55e; }
                        .level-box.current { border-left: 3px solid #23f7dd; }
                        .level-box.resistance { border-left: 3px solid #ef4444; }
                        .level-label { font-size: 0.8rem; color: #707085; }
                        .level-value { font-size: 1.2rem; font-weight: 700; }
                        .level-box.support .level-value { color: #22c55e; }
                        .level-box.current .level-value { color: #23f7dd; }
                        .level-box.resistance .level-value { color: #ef4444; }
                        .sentiment-bar { height: 12px; background: linear-gradient(90deg, #ef4444, #f97316, #22c55e); border-radius: 6px; position: relative; margin: 16px 0; }
                        .sentiment-marker { position: absolute; top: -4px; width: 20px; height: 20px; background: white; border-radius: 50%; transform: translateX(-50%); }
                        .disclaimer { font-size: 0.75rem; color: #707085; text-align: center; margin-top: 40px; padding-top: 20px; border-top: 1px solid #2a2a3a; }
                        .footer { text-align: center; margin-top: 20px; color: #23f7dd; }
                        @media print { body { background: white; color: black; } .section { border: 1px solid #ddd; } }
                    </style>
                </head>
                <body>
                    <div class="report-container">
                        <div class="header">
                            <h1> XRP Weekly Report</h1>
                            <div class="date">${dateRange}</div>
                        </div>
                        
                        <div class="section">
                            <h2> Executive Summary</h2>
                            <div class="metrics-grid">
                                <div class="metric-box">
                                    <div class="metric-label">Current Price</div>
                                    <div class="metric-value cyan">$${price.toFixed(4)}</div>
                                </div>
                                <div class="metric-box">
                                    <div class="metric-label">24h Change</div>
                                    <div class="metric-value ${change24h >= 0 ? 'green' : 'red'}">${change24h >= 0 ? '+' : ''}${change24h.toFixed(2)}%</div>
                                </div>
                                <div class="metric-box">
                                    <div class="metric-label">7d Change</div>
                                    <div class="metric-value ${change7d >= 0 ? 'green' : 'red'}">${change7d >= 0 ? '+' : ''}${change7d.toFixed(2)}%</div>
                                </div>
                                <div class="metric-box">
                                    <div class="metric-label">30d Change</div>
                                    <div class="metric-value ${change30d >= 0 ? 'green' : 'red'}">${change30d >= 0 ? '+' : ''}${change30d.toFixed(2)}%</div>
                                </div>
                            </div>
                            <p class="analysis-text">
                                XRP ${change7d >= 0 ? 'gained' : 'lost'} ${Math.abs(change7d).toFixed(2)}% over the past week, 
                                ${change7d >= 5 ? 'showing strong bullish momentum' : (change7d <= -5 ? 'experiencing selling pressure' : 'consolidating within a range')}.
                                The price is currently ${price > ma30 ? 'above' : 'below'} the 30-day moving average, 
                                indicating ${price > ma30 ? 'an uptrend' : 'a potential downtrend'}.
                            </p>
                        </div>
                        
                        <div class="section">
                            <h2> Technical Analysis</h2>
                            <div class="levels-grid">
                                <div class="level-box support">
                                    <div class="level-label"> Support</div>
                                    <div class="level-value">$${(Math.min(ma7, ma30) * 0.98).toFixed(2)}</div>
                                </div>
                                <div class="level-box current">
                                    <div class="level-label"> Current</div>
                                    <div class="level-value">$${price.toFixed(4)}</div>
                                </div>
                                <div class="level-box resistance">
                                    <div class="level-label"> Resistance</div>
                                    <div class="level-value">$${(price * 1.15).toFixed(2)}</div>
                                </div>
                            </div>
                            <br>
                            <p class="analysis-text">
                                <strong>Moving Averages:</strong><br>
                                 7-Day MA: $${ma7.toFixed(4)} (Price ${price > ma7 ? 'Above ' : 'Below '})<br>
                                 30-Day MA: $${ma30.toFixed(4)} (Price ${price > ma30 ? 'Above ' : 'Below '})<br><br>
                                <strong>Signal:</strong> ${(price > ma7 && price > ma30) ? ' BULLISH - Price above all MAs' : ((price < ma7 && price < ma30) ? ' BEARISH - Price below all MAs' : ' NEUTRAL - Mixed signals')}
                            </p>
                        </div>
                        
                        <div class="section">
                            <h2> Market Sentiment</h2>
                            <div class="sentiment-bar">
                                <div class="sentiment-marker" style="left: ${sentiment}%;"></div>
                            </div>
                            <p style="text-align: center; font-size: 1.2rem; margin-bottom: 16px;">
                                <strong>${sentiment >= 65 ? ' Bullish' : (sentiment >= 45 ? ' Neutral' : ' Bearish')}</strong> (${sentiment}/100)
                            </p>
                            <p class="analysis-text">
                                ${sentiment >= 65 ? 
                                    'Market sentiment is bullish with positive momentum indicators. Institutional interest remains strong as ETF inflows continue.' :
                                    (sentiment >= 45 ? 
                                        'Market is in a consolidation phase with neutral sentiment. Watch for a breakout above resistance or breakdown below support.' :
                                        'Bearish sentiment prevails with selling pressure. Consider waiting for clearer bullish signals before adding positions.'
                                    )
                                }
                            </p>
                        </div>
                        
                        <div class="section">
                            <h2> AI Outlook</h2>
                            <p class="analysis-text">
                                <strong>Short-term (1-2 weeks):</strong><br>
                                ${sentiment >= 60 ? 
                                    `Bullish bias with potential upside to $${(price * 1.15).toFixed(2)}. Key support at $${ma7.toFixed(4)} (7-day MA).` :
                                    `Cautious outlook. Watch for price to reclaim $${ma30.toFixed(4)} (30-day MA) for bullish confirmation.`
                                }<br><br>
                                <strong>Key Levels to Watch:</strong><br>
                                 Breakout target: $${(price * 1.20).toFixed(2)}<br>
                                 Support to hold: $${(Math.min(ma7, ma30) * 0.95).toFixed(2)}<br><br>
                                <strong>Risk Management:</strong><br>
                                Consider stop-loss below $${(Math.min(ma7, ma30) * 0.92).toFixed(2)} for risk management.
                            </p>
                        </div>
                        
                        <div class="disclaimer">
                             This report is for informational purposes only and does not constitute financial advice. 
                            Always do your own research before making investment decisions.
                        </div>
                        
                        <div class="footer">
                            Generated by XRP ETF Tracker  @chachakobe4er
                        </div>
                    </div>
                </body>
                </html>`;
                
                // Create and download
                const blob = new Blob([reportHTML], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `XRP_Weekly_Report_${today.toISOString().split('T')[0]}.html`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                status.innerHTML = ' Report downloaded! Open in browser and print to PDF.';
                btn.innerHTML = '<span></span> Generate PDF Report';
                btn.disabled = false;
                
            } catch (error) {
                console.error('Report generation error:', error);
                status.textContent = ' Error generating report';
                btn.innerHTML = '<span></span> Generate PDF Report';
                btn.disabled = false;
            }
        }

        // Auto-connect on page load
        window.addEventListener('DOMContentLoaded', () => {
            // Initialize language support
            initLanguage();
            
            fetchXRPPrice();
            fetchData();
            startAutoRefresh();
            
            // Load saved portfolio
            loadPortfolio();
            
            // Update report date range
            const today = new Date();
            const weekAgo = new Date(today);
            weekAgo.setDate(weekAgo.getDate() - 7);
            const reportDateEl = document.getElementById('reportDateRange');
            if (reportDateEl) {
                reportDateEl.textContent = `${weekAgo.toLocaleDateString('en-US', {month: 'short', day: 'numeric'})} - ${today.toLocaleDateString('en-US', {month: 'short', day: 'numeric', year: 'numeric'})}`;
            }
            
            // Initialize dashboard overview after a delay
            setTimeout(() => {
                updateDashboardOverview();
            }, 1000);
            
            // Auto pre-fetch exchange data in background after 3 seconds
            setTimeout(() => {
                if (Object.keys(exchangeData).length === 0 && !isExchangeFetching) {
                    console.log('Pre-fetching exchange data in background...');
                    fetchExchangeData();
                }
            }, 3000);
            
            // Auto pre-fetch Top 10K data in background after 5 seconds
            setTimeout(() => {
                if (whaleDataFull.length === 0 && !isWhaleFetching) {
                    console.log('Pre-fetching Top 10K data in background...');
                    fetchWhaleData();
                }
            }, 5000);
            
            // Update XRP price every 10 seconds
            setInterval(() => {
                fetchXRPPrice();
                updateDashboardOverview();
            }, 10000);
            
            // Schedule daily auto-refresh at 3 PM PST (23:00 UTC)
            scheduleDaily3PMRefresh();
            
            // Also check every minute if it's time to refresh
            setInterval(checkScheduledRefresh, 60000);

            // Show popup after 5 seconds if not recently closed
            if (shouldShowPopup()) {
                setTimeout(() => {
                    showPopup();
                }, 5000);
            }
        });
        
        // Schedule daily refresh at 3 PM PST
        let lastScheduledRefresh = null;
        
        function scheduleDaily3PMRefresh() {
            const now = new Date();
            
            // Calculate next 3 PM PST (UTC-8)
            // 3 PM PST = 23:00 UTC (or 22:00 UTC during daylight saving)
            const pstOffset = -8; // PST is UTC-8
            const targetHourUTC = 15 - pstOffset; // 3 PM PST in UTC = 23:00
            
            let next3PM = new Date(now);
            next3PM.setUTCHours(targetHourUTC, 0, 0, 0);
            
            // If we've passed 3 PM today, schedule for tomorrow
            if (now > next3PM) {
                next3PM.setDate(next3PM.getDate() + 1);
            }
            
            const msUntil3PM = next3PM - now;
            
            console.log(`Next scheduled refresh at 3 PM PST: ${next3PM.toLocaleString()}`);
            console.log(`Time until refresh: ${Math.round(msUntil3PM / 1000 / 60)} minutes`);
            
            // Schedule the refresh
            setTimeout(() => {
                performScheduledRefresh();
                // Schedule next day's refresh
                scheduleDaily3PMRefresh();
            }, msUntil3PM);
        }
        
        function checkScheduledRefresh() {
            const now = new Date();
            const hour = now.getHours();
            const minute = now.getMinutes();
            
            // Check if it's around 3 PM local time (allow 1 minute window)
            // This is a backup check in case the setTimeout drifts
            const today = now.toDateString();
            
            // Convert 3 PM PST to local time
            const pstOffset = -8;
            const localOffset = -now.getTimezoneOffset() / 60;
            const targetHourLocal = 15 + (localOffset - pstOffset);
            
            if (hour === Math.floor(targetHourLocal) && minute === 0 && lastScheduledRefresh !== today) {
                console.log('Backup scheduled refresh triggered');
                performScheduledRefresh();
            }
        }
        
        function performScheduledRefresh() {
            const today = new Date().toDateString();
            
            // Prevent multiple refreshes on same day
            if (lastScheduledRefresh === today) {
                console.log('Already refreshed today, skipping');
                return;
            }
            
            lastScheduledRefresh = today;
            
            console.log(' Performing scheduled 3 PM PST refresh...');
            
            // Show notification
            showRefreshNotification();
            
            // Refresh exchange data
            if (!isExchangeFetching) {
                console.log('Refreshing exchange data...');
                fetchExchangeData(true);
            }
            
            // Refresh Top 10K data
            if (!isWhaleFetching) {
                console.log('Refreshing Top 10K data...');
                fetchWhaleData(true);
            }
        }
        
        function showRefreshNotification() {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--bg-card);
                border: 1px solid var(--accent-xrp);
                border-radius: 12px;
                padding: 1rem 1.5rem;
                z-index: 10000;
                display: flex;
                align-items: center;
                gap: 0.75rem;
                box-shadow: 0 10px 40px rgba(0,0,0,0.5);
                animation: slideIn 0.3s ease;
            `;
            notification.innerHTML = `
                <span style="font-size: 1.5rem;"></span>
                <div>
                    <div style="font-weight: 600; color: var(--text-primary);">Scheduled Refresh</div>
                    <div style="font-size: 0.85rem; color: var(--text-muted);">Updating Exchange & Top 10K data...</div>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Remove after 5 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease forwards';
                setTimeout(() => notification.remove(), 300);
            }, 5000);
        }

        // ============================================
        // ANIMATED PRICE TICKER
        // ============================================
        
        let tickerCache = []; // Cache successful data
        
        async function updateTicker() {
            const track = document.getElementById('tickerTrack');
            if (!track) return;
            
            try {
                // Fetch top crypto prices from CoinGecko
                const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=ripple,bitcoin,ethereum,solana,cardano,dogecoin,polkadot,avalanche-2,chainlink,polygon&vs_currencies=usd&include_24hr_change=true');
                
                if (!response.ok) throw new Error('API rate limited');
                
                const data = await response.json();
                
                // Check if we got valid data (not an error response)
                if (data.error || !data.ripple) {
                    throw new Error('Invalid API response');
                }
                
                const cryptoMap = {
                    ripple: 'XRP',
                    bitcoin: 'BTC',
                    ethereum: 'ETH',
                    solana: 'SOL',
                    cardano: 'ADA',
                    dogecoin: 'DOGE',
                    polkadot: 'DOT',
                    'avalanche-2': 'AVAX',
                    chainlink: 'LINK',
                    polygon: 'MATIC'
                };
                
                const items = [];
                
                for (const [id, symbol] of Object.entries(cryptoMap)) {
                    if (data[id] && data[id].usd) {
                        items.push({
                            symbol: symbol,
                            price: data[id].usd,
                            change: data[id].usd_24h_change || 0
                        });
                    }
                }
                
                if (items.length > 0) {
                    tickerCache = items; // Cache successful data
                    renderTicker(items);
                }
                
            } catch (error) {
                console.log('Ticker API error (using cached data):', error.message);
                // Use cached data if available
                if (tickerCache.length > 0) {
                    renderTicker(tickerCache);
                } else {
                    // First load fallback - show loading message
                    track.innerHTML = '<div class="ticker-item"><span class="ticker-symbol">Loading crypto prices...</span></div>'.repeat(3);
                }
            }
        }
        
        function renderTicker(items) {
            const track = document.getElementById('tickerTrack');
            if (!track || items.length === 0) return;
            
            let html = '';
            for (let repeat = 0; repeat < 3; repeat++) {
                items.forEach(item => {
                    const changeClass = item.change >= 0 ? 'positive' : 'negative';
                    const changeSign = item.change >= 0 ? '+' : '';
                    const price = item.price >= 100 
                        ? '$' + item.price.toLocaleString('en-US', {maximumFractionDigits: 2})
                        : item.price >= 1
                        ? '$' + item.price.toFixed(2)
                        : '$' + item.price.toFixed(4);
                    
                    html += `
                        <div class="ticker-item">
                            <span class="ticker-symbol">${item.symbol}</span>
                            <span class="ticker-price">${price}</span>
                            <span class="ticker-change ${changeClass}">${changeSign}${item.change.toFixed(2)}%</span>
                        </div>
                        <span class="ticker-divider">|</span>
                    `;
                });
            }
            track.innerHTML = html;
        }
        
        // Initial update
        updateTicker();
        // Update every 2 minutes (CoinGecko free tier: 10-30 calls/min)
        setInterval(updateTicker, 120000);

        // ============================================
        // XRP LEDGER DATA
        // ============================================
        
        let xrplData = null;
        
        async function fetchXRPLData() {
            const statusText = document.getElementById('xrplStatusText');
            
            try {
                statusText.textContent = 'Fetching...';
                
                // Use public XRPL WebSocket/JSON-RPC endpoints
                const xrplServer = 'https://xrplcluster.com';
                
                // Fetch current ledger info
                const ledgerResponse = await fetch(xrplServer, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        method: 'ledger',
                        params: [{ ledger_index: 'validated', transactions: true, expand: false }]
                    })
                });
                
                const ledgerData = await ledgerResponse.json();
                
                // Fetch server info for more stats
                const serverResponse = await fetch(xrplServer, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        method: 'server_info',
                        params: [{}]
                    })
                });
                
                const serverData = await serverResponse.json();
                
                // Fetch recent transactions
                const txResponse = await fetch(xrplServer, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        method: 'ledger',
                        params: [{ ledger_index: 'validated', transactions: true, expand: true }]
                    })
                });
                
                const txData = await txResponse.json();
                
                xrplData = {
                    ledger: ledgerData.result?.ledger,
                    server: serverData.result?.info,
                    transactions: txData.result?.ledger?.transactions || []
                };
                
                updateXRPLDisplay();
                statusText.textContent = 'Live';
                
            } catch (error) {
                console.error('XRPL fetch error:', error);
                statusText.textContent = 'Retrying...';
                
                // Try backup endpoint
                try {
                    await fetchXRPLDataBackup();
                    statusText.textContent = 'Live (backup)';
                } catch (backupError) {
                    console.error('Backup also failed:', backupError);
                    statusText.textContent = 'Connection error';
                }
            }
        }
        
        async function fetchXRPLDataBackup() {
            // Try s1.ripple.com as backup
            const xrplServer = 'https://s1.ripple.com:51234';
            
            const ledgerResponse = await fetch(xrplServer, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    method: 'ledger',
                    params: [{ ledger_index: 'validated', transactions: true, expand: true }]
                })
            });
            
            const ledgerData = await ledgerResponse.json();
            
            const serverResponse = await fetch(xrplServer, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    method: 'server_info',
                    params: [{}]
                })
            });
            
            const serverData = await serverResponse.json();
            
            xrplData = {
                ledger: ledgerData.result?.ledger,
                server: serverData.result?.info,
                transactions: ledgerData.result?.ledger?.transactions || []
            };
            
            updateXRPLDisplay();
        }
        
        async function updateXRPLDisplay() {
            if (!xrplData) return;
            
            const ledger = xrplData.ledger;
            const server = xrplData.server;
            
            // Update XRP Price (use global currentXRPPrice or fetch it)
            const xrpPriceEl = document.getElementById('xrplXrpPrice');
            if (xrpPriceEl) {
                if (currentXRPPrice && currentXRPPrice > 0) {
                    xrpPriceEl.textContent = '$' + currentXRPPrice.toFixed(2);
                } else {
                    // Try to fetch price directly
                    xrpPriceEl.textContent = 'Loading...';
                    try {
                        const priceResponse = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=ripple&vs_currencies=usd');
                        const priceData = await priceResponse.json();
                        if (priceData.ripple?.usd) {
                            currentXRPPrice = priceData.ripple.usd;
                            xrpPriceEl.textContent = '$' + currentXRPPrice.toFixed(2);
                        } else {
                            // Try Binance as backup
                            const binanceRes = await fetch('https://api.binance.com/api/v3/ticker/price?symbol=XRPUSDT');
                            const binanceData = await binanceRes.json();
                            if (binanceData.price) {
                                currentXRPPrice = parseFloat(binanceData.price);
                                xrpPriceEl.textContent = '$' + currentXRPPrice.toFixed(2);
                            } else {
                                xrpPriceEl.textContent = '--';
                            }
                        }
                    } catch (e) {
                        console.error('Failed to fetch XRP price:', e);
                        xrpPriceEl.textContent = '--';
                    }
                }
            }
            
            // Update Ledger Index
            const ledgerIndex = document.getElementById('xrplLedgerIndex');
            if (ledgerIndex && ledger?.ledger_index) {
                ledgerIndex.textContent = parseInt(ledger.ledger_index).toLocaleString();
            }
            
            // Update Successful Payments (count Payment type transactions)
            const successPayments = document.getElementById('xrplSuccessPayments');
            if (successPayments) {
                const transactions = xrplData.transactions || [];
                // Count payments - check both expanded and non-expanded formats
                const payments = transactions.filter(tx => {
                    const txType = tx.TransactionType || tx.tx?.TransactionType;
                    const result = tx.meta?.TransactionResult || tx.metaData?.TransactionResult || 'tesSUCCESS';
                    return txType === 'Payment' && result === 'tesSUCCESS';
                });
                // Estimate daily successful payments (~24,600 ledgers/day)
                const ledgersPerDay = 24600;
                const estimatedDailyPayments = Math.round(payments.length * ledgersPerDay);
                if (payments.length > 0) {
                    successPayments.textContent = estimatedDailyPayments.toLocaleString();
                } else {
                    // Fallback: estimate based on total tx count (typically ~35% are payments)
                    const totalTx = transactions.length;
                    const estimatedPayments = Math.round(totalTx * 0.35 * ledgersPerDay);
                    successPayments.textContent = estimatedPayments > 0 ? estimatedPayments.toLocaleString() : '--';
                }
            }
            
            // Update Transaction Count (from current ledger)
            const txCount = document.getElementById('xrplTxCount');
            if (txCount) {
                const txInLedger = xrplData.transactions?.length || ledger?.transactions?.length || 0;
                // Estimate daily: ~24,600 ledgers per day
                const ledgersPerDay = 24600;
                const estimatedDaily = Math.round(txInLedger * ledgersPerDay);
                txCount.textContent = estimatedDaily > 0 ? estimatedDaily.toLocaleString() : (txInLedger + ' in ledger');
            }
            
            // Update Accounts Created (estimate from ledger data)
            const accounts = document.getElementById('xrplAccounts');
            if (accounts) {
                const transactions = xrplData.transactions || [];
                const accountCreates = transactions.filter(tx => {
                    const nodes = tx.meta?.AffectedNodes || tx.metaData?.AffectedNodes || [];
                    return nodes.some(n => n.CreatedNode?.LedgerEntryType === 'AccountRoot');
                });
                // Estimate daily account creations
                const ledgersPerDay = 24600;
                const estimatedDailyAccounts = Math.round(accountCreates.length * ledgersPerDay);
                accounts.textContent = estimatedDailyAccounts > 0 ? estimatedDailyAccounts.toLocaleString() : '~2,500/day';
            }
            
            // Update Ledger Interval (Close Time)
            const closeTime = document.getElementById('xrplCloseTime');
            if (closeTime && server?.validated_ledger) {
                const avgCloseTime = server.validated_ledger.close_time_resolution || 4;
                closeTime.textContent = avgCloseTime + ' sec';
            } else if (closeTime) {
                closeTime.textContent = '3-4 sec';
            }
            
            // Update TPS (Transactions Per Second)
            const tps = document.getElementById('xrplTPS');
            if (tps) {
                const txInLedger = xrplData.transactions?.length || 0;
                const avgLedgerTime = 3.5; // Average ledger close time in seconds
                const tpsValue = txInLedger / avgLedgerTime;
                tps.textContent = tpsValue.toFixed(2) + ' tx/s';
            }
            
            // Update Total XRP Burned (from ledger total_coins)
            const burnedTotal = document.getElementById('xrplBurnedTotal');
            if (burnedTotal && ledger?.total_coins) {
                const currentSupply = parseInt(ledger.total_coins) / 1000000;
                const initialSupply = 100000000000;
                const totalBurned = initialSupply - currentSupply;
                burnedTotal.textContent = totalBurned.toLocaleString(undefined, {maximumFractionDigits: 2}) + ' XRP';
            }
            
            // Render transactions
            renderXRPLTransactions();
        }
        
        function renderXRPLTransactions() {
            const txList = document.getElementById('xrplTxList');
            if (!txList) return;
            
            const transactions = xrplData?.transactions || [];
            
            if (transactions.length === 0) {
                txList.innerHTML = `
                    <div class="xrpl-tx-item">
                        <span class="xrpl-tx-type other">--</span>
                        <span class="xrpl-tx-hash">No transactions in current ledger</span>
                        <span class="xrpl-tx-amount">--</span>
                        <span class="xrpl-tx-time">--</span>
                        <span></span>
                    </div>
                `;
                return;
            }
            
            // Get up to 10 most recent transactions
            const recentTx = transactions.slice(0, 10);
            
            txList.innerHTML = recentTx.map(tx => {
                // Handle both expanded and non-expanded formats
                const txData = tx.tx || tx;
                const type = txData.TransactionType || 'Unknown';
                const typeClass = getTransactionTypeClass(type);
                const hash = tx.hash || txData.hash || '';
                const shortHash = hash ? (hash.substring(0, 8) + '...' + hash.substring(hash.length - 6)) : '--';
                
                // Parse amount
                let amount = '--';
                if (txData.Amount) {
                    if (typeof txData.Amount === 'string') {
                        const xrpAmount = parseInt(txData.Amount) / 1000000;
                        if (xrpAmount > 0.001) {
                            amount = xrpAmount >= 1000 
                                ? (xrpAmount / 1000).toFixed(1) + 'K XRP'
                                : xrpAmount.toFixed(2) + ' XRP';
                        }
                    } else if (txData.Amount.value) {
                        amount = parseFloat(txData.Amount.value).toFixed(2) + ' ' + (txData.Amount.currency || '');
                    }
                }
                
                // Parse time
                let timeAgo = 'now';
                if (txData.date) {
                    // XRPL epoch starts Jan 1, 2000
                    const xrplEpoch = 946684800;
                    const timestamp = (txData.date + xrplEpoch) * 1000;
                    timeAgo = getXRPLTimeAgo(timestamp);
                }
                
                return `
                    <div class="xrpl-tx-item">
                        <span class="xrpl-tx-type ${typeClass}">${formatTxType(type)}</span>
                        <span class="xrpl-tx-hash">${shortHash}</span>
                        <span class="xrpl-tx-amount">${amount}</span>
                        <span class="xrpl-tx-time">${timeAgo}</span>
                        <a href="https://xrpscan.com/tx/${hash}" target="_blank" class="xrpl-tx-link" title="View on XRPScan"></a>
                    </div>
                `;
            }).join('');
        }
        
        function getTransactionTypeClass(type) {
            const typeMap = {
                'Payment': 'payment',
                'OfferCreate': 'offer',
                'OfferCancel': 'offer',
                'TrustSet': 'trust',
                'EscrowCreate': 'escrow',
                'EscrowFinish': 'escrow',
                'EscrowCancel': 'escrow',
                'NFTokenMint': 'nftoken',
                'NFTokenBurn': 'nftoken',
                'NFTokenAcceptOffer': 'nftoken',
                'NFTokenCreateOffer': 'nftoken',
                'NFTokenCancelOffer': 'nftoken',
                'AMMCreate': 'amm',
                'AMMDeposit': 'amm',
                'AMMWithdraw': 'amm',
                'AMMBid': 'amm',
                'AMMVote': 'amm',
                'AccountSet': 'other',
                'AccountDelete': 'other',
                'SetRegularKey': 'other',
                'SignerListSet': 'other'
            };
            return typeMap[type] || 'other';
        }
        
        function formatTxType(type) {
            const typeLabels = {
                'Payment': 'Payment',
                'OfferCreate': 'DEX Order',
                'OfferCancel': 'Cancel',
                'TrustSet': 'TrustLine',
                'EscrowCreate': 'Escrow',
                'EscrowFinish': 'Escrow ',
                'EscrowCancel': 'Escrow ',
                'NFTokenMint': 'NFT Mint',
                'NFTokenBurn': 'NFT Burn',
                'NFTokenAcceptOffer': 'NFT Sale',
                'NFTokenCreateOffer': 'NFT Offer',
                'AMMCreate': 'AMM New',
                'AMMDeposit': 'AMM +',
                'AMMWithdraw': 'AMM -',
                'AccountSet': 'Settings',
                'AccountDelete': 'Delete'
            };
            return typeLabels[type] || type.replace(/([A-Z])/g, ' $1').trim().substring(0, 10);
        }
        
        function getXRPLTimeAgo(timestamp) {
            const seconds = Math.floor((Date.now() - timestamp) / 1000);
            if (seconds < 0) return 'just now';
            if (seconds < 60) return seconds + 's ago';
            if (seconds < 3600) return Math.floor(seconds / 60) + 'm ago';
            if (seconds < 86400) return Math.floor(seconds / 3600) + 'h ago';
            return Math.floor(seconds / 86400) + 'd ago';
        }
        
        function refreshXRPLData() {
            fetchXRPLData();
        }
        
        // Initialize XRPL data
        setTimeout(fetchXRPLData, 1500);
        // Refresh every 15 seconds for near real-time data
        setInterval(fetchXRPLData, 15000);
    </script>
</body>
</html>
